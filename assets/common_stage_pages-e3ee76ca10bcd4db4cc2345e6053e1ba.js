!(function (e) {
  e.fn.noUiSlider = function (t, n) {
    function i(e, t, n) {
      "function" == typeof e && e.call(t, n);
    }
    function r(e, t, n) {
      var i = t.data("setup"),
        r = i.handles,
        s = i.settings,
        o = i.pos;
      if (((e = 0 > e ? 0 : e > 100 ? 100 : e), 2 == s.handles))
        if (n.is(":first-child")) {
          var l = parseFloat(r[1][0].style[o]) - s.margin;
          e = e > l ? l : e;
        } else {
          var l = parseFloat(r[0][0].style[o]) + s.margin;
          e = l > e ? l : e;
        }
      if (s.step) {
        var c = a.from(s.range, s.step);
        e = Math.round(e / c) * c;
      }
      return e;
    }
    function s(e) {
      try {
        return [
          e.clientX ||
            e.originalEvent.clientX ||
            e.originalEvent.touches[0].clientX,
          e.clientY ||
            e.originalEvent.clientY ||
            e.originalEvent.touches[0].clientY,
        ];
      } catch (t) {
        return ["x", "y"];
      }
    }
    function o(e, t) {
      return parseFloat(e[0].style[t]);
    }
    var a = {
        to: function (e, t) {
          return (
            (t = e[0] < 0 ? t + Math.abs(e[0]) : t - e[0]),
            (100 * t) / this._length(e)
          );
        },
        from: function (e, t) {
          return (100 * t) / this._length(e);
        },
        is: function (e, t) {
          return (t * this._length(e)) / 100 + e[0];
        },
        _length: function (e) {
          return e[0] > e[1] ? e[0] - e[1] : e[1] - e[0];
        },
      },
      l = {
        handles: 2,
        serialization: {
          to: ["", ""],
          resolution: 0.01,
        },
      };
    methods = {
      create: function () {
        return this.each(function () {
          function n(e, t) {
            e.css(c, t + "%")
              .data("input")
              .val(a.is(d.range, t).toFixed(v));
          }
          var c,
            u,
            d = e.extend(l, t),
            h = "<a><div></div></a>",
            p = e(this).data("_isnS_", !0),
            f = [],
            m = "",
            g = function (e) {
              return !isNaN(parseFloat(e)) && isFinite(e);
            },
            _ = (d.serialization.resolution =
              d.serialization.resolution || 0.01)
              .toString()
              .split("."),
            v = 1 == _[0] ? 0 : _[1].length;
          (d.start = g(d.start) ? [d.start, 0] : d.start),
            e.each(d, function (e, t) {
              g(t)
                ? (d[e] = parseFloat(t))
                : "object" == typeof t &&
                  g(t[0]) &&
                  ((t[0] = parseFloat(t[0])),
                  g(t[1]) && (t[1] = parseFloat(t[1])));
              var n = !1;
              switch (((t = "undefined" == typeof t ? "x" : t), e)) {
                case "range":
                case "start":
                  n = 2 != t.length || !g(t[0]) || !g(t[1]);
                  break;
                case "handles":
                  n = 1 > t || t > 2 || !g(t);
                  break;
                case "connect":
                  n = "lower" != t && "upper" != t && "boolean" != typeof t;
                  break;
                case "orientation":
                  n = "vertical" != t && "horizontal" != t;
                  break;
                case "margin":
                case "step":
                  n = "undefined" != typeof t && !g(t);
                  break;
                case "serialization":
                  n =
                    "object" != typeof t ||
                    !g(t.resolution) ||
                    ("object" == typeof t.to && t.to.length < d.handles);
                  break;
                case "slide":
                  n = "function" != typeof t;
              }
              n &&
                console &&
                console.error("Bad input for " + e + " on slider:", p);
            }),
            (d.margin = d.margin ? a.from(d.range, d.margin) : 0),
            (d.serialization.to instanceof jQuery ||
              "string" == typeof d.serialization.to ||
              d.serialization.to === !1) &&
              (d.serialization.to = [d.serialization.to]),
            "vertical" == d.orientation
              ? ((m += "vertical"), (c = "top"), (u = 1))
              : ((m += "horizontal"), (c = "left"), (u = 0)),
            (m += d.connect
              ? "lower" == d.connect
                ? " connect lower"
                : " connect"
              : ""),
            p.addClass(m);
          for (var y = 0; y < d.handles; y++) {
            f[y] = p.append(h).children(":last");
            var b = a.to(d.range, d.start[y]);
            f[y].css(c, b + "%"),
              100 == b && f[y].is(":first-child") && f[y].css("z-index", 2);
            var w = ".noUiSlider",
              C =
                "mousedown" +
                w +
                "X MSPointerDown" +
                w +
                "X touchstart" +
                w +
                "X",
              k = "mousemove" + w + " MSPointerMove" + w + " touchmove" + w,
              T = "mouseup" + w + " MSPointerUp" + w + " touchend" + w;
            f[y]
              .find("div")
              .on(C, function (t) {
                if (
                  (e("body").bind("selectstart" + w, function () {
                    return !1;
                  }),
                  !p.hasClass("disabled"))
                ) {
                  e("body").addClass("TOUCH");
                  var n = e(this).addClass("active").parent(),
                    o = n.add(e(document)).add("body"),
                    l = parseFloat(n[0].style[c]),
                    h = s(t),
                    m = h,
                    g = !1;
                  e(document)
                    .on(k, function (e) {
                      e.preventDefault();
                      var t = s(e);
                      if ("x" != t[0]) {
                        (t[0] -= h[0]), (t[1] -= h[1]);
                        var o = [m[0] != t[0], m[1] != t[1]],
                          _ = l + (100 * t[u]) / (u ? p.height() : p.width());
                        (_ = r(_, p, n)),
                          o[u] &&
                            _ != g &&
                            (n
                              .css(c, _ + "%")
                              .data("input")
                              .val(a.is(d.range, _).toFixed(v)),
                            i(d.slide, p.data("_n", !0)),
                            (g = _),
                            n.css(
                              "z-index",
                              2 == f.length && 100 == _ && n.is(":first-child")
                                ? 2
                                : 1
                            )),
                          (m = t);
                      }
                    })
                    .on(T, function () {
                      o.off(w),
                        e("body").removeClass("TOUCH"),
                        p
                          .find(".active")
                          .removeClass("active")
                          .end()
                          .data("_n") && p.data("_n", !1).change();
                    });
                }
              })
              .on("click", function (e) {
                e.stopPropagation();
              });
          }
          p.on("click", function (e) {
            if (!p.hasClass("disabled")) {
              var t = s(e),
                o =
                  (100 * (t[u] - p.offset()[c])) / (u ? p.height() : p.width()),
                a =
                  f.length > 1
                    ? t[u] < (f[0].offset()[c] + f[1].offset()[c]) / 2
                      ? f[0]
                      : f[1]
                    : f[0];
              n(a, r(o, p, a), p), i(d.slide, p), p.change();
            }
          });
          for (var y = 0; y < f.length; y++) {
            var S = a.is(d.range, o(f[y], c)).toFixed(v);
            "string" == typeof d.serialization.to[y]
              ? f[y].data(
                  "input",
                  p
                    .append(
                      '<input type="hidden" name="' +
                        d.serialization.to[y] +
                        '">'
                    )
                    .find("input:last")
                    .val(S)
                    .change(function (e) {
                      e.stopPropagation();
                    })
                )
              : 0 == d.serialization.to[y]
              ? f[y].data("input", {
                  val: function (e) {
                    return "undefined" == typeof e
                      ? this.handle.data("noUiVal")
                      : void this.handle.data("noUiVal", e);
                  },
                  handle: f[y],
                })
              : f[y].data(
                  "input",
                  d.serialization.to[y]
                    .data("handleNR", y)
                    .val(S)
                    .change(function () {
                      var t = [null, null];
                      (t[e(this).data("handleNR")] = e(this).val()), p.val(t);
                    })
                );
          }
          e(this).data("setup", {
            settings: d,
            handles: f,
            pos: c,
            res: v,
          });
        });
      },
      val: function () {
        if ("undefined" != typeof arguments[0]) {
          var t =
            "number" == typeof arguments[0] ? [arguments[0]] : arguments[0];
          return this.each(function () {
            for (
              var n = e(this).data("setup"), i = 0;
              i < n.handles.length;
              i++
            )
              if (null != t[i]) {
                var s = r(a.to(n.settings.range, t[i]), e(this), n.handles[i]);
                n.handles[i]
                  .css(n.pos, s + "%")
                  .data("input")
                  .val(a.is(n.settings.range, s).toFixed(n.res));
              }
          });
        }
        for (
          var n = e(this).data("setup").handles, i = [], s = 0;
          s < n.length;
          s++
        )
          i.push(parseFloat(n[s].data("input").val()));
        return 1 == i.length ? i[0] : i;
      },
      disabled: function () {
        return n
          ? e(this).addClass("disabled")
          : e(this).removeClass("disabled");
      },
    };
    var c = jQuery.fn.val;
    return (
      (jQuery.fn.val = function () {
        return this.data("_isnS_")
          ? methods.val.apply(this, arguments)
          : c.apply(this, arguments);
      }),
      "disabled" == t
        ? methods.disabled.apply(this)
        : methods.create.apply(this)
    );
  };
})(jQuery);
var CROP = (function () {
  return function () {
    var e = 40,
      t = 10,
      n = 7500;
    (this.eles = {
      ele: void 0,
      container: void 0,
      img: void 0,
      overlay: void 0,
      slider: void 0,
      topLine: void 0,
      rightLine: void 0,
      bottomLine: void 0,
      leftLine: void 0,
    }),
      (this.img = void 0),
      (this.imgInfo = {
        aw: 0,
        ah: 0,
        w: 0,
        h: 0,
        at: 0,
        al: 0,
        t: 0,
        l: 0,
        s: 1,
      }),
      (this.stageInfo = Helpers.StageType.getStageInfo()),
      (this.constraints = {
        zoom: !0,
        movement: !0,
      }),
      (this.lockIndex = 0),
      (this.trimStart = null),
      (this.trimEnd = null),
      (this.init = function (e, t) {
        var n = $(document);
        (this.isVideo = t || !1),
          (this.settings = {
            slider: e + " .cropSlider",
          });
        var i,
          r,
          s,
          o,
          a,
          l,
          c,
          e = $(e + " .cropMain"),
          u = this;
        (r = $("<div />")
          .attr({
            class: "crop-container",
          })
          .css({
            width: e.width(),
            height: e.height(),
          })),
          (i = $(
            this.isVideo
              ? "<video muted playsinline disableRemotePlayback/>"
              : "<img />"
          )
            .attr({
              class: "crop-img",
            })
            .css({
              zIndex: 5999,
              top: 0,
              left: 0,
            })),
          (s = $("<div />")
            .attr({
              class: "crop-overlay",
            })
            .css({
              zIndex: 6e3,
            })),
          (o = $("<div />").attr({
            class: "cropper-top-line cropper-line",
          })),
          (a = $("<div />").attr({
            class: "cropper-right-line cropper-line",
          })),
          (l = $("<div />").attr({
            class: "cropper-bottom-line cropper-line",
          })),
          (c = $("<div />").attr({
            class: "cropper-left-line cropper-line",
          })),
          r.append(s),
          r.append(i),
          r.append(o),
          r.append(a),
          r.append(l),
          r.append(c),
          e.append(r),
          (this.eles.ele = e),
          (this.eles.container = r),
          (this.eles.img = i),
          (this.eles.overlay = s),
          (this.eles.topLine = o),
          (this.eles.rightLine = a),
          (this.eles.bottomLine = l),
          (this.eles.leftLine = c),
          s.bind("mousedown touchstart", function (e) {
            var t = {
              x:
                e.pageX ||
                e.originalEvent.pageX ||
                e.originalEvent.changedTouches[0].pageX,
              y:
                e.pageY ||
                e.originalEvent.pageY ||
                e.originalEvent.changedTouches[0].pageY,
            };
            return (
              e.preventDefault(),
              n.bind("mousemove touchmove", function (e) {
                var n =
                  e.touches ||
                  (e.originalEvent && e.originalEvent.targetTouches);
                if (
                  !(
                    (n && n.length > 1) ||
                    (n && e.target !== s.get(0)) ||
                    u.lockMovement === !0 ||
                    (!e.pageX &&
                      !e.pageY &&
                      void 0 === typeof e.originalEvent.changedTouches[0])
                  )
                ) {
                  var i = {
                      x:
                        e.pageX ||
                        (e.originalEvent.changedTouches
                          ? e.originalEvent.changedTouches[0].pageX
                          : 0),
                      y:
                        e.pageY ||
                        (e.originalEvent.changedTouches
                          ? e.originalEvent.changedTouches[0].pageY
                          : 0),
                    },
                    r = {
                      t: t.y - i.y,
                      l: t.x - i.x,
                    };
                  (t = i),
                    u.lockIndex <= 0
                      ? ((u.lockIndex = 0),
                        (u.moveChange = !0),
                        u.imgMove(r),
                        u.snap(r))
                      : u.lockIndex--;
                }
              }),
              !1
            );
          }),
          n.bind("mouseup touchend", function () {
            u.moveChange &&
              (u.eles.ele.trigger("cropperChange"), (u.moveChange = !1)),
              n.unbind("mousemove touchmove");
          }),
          this.slider();
      }),
      (this.loadImg = function (e, t) {
        var n = this;
        this.eles.img.attr("src", e).load(function () {
          return n.imageExceedsDimensions()
            ? void n.eles.ele.trigger("imageDimensionsExceeded")
            : (n.imgSize(t),
              t ? n.updateSlider(t.s) : n.centerImage(),
              void n.eles.ele.trigger("imageLoaded"));
        }),
          (this.img = this.eles.img[0]);
      }),
      (this.loadVideo = function (e, t, n) {
        var i = this;
        Object.defineProperties(i.eles.img[0], {
          width: {
            get: function () {
              return $(this).width();
            },
          },
          height: {
            get: function () {
              return $(this).height();
            },
          },
        }),
          this.eles.img.attr("src", e),
          this.eles.img[0].load(),
          this.eles.img.on("loadeddata", function () {
            i.imgSize(t),
              t ? i.eles.rangeButtons.setValue(t.s) : i.centerImage(),
              i.eles.ele.trigger("imageLoaded");
          }),
          (this.img = this.eles.img[0]);
        var r = function (e, t) {
            return (
              Helpers.App.extractNumbersFromString(
                Helpers.App.getFileNameFromURI(e)
              ).pop() -
              Helpers.App.extractNumbersFromString(
                Helpers.App.getFileNameFromURI(t)
              ).pop()
            );
          },
          s = {
            totalLength: parseFloat(n.duration),
            start: parseFloat(n.trimStart || 0),
            end: parseFloat(n.trimEnd || n.fragmentDuration),
            videoWidth: parseFloat(n.width),
            videoHeight: parseFloat(n.height),
            containerWidth: this.eles.container.width(),
            resizable: n.resizable,
            minLength: n.minLength,
          };
        n.showSeekableTimeline !== !1
          ? ((s.thumbs = n.timelineUrls.sort(r)), (s.showSeekableTimeline = !0))
          : (s.showSeekableTimeline = !1),
          this.buildVideoUI(s);
      }),
      (this.getVideoTrimStart = function () {
        return this.trimStart;
      }),
      (this.getVideoTrimEnd = function () {
        return this.trimEnd;
      }),
      (this.buildVideoUI = function (e) {
        function t() {
          var e;
          l.fragmentPlayer.isPlaying() !== !1 &&
            ((e = function t() {
              l.fragmentPlayer.play(),
                void 0 !== l.eles.seekableTimeline &&
                  (l.eles.seekableTimeline.unbind("dragend", t),
                  l.eles.seekableTimeline.unbind("resizeend", t));
            }),
            l.fragmentPlayer.pause(),
            void 0 !== l.eles.seekableTimeline &&
              (l.eles.seekableTimeline.bind("dragend", e),
              l.eles.seekableTimeline.bind("resizeend", e)));
        }
        function n(e, t) {
          (l.trimStart = t.start),
            (l.trimEnd = t.end),
            l.fragmentPlayer.setBoundaries(t.start, t.end);
        }
        function i(e, t) {
          l.fragmentPlayer.setCurrentTime(t.currentTime);
        }
        function r(e, t) {
          void 0 !== l.eles.seekableTimeline &&
            l.eles.seekableTimeline.setIndicatorPosition(t.currentTime);
        }
        function s() {
          l.fragmentPlayer.isPlaying() === !1
            ? (l.fragmentPlayer.play(), $(this).addClass("is-playing"))
            : (l.fragmentPlayer.pause(), $(this).removeClass("is-playing"));
        }
        function o(e, t) {
          l.imgResize(t.value);
        }
        function a() {
          l.imgReset();
        }
        var l = this,
          c = '<div class="playback-button">',
          u = 1,
          d = 4;
        (l.trimStart = e.start),
          (l.trimEnd = e.end),
          l.constraints.zoom !== !0 && ((u = 0.25), (d = 5)),
          (l.fragmentPlayer = new UI.FragmentPlayer(
            l.eles.img[0],
            e.start,
            e.end
          )),
          l.fragmentPlayer.setMute(!0),
          l.fragmentPlayer.setCurrentTime(e.start),
          (l.eles.rangeButtons = new UI.RangeButtons({
            value: 1,
            step: 0.1,
            min: u,
            max: d,
          })),
          l.eles.rangeButtons.render(l.eles.container),
          e.showSeekableTimeline === !0 &&
            ((l.eles.seekableTimeline = new UI.SeekableTimeline({
              totalLength: e.totalLength,
              start: e.start,
              end: e.end,
              videoWidth: e.videoWidth,
              videoHeight: e.videoHeight,
              thumbs: e.thumbs,
              forceContainerWidth: e.containerWidth,
              resizable: e.resizable,
              minLength: e.minLength,
            })),
            l.eles.seekableTimeline.render($(".seekable-timeline-container"))),
          (l.eles.playbackButton = $(c)),
          l.eles.playbackButton.appendTo(l.eles.container),
          l.eles.slider.hide(),
          void 0 !== l.eles.seekableTimeline &&
            (l.eles.seekableTimeline.bind("timeupdate", i),
            l.eles.seekableTimeline.bind("dragstart", t),
            l.eles.seekableTimeline.bind("resizestart", t),
            l.eles.seekableTimeline.bind("change", n)),
          l.eles.rangeButtons.bind("change", o),
          l.eles.rangeButtons.bind("reset", a),
          l.eles.playbackButton.on("click", s),
          l.fragmentPlayer.bind("timeupdate", r);
      }),
      (this.getDurationChangeDispatcher = function () {
        return this.eles.seekableTimeline;
      }),
      (this.getCropperChangeDispatcher = function () {
        return this.eles.ele;
      }),
      (this.getZoomChangeDispatcher = function () {
        return this.eles.rangeButtons;
      }),
      (this.centerImage = function () {
        {
          var e = this.eles.container,
            t = this.eles.img[0],
            n = e.width(),
            i = e.height(),
            r = (t.width - n) / 2 + t.offsetLeft,
            s = (t.height - i) / 2 + t.offsetTop;
          Helpers.StageType.getStageInfo();
        }
        this.stageInfo.backdrop_data &&
          ((r = -((this.eles.topLine.width() - t.width) / 2)),
          (s = -((this.eles.leftLine.height() - t.height) / 2))),
          this.imgMove({
            l: r,
            t: s,
          });
      }),
      (this.imgSize = function (t) {
        {
          var n,
            i,
            r,
            s,
            o,
            a = this.eles.img,
            l = {
              w: a.css("width", "").width(),
              h: a.css("height", "").height(),
            },
            c = this.eles.container,
            u = Helpers.StageType.getStageInfo(),
            d = 2 * e,
            h = c.width(),
            p = c.height();
          ({
            wh: this.eles.container.width() / this.eles.container.height(),
            hw: this.eles.container.height() / this.eles.container.width(),
          });
        }
        t && (this.imgInfo = t),
          (this.imgInfo.aw = l.w),
          (this.imgInfo.ah = l.h),
          (n =
            8 === u.image_type || 14 === u.image_type ? l.w < l.h : l.w > l.h),
          this.stageInfo.backdrop_data &&
            ((d = 0),
            (h = this.eles.topLine.width()),
            (p = this.eles.leftLine.height())),
          n
            ? ((this.imgInfo.w = h - d),
              (this.imgInfo.h = this.imgInfo.w * (l.h / l.w)),
              (this.imgInfo.al = e),
              (this.imgInfo.at = p / 2 - this.imgInfo.h / 2))
            : ((this.imgInfo.h = p - d),
              (this.imgInfo.w = this.imgInfo.h * (l.w / l.h)),
              (this.imgInfo.at = e),
              (this.imgInfo.al = h / 2 - this.imgInfo.w / 2)),
          (i =
            8 === u.image_type || 14 === u.image_type
              ? this.imgInfo.h < p - d
              : this.imgInfo.h > p - d),
          i &&
            ((this.imgInfo.h = p - d),
            (this.imgInfo.w = this.imgInfo.h * (l.w / l.h)),
            (this.imgInfo.at = p / 2 - this.imgInfo.h / 2)),
          (r =
            8 === u.image_type || 14 === u.image_type
              ? this.imgInfo.w < h - d
              : this.imgInfo.w > h - d),
          r &&
            ((this.imgInfo.w = h - d),
            (this.imgInfo.h = this.imgInfo.w * (l.h / l.w)),
            (this.imgInfo.al = h / 2 - this.imgInfo.w / 2)),
          (s = $(".cropper-top-line").get(0).clientWidth),
          (o = $(".cropper-left-line").get(0).clientHeight),
          this.stageInfo.backdrop_data &&
            ((this.imgInfo.at = parseInt(this.eles.topLine.css("top"))),
            (this.imgInfo.al = parseInt(this.eles.leftLine.css("left")))),
          (this.imgInfo.longerSide = this.imgInfo.w === s ? "width" : "height"),
          this.imgResize();
      }),
      (this.imgResize = function (e) {
        var t = this.eles.img,
          n = this.imgInfo,
          i = n.s;
        (n.s = e || n.s),
          t.css({
            width: n.w * n.s,
            height: n.h * n.s,
          }),
          this.imgMove({
            t: -(n.h * i - n.h * n.s) / 2,
            l: -(n.w * i - n.w * n.s) / 2,
          });
      }),
      (this.imgMove = function (t) {
        var n,
          i,
          r = this.eles.img,
          s = this.imgInfo,
          o = this.eles.container,
          a = o.width(),
          l = o.height();
        (s.t += t.t),
          (s.l += t.l),
          (n = parseInt(s.at - s.t, 10)),
          (i = parseInt(s.al - s.l, 10)),
          this.constraints.movement === !0 &&
            (n > e
              ? (n = e)
              : n < -(s.h * s.s - (l - e)) && (n = -(s.h * s.s - (l - e))),
            i > e
              ? (i = e)
              : i < -(s.w * s.s - (a - e)) && (i = -(s.w * s.s - (a - e)))),
          r.css({
            top: n,
            left: i,
          });
      }),
      (this.imgReset = function () {
        (this.imgInfo = {
          aw: 0,
          ah: 0,
          w: 0,
          h: 0,
          at: 0,
          al: 0,
          t: 0,
          l: 0,
          s: 1,
        }),
          this.img.removeAttribute("style"),
          this.imgSize(),
          this.centerImage(),
          this.updateSlider(1),
          this.eles.rangeButtons && this.eles.rangeButtons.setValue(1);
      }),
      (this.setConstraints = function (e) {
        return (
          Object.keys(e).forEach(
            function (t) {
              e.hasOwnProperty(t) && (this.constraints[t] = e[t]);
            }.bind(this)
          ),
          this
        );
      }),
      (this.slider = function () {
        var e,
          t = this,
          n = 0.002;
        (e = this.getZoomRange()),
          this.stageInfo.backdrop_data && (n = 0.001),
          (this.eles.slider = $(this.settings.slider)),
          this.eles.slider.noUiSlider({
            range: e,
            start: 1,
            step: n,
            handles: 1,
            slide: function () {
              var e = $(this).val();
              t.eles.ele.trigger("cropperChange"), t.imgResize(e);
            },
          });
      }),
      (coordinates = function i(t) {
        var n = t.imgInfo,
          r = t.eles.container,
          s = t.eles.img,
          o = s.attr("src"),
          i = {
            x: -(parseInt(s.css("left")) - e) * (n.aw / (n.w * n.s)),
            y: -(parseInt(s.css("top")) - e) * (n.ah / (n.h * n.s)),
            w: (r.width() - 2 * e) * (n.aw / (n.w * n.s)),
            h: (r.height() - 2 * e) * (n.ah / (n.h * n.s)),
            image: o,
          };
        return i;
      }),
      (this.snap = function (e) {
        var t = this.getDirections(e),
          n = this.getBoundaries(),
          i = this.getSnapTargets(t, n),
          r = this.getSnapValues(i);
        this.imgMove(r);
      }),
      (this.getDirections = function (e) {
        var t = {
          top: !1,
          bottom: !1,
          left: !1,
          right: !1,
        };
        return (
          e.t > 0 ? (t.top = !0) : e.t < 0 && (t.bottom = !0),
          e.l > 0 ? (t.left = !0) : e.l < 0 && (t.right = !0),
          t
        );
      }),
      (this.getBoundaries = function () {
        var e = (this.eles.img, this.getBordersAndBoundaries()),
          t = {
            top: null,
            bottom: null,
            left: null,
            right: null,
          };
        return (
          (t.top = e.borders.top > e.boundaries.top ? "outer" : "inner"),
          (t.bottom =
            e.borders.bottom > e.boundaries.bottom ? "inner" : "outer"),
          (t.left = e.borders.left > e.boundaries.left ? "outer" : "inner"),
          (t.right = e.borders.right > e.boundaries.right ? "inner" : "outer"),
          t
        );
      }),
      (this.getSnapTargets = function (e, t) {
        var n = {
          top: !1,
          bottom: !1,
          left: !1,
          right: !1,
        };
        return (
          e.top === !0 && "outer" === t.top && (n.top = !0),
          e.top === !0 && "inner" === t.bottom && (n.bottom = !0),
          e.bottom === !0 && "outer" === t.bottom && (n.bottom = !0),
          e.bottom === !0 && "inner" === t.top && (n.top = !0),
          e.left === !0 && "outer" === t.left && (n.left = !0),
          e.left === !0 && "inner" === t.right && (n.right = !0),
          e.right === !0 && "outer" === t.right && (n.right = !0),
          e.right === !0 && "inner" === t.left && (n.left = !0),
          n
        );
      }),
      (this.getSnapValues = function (e) {
        var n, i, r, s, o, a, l, c;
        return (
          (n = this.getBordersAndBoundaries()),
          (c = {
            t: 0,
            l: 0,
          }),
          e.top === !0 && e.bottom === !1
            ? (s = n.borders.top - n.boundaries.top)
            : e.bottom === !0 && e.top === !1
            ? (s = n.borders.bottom - n.boundaries.bottom)
            : e.bottom === !0 &&
              e.top === !0 &&
              ((i = n.borders.top - n.boundaries.top),
              (r = n.borders.bottom - n.boundaries.bottom),
              (s = Math.abs(i) <= Math.abs(r) ? i : r)),
          e.left === !0 && e.right === !1
            ? (l = n.borders.left - n.boundaries.left)
            : e.left === !1 && e.right === !0
            ? (l = n.borders.right - n.boundaries.right)
            : e.left === !0 &&
              e.right === !0 &&
              ((o = n.borders.left - n.boundaries.left),
              (a = n.borders.right - n.boundaries.right),
              (l = Math.abs(o) <= Math.abs(a) ? o : a)),
          Math.abs(s) <= t && ((c.t = s), (this.lockIndex = 10)),
          Math.abs(l) <= t && ((c.l = Math.floor(l)), (this.lockIndex = 10)),
          c
        );
      }),
      (this.getBordersAndBoundaries = function () {
        var e, t;
        return (
          (e = this.eles.img),
          (t = {
            borders: {
              top: e.position().top,
              bottom: e.position().top + e.height(),
              left: e.position().left,
              right: e.position().left + e.width(),
            },
            boundaries: {
              top: this.eles.topLine.position().top,
              bottom: this.eles.bottomLine.position().top,
              left: this.eles.leftLine.position().left,
              right: this.eles.rightLine.position().left,
            },
          })
        );
      }),
      (this.destroy = function () {
        "VIDEO" === this.eles.img[0].tagName &&
          (this.fragmentPlayer.destroy(),
          this.eles.seekableTimeline.destroy(),
          this.eles.rangeButtons.destroy(),
          this.eles.img.remove(),
          (this.eles.img[0].src = ""),
          this.eles.img[0].load(),
          (this.eles.img = null));
      }),
      (this.getImg = function () {
        return this.eles.img[0];
      }),
      (this.imageExceedsDimensions = function () {
        var e = this.getImg();
        return e.height > n || e.width > n;
      }),
      (this.updateSlider = function (e) {
        this.eles.slider.val(e);
      }),
      (this.getZoomRange = function () {
        var e;
        return (e = this.constraints.zoom === !0 ? [1, 4] : [0.25, 5]);
      }),
      (this.getCurrentZoom = function () {
        return this.imgInfo.s;
      }),
      (this.setZoom = function (e) {
        this.updateSlider(e),
          this.imgResize(e),
          this.eles.rangeButtons && this.eles.rangeButtons.setValue(e);
      }),
      (this.toggleMovementLock = function (e) {
        this.lockMovement = e;
      });
  };
})();
!(function (e) {
  "use strict";
  "function" == typeof define && define.amd
    ? define(["jquery"], e)
    : "object" == typeof exports && "object" == typeof module
    ? (module.exports = e(require("jquery")))
    : e(jQuery);
})(function (e, t) {
  "use strict";
  function n(t, n, i, r) {
    for (var s = [], o = 0; o < t.length; o++) {
      var a = t[o];
      if (a) {
        var l = tinycolor(a),
          c =
            l.toHsl().l < 0.5
              ? "sp-thumb-el sp-thumb-dark"
              : "sp-thumb-el sp-thumb-light";
        c += tinycolor.equals(n, a) ? " sp-thumb-active" : "";
        var u = l.toString(r.preferredFormat || "rgb"),
          d = g
            ? "background-color:" + l.toRgbString()
            : "filter:" + l.toFilter();
        s.push(
          '<span title="' +
            u +
            '" data-color="' +
            l.toRgbString() +
            '" class="' +
            c +
            '"><span class="sp-thumb-inner" style="' +
            d +
            ';" /></span>'
        );
      } else {
        var h = "sp-clear-display";
        s.push(
          e("<div />")
            .append(
              e(
                '<span data-color="" style="background-color:transparent;" class="' +
                  h +
                  '"></span>'
              ).attr("title", r.noColorSelectedText)
            )
            .html()
        );
      }
    }
    return "<div class='sp-cf " + i + "'>" + s.join("") + "</div>";
  }
  function i() {
    for (var e = 0; e < f.length; e++) f[e] && f[e].hide();
  }
  function r(t, n) {
    var i = e.extend({}, p, t);
    return (
      (i.callbacks = {
        move: c(i.move, n),
        change: c(i.change, n),
        show: c(i.show, n),
        hide: c(i.hide, n),
        beforeShow: c(i.beforeShow, n),
      }),
      i
    );
  }
  function s(s, a) {
    function c() {
      if (
        (V.showPaletteOnly && (V.showPalette = !0),
        Ut.text(
          V.showPaletteOnly ? V.togglePaletteMoreText : V.togglePaletteLessText
        ),
        V.palette)
      ) {
        (pt = V.palette.slice(0)),
          (ft = e.isArray(pt[0]) ? pt : [pt]),
          (mt = {});
        for (var t = 0; t < ft.length; t++)
          for (var n = 0; n < ft[t].length; n++) {
            var i = tinycolor(ft[t][n]).toRgbString();
            mt[i] = !0;
          }
      }
      kt.toggleClass("sp-flat", G),
        kt.toggleClass("sp-input-disabled", !V.showInput),
        kt.toggleClass("sp-alpha-enabled", V.showAlpha),
        kt.toggleClass("sp-clear-enabled", Xt),
        kt.toggleClass("sp-buttons-disabled", !V.showButtons),
        kt.toggleClass("sp-palette-buttons-disabled", !V.togglePaletteOnly),
        kt.toggleClass("sp-palette-disabled", !V.showPalette),
        kt.toggleClass("sp-palette-only", V.showPaletteOnly),
        kt.toggleClass("sp-initial-disabled", !V.showInitial),
        kt.addClass(V.className).addClass(V.containerClassName),
        B();
    }
    function p() {
      function t(t) {
        return (
          t.data && t.data.ignore
            ? (M(e(t.target).closest(".sp-thumb-el").data("color")), j())
            : (M(e(t.target).closest(".sp-thumb-el").data("color")),
              j(),
              $(!0),
              V.hideAfterPaletteSelect && O()),
          !1
        );
      }
      if (
        (m && kt.find("*:not(input)").attr("unselectable", "on"),
        c(),
        Ft && wt.after(Ht).hide(),
        Xt || jt.hide(),
        G)
      )
        wt.after(kt).hide();
      else {
        var n = "parent" === V.appendTo ? wt.parent() : e(V.appendTo);
        1 !== n.length && (n = e("body")), n.append(kt);
      }
      y(),
        Wt.bind("click.spectrum touchstart.spectrum", function (t) {
          Ct || E(),
            t.stopPropagation(),
            e(t.target).is("input") || t.preventDefault();
        }),
        (wt.is(":disabled") || V.disabled === !0) && z(),
        kt.click(l),
        Dt.change(x),
        Dt.bind("paste", function () {
          setTimeout(x, 1);
        }),
        Dt.keydown(function (e) {
          13 == e.keyCode && x();
        }),
        Lt.text(V.cancelText),
        Lt.bind("click.spectrum", function (e) {
          e.stopPropagation(), e.preventDefault(), D(), O();
        }),
        jt.attr("title", V.clearText),
        jt.bind("click.spectrum", function (e) {
          e.stopPropagation(), e.preventDefault(), (Yt = !0), j(), G && $(!0);
        }),
        Nt.text(V.chooseText),
        Nt.bind("click.spectrum", function (e) {
          e.stopPropagation(),
            e.preventDefault(),
            m && Dt.is(":focus") && Dt.trigger("change"),
            L() && ($(!0), O());
        }),
        Ut.text(
          V.showPaletteOnly ? V.togglePaletteMoreText : V.togglePaletteLessText
        ),
        Ut.bind("click.spectrum", function (e) {
          e.stopPropagation(),
            e.preventDefault(),
            (V.showPaletteOnly = !V.showPaletteOnly),
            V.showPaletteOnly ||
              G ||
              kt.css("left", "-=" + (Tt.outerWidth(!0) + 5)),
            c();
        }),
        u(
          At,
          function (e, t, n) {
            (ht = e / ot),
              (Yt = !1),
              n.shiftKey && (ht = Math.round(10 * ht) / 10),
              j();
          },
          T,
          S
        ),
        u(
          Et,
          function (e, t) {
            (ct = parseFloat(t / rt)), (Yt = !1), V.showAlpha || (ht = 1), j();
          },
          T,
          S
        ),
        u(
          St,
          function (e, t, n) {
            if (n.shiftKey) {
              if (!yt) {
                var i = ut * tt,
                  r = nt - dt * nt,
                  s = Math.abs(e - i) > Math.abs(t - r);
                yt = s ? "x" : "y";
              }
            } else yt = null;
            var o = !yt || "x" === yt,
              a = !yt || "y" === yt;
            o && (ut = parseFloat(e / tt)),
              a && (dt = parseFloat((nt - t) / nt)),
              (Yt = !1),
              V.showAlpha || (ht = 1),
              j();
          },
          T,
          S
        ),
        qt
          ? (M(qt),
            N(),
            (Gt = V.preferredFormat || tinycolor(qt).format),
            b(qt))
          : N(),
        G && P();
      var i = m ? "mousedown.spectrum" : "click.spectrum touchstart.spectrum";
      Mt.delegate(".sp-thumb-el", i, t),
        Rt.delegate(
          ".sp-thumb-el:nth-child(1)",
          i,
          {
            ignore: !0,
          },
          t
        );
    }
    function y() {
      if (Y && window.localStorage) {
        try {
          var t = window.localStorage[Y].split(",#");
          t.length > 1 &&
            (delete window.localStorage[Y],
            e.each(t, function (e, t) {
              b(t);
            }));
        } catch (n) {}
        try {
          gt = window.localStorage[Y].split(";");
        } catch (n) {}
      }
    }
    function b(t) {
      if (K) {
        var n = tinycolor(t).toRgbString();
        if (!mt[n] && -1 === e.inArray(n, gt))
          for (gt.push(n); gt.length > _t; ) gt.shift();
        if (Y && window.localStorage)
          try {
            window.localStorage[Y] = gt.join(";");
          } catch (i) {}
      }
    }
    function w() {
      var e = [];
      if (V.showPalette)
        for (var t = 0; t < gt.length; t++) {
          var n = tinycolor(gt[t]).toRgbString();
          mt[n] || e.push(gt[t]);
        }
      return e.reverse().slice(0, V.maxSelectionSize);
    }
    function C() {
      var t = R(),
        i = e.map(ft, function (e, i) {
          return n(e, t, "sp-palette-row sp-palette-row-" + i, V);
        });
      y(),
        gt && i.push(n(w(), t, "sp-palette-row sp-palette-row-selection", V)),
        Mt.html(i.join(""));
    }
    function k() {
      if (V.showInitial) {
        var e = Vt,
          t = R();
        Rt.html(n([e, t], t, "sp-palette-row-initial", V));
      }
    }
    function T() {
      (0 >= nt || 0 >= tt || 0 >= rt) && B(),
        (et = !0),
        kt.addClass(vt),
        (yt = null),
        wt.trigger("dragstart.spectrum", [R()]);
    }
    function S() {
      (et = !1), kt.removeClass(vt), wt.trigger("dragstop.spectrum", [R()]);
    }
    function x() {
      var e = Dt.val();
      if ((null !== e && "" !== e) || !Xt) {
        var t = tinycolor(e);
        t.isValid() ? (M(t), $(!0)) : Dt.addClass("sp-validation-error");
      } else M(null), $(!0);
    }
    function E() {
      Z ? O() : P();
    }
    function P() {
      var t = e.Event("beforeShow.spectrum");
      return Z
        ? void B()
        : (wt.trigger(t, [R()]),
          void (
            Q.beforeShow(R()) === !1 ||
            t.isDefaultPrevented() ||
            (i(),
            (Z = !0),
            e(bt).bind("keydown.spectrum", I),
            e(bt).bind("click.spectrum", A),
            e(window).bind("resize.spectrum", J),
            Ht.addClass("sp-active"),
            kt.removeClass("sp-hidden"),
            B(),
            N(),
            (Vt = R()),
            k(),
            Q.show(Vt),
            wt.trigger("show.spectrum", [Vt]))
          ));
    }
    function I(e) {
      27 === e.keyCode && O();
    }
    function A(e) {
      2 != e.button && (et || (Kt ? $(!0) : D(), O()));
    }
    function O() {
      Z &&
        !G &&
        ((Z = !1),
        e(bt).unbind("keydown.spectrum", I),
        e(bt).unbind("click.spectrum", A),
        e(window).unbind("resize.spectrum", J),
        Ht.removeClass("sp-active"),
        kt.addClass("sp-hidden"),
        Q.hide(R()),
        wt.trigger("hide.spectrum", [R()]));
    }
    function D() {
      M(Vt, !0);
    }
    function M(e, t) {
      if (tinycolor.equals(e, R())) return void N();
      var n, i;
      !e && Xt
        ? (Yt = !0)
        : ((Yt = !1),
          (n = tinycolor(e)),
          (i = n.toHsv()),
          (ct = (i.h % 360) / 360),
          (ut = i.s),
          (dt = i.v),
          (ht = i.a)),
        N(),
        n && n.isValid() && !t && (Gt = V.preferredFormat || n.getFormat());
    }
    function R(e) {
      return (
        (e = e || {}),
        Xt && Yt
          ? null
          : tinycolor.fromRatio(
              {
                h: ct,
                s: ut,
                v: dt,
                a: Math.round(100 * ht) / 100,
              },
              {
                format: e.format || Gt,
              }
            )
      );
    }
    function L() {
      return !Dt.hasClass("sp-validation-error");
    }
    function j() {
      N(), Q.move(R()), wt.trigger("move.spectrum", [R()]);
    }
    function N() {
      Dt.removeClass("sp-validation-error"), U();
      var e = tinycolor.fromRatio({
        h: ct,
        s: 1,
        v: 1,
      });
      St.css("background-color", e.toHexString());
      var t = Gt;
      1 > ht &&
        (0 !== ht || "name" !== t) &&
        ("hex" === t || "hex3" === t || "hex6" === t || "name" === t) &&
        (t = "rgb");
      var n = R({
          format: t,
        }),
        i = "";
      if (
        (zt.removeClass("sp-clear-display"),
        zt.css("background-color", "transparent"),
        !n && Xt)
      )
        zt.addClass("sp-clear-display");
      else {
        var r = n.toHexString(),
          s = n.toRgbString();
        if (
          (g || 1 === n.alpha
            ? zt.css("background-color", s)
            : (zt.css("background-color", "transparent"),
              zt.css("filter", n.toFilter())),
          V.showAlpha)
        ) {
          var o = n.toRgb();
          o.a = 0;
          var a = tinycolor(o).toRgbString(),
            l = "linear-gradient(left, " + a + ", " + r + ")";
          m
            ? It.css(
                "filter",
                tinycolor(a).toFilter(
                  {
                    gradientType: 1,
                  },
                  r
                )
              )
            : (It.css("background", "-webkit-" + l),
              It.css("background", "-moz-" + l),
              It.css("background", "-ms-" + l),
              It.css(
                "background",
                "linear-gradient(to right, " + a + ", " + r + ")"
              ));
        }
        i = n.toString(t);
      }
      V.showInput && Dt.val(i), V.showPalette && C(), k();
    }
    function U() {
      var e = ut,
        t = dt;
      if (Xt && Yt) Ot.hide(), Pt.hide(), xt.hide();
      else {
        Ot.show(), Pt.show(), xt.show();
        var n = e * tt,
          i = nt - t * nt;
        (n = Math.max(-it, Math.min(tt - it, n - it))),
          (i = Math.max(-it, Math.min(nt - it, i - it))),
          xt.css({
            top: i + "px",
            left: n + "px",
          });
        var r = ht * ot;
        Ot.css({
          left: r - at / 2 + "px",
        });
        var s = ct * rt;
        Pt.css({
          top: s - lt + "px",
        });
      }
    }
    function $(e) {
      var t = R(),
        n = "",
        i = !tinycolor.equals(t, Vt);
      t && ((n = t.toString(Gt)), b(t)),
        $t && wt.val(n),
        e && i && (Q.change(t), wt.trigger("change", [t]));
    }
    function B() {
      Z &&
        ((tt = St.width()),
        (nt = St.height()),
        (it = xt.height()),
        (st = Et.width()),
        (rt = Et.height()),
        (lt = Pt.height()),
        (ot = At.width()),
        (at = Ot.width()),
        G ||
          (kt.css("position", "absolute"),
          kt.offset(V.offset ? V.offset : o(kt, Wt))),
        U(),
        V.showPalette && C(),
        wt.trigger("reflow.spectrum"));
    }
    function F() {
      wt.show(),
        Wt.unbind("click.spectrum touchstart.spectrum"),
        kt.remove(),
        Ht.remove(),
        (f[Qt.id] = null);
    }
    function H(n, i) {
      return n === t
        ? e.extend({}, V)
        : i === t
        ? V[n]
        : ((V[n] = i),
          "preferredFormat" === n && (Gt = V.preferredFormat),
          void c());
    }
    function W() {
      (Ct = !1), wt.attr("disabled", !1), Wt.removeClass("sp-disabled");
    }
    function z() {
      O(), (Ct = !0), wt.attr("disabled", !0), Wt.addClass("sp-disabled");
    }
    function q(e) {
      (V.offset = e), B();
    }
    var V = r(a, s),
      G = V.flat,
      K = V.showSelectionPalette,
      Y = V.localStorageKey,
      X = V.theme,
      Q = V.callbacks,
      J = d(B, 10),
      Z = !1,
      et = !1,
      tt = 0,
      nt = 0,
      it = 0,
      rt = 0,
      st = 0,
      ot = 0,
      at = 0,
      lt = 0,
      ct = 0,
      ut = 0,
      dt = 0,
      ht = 1,
      pt = [],
      ft = [],
      mt = {},
      gt = V.selectionPalette.slice(0),
      _t = V.maxSelectionSize,
      vt = "sp-dragging",
      yt = null,
      bt = s.ownerDocument,
      wt = (bt.body, e(s)),
      Ct = !1,
      kt = e(v, bt).addClass(X),
      Tt = kt.find(".sp-picker-container"),
      St = kt.find(".sp-color"),
      xt = kt.find(".sp-dragger"),
      Et = kt.find(".sp-hue"),
      Pt = kt.find(".sp-slider"),
      It = kt.find(".sp-alpha-inner"),
      At = kt.find(".sp-alpha"),
      Ot = kt.find(".sp-alpha-handle"),
      Dt = kt.find(".sp-input"),
      Mt = kt.find(".sp-palette"),
      Rt = kt.find(".sp-initial"),
      Lt = kt.find(".sp-cancel"),
      jt = kt.find(".sp-clear"),
      Nt = kt.find(".sp-choose"),
      Ut = kt.find(".sp-palette-toggle"),
      $t = wt.is("input"),
      Bt = $t && "color" === wt.attr("type") && h(),
      Ft = $t && !G,
      Ht = Ft
        ? e(_).addClass(X).addClass(V.className).addClass(V.replacerClassName)
        : e([]),
      Wt = Ft ? Ht : wt,
      zt = Ht.find(".sp-preview-inner"),
      qt = V.color || ($t && wt.val()),
      Vt = !1,
      Gt = V.preferredFormat,
      Kt = !V.showButtons || V.clickoutFiresChange,
      Yt = !qt,
      Xt = V.allowEmpty && !Bt;
    p();
    var Qt = {
      show: P,
      hide: O,
      toggle: E,
      reflow: B,
      option: H,
      enable: W,
      disable: z,
      offset: q,
      set: function (e) {
        M(e), $();
      },
      get: R,
      destroy: F,
      container: kt,
    };
    return (Qt.id = f.push(Qt) - 1), Qt;
  }
  function o(t, n) {
    var i = 0,
      r = t.outerWidth(),
      s = t.outerHeight(),
      o = n.outerHeight(),
      a = t[0].ownerDocument,
      l = a.documentElement,
      c = l.clientWidth + e(a).scrollLeft(),
      u = l.clientHeight + e(a).scrollTop(),
      d = n.offset();
    return (
      (d.top += o),
      (d.left -= Math.min(
        d.left,
        d.left + r > c && c > r ? Math.abs(d.left + r - c) : 0
      )),
      (d.top -= Math.min(
        d.top,
        d.top + s > u && u > s ? Math.abs(s + o - i) : i
      )),
      d
    );
  }
  function a() {}
  function l(e) {
    e.stopPropagation();
  }
  function c(e, t) {
    var n = Array.prototype.slice,
      i = n.call(arguments, 2);
    return function () {
      return e.apply(t, i.concat(n.call(arguments)));
    };
  }
  function u(t, n, i, r) {
    function s(e) {
      e.stopPropagation && e.stopPropagation(),
        e.preventDefault && e.preventDefault(),
        (e.returnValue = !1);
    }
    function o(e) {
      if (u) {
        if (m && c.documentMode < 9 && !e.button) return l();
        var i =
            e.originalEvent &&
            e.originalEvent.touches &&
            e.originalEvent.touches[0],
          r = (i && i.pageX) || e.pageX,
          o = (i && i.pageY) || e.pageY,
          a = Math.max(0, Math.min(r - d.left, p)),
          g = Math.max(0, Math.min(o - d.top, h));
        f && s(e), n.apply(t, [a, g, e]);
      }
    }
    function a(n) {
      var r = n.which ? 3 == n.which : 2 == n.button;
      r ||
        u ||
        (i.apply(t, arguments) !== !1 &&
          ((u = !0),
          (h = e(t).height()),
          (p = e(t).width()),
          (d = e(t).offset()),
          e(c).bind(g),
          e(c.body).addClass("sp-dragging"),
          o(n),
          s(n)));
    }
    function l() {
      u &&
        (e(c).unbind(g),
        e(c.body).removeClass("sp-dragging"),
        setTimeout(function () {
          r.apply(t, arguments);
        }, 0)),
        (u = !1);
    }
    (n = n || function () {}),
      (i = i || function () {}),
      (r = r || function () {});
    var c = document,
      u = !1,
      d = {},
      h = 0,
      p = 0,
      f = "ontouchstart" in window,
      g = {};
    (g.selectstart = s),
      (g.dragstart = s),
      (g["touchmove mousemove"] = o),
      (g["touchend mouseup"] = l),
      e(t).bind("touchstart mousedown", a);
  }
  function d(e, t, n) {
    var i;
    return function () {
      var r = this,
        s = arguments,
        o = function () {
          (i = null), e.apply(r, s);
        };
      n && clearTimeout(i), (n || !i) && (i = setTimeout(o, t));
    };
  }
  function h() {
    return e.fn.spectrum.inputTypeColorSupport();
  }
  var p = {
      beforeShow: a,
      move: a,
      change: a,
      show: a,
      hide: a,
      color: !1,
      flat: !1,
      showInput: !1,
      allowEmpty: !1,
      showButtons: !0,
      clickoutFiresChange: !0,
      showInitial: !1,
      showPalette: !1,
      showPaletteOnly: !1,
      hideAfterPaletteSelect: !1,
      togglePaletteOnly: !1,
      showSelectionPalette: !0,
      localStorageKey: !1,
      appendTo: "body",
      maxSelectionSize: 7,
      cancelText: "cancel",
      chooseText: "choose",
      togglePaletteMoreText: "more",
      togglePaletteLessText: "less",
      clearText: "Clear Color Selection",
      noColorSelectedText: "No Color Selected",
      preferredFormat: !1,
      className: "",
      containerClassName: "",
      replacerClassName: "",
      showAlpha: !1,
      theme: "sp-light",
      palette: [
        [
          "#ffffff",
          "#000000",
          "#ff0000",
          "#ff8000",
          "#ffff00",
          "#008000",
          "#0000ff",
          "#4b0082",
          "#9400d3",
        ],
      ],
      selectionPalette: [],
      disabled: !1,
      offset: null,
    },
    f = [],
    m = !!/msie/i.exec(window.navigator.userAgent),
    g = (function () {
      function e(e, t) {
        return !!~("" + e).indexOf(t);
      }
      var t = document.createElement("div"),
        n = t.style;
      return (
        (n.cssText = "background-color:rgba(0,0,0,.5)"),
        e(n.backgroundColor, "rgba") || e(n.backgroundColor, "hsla")
      );
    })(),
    _ = [
      "<div class='sp-replacer'>",
      "<div class='sp-preview'><div class='sp-preview-inner'></div></div>",
      "<div class='sp-dd p-icon down-arrow'></div>",
      "</div>",
    ].join(""),
    v = (function () {
      var e = "";
      if (m)
        for (var t = 1; 6 >= t; t++) e += "<div class='sp-" + t + "'></div>";
      return [
        "<div class='sp-container sp-hidden'>",
        "<div class='sp-palette-container'>",
        "<div class='sp-palette sp-thumb sp-cf'></div>",
        "<div class='sp-palette-button-container sp-cf'>",
        "<button type='button' class='sp-palette-toggle'></button>",
        "</div>",
        "</div>",
        "<div class='sp-picker-container'>",
        "<div class='sp-top sp-cf'>",
        "<div class='sp-fill'></div>",
        "<div class='sp-top-inner'>",
        "<div class='sp-color'>",
        "<div class='sp-sat'>",
        "<div class='sp-val'>",
        "<div class='sp-dragger'></div>",
        "</div>",
        "</div>",
        "</div>",
        "<div class='sp-clear sp-clear-display'>",
        "</div>",
        "<div class='sp-hue'>",
        "<div class='sp-slider'></div>",
        e,
        "</div>",
        "</div>",
        "<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>",
        "</div>",
        "<div class='sp-input-container sp-cf'>",
        "<input class='sp-input' type='text' spellcheck='false'  />",
        "</div>",
        "<div class='sp-initial sp-thumb sp-cf'></div>",
        "<div class='sp-button-container sp-cf'>",
        "<a class='sp-cancel' href='#'></a>",
        "<button type='button' class='sp-choose'></button>",
        "</div>",
        "</div>",
        "</div>",
      ].join("");
    })(),
    y = "spectrum.id";
  (e.fn.spectrum = function (t) {
    if ("string" == typeof t) {
      var n = this,
        i = Array.prototype.slice.call(arguments, 1);
      return (
        this.each(function () {
          var r = f[e(this).data(y)];
          if (r) {
            var s = r[t];
            if (!s) throw new Error("Spectrum: no such method: '" + t + "'");
            "get" == t
              ? (n = r.get())
              : "container" == t
              ? (n = r.container)
              : "option" == t
              ? (n = r.option.apply(r, i))
              : "destroy" == t
              ? (r.destroy(), e(this).removeData(y))
              : s.apply(r, i);
          }
        }),
        n
      );
    }
    return this.spectrum("destroy").each(function () {
      var n = e.extend({}, t, e(this).data()),
        i = s(this, n);
      e(this).data(y, i.id);
    });
  }),
    (e.fn.spectrum.load = !0),
    (e.fn.spectrum.loadOpts = {}),
    (e.fn.spectrum.draggable = u),
    (e.fn.spectrum.defaults = p),
    (e.fn.spectrum.inputTypeColorSupport = function b() {
      if ("undefined" == typeof b._cachedResult) {
        var t = e("<input type='color'/>")[0];
        b._cachedResult = "color" === t.type && "" !== t.value;
      }
      return b._cachedResult;
    }),
    (e.spectrum = {}),
    (e.spectrum.localization = {}),
    (e.spectrum.palettes = {}),
    (e.fn.spectrum.processNativeColorInputs = function () {
      var t = e("input[type=color]");
      t.length &&
        !h() &&
        t.spectrum({
          preferredFormat: "hex6",
        });
    }),
    (function () {
      function e(e) {
        var n = {
            r: 0,
            g: 0,
            b: 0,
          },
          r = 1,
          o = !1,
          a = !1;
        return (
          "string" == typeof e && (e = D(e)),
          "object" == typeof e &&
            (e.hasOwnProperty("r") &&
            e.hasOwnProperty("g") &&
            e.hasOwnProperty("b")
              ? ((n = t(e.r, e.g, e.b)),
                (o = !0),
                (a = "%" === String(e.r).substr(-1) ? "prgb" : "rgb"))
              : e.hasOwnProperty("h") &&
                e.hasOwnProperty("s") &&
                e.hasOwnProperty("v")
              ? ((e.s = I(e.s)),
                (e.v = I(e.v)),
                (n = s(e.h, e.s, e.v)),
                (o = !0),
                (a = "hsv"))
              : e.hasOwnProperty("h") &&
                e.hasOwnProperty("s") &&
                e.hasOwnProperty("l") &&
                ((e.s = I(e.s)),
                (e.l = I(e.l)),
                (n = i(e.h, e.s, e.l)),
                (o = !0),
                (a = "hsl")),
            e.hasOwnProperty("a") && (r = e.a)),
          (r = C(r)),
          {
            ok: o,
            format: e.format || a,
            r: U(255, $(n.r, 0)),
            g: U(255, $(n.g, 0)),
            b: U(255, $(n.b, 0)),
            a: r,
          }
        );
      }
      function t(e, t, n) {
        return {
          r: 255 * k(e, 255),
          g: 255 * k(t, 255),
          b: 255 * k(n, 255),
        };
      }
      function n(e, t, n) {
        (e = k(e, 255)), (t = k(t, 255)), (n = k(n, 255));
        var i,
          r,
          s = $(e, t, n),
          o = U(e, t, n),
          a = (s + o) / 2;
        if (s == o) i = r = 0;
        else {
          var l = s - o;
          switch (((r = a > 0.5 ? l / (2 - s - o) : l / (s + o)), s)) {
            case e:
              i = (t - n) / l + (n > t ? 6 : 0);
              break;
            case t:
              i = (n - e) / l + 2;
              break;
            case n:
              i = (e - t) / l + 4;
          }
          i /= 6;
        }
        return {
          h: i,
          s: r,
          l: a,
        };
      }
      function i(e, t, n) {
        function i(e, t, n) {
          return (
            0 > n && (n += 1),
            n > 1 && (n -= 1),
            1 / 6 > n
              ? e + 6 * (t - e) * n
              : 0.5 > n
              ? t
              : 2 / 3 > n
              ? e + (t - e) * (2 / 3 - n) * 6
              : e
          );
        }
        var r, s, o;
        if (((e = k(e, 360)), (t = k(t, 100)), (n = k(n, 100)), 0 === t))
          r = s = o = n;
        else {
          var a = 0.5 > n ? n * (1 + t) : n + t - n * t,
            l = 2 * n - a;
          (r = i(l, a, e + 1 / 3)), (s = i(l, a, e)), (o = i(l, a, e - 1 / 3));
        }
        return {
          r: 255 * r,
          g: 255 * s,
          b: 255 * o,
        };
      }
      function r(e, t, n) {
        (e = k(e, 255)), (t = k(t, 255)), (n = k(n, 255));
        var i,
          r,
          s = $(e, t, n),
          o = U(e, t, n),
          a = s,
          l = s - o;
        if (((r = 0 === s ? 0 : l / s), s == o)) i = 0;
        else {
          switch (s) {
            case e:
              i = (t - n) / l + (n > t ? 6 : 0);
              break;
            case t:
              i = (n - e) / l + 2;
              break;
            case n:
              i = (e - t) / l + 4;
          }
          i /= 6;
        }
        return {
          h: i,
          s: r,
          v: a,
        };
      }
      function s(e, t, n) {
        (e = 6 * k(e, 360)), (t = k(t, 100)), (n = k(n, 100));
        var i = j.floor(e),
          r = e - i,
          s = n * (1 - t),
          o = n * (1 - r * t),
          a = n * (1 - (1 - r) * t),
          l = i % 6,
          c = [n, o, s, s, a, n][l],
          u = [a, n, n, o, s, s][l],
          d = [s, s, a, n, n, o][l];
        return {
          r: 255 * c,
          g: 255 * u,
          b: 255 * d,
        };
      }
      function o(e, t, n, i) {
        var r = [
          P(N(e).toString(16)),
          P(N(t).toString(16)),
          P(N(n).toString(16)),
        ];
        return i &&
          r[0].charAt(0) == r[0].charAt(1) &&
          r[1].charAt(0) == r[1].charAt(1) &&
          r[2].charAt(0) == r[2].charAt(1)
          ? r[0].charAt(0) + r[1].charAt(0) + r[2].charAt(0)
          : r.join("");
      }
      function a(e, t, n, i) {
        var r = [
          P(A(i)),
          P(N(e).toString(16)),
          P(N(t).toString(16)),
          P(N(n).toString(16)),
        ];
        return r.join("");
      }
      function l(e, t) {
        t = 0 === t ? 0 : t || 10;
        var n = F(e).toHsl();
        return (n.s -= t / 100), (n.s = T(n.s)), F(n);
      }
      function c(e, t) {
        t = 0 === t ? 0 : t || 10;
        var n = F(e).toHsl();
        return (n.s += t / 100), (n.s = T(n.s)), F(n);
      }
      function u(e) {
        return F(e).desaturate(100);
      }
      function d(e, t) {
        t = 0 === t ? 0 : t || 10;
        var n = F(e).toHsl();
        return (n.l += t / 100), (n.l = T(n.l)), F(n);
      }
      function h(e, t) {
        t = 0 === t ? 0 : t || 10;
        var n = F(e).toRgb();
        return (
          (n.r = $(0, U(255, n.r - N(255 * -(t / 100))))),
          (n.g = $(0, U(255, n.g - N(255 * -(t / 100))))),
          (n.b = $(0, U(255, n.b - N(255 * -(t / 100))))),
          F(n)
        );
      }
      function p(e, t) {
        t = 0 === t ? 0 : t || 10;
        var n = F(e).toHsl();
        return (n.l -= t / 100), (n.l = T(n.l)), F(n);
      }
      function f(e, t) {
        var n = F(e).toHsl(),
          i = (N(n.h) + t) % 360;
        return (n.h = 0 > i ? 360 + i : i), F(n);
      }
      function m(e) {
        var t = F(e).toHsl();
        return (t.h = (t.h + 180) % 360), F(t);
      }
      function g(e) {
        var t = F(e).toHsl(),
          n = t.h;
        return [
          F(e),
          F({
            h: (n + 120) % 360,
            s: t.s,
            l: t.l,
          }),
          F({
            h: (n + 240) % 360,
            s: t.s,
            l: t.l,
          }),
        ];
      }
      function _(e) {
        var t = F(e).toHsl(),
          n = t.h;
        return [
          F(e),
          F({
            h: (n + 90) % 360,
            s: t.s,
            l: t.l,
          }),
          F({
            h: (n + 180) % 360,
            s: t.s,
            l: t.l,
          }),
          F({
            h: (n + 270) % 360,
            s: t.s,
            l: t.l,
          }),
        ];
      }
      function v(e) {
        var t = F(e).toHsl(),
          n = t.h;
        return [
          F(e),
          F({
            h: (n + 72) % 360,
            s: t.s,
            l: t.l,
          }),
          F({
            h: (n + 216) % 360,
            s: t.s,
            l: t.l,
          }),
        ];
      }
      function y(e, t, n) {
        (t = t || 6), (n = n || 30);
        var i = F(e).toHsl(),
          r = 360 / n,
          s = [F(e)];
        for (i.h = (i.h - ((r * t) >> 1) + 720) % 360; --t; )
          (i.h = (i.h + r) % 360), s.push(F(i));
        return s;
      }
      function b(e, t) {
        t = t || 6;
        for (
          var n = F(e).toHsv(), i = n.h, r = n.s, s = n.v, o = [], a = 1 / t;
          t--;

        )
          o.push(
            F({
              h: i,
              s: r,
              v: s,
            })
          ),
            (s = (s + a) % 1);
        return o;
      }
      function w(e) {
        var t = {};
        for (var n in e) e.hasOwnProperty(n) && (t[e[n]] = n);
        return t;
      }
      function C(e) {
        return (e = parseFloat(e)), (isNaN(e) || 0 > e || e > 1) && (e = 1), e;
      }
      function k(e, t) {
        x(e) && (e = "100%");
        var n = E(e);
        return (
          (e = U(t, $(0, parseFloat(e)))),
          n && (e = parseInt(e * t, 10) / 100),
          j.abs(e - t) < 1e-6 ? 1 : (e % t) / parseFloat(t)
        );
      }
      function T(e) {
        return U(1, $(0, e));
      }
      function S(e) {
        return parseInt(e, 16);
      }
      function x(e) {
        return (
          "string" == typeof e && -1 != e.indexOf(".") && 1 === parseFloat(e)
        );
      }
      function E(e) {
        return "string" == typeof e && -1 != e.indexOf("%");
      }
      function P(e) {
        return 1 == e.length ? "0" + e : "" + e;
      }
      function I(e) {
        return 1 >= e && (e = 100 * e + "%"), e;
      }
      function A(e) {
        return Math.round(255 * parseFloat(e)).toString(16);
      }
      function O(e) {
        return S(e) / 255;
      }
      function D(e) {
        e = e.replace(M, "").replace(R, "").toLowerCase();
        var t = !1;
        if (H[e]) (e = H[e]), (t = !0);
        else if ("transparent" == e)
          return {
            r: 0,
            g: 0,
            b: 0,
            a: 0,
            format: "name",
          };
        var n;
        return (n = z.rgb.exec(e))
          ? {
              r: n[1],
              g: n[2],
              b: n[3],
            }
          : (n = z.rgba.exec(e))
          ? {
              r: n[1],
              g: n[2],
              b: n[3],
              a: n[4],
            }
          : (n = z.hsl.exec(e))
          ? {
              h: n[1],
              s: n[2],
              l: n[3],
            }
          : (n = z.hsla.exec(e))
          ? {
              h: n[1],
              s: n[2],
              l: n[3],
              a: n[4],
            }
          : (n = z.hsv.exec(e))
          ? {
              h: n[1],
              s: n[2],
              v: n[3],
            }
          : (n = z.hsva.exec(e))
          ? {
              h: n[1],
              s: n[2],
              v: n[3],
              a: n[4],
            }
          : (n = z.hex8.exec(e))
          ? {
              a: O(n[1]),
              r: S(n[2]),
              g: S(n[3]),
              b: S(n[4]),
              format: t ? "name" : "hex8",
            }
          : (n = z.hex6.exec(e))
          ? {
              r: S(n[1]),
              g: S(n[2]),
              b: S(n[3]),
              format: t ? "name" : "hex",
            }
          : (n = z.hex3.exec(e))
          ? {
              r: S(n[1] + "" + n[1]),
              g: S(n[2] + "" + n[2]),
              b: S(n[3] + "" + n[3]),
              format: t ? "name" : "hex",
            }
          : !1;
      }
      var M = /^[\s,#]+/,
        R = /\s+$/,
        L = 0,
        j = Math,
        N = j.round,
        U = j.min,
        $ = j.max,
        B = j.random,
        F = function (t, n) {
          if (((t = t ? t : ""), (n = n || {}), t instanceof F)) return t;
          if (!(this instanceof F)) return new F(t, n);
          var i = e(t);
          (this._originalInput = t),
            (this._r = i.r),
            (this._g = i.g),
            (this._b = i.b),
            (this._a = i.a),
            (this._roundA = N(100 * this._a) / 100),
            (this._format = n.format || i.format),
            (this._gradientType = n.gradientType),
            this._r < 1 && (this._r = N(this._r)),
            this._g < 1 && (this._g = N(this._g)),
            this._b < 1 && (this._b = N(this._b)),
            (this._ok = i.ok),
            (this._tc_id = L++);
        };
      (F.prototype = {
        isDark: function () {
          return this.getBrightness() < 128;
        },
        isLight: function () {
          return !this.isDark();
        },
        isValid: function () {
          return this._ok;
        },
        getOriginalInput: function () {
          return this._originalInput;
        },
        getFormat: function () {
          return this._format;
        },
        getAlpha: function () {
          return this._a;
        },
        getBrightness: function () {
          var e = this.toRgb();
          return (299 * e.r + 587 * e.g + 114 * e.b) / 1e3;
        },
        setAlpha: function (e) {
          return (
            (this._a = C(e)), (this._roundA = N(100 * this._a) / 100), this
          );
        },
        toHsv: function () {
          var e = r(this._r, this._g, this._b);
          return {
            h: 360 * e.h,
            s: e.s,
            v: e.v,
            a: this._a,
          };
        },
        toHsvString: function () {
          var e = r(this._r, this._g, this._b),
            t = N(360 * e.h),
            n = N(100 * e.s),
            i = N(100 * e.v);
          return 1 == this._a
            ? "hsv(" + t + ", " + n + "%, " + i + "%)"
            : "hsva(" + t + ", " + n + "%, " + i + "%, " + this._roundA + ")";
        },
        toHsl: function () {
          var e = n(this._r, this._g, this._b);
          return {
            h: 360 * e.h,
            s: e.s,
            l: e.l,
            a: this._a,
          };
        },
        toHslString: function () {
          var e = n(this._r, this._g, this._b),
            t = N(360 * e.h),
            i = N(100 * e.s),
            r = N(100 * e.l);
          return 1 == this._a
            ? "hsl(" + t + ", " + i + "%, " + r + "%)"
            : "hsla(" + t + ", " + i + "%, " + r + "%, " + this._roundA + ")";
        },
        toHex: function (e) {
          return o(this._r, this._g, this._b, e);
        },
        toHexString: function (e) {
          return "#" + this.toHex(e);
        },
        toHex8: function () {
          return a(this._r, this._g, this._b, this._a);
        },
        toHex8String: function () {
          return "#" + this.toHex8();
        },
        toRgb: function () {
          return {
            r: N(this._r),
            g: N(this._g),
            b: N(this._b),
            a: this._a,
          };
        },
        toRgbString: function () {
          return 1 == this._a
            ? "rgb(" + N(this._r) + ", " + N(this._g) + ", " + N(this._b) + ")"
            : "rgba(" +
                N(this._r) +
                ", " +
                N(this._g) +
                ", " +
                N(this._b) +
                ", " +
                this._roundA +
                ")";
        },
        toPercentageRgb: function () {
          return {
            r: N(100 * k(this._r, 255)) + "%",
            g: N(100 * k(this._g, 255)) + "%",
            b: N(100 * k(this._b, 255)) + "%",
            a: this._a,
          };
        },
        toPercentageRgbString: function () {
          return 1 == this._a
            ? "rgb(" +
                N(100 * k(this._r, 255)) +
                "%, " +
                N(100 * k(this._g, 255)) +
                "%, " +
                N(100 * k(this._b, 255)) +
                "%)"
            : "rgba(" +
                N(100 * k(this._r, 255)) +
                "%, " +
                N(100 * k(this._g, 255)) +
                "%, " +
                N(100 * k(this._b, 255)) +
                "%, " +
                this._roundA +
                ")";
        },
        toName: function () {
          return 0 === this._a
            ? "transparent"
            : this._a < 1
            ? !1
            : W[o(this._r, this._g, this._b, !0)] || !1;
        },
        toFilter: function (e) {
          var t = "#" + a(this._r, this._g, this._b, this._a),
            n = t,
            i = this._gradientType ? "GradientType = 1, " : "";
          if (e) {
            var r = F(e);
            n = r.toHex8String();
          }
          return (
            "progid:DXImageTransform.Microsoft.gradient(" +
            i +
            "startColorstr=" +
            t +
            ",endColorstr=" +
            n +
            ")"
          );
        },
        toString: function (e) {
          var t = !!e;
          e = e || this._format;
          var n = !1,
            i = this._a < 1 && this._a >= 0,
            r =
              !t &&
              i &&
              ("hex" === e || "hex6" === e || "hex3" === e || "name" === e);
          return r
            ? "name" === e && 0 === this._a
              ? this.toName()
              : this.toRgbString()
            : ("rgb" === e && (n = this.toRgbString()),
              "prgb" === e && (n = this.toPercentageRgbString()),
              ("hex" === e || "hex6" === e) && (n = this.toHexString()),
              "hex3" === e && (n = this.toHexString(!0)),
              "hex8" === e && (n = this.toHex8String()),
              "name" === e && (n = this.toName()),
              "hsl" === e && (n = this.toHslString()),
              "hsv" === e && (n = this.toHsvString()),
              n || this.toHexString());
        },
        _applyModification: function (e, t) {
          var n = e.apply(null, [this].concat([].slice.call(t)));
          return (
            (this._r = n._r),
            (this._g = n._g),
            (this._b = n._b),
            this.setAlpha(n._a),
            this
          );
        },
        lighten: function () {
          return this._applyModification(d, arguments);
        },
        brighten: function () {
          return this._applyModification(h, arguments);
        },
        darken: function () {
          return this._applyModification(p, arguments);
        },
        desaturate: function () {
          return this._applyModification(l, arguments);
        },
        saturate: function () {
          return this._applyModification(c, arguments);
        },
        greyscale: function () {
          return this._applyModification(u, arguments);
        },
        spin: function () {
          return this._applyModification(f, arguments);
        },
        _applyCombination: function (e, t) {
          return e.apply(null, [this].concat([].slice.call(t)));
        },
        analogous: function () {
          return this._applyCombination(y, arguments);
        },
        complement: function () {
          return this._applyCombination(m, arguments);
        },
        monochromatic: function () {
          return this._applyCombination(b, arguments);
        },
        splitcomplement: function () {
          return this._applyCombination(v, arguments);
        },
        triad: function () {
          return this._applyCombination(g, arguments);
        },
        tetrad: function () {
          return this._applyCombination(_, arguments);
        },
      }),
        (F.fromRatio = function (e, t) {
          if ("object" == typeof e) {
            var n = {};
            for (var i in e)
              e.hasOwnProperty(i) && (n[i] = "a" === i ? e[i] : I(e[i]));
            e = n;
          }
          return F(e, t);
        }),
        (F.equals = function (e, t) {
          return e && t ? F(e).toRgbString() == F(t).toRgbString() : !1;
        }),
        (F.random = function () {
          return F.fromRatio({
            r: B(),
            g: B(),
            b: B(),
          });
        }),
        (F.mix = function (e, t, n) {
          n = 0 === n ? 0 : n || 50;
          var i,
            r = F(e).toRgb(),
            s = F(t).toRgb(),
            o = n / 100,
            a = 2 * o - 1,
            l = s.a - r.a;
          (i = a * l == -1 ? a : (a + l) / (1 + a * l)), (i = (i + 1) / 2);
          var c = 1 - i,
            u = {
              r: s.r * i + r.r * c,
              g: s.g * i + r.g * c,
              b: s.b * i + r.b * c,
              a: s.a * o + r.a * (1 - o),
            };
          return F(u);
        }),
        (F.readability = function (e, t) {
          var n = F(e),
            i = F(t),
            r = n.toRgb(),
            s = i.toRgb(),
            o = n.getBrightness(),
            a = i.getBrightness(),
            l =
              Math.max(r.r, s.r) -
              Math.min(r.r, s.r) +
              Math.max(r.g, s.g) -
              Math.min(r.g, s.g) +
              Math.max(r.b, s.b) -
              Math.min(r.b, s.b);
          return {
            brightness: Math.abs(o - a),
            color: l,
          };
        }),
        (F.isReadable = function (e, t) {
          var n = F.readability(e, t);
          return n.brightness > 125 && n.color > 500;
        }),
        (F.mostReadable = function (e, t) {
          for (var n = null, i = 0, r = !1, s = 0; s < t.length; s++) {
            var o = F.readability(e, t[s]),
              a = o.brightness > 125 && o.color > 500,
              l = 3 * (o.brightness / 125) + o.color / 500;
            ((a && !r) || (a && r && l > i) || (!a && !r && l > i)) &&
              ((r = a), (i = l), (n = F(t[s])));
          }
          return n;
        });
      var H = (F.names = {
          aliceblue: "f0f8ff",
          antiquewhite: "faebd7",
          aqua: "0ff",
          aquamarine: "7fffd4",
          azure: "f0ffff",
          beige: "f5f5dc",
          bisque: "ffe4c4",
          black: "000",
          blanchedalmond: "ffebcd",
          blue: "00f",
          blueviolet: "8a2be2",
          brown: "a52a2a",
          burlywood: "deb887",
          burntsienna: "ea7e5d",
          cadetblue: "5f9ea0",
          chartreuse: "7fff00",
          chocolate: "d2691e",
          coral: "ff7f50",
          cornflowerblue: "6495ed",
          cornsilk: "fff8dc",
          crimson: "dc143c",
          cyan: "0ff",
          darkblue: "00008b",
          darkcyan: "008b8b",
          darkgoldenrod: "b8860b",
          darkgray: "a9a9a9",
          darkgreen: "006400",
          darkgrey: "a9a9a9",
          darkkhaki: "bdb76b",
          darkmagenta: "8b008b",
          darkolivegreen: "556b2f",
          darkorange: "ff8c00",
          darkorchid: "9932cc",
          darkred: "8b0000",
          darksalmon: "e9967a",
          darkseagreen: "8fbc8f",
          darkslateblue: "483d8b",
          darkslategray: "2f4f4f",
          darkslategrey: "2f4f4f",
          darkturquoise: "00ced1",
          darkviolet: "9400d3",
          deeppink: "ff1493",
          deepskyblue: "00bfff",
          dimgray: "696969",
          dimgrey: "696969",
          dodgerblue: "1e90ff",
          firebrick: "b22222",
          floralwhite: "fffaf0",
          forestgreen: "228b22",
          fuchsia: "f0f",
          gainsboro: "dcdcdc",
          ghostwhite: "f8f8ff",
          gold: "ffd700",
          goldenrod: "daa520",
          gray: "808080",
          green: "008000",
          greenyellow: "adff2f",
          grey: "808080",
          honeydew: "f0fff0",
          hotpink: "ff69b4",
          indianred: "cd5c5c",
          indigo: "4b0082",
          ivory: "fffff0",
          khaki: "f0e68c",
          lavender: "e6e6fa",
          lavenderblush: "fff0f5",
          lawngreen: "7cfc00",
          lemonchiffon: "fffacd",
          lightblue: "add8e6",
          lightcoral: "f08080",
          lightcyan: "e0ffff",
          lightgoldenrodyellow: "fafad2",
          lightgray: "d3d3d3",
          lightgreen: "90ee90",
          lightgrey: "d3d3d3",
          lightpink: "ffb6c1",
          lightsalmon: "ffa07a",
          lightseagreen: "20b2aa",
          lightskyblue: "87cefa",
          lightslategray: "789",
          lightslategrey: "789",
          lightsteelblue: "b0c4de",
          lightyellow: "ffffe0",
          lime: "0f0",
          limegreen: "32cd32",
          linen: "faf0e6",
          magenta: "f0f",
          maroon: "800000",
          mediumaquamarine: "66cdaa",
          mediumblue: "0000cd",
          mediumorchid: "ba55d3",
          mediumpurple: "9370db",
          mediumseagreen: "3cb371",
          mediumslateblue: "7b68ee",
          mediumspringgreen: "00fa9a",
          mediumturquoise: "48d1cc",
          mediumvioletred: "c71585",
          midnightblue: "191970",
          mintcream: "f5fffa",
          mistyrose: "ffe4e1",
          moccasin: "ffe4b5",
          navajowhite: "ffdead",
          navy: "000080",
          oldlace: "fdf5e6",
          olive: "808000",
          olivedrab: "6b8e23",
          orange: "ffa500",
          orangered: "ff4500",
          orchid: "da70d6",
          palegoldenrod: "eee8aa",
          palegreen: "98fb98",
          paleturquoise: "afeeee",
          palevioletred: "db7093",
          papayawhip: "ffefd5",
          peachpuff: "ffdab9",
          peru: "cd853f",
          pink: "ffc0cb",
          plum: "dda0dd",
          powderblue: "b0e0e6",
          purple: "800080",
          rebeccapurple: "663399",
          red: "f00",
          rosybrown: "bc8f8f",
          royalblue: "4169e1",
          saddlebrown: "8b4513",
          salmon: "fa8072",
          sandybrown: "f4a460",
          seagreen: "2e8b57",
          seashell: "fff5ee",
          sienna: "a0522d",
          silver: "c0c0c0",
          skyblue: "87ceeb",
          slateblue: "6a5acd",
          slategray: "708090",
          slategrey: "708090",
          snow: "fffafa",
          springgreen: "00ff7f",
          steelblue: "4682b4",
          tan: "d2b48c",
          teal: "008080",
          thistle: "d8bfd8",
          tomato: "ff6347",
          turquoise: "40e0d0",
          violet: "ee82ee",
          wheat: "f5deb3",
          white: "fff",
          whitesmoke: "f5f5f5",
          yellow: "ff0",
          yellowgreen: "9acd32",
        }),
        W = (F.hexNames = w(H)),
        z = (function () {
          var e = "[-\\+]?\\d+%?",
            t = "[-\\+]?\\d*\\.\\d+%?",
            n = "(?:" + t + ")|(?:" + e + ")",
            i =
              "[\\s|\\(]+(" +
              n +
              ")[,|\\s]+(" +
              n +
              ")[,|\\s]+(" +
              n +
              ")\\s*\\)?",
            r =
              "[\\s|\\(]+(" +
              n +
              ")[,|\\s]+(" +
              n +
              ")[,|\\s]+(" +
              n +
              ")[,|\\s]+(" +
              n +
              ")\\s*\\)?";
          return {
            rgb: new RegExp("rgb" + i),
            rgba: new RegExp("rgba" + r),
            hsl: new RegExp("hsl" + i),
            hsla: new RegExp("hsla" + r),
            hsv: new RegExp("hsv" + i),
            hsva: new RegExp("hsva" + r),
            hex3: /^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,
            hex6: /^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,
            hex8: /^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,
          };
        })();
      window.tinycolor = F;
    })(),
    e(function () {
      e.fn.spectrum.load && e.fn.spectrum.processNativeColorInputs();
    });
}),
  /*!
   * clipboard.js v1.6.1
   * https://zenorocha.github.io/clipboard.js
   *
   * Licensed MIT  Zeno Rocha
   */
  (function (e) {
    if ("object" == typeof exports && "undefined" != typeof module)
      module.exports = e();
    else if ("function" == typeof define && define.amd) define([], e);
    else {
      var t;
      (t =
        "undefined" != typeof window
          ? window
          : "undefined" != typeof global
          ? global
          : "undefined" != typeof self
          ? self
          : this),
        (t.Clipboard = e());
    }
  })(function () {
    var e;
    return (function t(e, n, i) {
      function r(o, a) {
        if (!n[o]) {
          if (!e[o]) {
            var l = "function" == typeof require && require;
            if (!a && l) return l(o, !0);
            if (s) return s(o, !0);
            var c = new Error("Cannot find module '" + o + "'");
            throw ((c.code = "MODULE_NOT_FOUND"), c);
          }
          var u = (n[o] = {
            exports: {},
          });
          e[o][0].call(
            u.exports,
            function (t) {
              var n = e[o][1][t];
              return r(n ? n : t);
            },
            u,
            u.exports,
            t,
            e,
            n,
            i
          );
        }
        return n[o].exports;
      }
      for (
        var s = "function" == typeof require && require, o = 0;
        o < i.length;
        o++
      )
        r(i[o]);
      return r;
    })(
      {
        1: [
          function (e, t) {
            function n(e, t) {
              for (; e && e.nodeType !== i; ) {
                if (e.matches(t)) return e;
                e = e.parentNode;
              }
            }
            var i = 9;
            if ("undefined" != typeof Element && !Element.prototype.matches) {
              var r = Element.prototype;
              r.matches =
                r.matchesSelector ||
                r.mozMatchesSelector ||
                r.msMatchesSelector ||
                r.oMatchesSelector ||
                r.webkitMatchesSelector;
            }
            t.exports = n;
          },
          {},
        ],
        2: [
          function (e, t) {
            function n(e, t, n, r, s) {
              var o = i.apply(this, arguments);
              return (
                e.addEventListener(n, o, s),
                {
                  destroy: function () {
                    e.removeEventListener(n, o, s);
                  },
                }
              );
            }
            function i(e, t, n, i) {
              return function (n) {
                (n.delegateTarget = r(n.target, t)),
                  n.delegateTarget && i.call(e, n);
              };
            }
            var r = e("./closest");
            t.exports = n;
          },
          {
            "./closest": 1,
          },
        ],
        3: [
          function (e, t, n) {
            (n.node = function (e) {
              return (
                void 0 !== e && e instanceof HTMLElement && 1 === e.nodeType
              );
            }),
              (n.nodeList = function (e) {
                var t = Object.prototype.toString.call(e);
                return (
                  void 0 !== e &&
                  ("[object NodeList]" === t ||
                    "[object HTMLCollection]" === t) &&
                  "length" in e &&
                  (0 === e.length || n.node(e[0]))
                );
              }),
              (n.string = function (e) {
                return "string" == typeof e || e instanceof String;
              }),
              (n.fn = function (e) {
                var t = Object.prototype.toString.call(e);
                return "[object Function]" === t;
              });
          },
          {},
        ],
        4: [
          function (e, t) {
            function n(e, t, n) {
              if (!e && !t && !n) throw new Error("Missing required arguments");
              if (!o.string(t))
                throw new TypeError("Second argument must be a String");
              if (!o.fn(n))
                throw new TypeError("Third argument must be a Function");
              if (o.node(e)) return i(e, t, n);
              if (o.nodeList(e)) return r(e, t, n);
              if (o.string(e)) return s(e, t, n);
              throw new TypeError(
                "First argument must be a String, HTMLElement, HTMLCollection, or NodeList"
              );
            }
            function i(e, t, n) {
              return (
                e.addEventListener(t, n),
                {
                  destroy: function () {
                    e.removeEventListener(t, n);
                  },
                }
              );
            }
            function r(e, t, n) {
              return (
                Array.prototype.forEach.call(e, function (e) {
                  e.addEventListener(t, n);
                }),
                {
                  destroy: function () {
                    Array.prototype.forEach.call(e, function (e) {
                      e.removeEventListener(t, n);
                    });
                  },
                }
              );
            }
            function s(e, t, n) {
              return a(document.body, e, t, n);
            }
            var o = e("./is"),
              a = e("delegate");
            t.exports = n;
          },
          {
            "./is": 3,
            delegate: 2,
          },
        ],
        5: [
          function (e, t) {
            function n(e) {
              var t;
              if ("SELECT" === e.nodeName) e.focus(), (t = e.value);
              else if ("INPUT" === e.nodeName || "TEXTAREA" === e.nodeName) {
                var n = e.hasAttribute("readonly");
                n || e.setAttribute("readonly", ""),
                  e.select(),
                  e.setSelectionRange(0, e.value.length),
                  n || e.removeAttribute("readonly"),
                  (t = e.value);
              } else {
                e.hasAttribute("contenteditable") && e.focus();
                var i = window.getSelection(),
                  r = document.createRange();
                r.selectNodeContents(e),
                  i.removeAllRanges(),
                  i.addRange(r),
                  (t = i.toString());
              }
              return t;
            }
            t.exports = n;
          },
          {},
        ],
        6: [
          function (e, t) {
            function n() {}
            (n.prototype = {
              on: function (e, t, n) {
                var i = this.e || (this.e = {});
                return (
                  (i[e] || (i[e] = [])).push({
                    fn: t,
                    ctx: n,
                  }),
                  this
                );
              },
              once: function (e, t, n) {
                function i() {
                  r.off(e, i), t.apply(n, arguments);
                }
                var r = this;
                return (i._ = t), this.on(e, i, n);
              },
              emit: function (e) {
                var t = [].slice.call(arguments, 1),
                  n = ((this.e || (this.e = {}))[e] || []).slice(),
                  i = 0,
                  r = n.length;
                for (i; r > i; i++) n[i].fn.apply(n[i].ctx, t);
                return this;
              },
              off: function (e, t) {
                var n = this.e || (this.e = {}),
                  i = n[e],
                  r = [];
                if (i && t)
                  for (var s = 0, o = i.length; o > s; s++)
                    i[s].fn !== t && i[s].fn._ !== t && r.push(i[s]);
                return r.length ? (n[e] = r) : delete n[e], this;
              },
            }),
              (t.exports = n);
          },
          {},
        ],
        7: [
          function (t, n, i) {
            !(function (r, s) {
              if ("function" == typeof e && e.amd) e(["module", "select"], s);
              else if ("undefined" != typeof i) s(n, t("select"));
              else {
                var o = {
                  exports: {},
                };
                s(o, r.select), (r.clipboardAction = o.exports);
              }
            })(this, function (e, t) {
              "use strict";
              function n(e) {
                return e && e.__esModule
                  ? e
                  : {
                      default: e,
                    };
              }
              function i(e, t) {
                if (!(e instanceof t))
                  throw new TypeError("Cannot call a class as a function");
              }
              var r = n(t),
                s =
                  "function" == typeof Symbol &&
                  "symbol" == typeof Symbol.iterator
                    ? function (e) {
                        return typeof e;
                      }
                    : function (e) {
                        return e &&
                          "function" == typeof Symbol &&
                          e.constructor === Symbol &&
                          e !== Symbol.prototype
                          ? "symbol"
                          : typeof e;
                      },
                o = (function () {
                  function e(e, t) {
                    for (var n = 0; n < t.length; n++) {
                      var i = t[n];
                      (i.enumerable = i.enumerable || !1),
                        (i.configurable = !0),
                        "value" in i && (i.writable = !0),
                        Object.defineProperty(e, i.key, i);
                    }
                  }
                  return function (t, n, i) {
                    return n && e(t.prototype, n), i && e(t, i), t;
                  };
                })(),
                a = (function () {
                  function e(t) {
                    i(this, e), this.resolveOptions(t), this.initSelection();
                  }
                  return (
                    o(e, [
                      {
                        key: "resolveOptions",
                        value: function () {
                          var e =
                            arguments.length > 0 && void 0 !== arguments[0]
                              ? arguments[0]
                              : {};
                          (this.action = e.action),
                            (this.emitter = e.emitter),
                            (this.target = e.target),
                            (this.text = e.text),
                            (this.trigger = e.trigger),
                            (this.selectedText = "");
                        },
                      },
                      {
                        key: "initSelection",
                        value: function () {
                          this.text
                            ? this.selectFake()
                            : this.target && this.selectTarget();
                        },
                      },
                      {
                        key: "selectFake",
                        value: function () {
                          var e = this,
                            t =
                              "rtl" ==
                              document.documentElement.getAttribute("dir");
                          this.removeFake(),
                            (this.fakeHandlerCallback = function () {
                              return e.removeFake();
                            }),
                            (this.fakeHandler =
                              document.body.addEventListener(
                                "click",
                                this.fakeHandlerCallback
                              ) || !0),
                            (this.fakeElem =
                              document.createElement("textarea")),
                            (this.fakeElem.style.fontSize = "12pt"),
                            (this.fakeElem.style.border = "0"),
                            (this.fakeElem.style.padding = "0"),
                            (this.fakeElem.style.margin = "0"),
                            (this.fakeElem.style.position = "absolute"),
                            (this.fakeElem.style[t ? "right" : "left"] =
                              "-9999px");
                          var n =
                            window.pageYOffset ||
                            document.documentElement.scrollTop;
                          (this.fakeElem.style.top = n + "px"),
                            this.fakeElem.setAttribute("readonly", ""),
                            (this.fakeElem.value = this.text),
                            document.body.appendChild(this.fakeElem),
                            (this.selectedText = r["default"](this.fakeElem)),
                            this.copyText();
                        },
                      },
                      {
                        key: "removeFake",
                        value: function () {
                          this.fakeHandler &&
                            (document.body.removeEventListener(
                              "click",
                              this.fakeHandlerCallback
                            ),
                            (this.fakeHandler = null),
                            (this.fakeHandlerCallback = null)),
                            this.fakeElem &&
                              (document.body.removeChild(this.fakeElem),
                              (this.fakeElem = null));
                        },
                      },
                      {
                        key: "selectTarget",
                        value: function () {
                          (this.selectedText = r["default"](this.target)),
                            this.copyText();
                        },
                      },
                      {
                        key: "copyText",
                        value: function () {
                          var e = void 0;
                          try {
                            e = document.execCommand(this.action);
                          } catch (t) {
                            e = !1;
                          }
                          this.handleResult(e);
                        },
                      },
                      {
                        key: "handleResult",
                        value: function (e) {
                          this.emitter.emit(e ? "success" : "error", {
                            action: this.action,
                            text: this.selectedText,
                            trigger: this.trigger,
                            clearSelection: this.clearSelection.bind(this),
                          });
                        },
                      },
                      {
                        key: "clearSelection",
                        value: function () {
                          this.target && this.target.blur(),
                            window.getSelection().removeAllRanges();
                        },
                      },
                      {
                        key: "destroy",
                        value: function () {
                          this.removeFake();
                        },
                      },
                      {
                        key: "action",
                        set: function () {
                          var e =
                            arguments.length > 0 && void 0 !== arguments[0]
                              ? arguments[0]
                              : "copy";
                          if (
                            ((this._action = e),
                            "copy" !== this._action && "cut" !== this._action)
                          )
                            throw new Error(
                              'Invalid "action" value, use either "copy" or "cut"'
                            );
                        },
                        get: function () {
                          return this._action;
                        },
                      },
                      {
                        key: "target",
                        set: function (e) {
                          if (void 0 !== e) {
                            if (
                              !e ||
                              "object" !==
                                ("undefined" == typeof e
                                  ? "undefined"
                                  : s(e)) ||
                              1 !== e.nodeType
                            )
                              throw new Error(
                                'Invalid "target" value, use a valid Element'
                              );
                            if (
                              "copy" === this.action &&
                              e.hasAttribute("disabled")
                            )
                              throw new Error(
                                'Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute'
                              );
                            if (
                              "cut" === this.action &&
                              (e.hasAttribute("readonly") ||
                                e.hasAttribute("disabled"))
                            )
                              throw new Error(
                                'Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes'
                              );
                            this._target = e;
                          }
                        },
                        get: function () {
                          return this._target;
                        },
                      },
                    ]),
                    e
                  );
                })();
              e.exports = a;
            });
          },
          {
            select: 5,
          },
        ],
        8: [
          function (t, n, i) {
            !(function (r, s) {
              if ("function" == typeof e && e.amd)
                e(
                  [
                    "module",
                    "./clipboard-action",
                    "tiny-emitter",
                    "good-listener",
                  ],
                  s
                );
              else if ("undefined" != typeof i)
                s(
                  n,
                  t("./clipboard-action"),
                  t("tiny-emitter"),
                  t("good-listener")
                );
              else {
                var o = {
                  exports: {},
                };
                s(o, r.clipboardAction, r.tinyEmitter, r.goodListener),
                  (r.clipboard = o.exports);
              }
            })(this, function (e, t, n, i) {
              "use strict";
              function r(e) {
                return e && e.__esModule
                  ? e
                  : {
                      default: e,
                    };
              }
              function s(e, t) {
                if (!(e instanceof t))
                  throw new TypeError("Cannot call a class as a function");
              }
              function o(e, t) {
                if (!e)
                  throw new ReferenceError(
                    "this hasn't been initialised - super() hasn't been called"
                  );
                return !t || ("object" != typeof t && "function" != typeof t)
                  ? e
                  : t;
              }
              function a(e, t) {
                if ("function" != typeof t && null !== t)
                  throw new TypeError(
                    "Super expression must either be null or a function, not " +
                      typeof t
                  );
                (e.prototype = Object.create(t && t.prototype, {
                  constructor: {
                    value: e,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0,
                  },
                })),
                  t &&
                    (Object.setPrototypeOf
                      ? Object.setPrototypeOf(e, t)
                      : (e.__proto__ = t));
              }
              function l(e, t) {
                var n = "data-clipboard-" + e;
                if (t.hasAttribute(n)) return t.getAttribute(n);
              }
              var c = r(t),
                u = r(n),
                d = r(i),
                h = (function () {
                  function e(e, t) {
                    for (var n = 0; n < t.length; n++) {
                      var i = t[n];
                      (i.enumerable = i.enumerable || !1),
                        (i.configurable = !0),
                        "value" in i && (i.writable = !0),
                        Object.defineProperty(e, i.key, i);
                    }
                  }
                  return function (t, n, i) {
                    return n && e(t.prototype, n), i && e(t, i), t;
                  };
                })(),
                p = (function (e) {
                  function t(e, n) {
                    s(this, t);
                    var i = o(
                      this,
                      (t.__proto__ || Object.getPrototypeOf(t)).call(this)
                    );
                    return i.resolveOptions(n), i.listenClick(e), i;
                  }
                  return (
                    a(t, e),
                    h(
                      t,
                      [
                        {
                          key: "resolveOptions",
                          value: function () {
                            var e =
                              arguments.length > 0 && void 0 !== arguments[0]
                                ? arguments[0]
                                : {};
                            (this.action =
                              "function" == typeof e.action
                                ? e.action
                                : this.defaultAction),
                              (this.target =
                                "function" == typeof e.target
                                  ? e.target
                                  : this.defaultTarget),
                              (this.text =
                                "function" == typeof e.text
                                  ? e.text
                                  : this.defaultText);
                          },
                        },
                        {
                          key: "listenClick",
                          value: function (e) {
                            var t = this;
                            this.listener = d["default"](
                              e,
                              "click",
                              function (e) {
                                return t.onClick(e);
                              }
                            );
                          },
                        },
                        {
                          key: "onClick",
                          value: function (e) {
                            var t = e.delegateTarget || e.currentTarget;
                            this.clipboardAction &&
                              (this.clipboardAction = null),
                              (this.clipboardAction = new c["default"]({
                                action: this.action(t),
                                target: this.target(t),
                                text: this.text(t),
                                trigger: t,
                                emitter: this,
                              }));
                          },
                        },
                        {
                          key: "defaultAction",
                          value: function (e) {
                            return l("action", e);
                          },
                        },
                        {
                          key: "defaultTarget",
                          value: function (e) {
                            var t = l("target", e);
                            return t ? document.querySelector(t) : void 0;
                          },
                        },
                        {
                          key: "defaultText",
                          value: function (e) {
                            return l("text", e);
                          },
                        },
                        {
                          key: "destroy",
                          value: function () {
                            this.listener.destroy(),
                              this.clipboardAction &&
                                (this.clipboardAction.destroy(),
                                (this.clipboardAction = null));
                          },
                        },
                      ],
                      [
                        {
                          key: "isSupported",
                          value: function () {
                            var e =
                                arguments.length > 0 && void 0 !== arguments[0]
                                  ? arguments[0]
                                  : ["copy", "cut"],
                              t = "string" == typeof e ? [e] : e,
                              n = !!document.queryCommandSupported;
                            return (
                              t.forEach(function (e) {
                                n = n && !!document.queryCommandSupported(e);
                              }),
                              n
                            );
                          },
                        },
                      ]
                    ),
                    t
                  );
                })(u["default"]);
              e.exports = p;
            });
          },
          {
            "./clipboard-action": 7,
            "good-listener": 4,
            "tiny-emitter": 6,
          },
        ],
      },
      {},
      [8]
    )(8);
  }),
  /*! algoliasearch 3.19.0 |  2014, 2015 Algolia SAS | github.com/algolia/algoliasearch-client-js */
  !(function (e) {
    var t;
    "undefined" != typeof window
      ? (t = window)
      : "undefined" != typeof self && (t = self),
      (t.ALGOLIA_MIGRATION_LAYER = e());
  })(function () {
    return (function e(t, n, i) {
      function r(o, a) {
        if (!n[o]) {
          if (!t[o]) {
            var l = "function" == typeof require && require;
            if (!a && l) return l(o, !0);
            if (s) return s(o, !0);
            var c = new Error("Cannot find module '" + o + "'");
            throw ((c.code = "MODULE_NOT_FOUND"), c);
          }
          var u = (n[o] = {
            exports: {},
          });
          t[o][0].call(
            u.exports,
            function (e) {
              var n = t[o][1][e];
              return r(n ? n : e);
            },
            u,
            u.exports,
            e,
            t,
            n,
            i
          );
        }
        return n[o].exports;
      }
      for (
        var s = "function" == typeof require && require, o = 0;
        o < i.length;
        o++
      )
        r(i[o]);
      return r;
    })(
      {
        1: [
          function (e, t) {
            function n(e, t) {
              for (var n in t) e.setAttribute(n, t[n]);
            }
            function i(e, t) {
              (e.onload = function () {
                (this.onerror = this.onload = null), t(null, e);
              }),
                (e.onerror = function () {
                  (this.onerror = this.onload = null),
                    t(new Error("Failed to load " + this.src), e);
                });
            }
            function r(e, t) {
              e.onreadystatechange = function () {
                ("complete" != this.readyState &&
                  "loaded" != this.readyState) ||
                  ((this.onreadystatechange = null), t(null, e));
              };
            }
            t.exports = function (e, t, s) {
              var o = document.head || document.getElementsByTagName("head")[0],
                a = document.createElement("script");
              "function" == typeof t && ((s = t), (t = {})),
                (t = t || {}),
                (s = s || function () {}),
                (a.type = t.type || "text/javascript"),
                (a.charset = t.charset || "utf8"),
                (a.async = !("async" in t && !t.async)),
                (a.src = e),
                t.attrs && n(a, t.attrs),
                t.text && (a.text = "" + t.text);
              var l = "onload" in a ? i : r;
              l(a, s), a.onload || i(a, s), o.appendChild(a);
            };
          },
          {},
        ],
        2: [
          function (e, t) {
            "use strict";
            function n(e) {
              for (
                var t = new RegExp(
                    "cdn\\.jsdelivr\\.net/algoliasearch/latest/" +
                      e.replace(".", "\\.") +
                      "(?:\\.min)?\\.js$"
                  ),
                  n = document.getElementsByTagName("script"),
                  i = !1,
                  r = 0,
                  s = n.length;
                s > r;
                r++
              )
                if (n[r].src && t.test(n[r].src)) {
                  i = !0;
                  break;
                }
              return i;
            }
            t.exports = n;
          },
          {},
        ],
        3: [
          function (e, t) {
            "use strict";
            function n(t) {
              var n = e(1),
                r = "//cdn.jsdelivr.net/algoliasearch/2/" + t + ".min.js",
                s =
                  "-- AlgoliaSearch `latest` warning --\nWarning, you are using the `latest` version string from jsDelivr to load the AlgoliaSearch library.\nUsing `latest` is no more recommended, you should load //cdn.jsdelivr.net/algoliasearch/2/algoliasearch.min.js\n\nAlso, we updated the AlgoliaSearch JavaScript client to V3. If you want to upgrade,\nplease read our migration guide at https://github.com/algolia/algoliasearch-client-js/wiki/Migration-guide-from-2.x.x-to-3.x.x\n-- /AlgoliaSearch  `latest` warning --";
              window.console &&
                (window.console.warn
                  ? window.console.warn(s)
                  : window.console.log && window.console.log(s));
              try {
                document.write(
                  "<script>window.ALGOLIA_SUPPORTS_DOCWRITE = true</script>"
                ),
                  window.ALGOLIA_SUPPORTS_DOCWRITE === !0
                    ? (document.write('<script src="' + r + '"></script>'),
                      i("document.write")())
                    : n(r, i("DOMElement"));
              } catch (o) {
                n(r, i("DOMElement"));
              }
            }
            function i(e) {
              return function () {
                var t = "AlgoliaSearch: loaded V2 script using " + e;
                window.console && window.console.log && window.console.log(t);
              };
            }
            t.exports = n;
          },
          {
            1: 1,
          },
        ],
        4: [
          function (e, t) {
            "use strict";
            function n() {
              var e =
                "-- AlgoliaSearch V2 => V3 error --\nYou are trying to use a new version of the AlgoliaSearch JavaScript client with an old notation.\nPlease read our migration guide at https://github.com/algolia/algoliasearch-client-js/wiki/Migration-guide-from-2.x.x-to-3.x.x\n-- /AlgoliaSearch V2 => V3 error --";
              (window.AlgoliaSearch = function () {
                throw new Error(e);
              }),
                (window.AlgoliaSearchHelper = function () {
                  throw new Error(e);
                }),
                (window.AlgoliaExplainResults = function () {
                  throw new Error(e);
                });
            }
            t.exports = n;
          },
          {},
        ],
        5: [
          function (e) {
            "use strict";
            function t(t) {
              var n = e(2),
                i = e(3),
                r = e(4);
              n(t) ? i(t) : r();
            }
            t("algoliasearch");
          },
          {
            2: 2,
            3: 3,
            4: 4,
          },
        ],
      },
      {},
      [5]
    )(5);
  }),
  (function (e) {
    if ("object" == typeof exports && "undefined" != typeof module)
      module.exports = e();
    else if ("function" == typeof define && define.amd) define([], e);
    else {
      var t;
      (t =
        "undefined" != typeof window
          ? window
          : "undefined" != typeof global
          ? global
          : "undefined" != typeof self
          ? self
          : this),
        (t.algoliasearch = e());
    }
  })(function () {
    var e;
    return (function t(e, n, i) {
      function r(o, a) {
        if (!n[o]) {
          if (!e[o]) {
            var l = "function" == typeof require && require;
            if (!a && l) return l(o, !0);
            if (s) return s(o, !0);
            var c = new Error("Cannot find module '" + o + "'");
            throw ((c.code = "MODULE_NOT_FOUND"), c);
          }
          var u = (n[o] = {
            exports: {},
          });
          e[o][0].call(
            u.exports,
            function (t) {
              var n = e[o][1][t];
              return r(n ? n : t);
            },
            u,
            u.exports,
            t,
            e,
            n,
            i
          );
        }
        return n[o].exports;
      }
      for (
        var s = "function" == typeof require && require, o = 0;
        o < i.length;
        o++
      )
        r(i[o]);
      return r;
    })(
      {
        1: [
          function (e, t) {
            function n(e) {
              if (((e = "" + e), !(e.length > 1e4))) {
                var t =
                  /^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(
                    e
                  );
                if (t) {
                  var n = parseFloat(t[1]),
                    i = (t[2] || "ms").toLowerCase();
                  switch (i) {
                    case "years":
                    case "year":
                    case "yrs":
                    case "yr":
                    case "y":
                      return n * u;
                    case "days":
                    case "day":
                    case "d":
                      return n * c;
                    case "hours":
                    case "hour":
                    case "hrs":
                    case "hr":
                    case "h":
                      return n * l;
                    case "minutes":
                    case "minute":
                    case "mins":
                    case "min":
                    case "m":
                      return n * a;
                    case "seconds":
                    case "second":
                    case "secs":
                    case "sec":
                    case "s":
                      return n * o;
                    case "milliseconds":
                    case "millisecond":
                    case "msecs":
                    case "msec":
                    case "ms":
                      return n;
                  }
                }
              }
            }
            function i(e) {
              return e >= c
                ? Math.round(e / c) + "d"
                : e >= l
                ? Math.round(e / l) + "h"
                : e >= a
                ? Math.round(e / a) + "m"
                : e >= o
                ? Math.round(e / o) + "s"
                : e + "ms";
            }
            function r(e) {
              return (
                s(e, c, "day") ||
                s(e, l, "hour") ||
                s(e, a, "minute") ||
                s(e, o, "second") ||
                e + " ms"
              );
            }
            function s(e, t, n) {
              return t > e
                ? void 0
                : 1.5 * t > e
                ? Math.floor(e / t) + " " + n
                : Math.ceil(e / t) + " " + n + "s";
            }
            var o = 1e3,
              a = 60 * o,
              l = 60 * a,
              c = 24 * l,
              u = 365.25 * c;
            t.exports = function (e, t) {
              return (
                (t = t || {}),
                "string" == typeof e ? n(e) : t["long"] ? r(e) : i(e)
              );
            };
          },
          {},
        ],
        2: [
          function (e, t) {
            function n() {
              throw new Error("setTimeout has not been defined");
            }
            function i() {
              throw new Error("clearTimeout has not been defined");
            }
            function r(e) {
              if (u === setTimeout) return setTimeout(e, 0);
              if ((u === n || !u) && setTimeout)
                return (u = setTimeout), setTimeout(e, 0);
              try {
                return u(e, 0);
              } catch (t) {
                try {
                  return u.call(null, e, 0);
                } catch (t) {
                  return u.call(this, e, 0);
                }
              }
            }
            function s(e) {
              if (d === clearTimeout) return clearTimeout(e);
              if ((d === i || !d) && clearTimeout)
                return (d = clearTimeout), clearTimeout(e);
              try {
                return d(e);
              } catch (t) {
                try {
                  return d.call(null, e);
                } catch (t) {
                  return d.call(this, e);
                }
              }
            }
            function o() {
              m &&
                p &&
                ((m = !1),
                p.length ? (f = p.concat(f)) : (g = -1),
                f.length && a());
            }
            function a() {
              if (!m) {
                var e = r(o);
                m = !0;
                for (var t = f.length; t; ) {
                  for (p = f, f = []; ++g < t; ) p && p[g].run();
                  (g = -1), (t = f.length);
                }
                (p = null), (m = !1), s(e);
              }
            }
            function l(e, t) {
              (this.fun = e), (this.array = t);
            }
            function c() {}
            var u,
              d,
              h = (t.exports = {});
            !(function () {
              try {
                u = "function" == typeof setTimeout ? setTimeout : n;
              } catch (e) {
                u = n;
              }
              try {
                d = "function" == typeof clearTimeout ? clearTimeout : i;
              } catch (e) {
                d = i;
              }
            })();
            var p,
              f = [],
              m = !1,
              g = -1;
            (h.nextTick = function (e) {
              var t = new Array(arguments.length - 1);
              if (arguments.length > 1)
                for (var n = 1; n < arguments.length; n++)
                  t[n - 1] = arguments[n];
              f.push(new l(e, t)), 1 !== f.length || m || r(a);
            }),
              (l.prototype.run = function () {
                this.fun.apply(null, this.array);
              }),
              (h.title = "browser"),
              (h.browser = !0),
              (h.env = {}),
              (h.argv = []),
              (h.version = ""),
              (h.versions = {}),
              (h.on = c),
              (h.addListener = c),
              (h.once = c),
              (h.off = c),
              (h.removeListener = c),
              (h.removeAllListeners = c),
              (h.emit = c),
              (h.binding = function () {
                throw new Error("process.binding is not supported");
              }),
              (h.cwd = function () {
                return "/";
              }),
              (h.chdir = function () {
                throw new Error("process.chdir is not supported");
              }),
              (h.umask = function () {
                return 0;
              });
          },
          {},
        ],
        3: [
          function (e, t, n) {
            function i() {
              return (
                "WebkitAppearance" in document.documentElement.style ||
                (window.console &&
                  (console.firebug || (console.exception && console.table))) ||
                (navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/) &&
                  parseInt(RegExp.$1, 10) >= 31)
              );
            }
            function r() {
              var e = arguments,
                t = this.useColors;
              if (
                ((e[0] =
                  (t ? "%c" : "") +
                  this.namespace +
                  (t ? " %c" : " ") +
                  e[0] +
                  (t ? "%c " : " ") +
                  "+" +
                  n.humanize(this.diff)),
                !t)
              )
                return e;
              var i = "color: " + this.color;
              e = [e[0], i, "color: inherit"].concat(
                Array.prototype.slice.call(e, 1)
              );
              var r = 0,
                s = 0;
              return (
                e[0].replace(/%[a-z%]/g, function (e) {
                  "%%" !== e && (r++, "%c" === e && (s = r));
                }),
                e.splice(s, 0, i),
                e
              );
            }
            function s() {
              return (
                "object" == typeof console &&
                console.log &&
                Function.prototype.apply.call(console.log, console, arguments)
              );
            }
            function o(e) {
              try {
                null == e
                  ? n.storage.removeItem("debug")
                  : (n.storage.debug = e);
              } catch (t) {}
            }
            function a() {
              var e;
              try {
                e = n.storage.debug;
              } catch (t) {}
              return e;
            }
            function l() {
              try {
                return window.localStorage;
              } catch (e) {}
            }
            (n = t.exports = e(4)),
              (n.log = s),
              (n.formatArgs = r),
              (n.save = o),
              (n.load = a),
              (n.useColors = i),
              (n.storage =
                "undefined" != typeof chrome &&
                "undefined" != typeof chrome.storage
                  ? chrome.storage.local
                  : l()),
              (n.colors = [
                "lightseagreen",
                "forestgreen",
                "goldenrod",
                "dodgerblue",
                "darkorchid",
                "crimson",
              ]),
              (n.formatters.j = function (e) {
                return JSON.stringify(e);
              }),
              n.enable(a());
          },
          {
            4: 4,
          },
        ],
        4: [
          function (e, t, n) {
            function i() {
              return n.colors[u++ % n.colors.length];
            }
            function r(e) {
              function t() {}
              function r() {
                var e = r,
                  t = +new Date(),
                  s = t - (c || t);
                (e.diff = s),
                  (e.prev = c),
                  (e.curr = t),
                  (c = t),
                  null == e.useColors && (e.useColors = n.useColors()),
                  null == e.color && e.useColors && (e.color = i());
                var o = Array.prototype.slice.call(arguments);
                (o[0] = n.coerce(o[0])),
                  "string" != typeof o[0] && (o = ["%o"].concat(o));
                var a = 0;
                (o[0] = o[0].replace(/%([a-z%])/g, function (t, i) {
                  if ("%%" === t) return t;
                  a++;
                  var r = n.formatters[i];
                  if ("function" == typeof r) {
                    var s = o[a];
                    (t = r.call(e, s)), o.splice(a, 1), a--;
                  }
                  return t;
                })),
                  "function" == typeof n.formatArgs &&
                    (o = n.formatArgs.apply(e, o));
                var l = r.log || n.log || console.log.bind(console);
                l.apply(e, o);
              }
              (t.enabled = !1), (r.enabled = !0);
              var s = n.enabled(e) ? r : t;
              return (s.namespace = e), s;
            }
            function s(e) {
              n.save(e);
              for (
                var t = (e || "").split(/[\s,]+/), i = t.length, r = 0;
                i > r;
                r++
              )
                t[r] &&
                  ((e = t[r].replace(/\*/g, ".*?")),
                  "-" === e[0]
                    ? n.skips.push(new RegExp("^" + e.substr(1) + "$"))
                    : n.names.push(new RegExp("^" + e + "$")));
            }
            function o() {
              n.enable("");
            }
            function a(e) {
              var t, i;
              for (t = 0, i = n.skips.length; i > t; t++)
                if (n.skips[t].test(e)) return !1;
              for (t = 0, i = n.names.length; i > t; t++)
                if (n.names[t].test(e)) return !0;
              return !1;
            }
            function l(e) {
              return e instanceof Error ? e.stack || e.message : e;
            }
            (n = t.exports = r),
              (n.coerce = l),
              (n.disable = o),
              (n.enable = s),
              (n.enabled = a),
              (n.humanize = e(1)),
              (n.names = []),
              (n.skips = []),
              (n.formatters = {});
            var c,
              u = 0;
          },
          {
            1: 1,
          },
        ],
        5: [
          function (t, n) {
            (function (i, r) {
              (function () {
                "use strict";
                function s(e) {
                  return (
                    "function" == typeof e ||
                    ("object" == typeof e && null !== e)
                  );
                }
                function o(e) {
                  return "function" == typeof e;
                }
                function a(e) {
                  Y = e;
                }
                function l(e) {
                  Z = e;
                }
                function c() {
                  return function () {
                    i.nextTick(f);
                  };
                }
                function u() {
                  return function () {
                    K(f);
                  };
                }
                function d() {
                  var e = 0,
                    t = new nt(f),
                    n = document.createTextNode("");
                  return (
                    t.observe(n, {
                      characterData: !0,
                    }),
                    function () {
                      n.data = e = ++e % 2;
                    }
                  );
                }
                function h() {
                  var e = new MessageChannel();
                  return (
                    (e.port1.onmessage = f),
                    function () {
                      e.port2.postMessage(0);
                    }
                  );
                }
                function p() {
                  return function () {
                    setTimeout(f, 1);
                  };
                }
                function f() {
                  for (var e = 0; J > e; e += 2) {
                    var t = st[e],
                      n = st[e + 1];
                    t(n), (st[e] = void 0), (st[e + 1] = void 0);
                  }
                  J = 0;
                }
                function m() {
                  try {
                    var e = t,
                      n = e("vertx");
                    return (K = n.runOnLoop || n.runOnContext), u();
                  } catch (i) {
                    return p();
                  }
                }
                function g(e, t) {
                  var n = this,
                    i = new this.constructor(v);
                  void 0 === i[lt] && N(i);
                  var r = n._state;
                  if (r) {
                    var s = arguments[r - 1];
                    Z(function () {
                      R(r, i, s, n._result);
                    });
                  } else A(n, i, e, t);
                  return i;
                }
                function _(e) {
                  var t = this;
                  if (e && "object" == typeof e && e.constructor === t)
                    return e;
                  var n = new t(v);
                  return x(n, e), n;
                }
                function v() {}
                function y() {
                  return new TypeError(
                    "You cannot resolve a promise with itself"
                  );
                }
                function b() {
                  return new TypeError(
                    "A promises callback cannot return that same promise."
                  );
                }
                function w(e) {
                  try {
                    return e.then;
                  } catch (t) {
                    return (ht.error = t), ht;
                  }
                }
                function C(e, t, n, i) {
                  try {
                    e.call(t, n, i);
                  } catch (r) {
                    return r;
                  }
                }
                function k(e, t, n) {
                  Z(function (e) {
                    var i = !1,
                      r = C(
                        n,
                        t,
                        function (n) {
                          i || ((i = !0), t !== n ? x(e, n) : P(e, n));
                        },
                        function (t) {
                          i || ((i = !0), I(e, t));
                        },
                        "Settle: " + (e._label || " unknown promise")
                      );
                    !i && r && ((i = !0), I(e, r));
                  }, e);
                }
                function T(e, t) {
                  t._state === ut
                    ? P(e, t._result)
                    : t._state === dt
                    ? I(e, t._result)
                    : A(
                        t,
                        void 0,
                        function (t) {
                          x(e, t);
                        },
                        function (t) {
                          I(e, t);
                        }
                      );
                }
                function S(e, t, n) {
                  t.constructor === e.constructor &&
                  n === ot &&
                  constructor.resolve === at
                    ? T(e, t)
                    : n === ht
                    ? I(e, ht.error)
                    : void 0 === n
                    ? P(e, t)
                    : o(n)
                    ? k(e, t, n)
                    : P(e, t);
                }
                function x(e, t) {
                  e === t ? I(e, y()) : s(t) ? S(e, t, w(t)) : P(e, t);
                }
                function E(e) {
                  e._onerror && e._onerror(e._result), O(e);
                }
                function P(e, t) {
                  e._state === ct &&
                    ((e._result = t),
                    (e._state = ut),
                    0 !== e._subscribers.length && Z(O, e));
                }
                function I(e, t) {
                  e._state === ct &&
                    ((e._state = dt), (e._result = t), Z(E, e));
                }
                function A(e, t, n, i) {
                  var r = e._subscribers,
                    s = r.length;
                  (e._onerror = null),
                    (r[s] = t),
                    (r[s + ut] = n),
                    (r[s + dt] = i),
                    0 === s && e._state && Z(O, e);
                }
                function O(e) {
                  var t = e._subscribers,
                    n = e._state;
                  if (0 !== t.length) {
                    for (var i, r, s = e._result, o = 0; o < t.length; o += 3)
                      (i = t[o]), (r = t[o + n]), i ? R(n, i, r, s) : r(s);
                    e._subscribers.length = 0;
                  }
                }
                function D() {
                  this.error = null;
                }
                function M(e, t) {
                  try {
                    return e(t);
                  } catch (n) {
                    return (pt.error = n), pt;
                  }
                }
                function R(e, t, n, i) {
                  var r,
                    s,
                    a,
                    l,
                    c = o(n);
                  if (c) {
                    if (
                      ((r = M(n, i)),
                      r === pt
                        ? ((l = !0), (s = r.error), (r = null))
                        : (a = !0),
                      t === r)
                    )
                      return void I(t, b());
                  } else (r = i), (a = !0);
                  t._state !== ct ||
                    (c && a
                      ? x(t, r)
                      : l
                      ? I(t, s)
                      : e === ut
                      ? P(t, r)
                      : e === dt && I(t, r));
                }
                function L(e, t) {
                  try {
                    t(
                      function (t) {
                        x(e, t);
                      },
                      function (t) {
                        I(e, t);
                      }
                    );
                  } catch (n) {
                    I(e, n);
                  }
                }
                function j() {
                  return ft++;
                }
                function N(e) {
                  (e[lt] = ft++),
                    (e._state = void 0),
                    (e._result = void 0),
                    (e._subscribers = []);
                }
                function U(e) {
                  return new yt(this, e).promise;
                }
                function $(e) {
                  var t = this;
                  return new t(
                    Q(e)
                      ? function (n, i) {
                          for (var r = e.length, s = 0; r > s; s++)
                            t.resolve(e[s]).then(n, i);
                        }
                      : function (e, t) {
                          t(new TypeError("You must pass an array to race."));
                        }
                  );
                }
                function B(e) {
                  var t = this,
                    n = new t(v);
                  return I(n, e), n;
                }
                function F() {
                  throw new TypeError(
                    "You must pass a resolver function as the first argument to the promise constructor"
                  );
                }
                function H() {
                  throw new TypeError(
                    "Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function."
                  );
                }
                function W(e) {
                  (this[lt] = j()),
                    (this._result = this._state = void 0),
                    (this._subscribers = []),
                    v !== e &&
                      ("function" != typeof e && F(),
                      this instanceof W ? L(this, e) : H());
                }
                function z(e, t) {
                  (this._instanceConstructor = e),
                    (this.promise = new e(v)),
                    this.promise[lt] || N(this.promise),
                    Q(t)
                      ? ((this._input = t),
                        (this.length = t.length),
                        (this._remaining = t.length),
                        (this._result = new Array(this.length)),
                        0 === this.length
                          ? P(this.promise, this._result)
                          : ((this.length = this.length || 0),
                            this._enumerate(),
                            0 === this._remaining &&
                              P(this.promise, this._result)))
                      : I(this.promise, q());
                }
                function q() {
                  return new Error("Array Methods must be provided an Array");
                }
                function V() {
                  var e;
                  if ("undefined" != typeof r) e = r;
                  else if ("undefined" != typeof self) e = self;
                  else
                    try {
                      e = Function("return this")();
                    } catch (t) {
                      throw new Error(
                        "polyfill failed because global object is unavailable in this environment"
                      );
                    }
                  var n = e.Promise;
                  (n &&
                    "[object Promise]" ===
                      Object.prototype.toString.call(n.resolve()) &&
                    !n.cast) ||
                    (e.Promise = vt);
                }
                var G;
                G = Array.isArray
                  ? Array.isArray
                  : function (e) {
                      return (
                        "[object Array]" === Object.prototype.toString.call(e)
                      );
                    };
                var K,
                  Y,
                  X,
                  Q = G,
                  J = 0,
                  Z = function (e, t) {
                    (st[J] = e),
                      (st[J + 1] = t),
                      (J += 2),
                      2 === J && (Y ? Y(f) : X());
                  },
                  et = "undefined" != typeof window ? window : void 0,
                  tt = et || {},
                  nt = tt.MutationObserver || tt.WebKitMutationObserver,
                  it =
                    "undefined" == typeof self &&
                    "undefined" != typeof i &&
                    "[object process]" === {}.toString.call(i),
                  rt =
                    "undefined" != typeof Uint8ClampedArray &&
                    "undefined" != typeof importScripts &&
                    "undefined" != typeof MessageChannel,
                  st = new Array(1e3);
                X = it
                  ? c()
                  : nt
                  ? d()
                  : rt
                  ? h()
                  : void 0 === et && "function" == typeof t
                  ? m()
                  : p();
                var ot = g,
                  at = _,
                  lt = Math.random().toString(36).substring(16),
                  ct = void 0,
                  ut = 1,
                  dt = 2,
                  ht = new D(),
                  pt = new D(),
                  ft = 0,
                  mt = U,
                  gt = $,
                  _t = B,
                  vt = W;
                (W.all = mt),
                  (W.race = gt),
                  (W.resolve = at),
                  (W.reject = _t),
                  (W._setScheduler = a),
                  (W._setAsap = l),
                  (W._asap = Z),
                  (W.prototype = {
                    constructor: W,
                    then: ot,
                    catch: function (e) {
                      return this.then(null, e);
                    },
                  });
                var yt = z;
                (z.prototype._enumerate = function () {
                  for (
                    var e = this.length, t = this._input, n = 0;
                    this._state === ct && e > n;
                    n++
                  )
                    this._eachEntry(t[n], n);
                }),
                  (z.prototype._eachEntry = function (e, t) {
                    var n = this._instanceConstructor,
                      i = n.resolve;
                    if (i === at) {
                      var r = w(e);
                      if (r === ot && e._state !== ct)
                        this._settledAt(e._state, t, e._result);
                      else if ("function" != typeof r)
                        this._remaining--, (this._result[t] = e);
                      else if (n === vt) {
                        var s = new n(v);
                        S(s, e, r), this._willSettleAt(s, t);
                      } else
                        this._willSettleAt(
                          new n(function (t) {
                            t(e);
                          }),
                          t
                        );
                    } else this._willSettleAt(i(e), t);
                  }),
                  (z.prototype._settledAt = function (e, t, n) {
                    var i = this.promise;
                    i._state === ct &&
                      (this._remaining--,
                      e === dt ? I(i, n) : (this._result[t] = n)),
                      0 === this._remaining && P(i, this._result);
                  }),
                  (z.prototype._willSettleAt = function (e, t) {
                    var n = this;
                    A(
                      e,
                      void 0,
                      function (e) {
                        n._settledAt(ut, t, e);
                      },
                      function (e) {
                        n._settledAt(dt, t, e);
                      }
                    );
                  });
                var bt = V,
                  wt = {
                    Promise: vt,
                    polyfill: bt,
                  };
                "function" == typeof e && e.amd
                  ? e(function () {
                      return wt;
                    })
                  : "undefined" != typeof n && n.exports
                  ? (n.exports = wt)
                  : "undefined" != typeof this && (this.ES6Promise = wt),
                  bt();
              }.call(this));
            }.call(
              this,
              t(2),
              "undefined" != typeof global
                ? global
                : "undefined" != typeof self
                ? self
                : "undefined" != typeof window
                ? window
                : {}
            ));
          },
          {
            2: 2,
          },
        ],
        6: [
          function (e, t) {
            function n() {
              (this._events = this._events || {}),
                (this._maxListeners = this._maxListeners || void 0);
            }
            function i(e) {
              return "function" == typeof e;
            }
            function r(e) {
              return "number" == typeof e;
            }
            function s(e) {
              return "object" == typeof e && null !== e;
            }
            function o(e) {
              return void 0 === e;
            }
            (t.exports = n),
              (n.EventEmitter = n),
              (n.prototype._events = void 0),
              (n.prototype._maxListeners = void 0),
              (n.defaultMaxListeners = 10),
              (n.prototype.setMaxListeners = function (e) {
                if (!r(e) || 0 > e || isNaN(e))
                  throw TypeError("n must be a positive number");
                return (this._maxListeners = e), this;
              }),
              (n.prototype.emit = function (e) {
                var t, n, r, a, l, c;
                if (
                  (this._events || (this._events = {}),
                  "error" === e &&
                    (!this._events.error ||
                      (s(this._events.error) && !this._events.error.length)))
                ) {
                  if (((t = arguments[1]), t instanceof Error)) throw t;
                  var u = new Error(
                    'Uncaught, unspecified "error" event. (' + t + ")"
                  );
                  throw ((u.context = t), u);
                }
                if (((n = this._events[e]), o(n))) return !1;
                if (i(n))
                  switch (arguments.length) {
                    case 1:
                      n.call(this);
                      break;
                    case 2:
                      n.call(this, arguments[1]);
                      break;
                    case 3:
                      n.call(this, arguments[1], arguments[2]);
                      break;
                    default:
                      (a = Array.prototype.slice.call(arguments, 1)),
                        n.apply(this, a);
                  }
                else if (s(n))
                  for (
                    a = Array.prototype.slice.call(arguments, 1),
                      c = n.slice(),
                      r = c.length,
                      l = 0;
                    r > l;
                    l++
                  )
                    c[l].apply(this, a);
                return !0;
              }),
              (n.prototype.addListener = function (e, t) {
                var r;
                if (!i(t)) throw TypeError("listener must be a function");
                return (
                  this._events || (this._events = {}),
                  this._events.newListener &&
                    this.emit("newListener", e, i(t.listener) ? t.listener : t),
                  this._events[e]
                    ? s(this._events[e])
                      ? this._events[e].push(t)
                      : (this._events[e] = [this._events[e], t])
                    : (this._events[e] = t),
                  s(this._events[e]) &&
                    !this._events[e].warned &&
                    ((r = o(this._maxListeners)
                      ? n.defaultMaxListeners
                      : this._maxListeners),
                    r &&
                      r > 0 &&
                      this._events[e].length > r &&
                      ((this._events[e].warned = !0),
                      console.error(
                        "(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",
                        this._events[e].length
                      ),
                      "function" == typeof console.trace && console.trace())),
                  this
                );
              }),
              (n.prototype.on = n.prototype.addListener),
              (n.prototype.once = function (e, t) {
                function n() {
                  this.removeListener(e, n),
                    r || ((r = !0), t.apply(this, arguments));
                }
                if (!i(t)) throw TypeError("listener must be a function");
                var r = !1;
                return (n.listener = t), this.on(e, n), this;
              }),
              (n.prototype.removeListener = function (e, t) {
                var n, r, o, a;
                if (!i(t)) throw TypeError("listener must be a function");
                if (!this._events || !this._events[e]) return this;
                if (
                  ((n = this._events[e]),
                  (o = n.length),
                  (r = -1),
                  n === t || (i(n.listener) && n.listener === t))
                )
                  delete this._events[e],
                    this._events.removeListener &&
                      this.emit("removeListener", e, t);
                else if (s(n)) {
                  for (a = o; a-- > 0; )
                    if (n[a] === t || (n[a].listener && n[a].listener === t)) {
                      r = a;
                      break;
                    }
                  if (0 > r) return this;
                  1 === n.length
                    ? ((n.length = 0), delete this._events[e])
                    : n.splice(r, 1),
                    this._events.removeListener &&
                      this.emit("removeListener", e, t);
                }
                return this;
              }),
              (n.prototype.removeAllListeners = function (e) {
                var t, n;
                if (!this._events) return this;
                if (!this._events.removeListener)
                  return (
                    0 === arguments.length
                      ? (this._events = {})
                      : this._events[e] && delete this._events[e],
                    this
                  );
                if (0 === arguments.length) {
                  for (t in this._events)
                    "removeListener" !== t && this.removeAllListeners(t);
                  return (
                    this.removeAllListeners("removeListener"),
                    (this._events = {}),
                    this
                  );
                }
                if (((n = this._events[e]), i(n))) this.removeListener(e, n);
                else if (n)
                  for (; n.length; ) this.removeListener(e, n[n.length - 1]);
                return delete this._events[e], this;
              }),
              (n.prototype.listeners = function (e) {
                var t;
                return (t =
                  this._events && this._events[e]
                    ? i(this._events[e])
                      ? [this._events[e]]
                      : this._events[e].slice()
                    : []);
              }),
              (n.prototype.listenerCount = function (e) {
                if (this._events) {
                  var t = this._events[e];
                  if (i(t)) return 1;
                  if (t) return t.length;
                }
                return 0;
              }),
              (n.listenerCount = function (e, t) {
                return e.listenerCount(t);
              });
          },
          {},
        ],
        7: [
          function (e, t) {
            var n = Object.prototype.hasOwnProperty,
              i = Object.prototype.toString;
            t.exports = function (e, t, r) {
              if ("[object Function]" !== i.call(t))
                throw new TypeError("iterator must be a function");
              var s = e.length;
              if (s === +s) for (var o = 0; s > o; o++) t.call(r, e[o], o, e);
              else for (var a in e) n.call(e, a) && t.call(r, e[a], a, e);
            };
          },
          {},
        ],
        8: [
          function (e, t) {
            (function (e) {
              t.exports =
                "undefined" != typeof window
                  ? window
                  : "undefined" != typeof e
                  ? e
                  : "undefined" != typeof self
                  ? self
                  : {};
            }.call(
              this,
              "undefined" != typeof global
                ? global
                : "undefined" != typeof self
                ? self
                : "undefined" != typeof window
                ? window
                : {}
            ));
          },
          {},
        ],
        9: [
          function (e, t) {
            t.exports =
              "function" == typeof Object.create
                ? function (e, t) {
                    (e.super_ = t),
                      (e.prototype = Object.create(t.prototype, {
                        constructor: {
                          value: e,
                          enumerable: !1,
                          writable: !0,
                          configurable: !0,
                        },
                      }));
                  }
                : function (e, t) {
                    e.super_ = t;
                    var n = function () {};
                    (n.prototype = t.prototype),
                      (e.prototype = new n()),
                      (e.prototype.constructor = e);
                  };
          },
          {},
        ],
        10: [
          function (e, t) {
            var n = {}.toString;
            t.exports =
              Array.isArray ||
              function (e) {
                return "[object Array]" == n.call(e);
              };
          },
          {},
        ],
        11: [
          function (e, t) {
            "use strict";
            var n = Object.prototype.hasOwnProperty,
              i = Object.prototype.toString,
              r = Array.prototype.slice,
              s = e(12),
              o = Object.prototype.propertyIsEnumerable,
              a = !o.call(
                {
                  toString: null,
                },
                "toString"
              ),
              l = o.call(function () {}, "prototype"),
              c = [
                "toString",
                "toLocaleString",
                "valueOf",
                "hasOwnProperty",
                "isPrototypeOf",
                "propertyIsEnumerable",
                "constructor",
              ],
              u = function (e) {
                var t = e.constructor;
                return t && t.prototype === e;
              },
              d = {
                $console: !0,
                $external: !0,
                $frame: !0,
                $frameElement: !0,
                $frames: !0,
                $innerHeight: !0,
                $innerWidth: !0,
                $outerHeight: !0,
                $outerWidth: !0,
                $pageXOffset: !0,
                $pageYOffset: !0,
                $parent: !0,
                $scrollLeft: !0,
                $scrollTop: !0,
                $scrollX: !0,
                $scrollY: !0,
                $self: !0,
                $webkitIndexedDB: !0,
                $webkitStorageInfo: !0,
                $window: !0,
              },
              h = (function () {
                if ("undefined" == typeof window) return !1;
                for (var e in window)
                  try {
                    if (
                      !d["$" + e] &&
                      n.call(window, e) &&
                      null !== window[e] &&
                      "object" == typeof window[e]
                    )
                      try {
                        u(window[e]);
                      } catch (t) {
                        return !0;
                      }
                  } catch (t) {
                    return !0;
                  }
                return !1;
              })(),
              p = function (e) {
                if ("undefined" == typeof window || !h) return u(e);
                try {
                  return u(e);
                } catch (t) {
                  return !1;
                }
              },
              f = function (e) {
                var t = null !== e && "object" == typeof e,
                  r = "[object Function]" === i.call(e),
                  o = s(e),
                  u = t && "[object String]" === i.call(e),
                  d = [];
                if (!t && !r && !o)
                  throw new TypeError("Object.keys called on a non-object");
                var h = l && r;
                if (u && e.length > 0 && !n.call(e, 0))
                  for (var f = 0; f < e.length; ++f) d.push(String(f));
                if (o && e.length > 0)
                  for (var m = 0; m < e.length; ++m) d.push(String(m));
                else
                  for (var g in e)
                    (h && "prototype" === g) ||
                      !n.call(e, g) ||
                      d.push(String(g));
                if (a)
                  for (var _ = p(e), v = 0; v < c.length; ++v)
                    (_ && "constructor" === c[v]) ||
                      !n.call(e, c[v]) ||
                      d.push(c[v]);
                return d;
              };
            (f.shim = function () {
              if (Object.keys) {
                var e = (function () {
                  return 2 === (Object.keys(arguments) || "").length;
                })(1, 2);
                if (!e) {
                  var t = Object.keys;
                  Object.keys = function (e) {
                    return t(s(e) ? r.call(e) : e);
                  };
                }
              } else Object.keys = f;
              return Object.keys || f;
            }),
              (t.exports = f);
          },
          {
            12: 12,
          },
        ],
        12: [
          function (e, t) {
            "use strict";
            var n = Object.prototype.toString;
            t.exports = function (e) {
              var t = n.call(e),
                i = "[object Arguments]" === t;
              return (
                i ||
                  (i =
                    "[object Array]" !== t &&
                    null !== e &&
                    "object" == typeof e &&
                    "number" == typeof e.length &&
                    e.length >= 0 &&
                    "[object Function]" === n.call(e.callee)),
                i
              );
            };
          },
          {},
        ],
        13: [
          function (e, t) {
            "use strict";
            function n(e, t) {
              if (e.map) return e.map(t);
              for (var n = [], i = 0; i < e.length; i++) n.push(t(e[i], i));
              return n;
            }
            var i = function (e) {
              switch (typeof e) {
                case "string":
                  return e;
                case "boolean":
                  return e ? "true" : "false";
                case "number":
                  return isFinite(e) ? e : "";
                default:
                  return "";
              }
            };
            t.exports = function (e, t, o, a) {
              return (
                (t = t || "&"),
                (o = o || "="),
                null === e && (e = void 0),
                "object" == typeof e
                  ? n(s(e), function (s) {
                      var a = encodeURIComponent(i(s)) + o;
                      return r(e[s])
                        ? n(e[s], function (e) {
                            return a + encodeURIComponent(i(e));
                          }).join(t)
                        : a + encodeURIComponent(i(e[s]));
                    }).join(t)
                  : a
                  ? encodeURIComponent(i(a)) + o + encodeURIComponent(i(e))
                  : ""
              );
            };
            var r =
                Array.isArray ||
                function (e) {
                  return "[object Array]" === Object.prototype.toString.call(e);
                },
              s =
                Object.keys ||
                function (e) {
                  var t = [];
                  for (var n in e)
                    Object.prototype.hasOwnProperty.call(e, n) && t.push(n);
                  return t;
                };
          },
          {},
        ],
        14: [
          function (e, t) {
            function n() {
              a.apply(this, arguments);
            }
            function i() {
              var e =
                "Not implemented in this environment.\nIf you feel this is a mistake, write to support@algolia.com";
              throw new c.AlgoliaSearchError(e);
            }
            t.exports = n;
            var r = e(16),
              s = e(26),
              o = e(27),
              a = e(15),
              l = e(9),
              c = e(28);
            l(n, a),
              (n.prototype.deleteIndex = function (e, t) {
                return this._jsonRequest({
                  method: "DELETE",
                  url: "/1/indexes/" + encodeURIComponent(e),
                  hostType: "write",
                  callback: t,
                });
              }),
              (n.prototype.moveIndex = function (e, t, n) {
                var i = {
                  operation: "move",
                  destination: t,
                };
                return this._jsonRequest({
                  method: "POST",
                  url: "/1/indexes/" + encodeURIComponent(e) + "/operation",
                  body: i,
                  hostType: "write",
                  callback: n,
                });
              }),
              (n.prototype.copyIndex = function (e, t, n) {
                var i = {
                  operation: "copy",
                  destination: t,
                };
                return this._jsonRequest({
                  method: "POST",
                  url: "/1/indexes/" + encodeURIComponent(e) + "/operation",
                  body: i,
                  hostType: "write",
                  callback: n,
                });
              }),
              (n.prototype.getLogs = function (t, n, i) {
                var r = e(25),
                  s = {};
                return (
                  "object" == typeof t
                    ? ((s = r(t)), (i = n))
                    : 0 === arguments.length || "function" == typeof t
                    ? (i = t)
                    : 1 === arguments.length || "function" == typeof n
                    ? ((i = n), (s.offset = t))
                    : ((s.offset = t), (s.length = n)),
                  void 0 === s.offset && (s.offset = 0),
                  void 0 === s.length && (s.length = 10),
                  this._jsonRequest({
                    method: "GET",
                    url: "/1/logs?" + this._getSearchParams(s, ""),
                    hostType: "read",
                    callback: i,
                  })
                );
              }),
              (n.prototype.listIndexes = function (e, t) {
                var n = "";
                return (
                  void 0 === e || "function" == typeof e
                    ? (t = e)
                    : (n = "?page=" + e),
                  this._jsonRequest({
                    method: "GET",
                    url: "/1/indexes" + n,
                    hostType: "read",
                    callback: t,
                  })
                );
              }),
              (n.prototype.initIndex = function (e) {
                return new r(this, e);
              }),
              (n.prototype.listUserKeys = function (e) {
                return this._jsonRequest({
                  method: "GET",
                  url: "/1/keys",
                  hostType: "read",
                  callback: e,
                });
              }),
              (n.prototype.getUserKeyACL = function (e, t) {
                return this._jsonRequest({
                  method: "GET",
                  url: "/1/keys/" + e,
                  hostType: "read",
                  callback: t,
                });
              }),
              (n.prototype.deleteUserKey = function (e, t) {
                return this._jsonRequest({
                  method: "DELETE",
                  url: "/1/keys/" + e,
                  hostType: "write",
                  callback: t,
                });
              }),
              (n.prototype.addUserKey = function (t, n, i) {
                var r = e(10),
                  s =
                    "Usage: client.addUserKey(arrayOfAcls[, params, callback])";
                if (!r(t)) throw new Error(s);
                (1 !== arguments.length && "function" != typeof n) ||
                  ((i = n), (n = null));
                var o = {
                  acl: t,
                };
                return (
                  n &&
                    ((o.validity = n.validity),
                    (o.maxQueriesPerIPPerHour = n.maxQueriesPerIPPerHour),
                    (o.maxHitsPerQuery = n.maxHitsPerQuery),
                    (o.indexes = n.indexes),
                    (o.description = n.description),
                    n.queryParameters &&
                      (o.queryParameters = this._getSearchParams(
                        n.queryParameters,
                        ""
                      )),
                    (o.referers = n.referers)),
                  this._jsonRequest({
                    method: "POST",
                    url: "/1/keys",
                    body: o,
                    hostType: "write",
                    callback: i,
                  })
                );
              }),
              (n.prototype.addUserKeyWithValidity = s(function (e, t, n) {
                return this.addUserKey(e, t, n);
              }, o("client.addUserKeyWithValidity()", "client.addUserKey()"))),
              (n.prototype.updateUserKey = function (t, n, i, r) {
                var s = e(10),
                  o =
                    "Usage: client.updateUserKey(key, arrayOfAcls[, params, callback])";
                if (!s(n)) throw new Error(o);
                (2 !== arguments.length && "function" != typeof i) ||
                  ((r = i), (i = null));
                var a = {
                  acl: n,
                };
                return (
                  i &&
                    ((a.validity = i.validity),
                    (a.maxQueriesPerIPPerHour = i.maxQueriesPerIPPerHour),
                    (a.maxHitsPerQuery = i.maxHitsPerQuery),
                    (a.indexes = i.indexes),
                    (a.description = i.description),
                    i.queryParameters &&
                      (a.queryParameters = this._getSearchParams(
                        i.queryParameters,
                        ""
                      )),
                    (a.referers = i.referers)),
                  this._jsonRequest({
                    method: "PUT",
                    url: "/1/keys/" + t,
                    body: a,
                    hostType: "write",
                    callback: r,
                  })
                );
              }),
              (n.prototype.startQueriesBatch = s(function () {
                this._batch = [];
              }, o("client.startQueriesBatch()", "client.search()"))),
              (n.prototype.addQueryInBatch = s(function (e, t, n) {
                this._batch.push({
                  indexName: e,
                  query: t,
                  params: n,
                });
              }, o("client.addQueryInBatch()", "client.search()"))),
              (n.prototype.sendQueriesBatch = s(function (e) {
                return this.search(this._batch, e);
              }, o("client.sendQueriesBatch()", "client.search()"))),
              (n.prototype.batch = function (t, n) {
                var i = e(10),
                  r = "Usage: client.batch(operations[, callback])";
                if (!i(t)) throw new Error(r);
                return this._jsonRequest({
                  method: "POST",
                  url: "/1/indexes/*/batch",
                  body: {
                    requests: t,
                  },
                  hostType: "write",
                  callback: n,
                });
              }),
              (n.prototype.destroy = i),
              (n.prototype.enableRateLimitForward = i),
              (n.prototype.disableRateLimitForward = i),
              (n.prototype.useSecuredAPIKey = i),
              (n.prototype.disableSecuredAPIKey = i),
              (n.prototype.generateSecuredApiKey = i);
          },
          {
            10: 10,
            15: 15,
            16: 16,
            25: 25,
            26: 26,
            27: 27,
            28: 28,
            9: 9,
          },
        ],
        15: [
          function (e, t) {
            function n(t, n, r) {
              var o = e(3)("algoliasearch"),
                l = e(25),
                c = e(10),
                u = e(30),
                d = "Usage: algoliasearch(applicationID, apiKey, opts)";
              if (r._allowEmptyCredentials !== !0 && !t)
                throw new a.AlgoliaSearchError(
                  "Please provide an application ID. " + d
                );
              if (r._allowEmptyCredentials !== !0 && !n)
                throw new a.AlgoliaSearchError(
                  "Please provide an API key. " + d
                );
              (this.applicationID = t), (this.apiKey = n);
              var h = s([
                this.applicationID + "-1.algolianet.com",
                this.applicationID + "-2.algolianet.com",
                this.applicationID + "-3.algolianet.com",
              ]);
              (this.hosts = {
                read: [],
                write: [],
              }),
                (this.hostIndex = {
                  read: 0,
                  write: 0,
                }),
                (r = r || {});
              var p = r.protocol || "https:",
                f = void 0 === r.timeout ? 2e3 : r.timeout;
              if (
                (/:$/.test(p) || (p += ":"),
                "http:" !== r.protocol && "https:" !== r.protocol)
              )
                throw new a.AlgoliaSearchError(
                  "protocol must be `http:` or `https:` (was `" +
                    r.protocol +
                    "`)"
                );
              r.hosts
                ? c(r.hosts)
                  ? ((this.hosts.read = l(r.hosts)),
                    (this.hosts.write = l(r.hosts)))
                  : ((this.hosts.read = l(r.hosts.read)),
                    (this.hosts.write = l(r.hosts.write)))
                : ((this.hosts.read = [
                    this.applicationID + "-dsn.algolia.net",
                  ].concat(h)),
                  (this.hosts.write = [
                    this.applicationID + ".algolia.net",
                  ].concat(h))),
                (this.hosts.read = u(this.hosts.read, i(p))),
                (this.hosts.write = u(this.hosts.write, i(p))),
                (this.requestTimeout = f),
                (this.extraHeaders = []),
                (this.cache = r._cache || {}),
                (this._ua = r._ua),
                (this._useCache =
                  !(void 0 !== r._useCache && !r._cache) || r._useCache),
                (this._useFallback = void 0 === r.useFallback || r.useFallback),
                (this._setTimeout = r._setTimeout),
                o("init done, %j", this);
            }
            function i(e) {
              return function (t) {
                return e + "//" + t.toLowerCase();
              };
            }
            function r(e) {
              if (void 0 === Array.prototype.toJSON) return JSON.stringify(e);
              var t = Array.prototype.toJSON;
              delete Array.prototype.toJSON;
              var n = JSON.stringify(e);
              return (Array.prototype.toJSON = t), n;
            }
            function s(e) {
              for (var t, n, i = e.length; 0 !== i; )
                (n = Math.floor(Math.random() * i)),
                  (i -= 1),
                  (t = e[i]),
                  (e[i] = e[n]),
                  (e[n] = t);
              return e;
            }
            function o(e) {
              var t = {};
              for (var n in e)
                if (Object.prototype.hasOwnProperty.call(e, n)) {
                  var i;
                  (i =
                    "x-algolia-api-key" === n ||
                    "x-algolia-application-id" === n
                      ? "**hidden for security purposes**"
                      : e[n]),
                    (t[n] = i);
                }
              return t;
            }
            t.exports = n;
            var a = e(28),
              l = e(29),
              c = e(18),
              u = 500;
            (n.prototype.initIndex = function (e) {
              return new c(this, e);
            }),
              (n.prototype.setExtraHeader = function (e, t) {
                this.extraHeaders.push({
                  name: e.toLowerCase(),
                  value: t,
                });
              }),
              (n.prototype.addAlgoliaAgent = function (e) {
                this._ua += ";" + e;
              }),
              (n.prototype._jsonRequest = function (t) {
                function n(e, l) {
                  function u(e) {
                    var t =
                      (e && e.body && e.body.message && e.body.status) ||
                      e.statusCode ||
                      (e && e.body && 200);
                    c(
                      "received response: statusCode: %s, computed statusCode: %d, headers: %j",
                      e.statusCode,
                      t,
                      e.headers
                    );
                    var n = 2 === Math.floor(t / 100),
                      r = new Date();
                    if (
                      (g.push({
                        currentHost: C,
                        headers: o(s),
                        content: i || null,
                        contentLength: void 0 !== i ? i.length : null,
                        method: l.method,
                        timeout: l.timeout,
                        url: l.url,
                        startTime: w,
                        endTime: r,
                        duration: r - w,
                        statusCode: t,
                      }),
                      n)
                    )
                      return (
                        h._useCache && d && (d[b] = e.responseText), e.body
                      );
                    var u = 4 !== Math.floor(t / 100);
                    if (u) return (p += 1), v();
                    c("unrecoverable error");
                    var f = new a.AlgoliaSearchError(e.body && e.body.message, {
                      debugData: g,
                      statusCode: t,
                    });
                    return h._promise.reject(f);
                  }
                  function _(e) {
                    c("error: %s, stack: %s", e.message, e.stack);
                    var n = new Date();
                    return (
                      g.push({
                        currentHost: C,
                        headers: o(s),
                        content: i || null,
                        contentLength: void 0 !== i ? i.length : null,
                        method: l.method,
                        timeout: l.timeout,
                        url: l.url,
                        startTime: w,
                        endTime: n,
                        duration: n - w,
                      }),
                      e instanceof a.AlgoliaSearchError ||
                        (e = new a.Unknown(e && e.message, e)),
                      (p += 1),
                      e instanceof a.Unknown ||
                      e instanceof a.UnparsableJSON ||
                      (p >= h.hosts[t.hostType].length && (f || !m))
                        ? ((e.debugData = g), h._promise.reject(e))
                        : e instanceof a.RequestTimeout
                        ? y()
                        : v()
                    );
                  }
                  function v() {
                    return (
                      c("retrying request"),
                      (h.hostIndex[t.hostType] =
                        (h.hostIndex[t.hostType] + 1) %
                        h.hosts[t.hostType].length),
                      n(e, l)
                    );
                  }
                  function y() {
                    return (
                      c("retrying request with higher timeout"),
                      (h.hostIndex[t.hostType] =
                        (h.hostIndex[t.hostType] + 1) %
                        h.hosts[t.hostType].length),
                      (l.timeout = h.requestTimeout * (p + 1)),
                      n(e, l)
                    );
                  }
                  var b,
                    w = new Date();
                  if (
                    (h._useCache && (b = t.url),
                    h._useCache && i && (b += "_body_" + l.body),
                    h._useCache && d && void 0 !== d[b])
                  )
                    return (
                      c("serving response from cache"),
                      h._promise.resolve(JSON.parse(d[b]))
                    );
                  if (p >= h.hosts[t.hostType].length)
                    return !m || f
                      ? (c("could not get any response"),
                        h._promise.reject(
                          new a.AlgoliaSearchError(
                            "Cannot connect to the AlgoliaSearch API. Send an email to support@algolia.com to report and resolve the issue. Application id was: " +
                              h.applicationID,
                            {
                              debugData: g,
                            }
                          )
                        ))
                      : (c("switching to fallback"),
                        (p = 0),
                        (l.method = t.fallback.method),
                        (l.url = t.fallback.url),
                        (l.jsonBody = t.fallback.body),
                        l.jsonBody && (l.body = r(l.jsonBody)),
                        (s = h._computeRequestHeaders()),
                        (l.timeout = h.requestTimeout * (p + 1)),
                        (h.hostIndex[t.hostType] = 0),
                        (f = !0),
                        n(h._request.fallback, l));
                  var C = h.hosts[t.hostType][h.hostIndex[t.hostType]],
                    k = C + l.url,
                    T = {
                      body: l.body,
                      jsonBody: l.jsonBody,
                      method: l.method,
                      headers: s,
                      timeout: l.timeout,
                      debug: c,
                    };
                  return (
                    c(
                      "method: %s, url: %s, headers: %j, timeout: %d",
                      T.method,
                      k,
                      T.headers,
                      T.timeout
                    ),
                    e === h._request.fallback && c("using fallback"),
                    e.call(h, k, T).then(u, _)
                  );
                }
                var i,
                  s,
                  c = e(3)("algoliasearch:" + t.url),
                  d = t.cache,
                  h = this,
                  p = 0,
                  f = !1,
                  m = h._useFallback && h._request.fallback && t.fallback;
                this.apiKey.length > u &&
                void 0 !== t.body &&
                (void 0 !== t.body.params || void 0 !== t.body.requests)
                  ? ((t.body.apiKey = this.apiKey),
                    (s = this._computeRequestHeaders(!1)))
                  : (s = this._computeRequestHeaders()),
                  void 0 !== t.body && (i = r(t.body)),
                  c("request start");
                var g = [],
                  _ = n(h._request, {
                    url: t.url,
                    method: t.method,
                    body: i,
                    jsonBody: t.body,
                    timeout: h.requestTimeout * (p + 1),
                  });
                return t.callback
                  ? void _.then(
                      function (e) {
                        l(function () {
                          t.callback(null, e);
                        }, h._setTimeout || setTimeout);
                      },
                      function (e) {
                        l(function () {
                          t.callback(e);
                        }, h._setTimeout || setTimeout);
                      }
                    )
                  : _;
              }),
              (n.prototype._getSearchParams = function (e, t) {
                if (void 0 === e || null === e) return t;
                for (var n in e)
                  null !== n &&
                    void 0 !== e[n] &&
                    e.hasOwnProperty(n) &&
                    ((t += "" === t ? "" : "&"),
                    (t +=
                      n +
                      "=" +
                      encodeURIComponent(
                        "[object Array]" ===
                          Object.prototype.toString.call(e[n])
                          ? r(e[n])
                          : e[n]
                      )));
                return t;
              }),
              (n.prototype._computeRequestHeaders = function (t) {
                var n = e(7),
                  i = {
                    "x-algolia-agent": this._ua,
                    "x-algolia-application-id": this.applicationID,
                  };
                return (
                  t !== !1 && (i["x-algolia-api-key"] = this.apiKey),
                  this.userToken && (i["x-algolia-usertoken"] = this.userToken),
                  this.securityTags &&
                    (i["x-algolia-tagfilters"] = this.securityTags),
                  this.extraHeaders &&
                    n(this.extraHeaders, function (e) {
                      i[e.name] = e.value;
                    }),
                  i
                );
              }),
              (n.prototype.search = function (t, n, i) {
                var r = e(10),
                  s = e(30),
                  o = "Usage: client.search(arrayOfQueries[, callback])";
                if (!r(t)) throw new Error(o);
                "function" == typeof n
                  ? ((i = n), (n = {}))
                  : void 0 === n && (n = {});
                var a = this,
                  l = {
                    requests: s(t, function (e) {
                      var t = "";
                      return (
                        void 0 !== e.query &&
                          (t += "query=" + encodeURIComponent(e.query)),
                        {
                          indexName: e.indexName,
                          params: a._getSearchParams(e.params, t),
                        }
                      );
                    }),
                  },
                  c = s(l.requests, function (e, t) {
                    return (
                      t +
                      "=" +
                      encodeURIComponent(
                        "/1/indexes/" +
                          encodeURIComponent(e.indexName) +
                          "?" +
                          e.params
                      )
                    );
                  }).join("&"),
                  u = "/1/indexes/*/queries";
                return (
                  void 0 !== n.strategy && (u += "?strategy=" + n.strategy),
                  this._jsonRequest({
                    cache: this.cache,
                    method: "POST",
                    url: u,
                    body: l,
                    hostType: "read",
                    fallback: {
                      method: "GET",
                      url: "/1/indexes/*",
                      body: {
                        params: c,
                      },
                    },
                    callback: i,
                  })
                );
              }),
              (n.prototype.setSecurityTags = function (e) {
                if ("[object Array]" === Object.prototype.toString.call(e)) {
                  for (var t = [], n = 0; n < e.length; ++n)
                    if (
                      "[object Array]" === Object.prototype.toString.call(e[n])
                    ) {
                      for (var i = [], r = 0; r < e[n].length; ++r)
                        i.push(e[n][r]);
                      t.push("(" + i.join(",") + ")");
                    } else t.push(e[n]);
                  e = t.join(",");
                }
                this.securityTags = e;
              }),
              (n.prototype.setUserToken = function (e) {
                this.userToken = e;
              }),
              (n.prototype.clearCache = function () {
                this.cache = {};
              }),
              (n.prototype.setRequestTimeout = function (e) {
                e && (this.requestTimeout = parseInt(e, 10));
              });
          },
          {
            10: 10,
            18: 18,
            25: 25,
            28: 28,
            29: 29,
            3: 3,
            30: 30,
            7: 7,
          },
        ],
        16: [
          function (e, t) {
            function n() {
              r.apply(this, arguments);
            }
            var i = e(9),
              r = e(18),
              s = e(26),
              o = e(27),
              a = e(29),
              l = e(28);
            (t.exports = n),
              i(n, r),
              (n.prototype.addObject = function (e, t, n) {
                var i = this;
                return (
                  (1 !== arguments.length && "function" != typeof t) ||
                    ((n = t), (t = void 0)),
                  this.as._jsonRequest({
                    method: void 0 !== t ? "PUT" : "POST",
                    url:
                      "/1/indexes/" +
                      encodeURIComponent(i.indexName) +
                      (void 0 !== t ? "/" + encodeURIComponent(t) : ""),
                    body: e,
                    hostType: "write",
                    callback: n,
                  })
                );
              }),
              (n.prototype.addObjects = function (t, n) {
                var i = e(10),
                  r = "Usage: index.addObjects(arrayOfObjects[, callback])";
                if (!i(t)) throw new Error(r);
                for (
                  var s = this,
                    o = {
                      requests: [],
                    },
                    a = 0;
                  a < t.length;
                  ++a
                ) {
                  var l = {
                    action: "addObject",
                    body: t[a],
                  };
                  o.requests.push(l);
                }
                return this.as._jsonRequest({
                  method: "POST",
                  url:
                    "/1/indexes/" + encodeURIComponent(s.indexName) + "/batch",
                  body: o,
                  hostType: "write",
                  callback: n,
                });
              }),
              (n.prototype.partialUpdateObject = function (e, t, n) {
                (1 !== arguments.length && "function" != typeof t) ||
                  ((n = t), (t = void 0));
                var i = this,
                  r =
                    "/1/indexes/" +
                    encodeURIComponent(i.indexName) +
                    "/" +
                    encodeURIComponent(e.objectID) +
                    "/partial";
                return (
                  t === !1 && (r += "?createIfNotExists=false"),
                  this.as._jsonRequest({
                    method: "POST",
                    url: r,
                    body: e,
                    hostType: "write",
                    callback: n,
                  })
                );
              }),
              (n.prototype.partialUpdateObjects = function (t, n) {
                var i = e(10),
                  r =
                    "Usage: index.partialUpdateObjects(arrayOfObjects[, callback])";
                if (!i(t)) throw new Error(r);
                for (
                  var s = this,
                    o = {
                      requests: [],
                    },
                    a = 0;
                  a < t.length;
                  ++a
                ) {
                  var l = {
                    action: "partialUpdateObject",
                    objectID: t[a].objectID,
                    body: t[a],
                  };
                  o.requests.push(l);
                }
                return this.as._jsonRequest({
                  method: "POST",
                  url:
                    "/1/indexes/" + encodeURIComponent(s.indexName) + "/batch",
                  body: o,
                  hostType: "write",
                  callback: n,
                });
              }),
              (n.prototype.saveObject = function (e, t) {
                var n = this;
                return this.as._jsonRequest({
                  method: "PUT",
                  url:
                    "/1/indexes/" +
                    encodeURIComponent(n.indexName) +
                    "/" +
                    encodeURIComponent(e.objectID),
                  body: e,
                  hostType: "write",
                  callback: t,
                });
              }),
              (n.prototype.saveObjects = function (t, n) {
                var i = e(10),
                  r = "Usage: index.saveObjects(arrayOfObjects[, callback])";
                if (!i(t)) throw new Error(r);
                for (
                  var s = this,
                    o = {
                      requests: [],
                    },
                    a = 0;
                  a < t.length;
                  ++a
                ) {
                  var l = {
                    action: "updateObject",
                    objectID: t[a].objectID,
                    body: t[a],
                  };
                  o.requests.push(l);
                }
                return this.as._jsonRequest({
                  method: "POST",
                  url:
                    "/1/indexes/" + encodeURIComponent(s.indexName) + "/batch",
                  body: o,
                  hostType: "write",
                  callback: n,
                });
              }),
              (n.prototype.deleteObject = function (e, t) {
                if (
                  "function" == typeof e ||
                  ("string" != typeof e && "number" != typeof e)
                ) {
                  var n = new l.AlgoliaSearchError(
                    "Cannot delete an object without an objectID"
                  );
                  return (
                    (t = e),
                    "function" == typeof t ? t(n) : this.as._promise.reject(n)
                  );
                }
                var i = this;
                return this.as._jsonRequest({
                  method: "DELETE",
                  url:
                    "/1/indexes/" +
                    encodeURIComponent(i.indexName) +
                    "/" +
                    encodeURIComponent(e),
                  hostType: "write",
                  callback: t,
                });
              }),
              (n.prototype.deleteObjects = function (t, n) {
                var i = e(10),
                  r = e(30),
                  s =
                    "Usage: index.deleteObjects(arrayOfObjectIDs[, callback])";
                if (!i(t)) throw new Error(s);
                var o = this,
                  a = {
                    requests: r(t, function (e) {
                      return {
                        action: "deleteObject",
                        objectID: e,
                        body: {
                          objectID: e,
                        },
                      };
                    }),
                  };
                return this.as._jsonRequest({
                  method: "POST",
                  url:
                    "/1/indexes/" + encodeURIComponent(o.indexName) + "/batch",
                  body: a,
                  hostType: "write",
                  callback: n,
                });
              }),
              (n.prototype.deleteByQuery = function (t, n, i) {
                function r(e) {
                  if (0 === e.nbHits) return e;
                  var t = d(e.hits, function (e) {
                    return e.objectID;
                  });
                  return h.deleteObjects(t).then(s).then(o);
                }
                function s(e) {
                  return h.waitTask(e.taskID);
                }
                function o() {
                  return h.deleteByQuery(t, n);
                }
                function l() {
                  a(function () {
                    i(null);
                  }, p._setTimeout || setTimeout);
                }
                function c(e) {
                  a(function () {
                    i(e);
                  }, p._setTimeout || setTimeout);
                }
                var u = e(25),
                  d = e(30),
                  h = this,
                  p = h.as;
                1 === arguments.length || "function" == typeof n
                  ? ((i = n), (n = {}))
                  : (n = u(n)),
                  (n.attributesToRetrieve = "objectID"),
                  (n.hitsPerPage = 1e3),
                  (n.distinct = !1),
                  this.clearCache();
                var f = this.search(t, n).then(r);
                return i ? void f.then(l, c) : f;
              }),
              (n.prototype.browseAll = function (t, n) {
                function i(e) {
                  if (!a._stopped) {
                    var t;
                    (t = void 0 !== e ? "cursor=" + encodeURIComponent(e) : u),
                      l._jsonRequest({
                        method: "GET",
                        url:
                          "/1/indexes/" +
                          encodeURIComponent(c.indexName) +
                          "/browse?" +
                          t,
                        hostType: "read",
                        callback: r,
                      });
                  }
                }
                function r(e, t) {
                  return a._stopped
                    ? void 0
                    : e
                    ? void a._error(e)
                    : (a._result(t),
                      void 0 === t.cursor ? void a._end() : void i(t.cursor));
                }
                "object" == typeof t && ((n = t), (t = void 0));
                var s = e(31),
                  o = e(17),
                  a = new o(),
                  l = this.as,
                  c = this,
                  u = l._getSearchParams(
                    s({}, n || {}, {
                      query: t,
                    }),
                    ""
                  );
                return i(), a;
              }),
              (n.prototype.ttAdapter = function (e) {
                var t = this;
                return function (n, i, r) {
                  var s;
                  (s = "function" == typeof r ? r : i),
                    t.search(n, e, function (e, t) {
                      return e ? void s(e) : void s(t.hits);
                    });
                };
              }),
              (n.prototype.waitTask = function (e, t) {
                function n() {
                  return u
                    ._jsonRequest({
                      method: "GET",
                      hostType: "read",
                      url:
                        "/1/indexes/" +
                        encodeURIComponent(c.indexName) +
                        "/task/" +
                        e,
                    })
                    .then(function (e) {
                      l++;
                      var t = s * l * l;
                      return (
                        t > o && (t = o),
                        "published" !== e.status
                          ? u._promise.delay(t).then(n)
                          : e
                      );
                    });
                }
                function i(e) {
                  a(function () {
                    t(null, e);
                  }, u._setTimeout || setTimeout);
                }
                function r(e) {
                  a(function () {
                    t(e);
                  }, u._setTimeout || setTimeout);
                }
                var s = 100,
                  o = 5e3,
                  l = 0,
                  c = this,
                  u = c.as,
                  d = n();
                return t ? void d.then(i, r) : d;
              }),
              (n.prototype.clearIndex = function (e) {
                var t = this;
                return this.as._jsonRequest({
                  method: "POST",
                  url:
                    "/1/indexes/" + encodeURIComponent(t.indexName) + "/clear",
                  hostType: "write",
                  callback: e,
                });
              }),
              (n.prototype.getSettings = function (e) {
                var t = this;
                return this.as._jsonRequest({
                  method: "GET",
                  url:
                    "/1/indexes/" +
                    encodeURIComponent(t.indexName) +
                    "/settings?getVersion=2",
                  hostType: "read",
                  callback: e,
                });
              }),
              (n.prototype.searchSynonyms = function (e, t) {
                return (
                  "function" == typeof e
                    ? ((t = e), (e = {}))
                    : void 0 === e && (e = {}),
                  this.as._jsonRequest({
                    method: "POST",
                    url:
                      "/1/indexes/" +
                      encodeURIComponent(this.indexName) +
                      "/synonyms/search",
                    body: e,
                    hostType: "read",
                    callback: t,
                  })
                );
              }),
              (n.prototype.saveSynonym = function (e, t, n) {
                return (
                  "function" == typeof t
                    ? ((n = t), (t = {}))
                    : void 0 === t && (t = {}),
                  this.as._jsonRequest({
                    method: "PUT",
                    url:
                      "/1/indexes/" +
                      encodeURIComponent(this.indexName) +
                      "/synonyms/" +
                      encodeURIComponent(e.objectID) +
                      "?forwardToSlaves=" +
                      (t.forwardToSlaves ? "true" : "false"),
                    body: e,
                    hostType: "write",
                    callback: n,
                  })
                );
              }),
              (n.prototype.getSynonym = function (e, t) {
                return this.as._jsonRequest({
                  method: "GET",
                  url:
                    "/1/indexes/" +
                    encodeURIComponent(this.indexName) +
                    "/synonyms/" +
                    encodeURIComponent(e),
                  hostType: "read",
                  callback: t,
                });
              }),
              (n.prototype.deleteSynonym = function (e, t, n) {
                return (
                  "function" == typeof t
                    ? ((n = t), (t = {}))
                    : void 0 === t && (t = {}),
                  this.as._jsonRequest({
                    method: "DELETE",
                    url:
                      "/1/indexes/" +
                      encodeURIComponent(this.indexName) +
                      "/synonyms/" +
                      encodeURIComponent(e) +
                      "?forwardToSlaves=" +
                      (t.forwardToSlaves ? "true" : "false"),
                    hostType: "write",
                    callback: n,
                  })
                );
              }),
              (n.prototype.clearSynonyms = function (e, t) {
                return (
                  "function" == typeof e
                    ? ((t = e), (e = {}))
                    : void 0 === e && (e = {}),
                  this.as._jsonRequest({
                    method: "POST",
                    url:
                      "/1/indexes/" +
                      encodeURIComponent(this.indexName) +
                      "/synonyms/clear?forwardToSlaves=" +
                      (e.forwardToSlaves ? "true" : "false"),
                    hostType: "write",
                    callback: t,
                  })
                );
              }),
              (n.prototype.batchSynonyms = function (e, t, n) {
                return (
                  "function" == typeof t
                    ? ((n = t), (t = {}))
                    : void 0 === t && (t = {}),
                  this.as._jsonRequest({
                    method: "POST",
                    url:
                      "/1/indexes/" +
                      encodeURIComponent(this.indexName) +
                      "/synonyms/batch?forwardToSlaves=" +
                      (t.forwardToSlaves ? "true" : "false") +
                      "&replaceExistingSynonyms=" +
                      (t.replaceExistingSynonyms ? "true" : "false"),
                    hostType: "write",
                    body: e,
                    callback: n,
                  })
                );
              }),
              (n.prototype.setSettings = function (e, t, n) {
                (1 !== arguments.length && "function" != typeof t) ||
                  ((n = t), (t = {}));
                var i = t.forwardToSlaves || !1,
                  r = this;
                return this.as._jsonRequest({
                  method: "PUT",
                  url:
                    "/1/indexes/" +
                    encodeURIComponent(r.indexName) +
                    "/settings?forwardToSlaves=" +
                    (i ? "true" : "false"),
                  hostType: "write",
                  body: e,
                  callback: n,
                });
              }),
              (n.prototype.listUserKeys = function (e) {
                var t = this;
                return this.as._jsonRequest({
                  method: "GET",
                  url:
                    "/1/indexes/" + encodeURIComponent(t.indexName) + "/keys",
                  hostType: "read",
                  callback: e,
                });
              }),
              (n.prototype.getUserKeyACL = function (e, t) {
                var n = this;
                return this.as._jsonRequest({
                  method: "GET",
                  url:
                    "/1/indexes/" +
                    encodeURIComponent(n.indexName) +
                    "/keys/" +
                    e,
                  hostType: "read",
                  callback: t,
                });
              }),
              (n.prototype.deleteUserKey = function (e, t) {
                var n = this;
                return this.as._jsonRequest({
                  method: "DELETE",
                  url:
                    "/1/indexes/" +
                    encodeURIComponent(n.indexName) +
                    "/keys/" +
                    e,
                  hostType: "write",
                  callback: t,
                });
              }),
              (n.prototype.addUserKey = function (t, n, i) {
                var r = e(10),
                  s =
                    "Usage: index.addUserKey(arrayOfAcls[, params, callback])";
                if (!r(t)) throw new Error(s);
                (1 !== arguments.length && "function" != typeof n) ||
                  ((i = n), (n = null));
                var o = {
                  acl: t,
                };
                return (
                  n &&
                    ((o.validity = n.validity),
                    (o.maxQueriesPerIPPerHour = n.maxQueriesPerIPPerHour),
                    (o.maxHitsPerQuery = n.maxHitsPerQuery),
                    (o.description = n.description),
                    n.queryParameters &&
                      (o.queryParameters = this.as._getSearchParams(
                        n.queryParameters,
                        ""
                      )),
                    (o.referers = n.referers)),
                  this.as._jsonRequest({
                    method: "POST",
                    url:
                      "/1/indexes/" +
                      encodeURIComponent(this.indexName) +
                      "/keys",
                    body: o,
                    hostType: "write",
                    callback: i,
                  })
                );
              }),
              (n.prototype.addUserKeyWithValidity = s(function (e, t, n) {
                return this.addUserKey(e, t, n);
              }, o("index.addUserKeyWithValidity()", "index.addUserKey()"))),
              (n.prototype.updateUserKey = function (t, n, i, r) {
                var s = e(10),
                  o =
                    "Usage: index.updateUserKey(key, arrayOfAcls[, params, callback])";
                if (!s(n)) throw new Error(o);
                (2 !== arguments.length && "function" != typeof i) ||
                  ((r = i), (i = null));
                var a = {
                  acl: n,
                };
                return (
                  i &&
                    ((a.validity = i.validity),
                    (a.maxQueriesPerIPPerHour = i.maxQueriesPerIPPerHour),
                    (a.maxHitsPerQuery = i.maxHitsPerQuery),
                    (a.description = i.description),
                    i.queryParameters &&
                      (a.queryParameters = this.as._getSearchParams(
                        i.queryParameters,
                        ""
                      )),
                    (a.referers = i.referers)),
                  this.as._jsonRequest({
                    method: "PUT",
                    url:
                      "/1/indexes/" +
                      encodeURIComponent(this.indexName) +
                      "/keys/" +
                      t,
                    body: a,
                    hostType: "write",
                    callback: r,
                  })
                );
              });
          },
          {
            10: 10,
            17: 17,
            18: 18,
            25: 25,
            26: 26,
            27: 27,
            28: 28,
            29: 29,
            30: 30,
            31: 31,
            9: 9,
          },
        ],
        17: [
          function (e, t) {
            "use strict";
            function n() {}
            t.exports = n;
            var i = e(9),
              r = e(6).EventEmitter;
            i(n, r),
              (n.prototype.stop = function () {
                (this._stopped = !0), this._clean();
              }),
              (n.prototype._end = function () {
                this.emit("end"), this._clean();
              }),
              (n.prototype._error = function (e) {
                this.emit("error", e), this._clean();
              }),
              (n.prototype._result = function (e) {
                this.emit("result", e);
              }),
              (n.prototype._clean = function () {
                this.removeAllListeners("stop"),
                  this.removeAllListeners("end"),
                  this.removeAllListeners("error"),
                  this.removeAllListeners("result");
              });
          },
          {
            6: 6,
            9: 9,
          },
        ],
        18: [
          function (e, t) {
            function n(e, t) {
              (this.indexName = t),
                (this.as = e),
                (this.typeAheadArgs = null),
                (this.typeAheadValueOption = null),
                (this.cache = {});
            }
            var i = e(24);
            (t.exports = n),
              (n.prototype.clearCache = function () {
                this.cache = {};
              }),
              (n.prototype.search = i("query")),
              (n.prototype.similarSearch = i("similarQuery")),
              (n.prototype.browse = function (t, n, i) {
                var r,
                  s,
                  o = e(31),
                  a = this;
                0 === arguments.length ||
                (1 === arguments.length && "function" == typeof arguments[0])
                  ? ((r = 0), (i = arguments[0]), (t = void 0))
                  : "number" == typeof arguments[0]
                  ? ((r = arguments[0]),
                    "number" == typeof arguments[1]
                      ? (s = arguments[1])
                      : "function" == typeof arguments[1] &&
                        ((i = arguments[1]), (s = void 0)),
                    (t = void 0),
                    (n = void 0))
                  : "object" == typeof arguments[0]
                  ? ("function" == typeof arguments[1] && (i = arguments[1]),
                    (n = arguments[0]),
                    (t = void 0))
                  : "string" == typeof arguments[0] &&
                    "function" == typeof arguments[1] &&
                    ((i = arguments[1]), (n = void 0)),
                  (n = o({}, n || {}, {
                    page: r,
                    hitsPerPage: s,
                    query: t,
                  }));
                var l = this.as._getSearchParams(n, "");
                return this.as._jsonRequest({
                  method: "GET",
                  url:
                    "/1/indexes/" +
                    encodeURIComponent(a.indexName) +
                    "/browse?" +
                    l,
                  hostType: "read",
                  callback: i,
                });
              }),
              (n.prototype.browseFrom = function (e, t) {
                return this.as._jsonRequest({
                  method: "GET",
                  url:
                    "/1/indexes/" +
                    encodeURIComponent(this.indexName) +
                    "/browse?cursor=" +
                    encodeURIComponent(e),
                  hostType: "read",
                  callback: t,
                });
              }),
              (n.prototype.searchFacet = function (t, n) {
                var i = e(25),
                  r = e(32),
                  s =
                    "Usage: index.searchFacet({facetName, facetQuery, ...params}[, callback])";
                if (void 0 === t.facetName || void 0 === t.facetQuery)
                  throw new Error(s);
                var o = t.facetName,
                  a = r(i(t), function (e) {
                    return "facetName" === e;
                  }),
                  l = this.as._getSearchParams(a, "");
                return this.as._jsonRequest({
                  method: "POST",
                  url:
                    "/1/indexes/" +
                    encodeURIComponent(this.indexName) +
                    "/facets/" +
                    encodeURIComponent(o) +
                    "/query",
                  hostType: "read",
                  body: {
                    params: l,
                  },
                  callback: n,
                });
              }),
              (n.prototype._search = function (e, t, n) {
                return this.as._jsonRequest({
                  cache: this.cache,
                  method: "POST",
                  url:
                    t ||
                    "/1/indexes/" +
                      encodeURIComponent(this.indexName) +
                      "/query",
                  body: {
                    params: e,
                  },
                  hostType: "read",
                  fallback: {
                    method: "GET",
                    url: "/1/indexes/" + encodeURIComponent(this.indexName),
                    body: {
                      params: e,
                    },
                  },
                  callback: n,
                });
              }),
              (n.prototype.getObject = function (e, t, n) {
                var i = this;
                (1 !== arguments.length && "function" != typeof t) ||
                  ((n = t), (t = void 0));
                var r = "";
                if (void 0 !== t) {
                  r = "?attributes=";
                  for (var s = 0; s < t.length; ++s)
                    0 !== s && (r += ","), (r += t[s]);
                }
                return this.as._jsonRequest({
                  method: "GET",
                  url:
                    "/1/indexes/" +
                    encodeURIComponent(i.indexName) +
                    "/" +
                    encodeURIComponent(e) +
                    r,
                  hostType: "read",
                  callback: n,
                });
              }),
              (n.prototype.getObjects = function (t, n, i) {
                var r = e(10),
                  s = e(30),
                  o = "Usage: index.getObjects(arrayOfObjectIDs[, callback])";
                if (!r(t)) throw new Error(o);
                var a = this;
                (1 !== arguments.length && "function" != typeof n) ||
                  ((i = n), (n = void 0));
                var l = {
                  requests: s(t, function (e) {
                    var t = {
                      indexName: a.indexName,
                      objectID: e,
                    };
                    return n && (t.attributesToRetrieve = n.join(",")), t;
                  }),
                };
                return this.as._jsonRequest({
                  method: "POST",
                  url: "/1/indexes/*/objects",
                  hostType: "read",
                  body: l,
                  callback: i,
                });
              }),
              (n.prototype.as = null),
              (n.prototype.indexName = null),
              (n.prototype.typeAheadArgs = null),
              (n.prototype.typeAheadValueOption = null);
          },
          {
            10: 10,
            24: 24,
            25: 25,
            30: 30,
            31: 31,
            32: 32,
          },
        ],
        19: [
          function (e, t) {
            "use strict";
            var n = e(14),
              i = e(20);
            t.exports = i(n);
          },
          {
            14: 14,
            20: 20,
          },
        ],
        20: [
          function (e, t) {
            (function (n) {
              "use strict";
              var i = e(8),
                r = i.Promise || e(5).Promise;
              t.exports = function (t, s) {
                function o(t, n, i) {
                  var r = e(25),
                    s = e(21);
                  return (
                    (i = r(i || {})),
                    void 0 === i.protocol && (i.protocol = s()),
                    (i._ua = i._ua || o.ua),
                    new a(t, n, i)
                  );
                }
                function a() {
                  t.apply(this, arguments);
                }
                var l = e(9),
                  c = e(28),
                  u = e(22),
                  d = e(23),
                  h = e(33);
                (s = s || ""),
                  "debug" === n.env.NODE_ENV && e(3).enable("algoliasearch*"),
                  (o.version = e(34)),
                  (o.ua = "Algolia for vanilla JavaScript " + s + o.version),
                  (o.initPlaces = h(o)),
                  (i.__algolia = {
                    debug: e(3),
                    algoliasearch: o,
                  });
                var p = {
                  hasXMLHttpRequest: "XMLHttpRequest" in i,
                  hasXDomainRequest: "XDomainRequest" in i,
                };
                return (
                  p.hasXMLHttpRequest &&
                    ((p.cors = "withCredentials" in new XMLHttpRequest()),
                    (p.timeout = "timeout" in new XMLHttpRequest())),
                  l(a, t),
                  (a.prototype._request = function (e, t) {
                    return new r(function (n, i) {
                      function r() {
                        if (!l) {
                          p.timeout || clearTimeout(a);
                          var e;
                          try {
                            e = {
                              body: JSON.parse(h.responseText),
                              responseText: h.responseText,
                              statusCode: h.status,
                              headers:
                                (h.getAllResponseHeaders &&
                                  h.getAllResponseHeaders()) ||
                                {},
                            };
                          } catch (t) {
                            e = new c.UnparsableJSON({
                              more: h.responseText,
                            });
                          }
                          e instanceof c.UnparsableJSON ? i(e) : n(e);
                        }
                      }
                      function s(e) {
                        l ||
                          (p.timeout || clearTimeout(a),
                          i(
                            new c.Network({
                              more: e,
                            })
                          ));
                      }
                      function o() {
                        p.timeout || ((l = !0), h.abort()),
                          i(new c.RequestTimeout());
                      }
                      if (!p.cors && !p.hasXDomainRequest)
                        return void i(new c.Network("CORS not supported"));
                      e = u(e, t.headers);
                      var a,
                        l,
                        d = t.body,
                        h = p.cors
                          ? new XMLHttpRequest()
                          : new XDomainRequest();
                      h instanceof XMLHttpRequest
                        ? h.open(t.method, e, !0)
                        : h.open(t.method, e),
                        p.cors &&
                          (d &&
                            ("POST" === t.method
                              ? h.setRequestHeader(
                                  "content-type",
                                  "application/x-www-form-urlencoded"
                                )
                              : h.setRequestHeader(
                                  "content-type",
                                  "application/json"
                                )),
                          h.setRequestHeader("accept", "application/json")),
                        (h.onprogress = function () {}),
                        (h.onload = r),
                        (h.onerror = s),
                        p.timeout
                          ? ((h.timeout = t.timeout), (h.ontimeout = o))
                          : (a = setTimeout(o, t.timeout)),
                        h.send(d);
                    });
                  }),
                  (a.prototype._request.fallback = function (e, t) {
                    return (
                      (e = u(e, t.headers)),
                      new r(function (n, i) {
                        d(e, t, function (e, t) {
                          return e ? void i(e) : void n(t);
                        });
                      })
                    );
                  }),
                  (a.prototype._promise = {
                    reject: function (e) {
                      return r.reject(e);
                    },
                    resolve: function (e) {
                      return r.resolve(e);
                    },
                    delay: function (e) {
                      return new r(function (t) {
                        setTimeout(t, e);
                      });
                    },
                  }),
                  o
                );
              };
            }.call(this, e(2)));
          },
          {
            2: 2,
            21: 21,
            22: 22,
            23: 23,
            25: 25,
            28: 28,
            3: 3,
            33: 33,
            34: 34,
            5: 5,
            8: 8,
            9: 9,
          },
        ],
        21: [
          function (e, t) {
            "use strict";
            function n() {
              var e = window.document.location.protocol;
              return "http:" !== e && "https:" !== e && (e = "http:"), e;
            }
            t.exports = n;
          },
          {},
        ],
        22: [
          function (e, t) {
            "use strict";
            function n(e, t) {
              return (e += /\?/.test(e) ? "&" : "?"), e + i(t);
            }
            t.exports = n;
            var i = e(13);
          },
          {
            13: 13,
          },
        ],
        23: [
          function (e, t) {
            "use strict";
            function n(e, t, n) {
              function s() {
                t.debug("JSONP: success"),
                  g ||
                    h ||
                    ((g = !0),
                    d ||
                      (t.debug(
                        "JSONP: Fail. Script loaded but did not call the callback"
                      ),
                      a(),
                      n(new i.JSONPScriptFail())));
              }
              function o() {
                ("loaded" !== this.readyState &&
                  "complete" !== this.readyState) ||
                  s();
              }
              function a() {
                clearTimeout(_),
                  (f.onload = null),
                  (f.onreadystatechange = null),
                  (f.onerror = null),
                  p.removeChild(f);
              }
              function l() {
                try {
                  delete window[m], delete window[m + "_loaded"];
                } catch (e) {
                  window[m] = window[m + "_loaded"] = void 0;
                }
              }
              function c() {
                t.debug("JSONP: Script timeout"),
                  (h = !0),
                  a(),
                  n(new i.RequestTimeout());
              }
              function u() {
                t.debug("JSONP: Script error"),
                  g || h || (a(), n(new i.JSONPScriptError()));
              }
              if ("GET" !== t.method)
                return void n(
                  new Error(
                    "Method " +
                      t.method +
                      " " +
                      e +
                      " is not supported by JSONP."
                  )
                );
              t.debug("JSONP: start");
              var d = !1,
                h = !1;
              r += 1;
              var p = document.getElementsByTagName("head")[0],
                f = document.createElement("script"),
                m = "algoliaJSONP_" + r,
                g = !1;
              (window[m] = function (e) {
                return (
                  l(),
                  h
                    ? void t.debug("JSONP: Late answer, ignoring")
                    : ((d = !0),
                      a(),
                      void n(null, {
                        body: e,
                      }))
                );
              }),
                (e += "&callback=" + m),
                t.jsonBody &&
                  t.jsonBody.params &&
                  (e += "&" + t.jsonBody.params);
              var _ = setTimeout(c, t.timeout);
              (f.onreadystatechange = o),
                (f.onload = s),
                (f.onerror = u),
                (f.async = !0),
                (f.defer = !0),
                (f.src = e),
                p.appendChild(f);
            }
            t.exports = n;
            var i = e(28),
              r = 0;
          },
          {
            28: 28,
          },
        ],
        24: [
          function (e, t) {
            function n(e, t) {
              return function (n, r, s) {
                if (
                  ("function" == typeof n && "object" == typeof r) ||
                  "object" == typeof s
                )
                  throw new i.AlgoliaSearchError(
                    "index.search usage is index.search(query, params, cb)"
                  );
                0 === arguments.length || "function" == typeof n
                  ? ((s = n), (n = ""))
                  : (1 !== arguments.length && "function" != typeof r) ||
                    ((s = r), (r = void 0)),
                  "object" == typeof n && null !== n
                    ? ((r = n), (n = void 0))
                    : (void 0 !== n && null !== n) || (n = "");
                var o = "";
                return (
                  void 0 !== n && (o += e + "=" + encodeURIComponent(n)),
                  void 0 !== r && (o = this.as._getSearchParams(r, o)),
                  this._search(o, t, s)
                );
              };
            }
            t.exports = n;
            var i = e(28);
          },
          {
            28: 28,
          },
        ],
        25: [
          function (e, t) {
            t.exports = function (e) {
              return JSON.parse(JSON.stringify(e));
            };
          },
          {},
        ],
        26: [
          function (e, t) {
            t.exports = function (e, t) {
              function n() {
                return (
                  i || (console.log(t), (i = !0)), e.apply(this, arguments)
                );
              }
              var i = !1;
              return n;
            };
          },
          {},
        ],
        27: [
          function (e, t) {
            t.exports = function (e, t) {
              var n = e.toLowerCase().replace(".", "").replace("()", "");
              return (
                "algoliasearch: `" +
                e +
                "` was replaced by `" +
                t +
                "`. Please see https://github.com/algolia/algoliasearch-client-js/wiki/Deprecated#" +
                n
              );
            };
          },
          {},
        ],
        28: [
          function (e, t) {
            "use strict";
            function n(t, n) {
              var i = e(7),
                r = this;
              "function" == typeof Error.captureStackTrace
                ? Error.captureStackTrace(this, this.constructor)
                : (r.stack =
                    new Error().stack ||
                    "Cannot get a stacktrace, browser is too old"),
                (this.name = "AlgoliaSearchError"),
                (this.message = t || "Unknown error"),
                n &&
                  i(n, function (e, t) {
                    r[t] = e;
                  });
            }
            function i(e, t) {
              function i() {
                var i = Array.prototype.slice.call(arguments, 0);
                "string" != typeof i[0] && i.unshift(t),
                  n.apply(this, i),
                  (this.name = "AlgoliaSearch" + e + "Error");
              }
              return r(i, n), i;
            }
            var r = e(9);
            r(n, Error),
              (t.exports = {
                AlgoliaSearchError: n,
                UnparsableJSON: i(
                  "UnparsableJSON",
                  "Could not parse the incoming response as JSON, see err.more for details"
                ),
                RequestTimeout: i(
                  "RequestTimeout",
                  "Request timedout before getting a response"
                ),
                Network: i(
                  "Network",
                  "Network issue, see err.more for details"
                ),
                JSONPScriptFail: i(
                  "JSONPScriptFail",
                  "<script> was loaded but did not call our provided callback"
                ),
                JSONPScriptError: i(
                  "JSONPScriptError",
                  "<script> unable to load due to an `error` event on it"
                ),
                Unknown: i("Unknown", "Unknown error occured"),
              });
          },
          {
            7: 7,
            9: 9,
          },
        ],
        29: [
          function (e, t) {
            t.exports = function (e, t) {
              t(e, 0);
            };
          },
          {},
        ],
        30: [
          function (e, t) {
            var n = e(7);
            t.exports = function (e, t) {
              var i = [];
              return (
                n(e, function (n, r) {
                  i.push(t(n, r, e));
                }),
                i
              );
            };
          },
          {
            7: 7,
          },
        ],
        31: [
          function (e, t) {
            var n = e(7);
            t.exports = function i(e) {
              var t = Array.prototype.slice.call(arguments);
              return (
                n(t, function (t) {
                  for (var n in t)
                    t.hasOwnProperty(n) &&
                      ("object" == typeof e[n] && "object" == typeof t[n]
                        ? (e[n] = i({}, e[n], t[n]))
                        : void 0 !== t[n] && (e[n] = t[n]));
                }),
                e
              );
            };
          },
          {
            7: 7,
          },
        ],
        32: [
          function (e, t) {
            t.exports = function (t, n) {
              var i = e(11),
                r = e(7),
                s = {};
              return (
                r(i(t), function (e) {
                  n(e) !== !0 && (s[e] = t[e]);
                }),
                s
              );
            };
          },
          {
            11: 11,
            7: 7,
          },
        ],
        33: [
          function (e, t) {
            function n(t) {
              return function (n, r, s) {
                var o = e(25);
                (s = (s && o(s)) || {}),
                  (s.hosts = s.hosts || [
                    "places-dsn.algolia.net",
                    "places-1.algolianet.com",
                    "places-2.algolianet.com",
                    "places-3.algolianet.com",
                  ]),
                  (0 !== arguments.length &&
                    "object" != typeof n &&
                    void 0 !== n) ||
                    ((n = ""), (r = ""), (s._allowEmptyCredentials = !0));
                var a = t(n, r, s),
                  l = a.initIndex("places");
                return (l.search = i("query", "/1/places/query")), l;
              };
            }
            t.exports = n;
            var i = e(24);
          },
          {
            24: 24,
            25: 25,
          },
        ],
        34: [
          function (e, t) {
            "use strict";
            t.exports = "3.19.0";
          },
          {},
        ],
      },
      {},
      [19]
    )(19);
  }),
  /**
   * jQuery Grid-A-Licious(tm) v3.01
   *
   * Terms of Use - jQuery Grid-A-Licious(tm)
   * under the MIT (http://www.opensource.org/licenses/mit-license.php) License.
   *
   * Copyright 2008-2012 Andreas Pihlstrm (Suprb). All rights reserved.
   * (http://suprb.com/apps/gridalicious/)
   *
   */
  (function (e, t) {
    var n = function (e, t, n) {
      var i;
      return function () {
        function r() {
          n || e.apply(s, o), (i = null);
        }
        var s = this,
          o = arguments;
        i ? clearTimeout(i) : n && e.apply(s, o), (i = setTimeout(r, t || 150));
      };
    };
    jQuery.fn[t] = function (e) {
      return e ? this.bind("resize", n(e)) : this.trigger(t);
    };
  })(jQuery, "smartresize"),
  (function (e) {
    (e.Gal = function (t, n) {
      (this.element = e(n)), this._init(t);
    }),
      (e.Gal.settings = {
        selector: ".item",
        width: 225,
        gutter: 20,
        animate: !1,
        animationOptions: {
          speed: 200,
          duration: 300,
          effect: "fadeInOnAppear",
          queue: !0,
          complete: function () {},
        },
      }),
      (e.Gal.prototype = {
        _init: function (t) {
          var n = this;
          (this.name = this._setName(5)),
            (this.gridArr = []),
            (this.gridArrAppend = []),
            (this.gridArrPrepend = []),
            (this.setArr = !1),
            (this.setGrid = !1),
            this.setOptions,
            (this.cols = 0),
            (this.itemCount = 0),
            (this.prependCount = 0),
            (this.isPrepending = !1),
            (this.appendCount = 0),
            (this.resetCount = !0),
            (this.ifCallback = !0),
            (this.box = this.element),
            (this.boxWidth = this.box.width()),
            (this.options = e.extend(!0, {}, e.Gal.settings, t)),
            (this.gridArr = e.makeArray(this.box.find(this.options.selector))),
            (this.isResizing = !1),
            (this.w = 0),
            (this.boxArr = []),
            this._setCols(),
            this._renderGrid("append"),
            e(this.box).addClass("gridalicious"),
            e(window).smartresize(function () {
              n.resize();
            });
        },
        _setName: function (e, t) {
          return (
            (t = t ? t : ""),
            e
              ? this._setName(
                  --e,
                  "0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".charAt(
                    Math.floor(60 * Math.random())
                  ) + t
                )
              : t
          );
        },
        _setCols: function () {
          (this.cols = Math.floor(this.box.width() / this.options.width)),
            this.cols < 1 && (this.cols = 1),
            (diff =
              (this.box.width() -
                this.cols * this.options.width -
                this.options.gutter) /
              this.cols),
            (w = ((this.options.width + diff) / this.box.width()) * 100),
            (this.w = w);
          for (var t = 0; t < this.cols; t++) {
            var n = e("<ul></ul>")
              .addClass("galcolumn")
              .attr("id", "item" + t + this.name)
              .css({
                width: w + "%",
                paddingLeft: this.options.gutter,
                paddingBottom: this.options.gutter,
                float: "left",
                "-webkit-box-sizing": "border-box",
                "-moz-box-sizing": "border-box",
                "-o-box-sizing": "border-box",
                "box-sizing": "border-box",
              });
            this.box.append(n);
          }
          this.box.find(e("#clear" + this.name)).remove();
          var i = e("<div></div>")
            .css({
              clear: "both",
              height: "0",
              width: "0",
              display: "block",
            })
            .attr("id", "clear" + this.name);
          this.box.append(i);
        },
        _renderGrid: function (t, n, i) {
          {
            var r = [],
              s = [],
              o = 0,
              a = (this.prependCount, this.appendCount),
              l = this.options.gutter,
              c = this.cols,
              u = this.name;
            e(".galcolumn").width();
          }
          n
            ? ((s = n),
              "append" == t && ((a += i), (o = this.appendCount)),
              "prepend" == t &&
                ((this.isPrepending = !0),
                (o = Math.round(i % c)),
                0 >= o && (o = c)),
              "renderAfterPrepend" == t && ((a += i), (o = i)))
            : ((s = this.gridArr), (a = e(this.gridArr).size())),
            e.each(s, function (n, i) {
              var s = e(i),
                d = "100%";
              if (
                (s.hasClass("not-responsive") && (d = "auto"),
                s
                  .css({
                    marginBottom: l,
                    zoom: "1",
                    filter: "alpha(opacity=0)",
                    opacity: "0",
                  })
                  .find("img, object, embed, iframe")
                  .css({
                    width: d,
                    height: "auto",
                    display: "block",
                    "margin-left": "auto",
                    "margin-right": "auto",
                  }),
                "prepend" == t)
              )
                o--,
                  e("#item" + o + u).prepend(s),
                  r.push(s),
                  0 == o && (o = c);
              else {
                for (
                  var h = e("#item0" + u), p = e("#item0" + u).height(), f = 1;
                  c > f;
                  f++
                ) {
                  var m = e("#item" + f + u),
                    g = e("#item" + f + u).height();
                  p - 30 > g && ((p = g), (h = m), (o = f));
                }
                h.append(s), r.push(s), a >= c && (a -= c);
              }
            }),
            (this.appendCount = a),
            (this.itemCount = o),
            "append" == t || "prepend" == t
              ? ("prepend" == t && this._updateAfterPrepend(this.gridArr, s),
                this._renderItem(r),
                (this.isPrepending = !1))
              : this._renderItem(this.gridArr);
        },
        _collectItems: function () {
          var t = [];
          return (
            e(this.box)
              .find(this.options.selector)
              .each(function () {
                t.push(e(this));
              }),
            t
          );
        },
        _renderItem: function (t) {
          var n = this.options.animationOptions.speed,
            i = this.options.animationOptions.effect,
            r = this.options.animationOptions.duration,
            s = this.options.animationOptions.queue,
            o = this.options.animate,
            a = this.options.animationOptions.complete,
            l = 0,
            c = 0;
          o !== !0 || this.isResizing
            ? (e.each(t, function (t, n) {
                e(n).css({
                  opacity: "1",
                  filter: "alpha(opacity=100)",
                });
              }),
              this.ifCallback && a.call(t))
            : (s === !0 && "fadeInOnAppear" == i
                ? (this.isPrepending && t.reverse(),
                  e.each(t, function (i, s) {
                    setTimeout(function () {
                      e(s).animate(
                        {
                          opacity: "1.0",
                        },
                        r
                      ),
                        c++,
                        c == t.length && a.call(void 0, t);
                    }, l * n),
                      l++;
                  }))
                : s === !1 &&
                  "fadeInOnAppear" == i &&
                  (this.isPrepending && t.reverse(),
                  e.each(t, function (n, i) {
                    e(i).animate(
                      {
                        opacity: "1.0",
                      },
                      r
                    ),
                      c++,
                      c == t.length && this.ifCallback && a.call(void 0, t);
                  })),
              s !== !0 ||
                i ||
                e.each(t, function (n, i) {
                  e(i).css({
                    opacity: "1",
                    filter: "alpha(opacity=100)",
                  }),
                    c++,
                    c == t.length && this.ifCallback && a.call(void 0, t);
                }));
        },
        _updateAfterPrepend: function (t, n) {
          var i = this.gridArr;
          e.each(n, function (e, t) {
            i.unshift(t);
          }),
            (this.gridArr = i);
        },
        resize: function (t) {
          if (this.box.width() !== this.boxWidth || (void 0 != t && 0 != t)) {
            this.box.css("display", "block");
            var n = this.box.find(e(".galcolumn"));
            n.detach(),
              this._setCols(),
              (this.ifCallback = !1),
              (this.isResizing = !0),
              this._renderGrid("append"),
              (this.ifCallback = !0),
              (this.isResizing = !1),
              (this.boxWidth = this.box.width()),
              n.remove(),
              this.box.trigger("gridalicious:resized");
          }
        },
        append: function (t) {
          var n = this.gridArr,
            i = this.gridArrPrepend;
          e.each(t, function (e, t) {
            n.push(t), i.push(t);
          }),
            this._renderGrid("append", t, e(t).size());
        },
        prepend: function (t) {
          (this.ifCallback = !1),
            this._renderGrid("prepend", t, e(t).size()),
            (this.ifCallback = !0);
        },
      }),
      (e.fn.gridalicious = function (t, n) {
        return (
          this.each(
            "string" == typeof t
              ? function () {
                  var i = e.data(this, "gridalicious");
                  i[t].apply(i, [n]);
                }
              : function () {
                  e.data(this, "gridalicious", new e.Gal(t, this));
                }
          ),
          this
        );
      });
  })(jQuery),
  ($.Gal.prototype.updateOption = function (e) {
    var t = Object.keys(e),
      n = this;
    t.forEach(function (t) {
      n.options[t] = e[t];
    });
  }),
  ($.Gal.prototype.resize = function (e) {
    if (this.box.width() !== this.boxWidth || (void 0 != e && 0 != e)) {
      this.box.trigger("gridalicious:toResize"),
        this.box.css("display", "block");
      var t = this.box.find($(".galcolumn"));
      t.detach(),
        this._setCols(),
        (this.ifCallback = !1),
        (this.isResizing = !0),
        this._renderGrid("append"),
        (this.ifCallback = !0),
        (this.isResizing = !1),
        (this.boxWidth = this.box.width()),
        t.remove(),
        this.box.trigger("gridalicious:resized");
    }
  }),
  Class(
    UI,
    "JsonFetcher"
  )({
    RETRIES: 3,
    RETRY_AFTER: 1e3,
    prototype: {
      init: function (e) {
        (this.async = e.async || !1),
          (this.path = e.path),
          (this.retries = e.retries || UI.JsonFetcher.RETRIES),
          (this.retryAfter = e.retryAfter || UI.JsonFetcher.RETRY_AFTER);
      },
      fetch: function () {
        var e = this,
          t = new Promise(function (t, n) {
            var i = {
                method: "GET",
                url: e.path,
                dataType: "json",
                async: e.async,
                retries: e.retries,
                retryAfter: e.retryAfter,
              },
              r = function (s) {
                (i.retries -= 1),
                  i.retries > 0
                    ? setTimeout(function () {
                        $.ajax(i).done(t).fail(r);
                      }, i.retryAfter)
                    : ((s.url = e.jsonPath), n(s));
              };
            $.ajax(i).done(t).fail(r);
          });
        return t;
      },
    },
  }),
  Module(
    Helpers,
    "PremiumAssetsValidator"
  )({
    _assetPremiumValidationStrategy: {
      background: "_checkForPremiumMulticontrolAssets",
      graphic: "_checkForPremiumMulticontrolAssets",
      video: "_checkForPremiumMulticontrolAssets",
      asset_library: "_checkForPremiumMulticontrolAssets",
      default: "_checkForPremiumAssets",
      text: "_checkForPremiumFonts",
      track: "_checkForPremiumAudio",
    },
    getStageInfo: function () {
      var e = JSON.parse(JSON.stringify(Helpers.StageType.getStageInfo()));
      return (
        e &&
          e.is_free &&
          this._checkForPremiumAssetsInStage() &&
          (e.is_free = !1),
        e
      );
    },
    _checkForPremiumAssetsInStage: function () {
      var e = !1;
      return (e = Helpers.StageType.isVideoV4()
        ? this._checkForPremiumAssetsInVideoV4()
        : this._checkForPremiumAssetsInSmartTemplate());
    },
    _checkForPremiumAssetsInSmartTemplate: function () {
      var e = page.stage.record;
      return this._checkForPremiumAssetsStrategy(e);
    },
    _checkForPremiumAssetsInVideoV4: function () {
      if (this._checkForPremiumAudio(page.stage.audioRecord) === !0) return !0;
      var e = JSON.parse(MemoryStorage.getItem("slidesData")).collection,
        t = page.stage.record;
      e[page.stage.selectedSlide] = t;
      for (var n = 0; n < e.length; n++) {
        var i = e[n];
        if (this._checkForPremiumAssetsStrategy(i) === !0) return !0;
      }
      return !1;
    },
    _checkForPremiumAssetsStrategy: function (e) {
      var t,
        n = !1;
      for (var i in e)
        e.hasOwnProperty(i) &&
          ((t =
            Helpers.PremiumAssetsValidator._assetPremiumValidationStrategy[i]),
          void 0 === t &&
            (t =
              Helpers.PremiumAssetsValidator._assetPremiumValidationStrategy[
                "default"
              ]),
          e[i] && this[t](e[i]) && (n = !0));
      return n;
    },
    _checkForPremiumFonts: function (e) {
      for (var t = 0; t < e.length; t++) {
        var n = e[t],
          i = n.allowedFonts.filter(function (e) {
            return e.name === n.font;
          });
        if (i.length && n.visible === !0 && i[0].isPremium) return !0;
      }
      return !1;
    },
    _checkForPremiumAudio: function (e) {
      return e && e.enabled && e.track && e.track.isPremium === !0 ? !0 : !1;
    },
    _checkForPremiumMulticontrolAssets: function (e) {
      for (var t = 0; t < e.length; t++) {
        var n = e[t];
        if (n.hasLayers && n.selectedLayer && n.selectedLayer.isPremium === !0)
          return !0;
      }
      return !1;
    },
    _checkForPremiumAssets: function (e) {
      return e.isPremium === !0;
    },
  }),
  Module(Helpers, "State").includes(CustomEventSupport)({
    _stateEndpoint: "/stateid/",
    MAX_SECONDS_POST_STATE: 45,
    INTERVAL_FOR_RETRY: 1e3,
    getParams: function (e) {
      return window.history.state || this._getState(e), window.history.state;
    },
    setParams: function (e) {
      var t = this,
        n = {},
        i = t._getNewStateId();
      (n.id = i), (n.data = e), (n.persist = !1);
      var r = [window.location.origin, window.location.pathname];
      e ? (r = r.concat("?stateId=", i)) : (n = null),
        Helpers.StageType.isVideoV4() &&
          window.history.pushState(
            n,
            Helpers.StageType.getStageSlug(),
            r.join("")
          ),
        t.dispatch("pushstate", {
          stateObject: n,
        });
      var s = new Date();
      t._setState(n, s);
    },
    _setState: function (e, t) {
      var n = this;
      e &&
        $.ajax({
          url: n._stateEndpoint,
          data: e,
          dataType: "json",
          method: "POST",
          async: !0,
          success: n._postStateSuccessHandler.bind(n),
          error: n._postStateFailHandler.bind(n, e, t),
        });
    },
    _getState: function (e) {
      var t = this,
        n = [t._stateEndpoint, e].join("");
      $.ajax({
        url: n,
        method: "GET",
        async: !1,
        success: t._getStateSuccessHandler.bind(t),
        error: t._getStateFailHandler.bind(t),
      });
    },
    _postStateSuccessHandler: function (e) {
      var t, n, i;
      (t = this),
        (n = [
          window.location.origin,
          window.location.pathname,
          "?stateId=",
          e.id,
        ].join("")),
        Helpers.StageType.isVideoV4()
          ? (history.state.id !== e.id &&
              "staging" === window.environment &&
              Helpers.GlobalEventTracker.track("stateID.collision", {
                error: !1,
                message: [
                  "there was a collision with a state ID: ",
                  history.state.id,
                ].join(""),
                response: e,
              }),
            window.history.replaceState(
              window.history.state,
              Helpers.StageType.getStageSlug(),
              n
            ),
            (i = {
              stateObject: window.history.state,
            }))
          : (i = {
              stateObject: e,
            }),
        t.dispatch("replacestate", i);
    },
    _postStateFailHandler: function (e, t, n) {
      var i,
        r,
        s = this,
        o = s._getSecondsRetryingPostState(t);
      o >= 5 &&
        Helpers.App.isAdmin() &&
        ((i =
          "State server is not available. Your changes might not be stored"),
        window.page.flash(i, "alert", {
          autoclose: {
            milliseconds: PageController.NOTIFICATION_AUTODISMISS_TIME + 5e3,
          },
        })),
        o >= 45
          ? ((r = Helpers.App.isAdmin()
              ? "stateID.postState.admin"
              : "stateID.postState"),
            Helpers.GlobalEventTracker.track(r, {
              error: !0,
              message: "Could not store state date after 45 seconds trying",
              response: n,
            }))
          : setTimeout(function () {
              s._setState(e, t);
            }, s.INTERVAL_FOR_RETRY);
    },
    _getStateSuccessHandler: function (e) {
      try {
        window.history.replaceState(
          {
            data: JSON.parse(e),
          },
          "",
          window.location.href
        );
      } catch (t) {
        Helpers.GlobalEventTracker.track("stateID.parseGetState", {
          error: !0,
          message: "Error parsing response from state ID service",
          response: e,
        });
      }
    },
    _getStateFailHandler: function (e) {
      Helpers.GlobalEventTracker.track("stateID.getState", {
        error: !0,
        message: "Error getting state data from service",
        response: e,
      }),
        setTimeout(function () {
          page.stage.dispatch("stage.error", {
            message:
              "We weren't able to load stage's state right now. Please try again later",
          });
        });
    },
    _getNewStateId: function () {
      return new Date().getTime().toString(16) + this._getSalt(4);
    },
    _getSecondsRetryingPostState: function (e) {
      return (new Date().getTime() - e.getTime()) / 1e3;
    },
    _getSalt: function (e) {
      var t = function (e) {
        var n, i, r, s;
        for (e = e || 32, i = "", r = 0, s = 14, n = 0; e > n; n += 1)
          i += t.codes[Math.floor(Math.random() * (s - r + 1)) + r];
        return i;
      };
      return (
        (t.codes = [
          0,
          1,
          2,
          3,
          4,
          5,
          6,
          7,
          8,
          9,
          "a",
          "b",
          "c",
          "d",
          "e",
          "f",
        ]),
        t(e)
      );
    },
  }),
  Module(
    Helpers,
    "Collision"
  )({
    rectangleCircle: function (e, t) {
      var n, i, r, s, o, a;
      return (
        (n = t.x),
        (i = t.y),
        t.x < e.x ? (n = e.x) : t.x > e.x + e.width && (n = e.x + e.width),
        t.y < e.y ? (i = e.y) : t.y > e.y + e.height && (i = e.y + e.height),
        (r = t.x - n),
        (s = t.y - i),
        (o = Math.sqrt(r * r + s * s)),
        (a = {
          collision: !1,
          distance: o,
          rectangle: e,
          circle: t,
        }),
        o <= t.radius && (a.collision = !0),
        a
      );
    },
  }),
  Module(Helpers, "PurchasesHelper").includes(CustomEventSupport)({
    getDownloadPathById: function (e) {
      return new Promise(function (t, n) {
        $.ajax({
          method: "GET",
          url: "/api/v1/purchases/" + e + "/get_image_url",
        })
          .done(function (e) {
            t(e.path);
          })
          .fail(n);
      });
    },
  }),
  Module("CDNSupport")({
    _cdnRoundRobin: 0,
    prototype: {
      _CDNConfig: {
        development: {
          basePath: "https://smart-templates.us",
          cdnPath: "https://assets-staging-#.placeit.net",
          cdnPublicPath:
            "https://nice-assets-staging#.s3-accelerate.amazonaws.com",
        },
        staging: {
          basePath: "https://smart-templates.us",
          cdnPath: "https://assets-staging-#.placeit.net",
          cdnPublicPath:
            "https://nice-assets-staging#.s3-accelerate.amazonaws.com",
        },
        production: {
          basePath: "https://smart-templates.us",
          cdnPath: "https://assets-staging-#.placeit.net",
          cdnPublicPath:
            "https://nice-assets-staging#.s3-accelerate.amazonaws.com",
          // basePath: "http://localhost:9999",
          // cdnPath: "http://localhost:9999",
          // cdnPublicPath: "http://localhost:9999",
        },
      },
      _cdnBasePath: function () {
        var e = this._CDNConfig[window.environment].cdnPath;
        return (
          (CDNSupport._cdnRoundRobin = (CDNSupport._cdnRoundRobin % 3) + 1),
          e.replace(/#/, CDNSupport._cdnRoundRobin)
        );
      },
      _cdnBasePublicPath: function () {
        var e = this._CDNConfig[window.environment].cdnPublicPath;
        console.log("_cdnBasePublicPath", e);
        return e;
        return (
          (CDNSupport._cdnRoundRobin = (CDNSupport._cdnRoundRobin % 3) + 1),
          1 === CDNSupport._cdnRoundRobin
            ? e.replace(/#/, "")
            : e.replace(/#/, "-" + CDNSupport._cdnRoundRobin)
        );
      },
    },
  }),
  Class(UI, "SwitchStagePriceModal")
    .inherits(UI.SimpleModal)
    .includes(
      CDNSupport,
      BubblingSupport
    )({
    content:
      '<div class="switchStagePriceModal">                <div class= "images">                    <div class="leftImage"><img src="./assets/left-image-premium-modal.png"></div>                    <div class="selectedImage"><span class="crown"></span>                        <img src="">                        <i class="glyphicon glyphicon-music"></i>                    </div>                    <div class="rigthImage"><img src="./assets/right-image-premium-modal.png"></div>                </div>                <div class="paidText">Free templates don\'t include Premium graphics. Use them for <span class="paidTextPrice"></span></div>                <div class="subcriptionText">Free with Unlimited Subscription</div>                <button class="gotItBtn button primary">Got it!</button>                <div class="orDiv">or</div>                <button class="getSubscriptionBtn button primary">Get Unlimited Subscription!</button>            </div>',
    prototype: {
      $gotItBtn: null,
      $paidTextPrice: null,
      $assetImg: null,
      $icon: null,
      init: function (e) {
        UI.SimpleModal.prototype.init.call(this, e),
          this.addCloseButton(),
          this.setContent(UI.SwitchStagePriceModal.content),
          (this.$gotItBtn = this.element.find(".gotItBtn")),
          (this.$paidTextPrice = this.element.find(".paidTextPrice")),
          (this.$getSubscriptionBtn = this.element.find(".getSubscriptionBtn")),
          (this.$assetImg = this.element.find(".selectedImage img")),
          (this.$icon = this.element.find(".selectedImage i")),
          this._bindEvents();
      },
      _bindEvents: function () {
        return (
          this.$gotItBtn.click(
            function () {
              this.deactivate();
            }.bind(this)
          ),
          this.$getSubscriptionBtn.click(
            function () {
              Helpers.GlobalEventTracker.premiumAssetsModalOpenSubscribtion({
                session: Helpers.App.getTrackerId(),
                user_id: Helpers.App.getUser().id,
                button_clicked: "other",
              }),
                this.dispatch("pricingButton.click");
            }.bind(this)
          ),
          this
        );
      },
      activate: function (e, t) {
        this.setAssetImage(e),
          this.setPrice(t),
          UI.SimpleModal.prototype.activate.call(this);
      },
      setPrice: function (e) {
        var t = window.currencyHelper.getSymbol(recurlyConfig.currency);
        this.$paidTextPrice.text(t + e);
      },
      setAssetImage: function (e) {
        if (e) {
          var t = this._cdnBasePath() + e;
          e.startsWith("https://") && (t = e),
            this.$assetImg.attr("src", t),
            this.$icon.hide(),
            this.$assetImg.show();
        } else this.$icon.show(), this.$assetImg.hide();
      },
    },
  }),
  Module("SwitchStageThemeSupport")({
    _assetChangeStrategy: {
      TextControl: "_getChangeDataFromTextcontrol",
      AudioControl: "_getChangeDataFromAudiocontrol",
      MultiControl: "_getChangeDataFromMulticontrol",
    },
    prototype: {
      themeSupportWidgetList: ["stageActionsManager"],
      showSwitchModalAllowed: !0,
      switchStagePriceModal: null,
      initSwitchStageThemeSupport: function () {
        Helpers.StageType.getStageInfo().is_free &&
          !Helpers.App.isSubscriptionValid() &&
          (this._instantiateSwitchStagePriceModal(),
          this.bind("change", this._changeStateEventsHandler.bind(this))),
          (Helpers.App.isAdmin() === !0 || Helpers.App.isSubscriptionValid()) &&
            (this.showSwitchModalAllowed = !1);
      },
      _changeStateEventsHandler: function (e) {
        var t = this;
        Helpers.StageType.getTheme()
          .then(function (n) {
            t.setTheme(n);
            var i = t._getChangedData(e.data);
            n === ThemeSupport.PAID &&
              t.showSwitchModalAllowed &&
              i.isPremium &&
              ((t.showSwitchModalAllowed = !1),
              t.activateSwitchStagePriceModal(i)),
              n === ThemeSupport.FREE && (t.showSwitchModalAllowed = !0);
          })
          ["catch"](function (e) {
            throw new Error(e);
          });
      },
      _instantiateSwitchStagePriceModal: function () {
        this.appendChild(
          new UI.SwitchStagePriceModal({
            name: "switchStagePriceModal",
            dismissable: !0,
          })
        ),
          this.switchStagePriceModal.render($("body"));
      },
      updateChildrenTheme: function (e) {
        var t = this;
        this.themeSupportWidgetList.forEach(function (n) {
          void 0 !== t[n] && t[n].setTheme && t[n].setTheme(e);
        });
      },
      setFreeTheme: function () {
        this.updateChildrenTheme(ThemeSupport.FREE);
      },
      setPaidTheme: function () {
        this.updateChildrenTheme(ThemeSupport.PAID);
      },
      setAdminTheme: function () {
        this.updateChildrenTheme(ThemeSupport.ADMIN);
      },
      setSubscribedTheme: function () {
        this.updateChildrenTheme(ThemeSupport.SUBSCRIBED);
      },
      _getChangedData: function (e) {
        var t, n;
        return (
          e.originalDispatcher &&
            e.originalDispatcher.constructor &&
            ((t = e.originalDispatcher.constructor.className),
            (n = SwitchStageThemeSupport._assetChangeStrategy[t])),
          void 0 === n ? {} : this[n](e)
        );
      },
      _getChangeDataFromMulticontrol: function (e) {
        var t = null,
          n = null,
          i = !1;
        return (
          e.originalDispatcher &&
            e.originalDispatcher.record &&
            e.originalDispatcher.record.selectedLayer &&
            ((t = e.originalDispatcher.record.selectedLayer.image),
            (n = e.originalDispatcher.record.selectedLayer.id),
            (i = e.originalDispatcher.record.selectedLayer.isPremium)),
          {
            id: n,
            image: t,
            isPremium: i,
          }
        );
      },
      _getChangeDataFromAudiocontrol: function (e) {
        var t = null,
          n = !1;
        return (
          e.originalDispatcher &&
            e.originalDispatcher.record &&
            e.originalDispatcher.record.track &&
            ((t = e.originalDispatcher.record.track.id),
            (n = e.originalDispatcher.record.track.isPremium)),
          {
            id: t,
            image: void 0,
            isPremium: n,
          }
        );
      },
      _getChangeDataFromTextcontrol: function (e) {
        var t = null,
          n = null,
          i = !1;
        return (
          e.originalDispatcher &&
            e.originalDispatcher.fontPicker &&
            e.originalDispatcher.fontPicker.activeFont &&
            ((t = e.originalDispatcher.fontPicker.activeFont.image),
            (n = e.originalDispatcher.fontPicker.activeFont.id),
            (i = e.originalDispatcher.fontPicker.activeFont.isPremium)),
          {
            id: n,
            image: t,
            isPremium: i,
          }
        );
      },
      activateSwitchStagePriceModal: function (e) {
        var t = this,
          n = Helpers.Price.stage(
            Helpers.PremiumAssetsValidator.getStageInfo()
          );
        n.priceWithDiscount
          .then(function (n) {
            t.switchStagePriceModal.activate(e.image, n),
              Helpers.GlobalEventTracker.premiumAssetsModalOpen({
                session: Helpers.App.getTrackerId(),
                user_id: Helpers.App.getUser().id,
                asset_id: e.id,
              });
          })
          ["catch"](function (e) {
            throw new Error(e);
          });
      },
      updatePremiumFontsInfo: function () {
        var e = this;
        AlgoliaClient.findFontsBy(
          {
            name: e._getSuggestedFontsList(),
          },
          1e3
        )
          .then(function (t) {
            return e._adaptAlgoliaResponse(t);
          })
          .then(function (t) {
            e._updateSuggestedFonts(t),
              e.leftSideBar.textControlGroup.updatePremiumBadgeInControls(),
              Helpers.GlobalEventTracker.track("updatePremiumFontsInfo", {
                stage: window.location.href,
              });
          });
      },
      _getSuggestedFontsList: function () {
        var e = [],
          t = this;
        if (Helpers.StageType.isVideoV4()) {
          var n = this._getSlidesRecord();
          n.forEach(function (n) {
            Array.prototype.push.apply(e, t._getAllowedFontsNames(n.text));
          });
        } else
          Array.prototype.push.apply(e, t._getAllowedFontsNames(t.record.text));
        return e
          .filter(function (t, n) {
            return e.indexOf(t) === n;
          })
          .map(function (e) {
            return "'" + e + "'";
          });
      },
      _getAllowedFontsNames: function (e) {
        var t = [];
        return (
          e.forEach(function (e) {
            e.allowedFonts.forEach(function (e) {
              t.push(e.name);
            });
          }),
          t
        );
      },
      _adaptAlgoliaResponse: function (e) {
        var t = {};
        return (
          window.AlgoliaFontDataAdapter.adaptAlgoliaResponse(e),
          e.hits.forEach(function (e) {
            var n = new Font({
              data: e,
            });
            t[n.name] = n;
          }),
          new Promise.resolve(t)
        );
      },
      _updateSuggestedFonts: function (e, t) {
        var n = this;
        if (
          (!t & n.record &&
            ((t = n.record.text), this._updateSuggestedFontsData(e, t)),
          Helpers.StageType.isVideoV4())
        ) {
          var i = this._getSlidesRecord();
          i.forEach(function (t) {
            n._updateSuggestedFontsData(e, t.text);
          });
          var r = JSON.parse(MemoryStorage.getItem("slidesData"));
          (r.collection = i),
            MemoryStorage.setItem("slidesData", JSON.stringify(r));
        }
      },
      _updateSuggestedFontsData: function (e, t) {
        for (var n = this, i = 0; i < t.length; i++)
          for (var r = 0; r < t[i].allowedFonts.length; r++) {
            var s = t[i].allowedFonts[r].name,
              o = e[s];
            if (void 0 !== o) {
              t[i].allowedFonts[r] = o;
              var a = n.fontListManager.findInList("all", s);
              (a.isPremium = o.isPremium),
                o.isPremium &&
                  t[i].visible &&
                  o.name === t[i].font &&
                  n.showSwitchModalAllowed &&
                  (n.activateSwitchStagePriceModal({
                    image: o.image,
                    id: o.id,
                  }),
                  (n.showSwitchModalAllowed = !1));
            }
          }
      },
      _getSlidesRecord: function () {
        var e = this,
          t = JSON.parse(MemoryStorage.getItem("slidesData")).collection;
        return void 0 !== e.record && (t[e.selectedSlide] = e.record), t;
      },
    },
  }),
  Module("StageFontsSupport")({
    _fontsManifestPath: "fonts/public_fonts_manifest.json",
    prototype: {
      buildStageFonts: function (e) {
        var t,
          n,
          i,
          r,
          s = this;
        s._createFontLists(),
          s._setSavedFontsClass(),
          (t = s._getForeignFonts(e)),
          (n = void 0 === window.savedFonts ? [] : window.savedFonts);
        var o = s._compileStageRecordsFonts(e),
          a = t.map(function (e) {
            return "'" + e + "'";
          });
        (i = s._setFontsIndexSearchParams(a, n)),
          (r =
            null === i
              ? new Promise.resolve()
              : AlgoliaClient.findFontsBy(
                  i,
                  s.constructor.ALGOLIA_FONTS_RESULT_QUANTITY
                ));
        var l = s._requestFontManifest();
        return Promise.all([r, l])
          .then(function (r) {
            var a = r[0],
              l = s._mapFontsFromManifest(r[1]);
            null !== i &&
              (window.AlgoliaFontDataAdapter.adaptAlgoliaResponse(a),
              s._feedFontList(n, "saved", a.hits, "id"),
              s._feedFontList(t, "recent", a.hits, "name")),
              s._updateListAllWitAllowedFonts(o, l, e);
          })
          ["catch"](function (e) {
            var t = new Error(
              "AlgoliaFonts:searchError " +
                JSON.stringify({
                  error: e,
                })
            );
            window.newrelic.noticeError(t);
          });
      },
      buildSlideFonts: function (e) {
        var t = this,
          n = t._collectStageFonts(e),
          i = [];
        return (
          n.forEach(function (e) {
            var n = t.fontListManager.findInList("all", e.name);
            n || ((e.id = t._fontUrlToFontId(e.image)), i.push(e));
          }),
          0 === i.length
            ? Promise.resolve()
            : t
                ._requestFontManifest()
                .then(function (n) {
                  var r = t._mapFontsFromManifest(n);
                  t._updateListAllWitAllowedFonts(i, r, e);
                })
                ["catch"](function (e) {
                  var t = new Error(
                    "FontsManifest:searchError " +
                      JSON.stringify({
                        error: e,
                      })
                  );
                  window.newrelic.noticeError(t);
                })
        );
      },
      _requestFontManifest: function () {
        var e = this;
        console.log("_requestFontManifest", e.getPublicFontsManifestPath());
        return new Promise(function (t, n) {
          $.ajax({
            url: e.getPublicFontsManifestPath(),
            success: t,
            error: n,
          });
        });
      },
      _mapFontsFromManifest: function (e) {
        var t = {};
        return (
          e.forEach(function (e) {
            t[e.id] = e;
          }),
          t
        );
      },
      _updateListAllWitAllowedFonts: function (e, t, n) {
        var i = this,
          r = i.fontListManager.getList("all"),
          s = {};
        e.forEach(function (e) {
          var n = i._findFontInManifest(e, t);
          void 0 !== n && (e.isPremium = n.isPremium);
          var o = new Font({
            data: e,
          });
          (s[o.name] = o), r.add(o, "name");
        }),
          i._updateSuggestedFonts(s, n);
      },
      _getUIJsonTexts: function () {
        var e = [],
          t = this._getSlidesRecord();
        return (
          t.forEach(function (t) {
            e = e.concat(t.text);
          }),
          e.filter(function (t, n) {
            return e.indexOf(t) === n;
          })
        );
      },
      getPublicFontsManifestPath: function () {
        return [
          this._cdnBasePublicPath(),
          StageFontsSupport._fontsManifestPath,
        ].join("/");
      },
      _findFontInManifest: function (e, t) {
        return e.id || (e.id = this._fontUrlToFontId(e.image)), t[e.id];
      },
    },
  }),
  Module("VideoS3BucketSupport")({
    prototype: {
      _videoBucketBasePath: {
        development: "https://s3.amazonaws.com/place.it-staging/",
        staging: "https://s3.amazonaws.com/place.it-staging/",
        production: "https://s3.amazonaws.com/place.it/",
      },
      _getVideoBucketBasePath: function () {
        return this._videoBucketBasePath[window.environment];
      },
      _getVideoS3URL: function (e) {
        return this._getVideoBucketBasePath() + "uploads/" + e + "/video.mp4";
      },
    },
  }),
  Module("ChangesCounterSupport")({
    prototype: {
      counter: 0,
      pendingToCount: 0,
      increment: function () {
        (this.counter += this.pendingToCount),
          this.dispatch("newChange", {
            oldValue: this.counter - this.pendingToCount,
            newValue: this.counter,
            fromIncrement: !0,
          }),
          (this.pendingToCount = 0);
      },
      decrement: function () {
        0 !== this.pendingToCount && this.pendingToCount--;
      },
      setValue: function (e) {
        var t = this.counter;
        (this.counter = e),
          this.dispatch("newChange", {
            oldValue: t,
            newValue: this.counter,
            fromIncrement: !1,
          });
      },
      addPendingToCount: function () {
        this.pendingToCount++;
      },
    },
  }),
  Module("CleanRecordSupport")({
    newLineRegex: /\n/g,
    httpRegex: /^http[s]+:/,
    prototype: {
      getCleanRecord: function (e) {
        var t, n;
        return (
          (t = JSON.parse(JSON.stringify(e))),
          (n = function (e) {
            return e.filter(function (e) {
              return e.visible;
            });
          }),
          t.graphic &&
            t.graphic.forEach(function (e) {
              e.layers && (e.layers = n(e.layers));
            }),
          t.background &&
            t.background.forEach(function (e) {
              e.layers && (e.layers = n(e.layers));
            }),
          t.video &&
            t.video.forEach(function (e) {
              e.layers && (e.layers = n(e.layers));
            }),
          t.asset_library &&
            t.asset_library.forEach(function (e) {
              e.layers && (e.layers = n(e.layers));
            }),
          t.text &&
            t.text.forEach(function (e) {
              e.allowedFonts = e.allowedFonts.filter(function (t) {
                return e.font === t.name;
              });
            }),
          t.customRules &&
            t.customRules.forEach(function (e) {
              delete e.accumulatedInteractions;
            }),
          t.options &&
            t.options.length > 0 &&
            t.options.forEach(function (e) {
              e.options = [];
            }),
          delete t.previewImage,
          delete t.md5Hash,
          (t._slideData = null),
          t
        );
      },
      getNormalizedJSON: function (e) {
        var t = this.getCleanRecord(e),
          n = this._sortObjectByProperties,
          i = this.constructor.newLineRegex,
          r = this.constructor.httpRegex;
        if (
          window._pl_featureFlags.t17627.enableNormalizer !== !0 &&
          window.devMode !== !0
        )
          return t;
        if (
          (console.log("Using JSON normalizer"),
          t.images &&
            t.images.forEach(function (e) {
              (e.name = e.name.replace("ae.custom_graphic.", "")),
                e.layers &&
                  e.layers.length > 0 &&
                  null === e.layers[0].image &&
                  (e.layers = []),
                delete e.hash;
            }),
          t.text &&
            t.text.forEach(function (e) {
              e.allowedFonts &&
                Array.isArray(e.allowedFonts) &&
                (e.allowedFonts = e.allowedFonts.map(function (e) {
                  return (
                    delete e.id, delete e.visible, delete e.isPremium, n(e)
                  );
                })),
                e.contents && (e.contents = e.contents.replace(i, "\r")),
                e.visible === !1 && (e.contents = ""),
                e.color && (e.color = e.color.toLowerCase()),
                (e.capitalization = "ALLCAPS"),
                delete e.excludable,
                delete e.maxCharacters,
                delete e.layers,
                delete e.maxLines;
            }),
          t.video &&
            t.video.forEach(function (e) {
              (e.layers = []),
                e.selectedLayer &&
                  (delete e.selectedLayer.assetType,
                  delete e.selectedLayer.tags,
                  delete e.selectedLayer.usage,
                  delete e.selectedLayer.updatedAt,
                  delete e.selectedLayer.assetGroups,
                  delete e.selectedLayer.smallImageSize,
                  delete e.selectedLayer.allowTrimmer,
                  delete e.selectedLayer.duration,
                  delete e.selectedLayer.isPremium,
                  delete e.selectedLayer.objectID,
                  delete e.selectedLayer.layers,
                  "customGraphic" === e.selectedLayer.id &&
                    (delete e.selectedLayer.name,
                    delete e.selectedLayer.userImageFileName,
                    delete e.selectedLayer.path),
                  "null" === e.selectedLayer.id && delete e.selectedLayer.size,
                  (e.selectedLayer = n(e.selectedLayer))),
                e.hasLayers === !0 &&
                  null === e.selectedLayer &&
                  (e.selectedLayer = {
                    id: "null",
                    image: null,
                    visible: !0,
                  }),
                delete e.preconfiguredSearch;
            }),
          t.asset_library &&
            t.asset_library.forEach(function (e) {
              (e.layers = []),
                e.selectedLayer &&
                  (delete e.selectedLayer.assetType,
                  delete e.selectedLayer.tags,
                  delete e.selectedLayer.usage,
                  delete e.selectedLayer.updatedAt,
                  delete e.selectedLayer.assetGroups,
                  delete e.selectedLayer.hasAnimated,
                  delete e.selectedLayer.originalFile,
                  delete e.selectedLayer.duration,
                  delete e.selectedLayer.smallImageSize,
                  delete e.selectedLayer.allowTrimmer,
                  delete e.selectedLayer.isPremium,
                  delete e.selectedLayer.objectID,
                  delete e.selectedLayer.layers,
                  "customGraphic" === e.selectedLayer.id &&
                    (delete e.selectedLayer.name,
                    delete e.selectedLayer.userImageFileName,
                    delete e.selectedLayer.path,
                    r.test(e.selectedLayer.image) === !1 &&
                      delete e.selectedLayer.image),
                  e.selectedLayer.image &&
                    (e.selectedLayer.image = e.selectedLayer.image.replace(
                      "small.jpg",
                      "medium.jpg"
                    )),
                  "null" === e.selectedLayer.id && delete e.selectedLayer.size,
                  (e.selectedLayer = n(e.selectedLayer))),
                e.hasLayers === !0 &&
                  null === e.selectedLayer &&
                  (e.selectedLayer = {
                    id: "null",
                    image: null,
                    visible: !0,
                  }),
                delete e.preconfiguredSearch;
            }),
          t.graphic &&
            t.graphic.forEach(function (e) {
              e.selectedLayer &&
                (delete e.selectedLayer.assetType,
                delete e.selectedLayer.tags,
                delete e.selectedLayer.updatedAt,
                delete e.selectedLayer.assetGroups,
                delete e.selectedLayer.usage,
                delete e.selectedLayer.hasAnimated,
                delete e.selectedLayer.originalFile,
                delete e.selectedLayer.duration,
                delete e.selectedLayer.smallImageSize,
                delete e.selectedLayer.allowTrimmer,
                delete e.selectedLayer.isPremium,
                delete e.selectedLayer.objectID,
                r.test(e.selectedLayer.image) === !1 &&
                  delete e.selectedLayer.image,
                r.test(e.selectedLayer.video) === !1 &&
                  delete e.selectedLayer.video,
                delete e.selectedLayer.path,
                e.selectedLayer.layers &&
                  Array.isArray(e.selectedLayer.layers) &&
                  e.selectedLayer.layers.forEach(function (e) {
                    delete e.keyFrame,
                      e.color && (e.color = e.color.toLowerCase());
                  }),
                "null" === e.selectedLayer.id && delete e.selectedLayer.size,
                (e.selectedLayer = n(e.selectedLayer))),
                e.hasLayers === !0 &&
                  null === e.selectedLayer &&
                  (e.selectedLayer = {
                    id: "null",
                    image: null,
                    visible: !0,
                  }),
                Array.isArray(e.layers) &&
                  0 === e.layers.length &&
                  delete e.selectedLayer.layers,
                delete e.groupTags,
                delete e.width,
                delete e.height,
                delete e.preconfiguredSearch,
                (e.color = e.color ? e.color.toLowerCase() : "#000000"),
                delete e.layers,
                (e.layers = []);
            }),
          t.color_picker &&
            t.color_picker.forEach(function (e) {
              delete e.layers, e.color && (e.color = e.color.toLowerCase());
            }),
          delete t.composition,
          delete t.defaultAssetColors,
          (t = n(t)),
          t.linkedSmartTemplateId)
        ) {
          var s = t.linkedSmartTemplateId;
          delete t.linkedSmartTemplateId, (t.linkedSmartTemplateId = s);
        }
        return t;
      },
      _sortObjectByProperties: function (e) {
        return Object.keys(e)
          .sort()
          .reduce(function (t, n) {
            return (t[n] = e[n]), t;
          }, {});
      },
    },
  }),
  Module("ColorPalettesSupport")({
    prototype: {
      _fullPalette: [
        [
          "#000000",
          "#171717",
          "#2B2B2B",
          "#3F3F3F",
          "#565656",
          "#6D6D6D",
          "#848484",
          "#A0A0A0",
          "#B5B5B5",
          "#C0C0C0",
          "#CECECE",
          "#DADADA",
          "#E5E5E5",
          "#F2F2F2",
          "#FFFFFF",
        ],
        [
          "#EFDFE2",
          "#EFE3E1",
          "#EAE4DA",
          "#E5E1D1",
          "#EAE7D6",
          "#E9EDDA",
          "#DDEDE0",
          "#E4EFEC",
          "#DFEBED",
          "#E3EDF2",
          "#DFE3EF",
          "#E3E1EF",
          "#E9E2F2",
          "#F2EAF4",
          "#F4E6EE",
        ],
        [
          "#FED9DF",
          "#FED5CB",
          "#FEE6C2",
          "#FFF2C3",
          "#FFF9C9",
          "#EEFEB2",
          "#BFFECE",
          "#BDFFF4",
          "#B8F1FE",
          "#B0E8FE",
          "#CFDAFF",
          "#DBD2FF",
          "#E7CFFF",
          "#F9D2FF",
          "#FED0E9",
        ],
        [
          "#FFA4AF",
          "#FFB297",
          "#FFCF83",
          "#FFE578",
          "#FFF388",
          "#F0F998",
          "#9FFFB3",
          "#A0F2E2",
          "#7BE6FF",
          "#7DD4FF",
          "#B3C7FF",
          "#BFB0FF",
          "#D6ABFF",
          "#F4A9FF",
          "#FD9ED1",
        ],
        [
          "#FF5572",
          "#FF8A66",
          "#F4B460",
          "#F2D86D",
          "#FCE963",
          "#E0F48C",
          "#8EEF9D",
          "#8FEAD9",
          "#80D9E8",
          "#5CC1FF",
          "#7DA5FF",
          "#9988FF",
          "#B678FF",
          "#EA83FF",
          "#FD72CA",
        ],
        [
          "#F9354C",
          "#F76943",
          "#FFB133",
          "#F2D455",
          "#F9E535",
          "#D1F746",
          "#5DED6B",
          "#61F2D9",
          "#57D5EA",
          "#39AAFF",
          "#407BFF",
          "#6B48FF",
          "#915CF7",
          "#D959EF",
          "#FC46A8",
        ],
        [
          "#FF0013",
          "#FF4800",
          "#FFA300",
          "#FFCE00",
          "#FFEC00",
          "#BBFF00",
          "#00FF4E",
          "#00FFDA",
          "#00C9FF",
          "#007AFF",
          "#0031FF",
          "#3E00FF",
          "#8F00FF",
          "#E600FF",
          "#FC1681",
        ],
        [
          "#e2142d",
          "#E24610",
          "#E09722",
          "#E2B80A",
          "#EAC800",
          "#B1E007",
          "#00EA3D",
          "#1FDBB7",
          "#10BAE2",
          "#0E78D8",
          "#002EC1",
          "#3636BA",
          "#6F2EBC",
          "#C813E2",
          "#DE2386",
        ],
        [
          "#c1112f",
          "#C13610",
          "#C98B27",
          "#C19D0A",
          "#CCB409",
          "#A2C914",
          "#06C633",
          "#1FB598",
          "#14A9C1",
          "#0068C6",
          "#002A91",
          "#2020B7",
          "#5816B7",
          "#B00ECC",
          "#B8287C",
        ],
        [
          "#aa0b2d",
          "#A52A0E",
          "#AF761B",
          "#8C7206",
          "#A08E10",
          "#85A317",
          "#24AA3D",
          "#1C8E78",
          "#0096AF",
          "#005A9E",
          "#0B316D",
          "#1212A0",
          "#33048E",
          "#8F15AD",
          "#8F1F65",
        ],
        [
          "#820828",
          "#841E0D",
          "#723E00",
          "#6B5600",
          "#685D12",
          "#66702E",
          "#298939",
          "#237061",
          "#117A8C",
          "#004466",
          "#012354",
          "#0E0E7F",
          "#281868",
          "#69187C",
          "#712057",
        ],
        [
          "#560a22",
          "#5E180E",
          "#563610",
          "#4F420B",
          "#443F15",
          "#3F4C11",
          "#215127",
          "#174940",
          "#085663",
          "#063244",
          "#061D38",
          "#16104C",
          "#10064C",
          "#440E51",
          "#531342",
        ],
      ],
      _limitedPalette: [
        [
          "#ffffff",
          "#1d1d1d",
          "#142649",
          "#303538",
          "#00a86b",
          "#26306c",
          "#f16b81",
          "#a2a7ab",
        ],
        [
          "#74242e",
          "#004b94",
          "#e0a0b0",
          "#263a31",
          "#2c2c2c",
          "#404040",
          "#93bce4",
          "#ad362d",
        ],
        [
          "#474747",
          "#b72e6d",
          "#c4beb2",
          "#d6dbdd",
          "#f6ab1b",
          "#574b8b",
          "#5b2534",
          "#4b6b90",
        ],
        [
          "#0079a2",
          "#008eb3",
          "#a1e3bb",
          "#336633",
          "#c0e336",
          "#f8f07c",
          "#ffeb99",
          "#d5b74f",
        ],
        ["#9c8e74", "#3f2d1f", "#f59c58", "#e65a39"],
      ],
      getFullPalette: function () {
        return $.extend(!0, [], this._fullPalette);
      },
      getLimitedColorsPalette: function () {
        return $.extend(!0, [], this._limitedPalette);
      },
      _getRamdomColor: function (e) {
        var t = Math.floor(Math.random() * (e.length - 1) + 1),
          n = Math.floor(Math.random() * (e[t].length - 1) + 1);
        return e[t][n];
      },
      getFullPaletteRandomColor: function () {
        return this._getRamdomColor(this.getFullPalette());
      },
    },
  }),
  Class("CropperLocalCropper")({
    PERSIST_URL: "/cropper/persist",
    SLOW_CONNECTION_ALERT: {
      time: 3e4,
      message:
        "This is taking longer than usual, check your internet connection and try again",
    },
    crop: function (e, t) {
      var n, i;
      return (
        (n = this),
        (i = {}),
        (i.id = t.id),
        (i.user_image_filename = e.name),
        (i.crop_params = t),
        new Promise(function (r, s) {
          n._getBase64(e)
            .then(function (e) {
              return (
                (i.user_image_url = e),
                CropResize.run(e, t)
                  .then(function (e) {
                    return (
                      (i.cropped_image_url = e),
                      CropResize.generateThumbnail(e)
                        .then(function (e) {
                          (i.thumbnail_url = e), r(i);
                        })
                        ["catch"](s)
                    );
                  })
                  ["catch"](s)
              );
            })
            ["catch"](s);
        })
      );
    },
    persist: function (e, t) {
      var n, i, r, s;
      return (
        (n = this),
        (i = {
          userImage: e.user_image_url,
          croppedImage: e.cropped_image_url,
          thumbnail: e.thumbnail_url,
          cropParams: e.crop_params,
        }),
        (r = function () {
          var e = P.delay(n.SLOW_CONNECTION_ALERT.time);
          return (s = P.runner(Promise.reject(!0))), Promise.race([e, s]);
        }),
        r()
          .then(function () {
            "function" == typeof t && t(n.SLOW_CONNECTION_ALERT.message);
          })
          ["catch"](function () {}),
        new Promise(function (e, t) {
          s.run();
          e({});
          // $.ajax({
          //   method: "POST",
          //   url: n.PERSIST_URL,
          //   data: JSON.stringify(i),
          //   processData: null,
          //   contentType: "application/json",
          // })
          //   .done(function (t) {
          //     s.run(), e(t);
          //   })
          //   .fail(function (e) {
          //     s.run(), t(e.responseText);
          //   });
        })
      );
    },
    _getBase64: function (e) {
      return new Promise(function (t, n) {
        if (e instanceof File == !1) return t(e);
        var i = new FileReader();
        i.readAsDataURL(e),
          (i.onload = function () {
            t(i.result);
          }),
          (i.onerror = function (e) {
            n(e);
          });
      });
    },
  }),
  Class("CropperLocalUploader")({
    upload: function (e) {
      var t = this;
      return new Promise(function (n, i) {
        t._getBase64(e)
          .then(function (e) {
            n(t._buildMock(e));
          })
          ["catch"](i);
      });
    },
    _buildMock: function (e) {
      var t = this._generateUid(10);
      return {
        id: t,
        user_image_filename: "user_image.jpeg",
        user_image_url: e,
      };
    },
    _getBase64: function (e) {
      return new Promise(function (t, n) {
        var i = new FileReader();
        i.readAsDataURL(e),
          (i.onload = function () {
            t(i.result);
          }),
          (i.onerror = function (e) {
            n(e);
          });
      });
    },
    _generateUid: (function () {
      var e = function (t) {
        var n, i, r, s;
        for (t = t || 32, i = "", r = 0, s = 14, n = 0; t > n; n++)
          i += e.codes[Math.floor(Math.random() * (s - r + 1)) + r];
        return i;
      };
      return (
        (e.codes = [
          0,
          1,
          2,
          3,
          4,
          5,
          6,
          7,
          8,
          9,
          "a",
          "b",
          "c",
          "d",
          "e",
          "f",
        ]),
        e
      );
    })(),
  }),
  Class("CropperRemoteCropper")({
    CROP_URL: "/cropper/crop",
    CROP_VIDEO_URL: "/cropper/cropNTrimVideo",
    crop: function (e) {
      return new Promise(function (t, n) {
        $.ajax(CropperRemoteCropper.CROP_URL, {
          method: "POST",
          data: e,
        })
          .done(t)
          .fail(n);
      });
    },
    cropVideo: function (e) {
      return new Promise(function (t, n) {
        $.ajax(CropperRemoteCropper.CROP_VIDEO_URL, {
          method: "POST",
          data: e,
        })
          .done(t)
          .fail(n);
      });
    },
  }),
  Class("CropperRemoteUploader")({
    UPLOAD_URL: "/cropper/upload",
    UPLOAD_VIDEO_URL: "/cropper/uploadVideo",
    UPLOAD_BY_URL: "/cropper/uploadByUrl",
    UPLOAD_VIDEO_BY_URL: "/cropper/uploadVideoByUrl",
    UPLOAD_VIDEO_BY_PUBLIC_URL: "/cropper/uploadVideoByPublicUrl",
    STORE_VIDEO: "/cropper/storeVideo",
    upload: function (e) {
      return new Promise(function (t, n) {
        var i = new FormData();
        i.append("user_image", e, e.name),
          "undefined" != typeof window._stageData &&
            Helpers.StageType.isCropperTool() &&
            i.append("cropperResize", !0),
          $.ajax({
            url: CropperRemoteUploader.UPLOAD_URL,
            data: i,
            method: "POST",
            processData: !1,
            contentType: !1,
            cache: !1,
          })
            .done(t)
            .fail(n);
      });
    },
    uploadURI: function (e) {
      return new Promise(function (t, n) {
        t();
        // var i = new FormData();
        // i.append("user_image_url", e),
        //   "undefined" != typeof window._stageData &&
        //     Helpers.StageType.isCropperTool() &&
        //     i.append("cropperResize", !0),
        //   $.ajax({
        //     url: CropperRemoteUploader.UPLOAD_URL,
        //     data: i,
        //     method: "POST",
        //     processData: !1,
        //     contentType: !1,
        //     cache: !1,
        //   })
        //     .done(t)
        //     .fail(n);
      });
    },
    uploadVideo: function (e, t) {
      return new Promise(function (n, i) {
        var r = new FormData();
        (t = t || {}),
          r.append("user_video", e, e.name),
          $.ajax({
            url: CropperRemoteUploader.UPLOAD_VIDEO_URL,
            data: r,
            method: "POST",
            processData: !1,
            contentType: !1,
            cache: !1,
            headers: t,
          })
            .done(n)
            .fail(i);
      });
    },
    uploadByUrl: function (e) {
      return new Promise(function (t, n) {
        $.ajax(CropperRemoteUploader.UPLOAD_BY_URL, {
          method: "POST",
          data: e,
        })
          .done(t)
          .fail(n);
      });
    },
    uploadVideoByUrl: function (e) {
      return new Promise(function (t, n) {
        $.ajax(CropperRemoteUploader.UPLOAD_VIDEO_BY_URL, {
          method: "POST",
          data: e,
        })
          .done(t)
          .fail(n);
      });
    },
    uploadVideoByPublicUrl: function (e, t) {
      return new Promise(function (n, i) {
        $.ajax(CropperRemoteUploader.UPLOAD_VIDEO_BY_PUBLIC_URL, {
          method: "POST",
          data: e,
          headers: t,
        })
          .done(n)
          .fail(i);
      });
    },
    storeVideo: function (e, t) {
      return new Promise(function (n, i) {
        var r = new FormData();
        (t = t || {}),
          r.append("user_video", e, e.name),
          $.ajax({
            url: CropperRemoteUploader.STORE_VIDEO,
            data: r,
            method: "POST",
            processData: !1,
            contentType: !1,
            cache: !1,
            headers: t,
          })
            .done(n)
            .fail(i);
      });
    },
  }),
  Module("PinchDetectSupport")({
    prototype: {
      previousDistance: 0,
      touchMoveHandler: null,
      touchEndHandler: null,
      boundElement: null,
      bindPinch: function (e) {
        (this.boundElement = e),
          (this.touchMoveHandler = this._touchMoveHandler.bind(this)),
          (this.touchEndHandler = this._touchEndHandler.bind(this)),
          e.addEventListener("touchmove", this.touchMoveHandler),
          e.addEventListener("touchend", this.touchEndHandler);
      },
      unbindPinch: function () {
        this.boundElement.removeEventListener(this.touchMoveHandler),
          this.boundElement.removeEventListener(this.touchEndHandler);
      },
      _getDistance: function (e, t) {
        return Math.sqrt(
          Math.pow(e.clientX - t.clientX, 2) +
            Math.pow(t.clientY - e.clientY, 2)
        );
      },
      _touchMoveHandler: function (e) {
        var t,
          n,
          i = e.touches || e.originalEvent.touches;
        2 === i.length &&
          ((t = this._getDistance(i[0], i[1])),
          0 !== this.previousDistance
            ? ((n = t / this.previousDistance),
              (this.previousDistance = t),
              this.dispatch("pinch", {
                deltaDistance: n,
                distance: t,
              }))
            : ((n = 0), (this.previousDistance = t)));
      },
      _touchEndHandler: function () {
        (this.previousDistance = 0), this.dispatch("pinchend");
      },
    },
  }),
  Class(UI, "CropperModal").inherits(Widget).includes(PinchDetectSupport)({
    elementClass: "cropper-object-image",
    html: '        <div class="modal cropper-overlay fade" id="cropperOverlay" tabindex="-1" role="dialog" arial-labelledby="cropperOverlayLabel" aria-hidden="true" data-backdrop="static">          <div class="modal-dialog">            <div class="modal-content">              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>              <div class="modal-header">              </div>              <div class="modal-body">              </div>            </div>          </div>        </div>    ',
    _cropperTemplate:
      '        <div class="cropper-object-image">          <div class="cropMain"></div>          <div class="cropSlider"></div>          <div class="seekable-timeline-container"></div>          <button class="crop-and-trim-button is-hidden button primary">Crop & Trim</button>          <button class="cropButton button primary button-sh">Crop</button>          <button class="reset-cropper button secondary button-sh">Reset</button>        </div>    ',
    ERROR_MESSAGES: {
      imageDimensions:
        "The height or width of your image is larger than 7500 pixels.             Please upload a smaller resolution image! Click             <a target='_blank' href='https://blog.placeit.net/resize-images-placeit/'>here</a> for help.",
      imageFormat:
        "Unfortunately your file is not supported, we support jpg, jpeg, and png",
      video: "Couldn\u2019t load video",
    },
    prototype: {
      $window: null,
      $modalBody: null,
      $cropperContainer: null,
      $cropMain: null,
      $cropContainer: null,
      $lines: null,
      $cropButton: null,
      $resetButton: null,
      $cropAndTrimButton: null,
      cropperObject: null,
      _viewportDimensions: null,
      active: !1,
      CROP_SPACE: 80,
      MIN_WIDTH_MODAL: 362,
      pinchHandler: null,
      pinchEndHandler: null,
      zoomRange: null,
      init: function (e) {
        Widget.prototype.init.call(this, e),
          (this.$window = $(window)),
          (this.$modalBody = this.element.find(".modal-body")),
          this._bindEvents();
      },
      _bindEvents: function () {
        return (
          (this._arrowKeysHandler = this._arrowKeysHandler.bind(this)),
          (this.pinchHandler = this._pinchHandler.bind(this)),
          (this.pinchEndHandler = this._pinchEndHandler.bind(this)),
          this.element.on(
            "keydown",
            function (e) {
              13 === e.which &&
                (this._applyCrop(),
                Helpers.GlobalEventTracker.cropKeydownEnter({
                  stage_type:
                    Helpers.StageType._types[
                      window._stageData.stage_data.image_type
                    ],
                }));
            }.bind(this)
          ),
          this.element.on(
            "click",
            ".cropButton, .crop-and-trim-button",
            function () {
              this._applyCrop();
            }.bind(this)
          ),
          this.element.on(
            "click",
            ".reset-cropper",
            function () {
              return this.cropperObject.imgReset(), !1;
            }.bind(this)
          ),
          this.element.on(
            "click",
            ".close",
            function () {
              this.dispatch("modal.cancel"), this.deactivate();
            }.bind(this)
          ),
          this.element.bind(
            "keydown",
            function (e) {
              27 === e.keyCode &&
                (this.dispatch("modal.cancel"), this.deactivate());
            }.bind(this)
          ),
          this.element.on(
            "hidden.bs.modal",
            function () {
              this.cropperObject.destroy();
            }.bind(this)
          ),
          this.bind("pinch", this.pinchHandler),
          this.bind("pinchend", this.pinchEndHandler),
          this
        );
      },
      _arrowKeysHandler: function (e) {
        var t, n;
        return this.active !== !0
          ? !1
          : ((t = 0),
            (n = 0),
            37 === e.which
              ? (t = 1)
              : 38 === e.which
              ? (n = 1)
              : 39 === e.which
              ? (t = -1)
              : 40 === e.which && (n = -1),
            this.cropperObject.imgMove({
              t: n,
              l: t,
            }),
            this);
      },
      _newCropInstance: function (e) {
        return (
          this.$modalBody.empty(),
          this.$modalBody.html(this.constructor._cropperTemplate),
          (this.cropperObject = null),
          (this.cropperObject = new CROP()),
          this.cropperObject
            .setConstraints(e.cropperConstraints)
            .init(".cropper-object-image", e.isVideo),
          (this.$cropperContainer = this.element.find(".cropper-object-image")),
          (this.$cropMain = this.element.find(".cropMain")),
          (this.$cropContainer = this.element
            .find(".crop-container")
            .addClass("with-shadow")),
          (this.$lines = {
            top: this.$cropperContainer.find(".cropper-top-line"),
            right: this.$cropperContainer.find(".cropper-right-line"),
            bottom: this.$cropperContainer.find(".cropper-bottom-line"),
            left: this.$cropperContainer.find(".cropper-left-line"),
          }),
          (this.$cropButton = this.element.find(".cropButton")),
          (this.$resetButton = this.element.find(".reset-cropper")),
          (this.$cropAndTrimButton = this.element.find(
            ".crop-and-trim-button"
          )),
          (this.zoomRange = this.cropperObject.getZoomRange()),
          this.bindPinch(this.element[0]),
          this.cropperObject.eles.ele.bind(
            "imageLoaded",
            function (e) {
              this.element.removeAttr("style"), this.dispatch("imageLoaded", e);
            }.bind(this)
          ),
          this.cropperObject.eles.img.bind(
            "error",
            function () {
              var e;
              this.element.hide(),
                (e =
                  this.cropperObject.isVideo === !0
                    ? this.constructor.ERROR_MESSAGES.video
                    : this.constructor.ERROR_MESSAGES.imageFormat),
                this.dispatch("imageLoadError", {
                  message: e,
                });
            }.bind(this)
          ),
          this.cropperObject.eles.ele.bind(
            "imageDimensionsExceeded",
            function () {
              this.element.hide(),
                this.dispatch("imageLoadError", {
                  message: this.constructor.ERROR_MESSAGES.imageDimensions,
                  sizeExceeded: !0,
                });
            }.bind(this)
          ),
          this
        );
      },
      _getViewportDimensions: function () {
        return this._viewportDimensions;
      },
      _loadImage: function (e) {
        return (
          (e = e.substring(e.search("/uploads"), e.length)),
          this.cropperObject.loadImg(e),
          this
        );
      },
      _resizeContainers: function () {
        var e, t;
        return (
          (e = this._getViewportDimensions()),
          (t = this._getCropperDimensions(e.width, e.height)),
          this._resizeCropperArea({
            width: t.width + this.CROP_SPACE,
            height: t.height + this.CROP_SPACE,
          }),
          this._updateCropperLinesPosition({
            width: t.width,
            height: t.height,
          }),
          this._setModalWidth(t.width),
          this
        );
      },
      _setModalWidth: function (e) {
        var t, n, i;
        (i = this.CROP_SPACE),
          (t = 42 + i),
          (n = e + t >= this.MIN_WIDTH_MODAL ? e + t : this.MIN_WIDTH_MODAL),
          this.element.find(".modal-dialog").width(n);
      },
      _getCropperDimensions: function (e, t) {
        var n, i, r, s, o, a, l;
        return (
          (a = this.CROP_SPACE),
          (n = this.$window.width()),
          (i = this.$window.height()),
          (o = 78 + a),
          (r = n - o),
          (l = this.cropperObject.isVideo ? 67 : 0),
          (heightConstraint = 244 + l + a),
          (s = i - heightConstraint),
          (fitHorizontally = function () {
            (cropperWidth = r), (cropperHeight = (t / e) * cropperWidth);
          }),
          (fitVertically = function () {
            (cropperHeight = s), (cropperWidth = (e / t) * cropperHeight);
          }),
          e >= r
            ? (fitHorizontally(), cropperHeight > s && fitVertically())
            : (fitVertically(), cropperWidth > r && fitHorizontally()),
          {
            width: cropperWidth,
            height: cropperHeight,
          }
        );
      },
      _setCustomBorderShadow: function () {
        var e = $("<div></div>"),
          t = this.$lines.top,
          n = this.$lines.left;
        e.css({
          "box-sizing": "border-box",
          border: "solid rgba(0, 0, 0, 0.3)",
          "pointer-events": "none",
          top: 0,
          left: 0,
          width: "100%",
          height: "100%",
          "border-top-width": t.css("top"),
          "border-left-width": n.css("left"),
          "border-bottom-width":
            this.$cropContainer.height() -
            (parseInt(t.css("top")) + n.height() + t.height()) +
            "px",
          "border-right-width":
            this.$cropContainer.width() -
            (parseInt(n.css("left")) + t.width() + n.width()) +
            "px",
          position: "absolute",
          "z-index": 6e3,
        }),
          this.$cropContainer.append(e);
      },
      _resizeCropperArea: function (e) {
        return (
          this.$cropMain.css({
            width: e.width,
            height: e.height,
          }),
          this.$cropContainer.css({
            width: e.width,
            height: e.height,
          }),
          this
        );
      },
      _updateCropperLinesPosition: function (e, t) {
        return (
          t ||
            (t = {
              top: 40,
              left: 40,
            }),
          this.$lines.top.css({
            width: e.width,
            top: t.top + "px",
            left: t.left + "px",
          }),
          this.$lines.bottom.css({
            width: e.width,
            top: t.top + e.height + "px",
            left: t.left + "px",
          }),
          this.$lines.left.css({
            height: e.height,
            top: t.top + "px",
            left: t.left + "px",
          }),
          this.$lines.right.css({
            height: e.height,
            top: t.top + "px",
            left: t.left + e.width + "px",
          }),
          this
        );
      },
      _applyCrop: function () {
        var e, t;
        return (
          (e = this),
          this.cropperDebounce && clearTimeout(this.cropperDebounce),
          (this.cropperDebounce = setTimeout(function () {
            return (
              e.deactivate(),
              (t = e._getImageScale())
                ? (e.dispatch("cropImage", e._getParamsFromCropper()), !1)
                : !1
            );
          }, 200)),
          this
        );
      },
      _getImageScale: function () {
        var e,
          t = this.element.find(".crop-img"),
          n = parseFloat(t.get(0).style.width, 10);
        return 0 === t.length
          ? !1
          : ((e = t.get(0).naturalWidth),
            "VIDEO" === t[0].tagName && (e = t[0].videoWidth),
            n / e);
      },
      _getImageDimensions: function () {
        var e = this.element.find(".crop-img");
        return 0 === e.length
          ? !1
          : {
              width: e.width(),
              height: e.height(),
            };
      },
      _getCropAreaDimensions: function () {
        return {
          width: this.$cropMain.width() - 80,
          height: this.$cropMain.height() - 80,
        };
      },
      _getParamsFromCropper: function () {
        var e, t, n, i, r, s, o, a;
        e = this.element.find(".crop-img");
        var l;
        return (
          8 === _stageData.stage_data.image_type ||
          14 === _stageData.stage_data.image_type
            ? ((t = this._getImageDimensions()),
              (n = this._getCropAreaDimensions()),
              (i = parseInt(e.css("left"), 10) - 40),
              (r = parseInt(e.css("top"), 10) - 40),
              (l = {
                id: this.productShot.id,
                x: i,
                y: r,
                width: n.width,
                height: n.height,
                scale: this._getImageScale(),
                new_width: t.width,
                new_height: t.height,
              }))
            : ((a = this.cropperObject.imgInfo),
              (s = parseInt(e.css("top"), 10) - 40),
              (o = parseInt(e.css("left"), 10) - 40),
              (l = {
                id: this.productShot ? this.productShot.id : null,
                actual_height: a.ah,
                actual_left: a.al,
                actual_top: a.at,
                actual_width: a.aw,
                new_width: a.w,
                new_height: a.h,
                top: s,
                left: o,
                zoom: a.s,
                longer_side: this.cropperObject.imgInfo.longerSide,
                image_element_top: a.t,
                image_element_left: a.l,
              })),
          (l.trim_start = this.cropperObject.getVideoTrimStart()),
          (l.trim_end = this.cropperObject.getVideoTrimEnd()),
          l
        );
      },
      setViewportDimensions: function (e) {
        return (this._viewportDimensions = e), this;
      },
      loadProductShotData: function (e, t) {
        return (
          (this.productShot = e),
          this._newCropInstance(t),
          this._resizeContainers(),
          this.element.show(),
          this._loadImage(this.productShot.user_image_path),
          this
        );
      },
      loadImage: function (e, t) {
        return (
          this._newCropInstance(e),
          this._resizeContainers(),
          this.element.show(),
          this.cropperObject.loadImg(t, e.existingImageInfo),
          this
        );
      },
      _pinchHandler: function (e) {
        var t = e.data.deltaDistance,
          n = t * this.cropperObject.getCurrentZoom();
        n < this.zoomRange[0] && (n = this.zoomRange[0]),
          n > this.zoomRange[1] && (n = this.zoomRange[1]),
          this.cropperObject.toggleMovementLock(!0),
          this.cropperObject.setZoom(n);
      },
      _pinchEndHandler: function () {
        this.cropperObject.toggleMovementLock(!1);
      },
      loadVideo: function (e, t) {
        if (
          ((this.cropperConfig = e),
          (e.isVideo = !0),
          !e.videoInfo.fragmentDuration)
        ) {
          var n = page.stage.stageImageWidget.getVideoDuration();
          Helpers.GlobalEventTracker.smartTemplateEvent(
            "cropNTrim-missingSlideDuration",
            {
              recordId: page.stage.record.id,
            }
          ),
            n ||
              (Helpers.GlobalEventTracker.smartTemplateEvent(
                "cropNTrim-cannotGetVideoDurationFallback",
                {
                  recordId: page.stage.record.id,
                }
              ),
              (n = e.videoInfo.duration)),
            (e.videoInfo.fragmentDuration = n);
        }
        return (
          this._newCropInstance(e),
          this._resizeContainers(),
          this.element.show(),
          this.$cropButton.hide(),
          this.$resetButton.hide(),
          this.$cropAndTrimButton.removeClass("is-hidden"),
          this.cropperObject.loadVideo(t, e.existingImageInfo, e.videoInfo),
          this
        );
      },
      setHeaderText: function (e) {
        var t = this.element.find(".modal-header");
        t.html("<p> <strong>" + e + "</strong> </p>");
      },
      activate: function () {
        return (
          Widget.prototype.activate.call(this),
          (this.active = !0),
          this.element.modal("show"),
          this.element.on("keydown", this._arrowKeysHandler),
          this
        );
      },
      deactivate: function () {
        return (
          Widget.prototype.deactivate.call(this),
          (this.active = !1),
          this.element.modal("hide"),
          this.element.off("keydown", this._arrowKeysHandler),
          this.unbindPinch(),
          this
        );
      },
    },
  }),
  Class(UI, "UserDownloadsModal")
    .inherits(UI.SimpleModal)
    .includes(
      CustomEventSupport,
      BubblingSupport,
      GenericDestroySupport
    )({
    elementClass: "user-downloads-modal",
    SEARCH_PRODUCTSHOTS_URL: "/purchases/search_productshots_new",
    TOTAL_PAGES: 9,
    FIXED_PAGES: 2,
    CONTENT_TEMPLATE:
      '        <div class="downloads-library-panel">            <div class="filter-panel">                <div class="filter-control dropdown mb-sm">                    <button type="button" class="button dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">                        <div class="filter-option">Filter</div>                        <span class="dropdown-filters" aria-hidden="true"></span>                    </button>                    <div class="dropdown-menu">                        <ul class="filter-all list-unstyled" role="menu">                            <li class="item-all" data-view-all>                                <a class="clear-filters">                                    <span class="item-caret-right">View all</span>                                </a>                                <div class="toggleable-icons">                                    <i class="check-filters icon-ok check-mark toggleable"></i>                                </div>                            </li>                        </ul>                        <div class="title-tag"><span>Category</span></div>                        <ul class="filter-tag-list list-unstyled" role="menu"></ul>                    </div>                </div>            </div>            <div class="downloads-panel">                <div class="downloads">                    <ol class="items list-unstyled">                    </ol>                </div>                <div class="pagination-container">                    <div class="pagination">                        <div class="pages"></div>                    </div>                </div>            </div>        </div>',
    FILTER_TEMPLATE:
      '        <li class="item-tag">            <a class="link-filter text-capitalize">                {{label}} <span class="total text-muted">({{total}})</span>            </a>            <div class="toggleable-icons">                <i class="check-filters icon-ok check-mark toggleable"></i>                <i class="delete-filters remove-mark toggleable"></i>            </div>        </li>',
    ITEM_TEMPLATE:
      '    <li class="item">        <div class="name truncate">{{name}}</div>    </li>',
    EMPTY_STATE_TEMPLATE:
      '        <div class="downloads-library-panel">            <div class="downloads-panel empty-state">                <div class="title">                    No downloads yet                </div>                <div>                    You need to download some designs first!                </div>                <a href="/c/design-templates" class="button secondary">                    Try our Design Templates                </a>            </div>        </div>',
    NOT_LOGGED_IN_TEMPLATE:
      '        <div class="downloads-library-panel">            <div class="downloads-panel not-logged-in-state">                <div class="title">                    Ouhh, it\'s empty in here                </div>                <div class="subtitle">                    Log in to see your downloads!                </div>                <a class="button secondary login-btn">                    Login                </a>            </div>        </div>',
    LOADER_TEMPLATE:
      '        <div class="loader-container">            <div class="item-spinner"></div>            <div class="title">Fetching your downloads...</div>        </div>',
    prototype: {
      filters: null,
      currentFilters: null,
      currentPage: null,
      searchResults: null,
      $mainWrapper: null,
      $filters: null,
      $filterItems: null,
      $items: null,
      $clearFilters: null,
      $dropdownFilters: null,
      $pagination: null,
      $paginationPages: null,
      $downloadsPanel: null,
      imgEvents: [],
      $loginBtn: null,
      init: function (e) {
        UI.SimpleModal.prototype.init.call(this, e), this.addCloseButton();
      },
      activate: function () {
        var e;
        return (
          (e = this),
          Helpers.App.isLoggedIn()
            ? (e.setContent(UI.UserDownloadsModal.CONTENT_TEMPLATE),
              (e.$filters = e.element.find(".filter-tag-list")),
              (e.$clearFilters = e.element.find(".item-all")),
              (e.$dropdownFilters = e.element.find(
                ".filter-control .dropdown-toggle"
              )),
              (e.$items = e.element.find(".items")),
              (e.$pagination = e.element.find(".pagination")),
              (e.$paginationPages = e.$pagination.find(".pages")),
              (e.$downloadsPanel = e.element.find(".downloads-panel")),
              (e.$mainLoader = $(UI.UserDownloadsModal.LOADER_TEMPLATE)),
              (e.$itemsLoader = $(UI.UserDownloadsModal.LOADER_TEMPLATE)),
              e.bodyContentContainer.append(e.$mainLoader),
              e.$downloadsPanel.append(e.$itemsLoader),
              e.$mainLoader.hide(),
              e.$itemsLoader.hide())
            : (e.setContent(UI.UserDownloadsModal.NOT_LOGGED_IN_TEMPLATE),
              (e.$loginBtn = e.element.find(".login-btn"))),
          (e.$mainWrapper = e.element.find(".downloads-library-panel")),
          e._setBindings(),
          UI.SimpleModal.prototype.activate.call(this),
          this
        );
      },
      search: function (e) {
        var t, n;
        return (
          (t = this),
          (e = e || {}),
          (n = Object.assign({}, t.filters)),
          Object.keys(e).forEach(function (t) {
            n[t] = e[t];
          }),
          new Promise(function (e, i) {
            $.ajax({
              url: t.constructor.SEARCH_PRODUCTSHOTS_URL,
              method: "POST",
              data: n,
              success: e,
              error: function (e) {
                t.dispatch("search.error"), i(e.status + " - " + e.statusText);
              },
            });
          })
        );
      },
      _setBindings: function () {
        var e, t;
        (e = this),
          e.element.unbind("shown.bs.modal"),
          e.element.bind("shown.bs.modal", function () {
            Helpers.App.isLoggedIn()
              ? (e.$mainLoader.show(),
                e.$itemsLoader.hide(),
                (t = {
                  include_categories_total: !0,
                }),
                e
                  ._buildUserDownloads(t)
                  .then(function (t) {
                    0 === t.total_productshots
                      ? (e.setContent(
                          UI.UserDownloadsModal.EMPTY_STATE_TEMPLATE
                        ),
                        (e.$mainWrapper = e.element.find(
                          ".downloads-library-panel"
                        )),
                        e.$mainLoader.hide(),
                        e.$mainWrapper.addClass("visible"))
                      : (e._buildFilters(),
                        e.$clearFilters.addClass("is-selected"));
                  })
                  ["catch"](function (t) {
                    e.$mainLoader.hide(),
                      setTimeout(function () {
                        throw new Error(
                          "Something went wrong when fetching user download items at opening the modal: " +
                            t
                        );
                      }, 10);
                  }))
              : (e.$mainWrapper.addClass("visible"),
                e.$loginBtn.bind("click", function () {
                  page.appNavBar.ssoModal.activate(), e.deactivate();
                }));
          }),
          e.element.bind("hidden.bs.modal", function () {
            e._removeFiltersBindings(), e.$mainWrapper.removeClass("visible");
          });
      },
      _buildUserDownloads: function (e) {
        var t;
        return (
          (t = this),
          (e = e || {}),
          t.$items.hide(),
          t.$pagination.hide(),
          t.$itemsLoader.show(),
          new Promise(function (n, i) {
            t.search(e)
              .then(function (i) {
                (t.searchResults = i),
                  (t.currentFilters = e),
                  (t.currentPage = e && e.page ? parseInt(e.page) : 1),
                  t._buildItems(),
                  t._buildPagination(),
                  t.$items.gridalicious({
                    width: 250,
                    gutter: 10,
                    selector: ".item",
                    animate: !1,
                  }),
                  n(i);
              })
              ["catch"](function (e) {
                t.$itemsLoader.hide(),
                  t.$items.show(),
                  t.$pagination.show(),
                  i(e);
              });
          })
        );
      },
      _buildFilters: function () {
        var e, t, n;
        (e = this),
          e.$filters.empty(),
          e.searchResults.categories.forEach(function (i) {
            (t = e._getCategory(i.category_id)),
              t &&
                ((n = {
                  label: t.name,
                  total: i.total_productshots,
                  data: {
                    categories: t.id,
                  },
                }),
                e._buildFilterItem(n));
          }),
          (e.$filterItems = e.$filters.find(".item-tag")),
          e._setFilterItemsBindings();
      },
      _buildFilterItem: function (e) {
        var t, n, i;
        (t = this),
          (n = UI.UserDownloadsModal.FILTER_TEMPLATE),
          (n = n.replace("{{label}}", e.label)),
          (n = n.replace("{{total}}", e.total)),
          (i = $(n)),
          i.data(e.data),
          e.total > 0 && i.addClass("enabled"),
          t.$filters.append(i);
      },
      _buildItems: function () {
        var e;
        (e = this),
          e.$items.empty(),
          e.searchResults.productshots &&
            ((e.imgEvents = []),
            e.searchResults.productshots.forEach(function (t) {
              var n, i, r;
              (n = UI.UserDownloadsModal.ITEM_TEMPLATE),
                (n = n.replace("{{name}}", t.name)),
                (i = $(n)),
                t.thumb &&
                  ((r = $('<img src="' + t.thumb + '">')),
                  i.prepend(r),
                  e.imgEvents.push(
                    new Promise(function (e, t) {
                      r.bind("load", e), r.bind("error", t);
                    })
                  )),
                e.$items.append(i),
                i.bind("click", function () {
                  e.dispatch("userDownloadItem.selected", t);
                });
            }),
            P.allSettled(e.imgEvents).then(function () {
              e.showItems();
            }));
      },
      showItems: function () {
        var e;
        (e = this),
          e.$mainLoader.hide(),
          e.$itemsLoader.hide(),
          e.$items.show(),
          e.$pagination.show(),
          e.$items.gridalicious("resize", !0),
          e.$mainWrapper.addClass("visible");
      },
      _buildPagination: function () {
        var e, t, n, i, r, s, o;
        if (
          ((e = this),
          e.$paginationPages.empty(),
          0 !== e.searchResults.total_pages &&
            0 !== e.searchResults.total_productshots)
        ) {
          if (
            ((t = e.searchResults.total_pages),
            (n =
              UI.UserDownloadsModal.TOTAL_PAGES -
              2 * UI.UserDownloadsModal.FIXED_PAGES),
            (i = t - n - 1),
            t <= UI.UserDownloadsModal.TOTAL_PAGES
              ? ((s = 1), (o = t))
              : e.currentPage > i
              ? ((s = i), (o = t - UI.UserDownloadsModal.FIXED_PAGES))
              : e.currentPage < n + UI.UserDownloadsModal.FIXED_PAGES
              ? ((s = UI.UserDownloadsModal.FIXED_PAGES + 1),
                (o = n + UI.UserDownloadsModal.FIXED_PAGES))
              : ((s = e.currentPage - Math.floor(n / 2)),
                (o = e.currentPage + Math.floor(n / 2))),
            s > 1)
          )
            for (r = 1; r <= UI.UserDownloadsModal.FIXED_PAGES; r++)
              e._buildPaginationPage(r);
          for (r = s; o >= r; r++) e._buildPaginationPage(r);
          if (t > o)
            for (r = t - UI.UserDownloadsModal.FIXED_PAGES + 1; t >= r; r++)
              e._buildPaginationPage(r);
          e._buildPaginationArrows(), e._buildGapPagination();
        }
      },
      _buildPaginationItem: function (e, t) {
        var n, i;
        return (
          (n = this),
          t === n.currentPage
            ? ((i = $("<em>" + e + "</em>")), i.addClass("current"))
            : (i = $("<a>" + e + "</a>")),
          i.data("page", t),
          i.bind("click", function () {
            var e = n.currentFilters;
            (e.page = $(this).data("page")),
              n._removeFiltersBindings(),
              n._buildUserDownloads(e)["finally"](function () {
                n._setFilterItemsBindings(), n._setRemoveFiltersBindings();
              });
          }),
          i
        );
      },
      _buildPaginationPage: function (e) {
        var t, n;
        (t = this),
          (n = t._buildPaginationItem(e, e)),
          n.addClass("page"),
          t.$paginationPages.append(n);
      },
      _buildPaginationArrows: function () {
        var e, t;
        (e = this),
          e.currentPage > 1 &&
            ((t = e._buildPaginationItem("\xab", e.currentPage - 1)),
            t.addClass("arrow"),
            t.addClass("previous_page"),
            e.$paginationPages.prepend(t)),
          e.currentPage !== e.searchResults.total_pages &&
            ((t = e._buildPaginationItem("\xbb", e.currentPage + 1)),
            t.addClass("arrow"),
            t.addClass("next_page"),
            e.$paginationPages.append(t));
      },
      _buildGapPagination: function () {
        var e, t, n, i, r;
        (e = this),
          e.$paginationPages.find(".gap").remove(),
          (t = e.$paginationPages.find(".page")),
          (n = t.length);
        for (var s = 0; n > s; s++)
          "undefined" != typeof t[s + 1] &&
            ((i = parseInt($(t[s]).data("page"))),
            (r = parseInt($(t[s + 1]).data("page"))),
            i + 1 !== r && $(t[s]).after('<span class="gap">...</span>'));
      },
      _getCategory: function (e) {
        var t, n;
        if (!window._pl_categories) return !1;
        (t = window._pl_categories), (n = !1);
        for (var i = 0; i < t.length; i++)
          if (t[i].id === e) {
            n = t[i];
            break;
          }
        return n;
      },
      _getSelectedFilterItem: function () {
        var e, t;
        return (
          (e = this),
          (t = e.$clearFilters.hasClass("is-selected")
            ? e.$clearFilters
            : e.$filters.find(".is-selected")),
          1 === t.length ? t : !1
        );
      },
      _setFilterItemsBindings: function () {
        var e;
        (e = this),
          e.$filterItems &&
            (e._removeFiltersBindings(),
            e.$filterItems.bind("click", e._filterItemClickHandler.bind(e)));
      },
      _setRemoveFiltersBindings: function () {
        var e, t;
        (e = this),
          (t = e._getSelectedFilterItem()),
          t &&
            t.hasClass("item-tag") &&
            (e.$clearFilters.bind("click", e._removeFilterClickHandler.bind(e)),
            $(".delete-filters", t).bind(
              "click",
              e._removeFilterClickHandler.bind(e)
            ),
            t.unbind("click"));
      },
      _removeFiltersBindings: function () {
        var e;
        (e = this),
          e.$filterItems &&
            (e.$clearFilters.unbind("click"),
            e.$filterItems.unbind("click"),
            $(".delete-filters", e.$filterItems).unbind("click"));
      },
      _filterItemClickHandler: function (e) {
        var t, n, i, r;
        (t = this),
          (n = $(e.currentTarget)),
          (i = n.data()),
          (i.page = 1),
          t._removeFiltersBindings(),
          (r = t._getSelectedFilterItem()),
          r && r.removeClass("is-selected"),
          n.addClass("is-selected"),
          t
            ._buildUserDownloads(i)
            .then(function () {
              t._setFilterItemsBindings(), t._setRemoveFiltersBindings();
            })
            ["catch"](function () {
              n.removeClass("is-selected"),
                r && r.addClass("is-selected"),
                t._setFilterItemsBindings(),
                t._setRemoveFiltersBindings(),
                setTimeout(function () {
                  throw new Error(
                    "Something went wrong when applying a filter: " +
                      JSON.stringify(i)
                  );
                }, 10);
            });
      },
      _removeFilterClickHandler: function (e) {
        var t, n;
        e.stopPropagation(),
          (t = this),
          t._removeFiltersBindings(),
          (n = t._getSelectedFilterItem()),
          n && n.removeClass("is-selected"),
          t.$clearFilters.addClass("is-selected"),
          t.$dropdownFilters.dropdown("toggle"),
          t
            ._buildUserDownloads()
            .then(function () {
              t._setFilterItemsBindings();
            })
            ["catch"](function (e) {
              t.$clearFilters.removeClass("is-selected"),
                n && n.addClass("is-selected"),
                t._setFilterItemsBindings(),
                t._setRemoveFiltersBindings(),
                setTimeout(function () {
                  throw new Error(
                    "Something went wrong when removing filters: " + e
                  );
                }, 10);
            });
      },
    },
  }),
  Module("CustomAssetSupport")({
    prototype: {
      _fragmentDuration: null,
      customType: null,
      getCustomAssetDataTask: null,
      _initCustomUpload: function (e) {
        var t = this,
          n = {};
        (n.id = t.customType),
          (n.name = t.customType),
          (n.image = null),
          (n.visible = !1),
          (t.customImageUploader = new UI.SmartTemplate.ImageUploader({
            name: t.customType,
            record: n,
            viewport: this._getViewportData(),
            maxSize: UI.StageBase.maxSizeAllowed.image,
            videoMaxSize: UI.StageBase.maxSizeAllowed.video,
            acceptedFiles: $.extend(
              {},
              UI.StageBase.acceptedFiles.image,
              UI.StageBase.acceptedFiles.video
            ),
            componentToInform: this,
            loadingState: !1,
            acceptVideo: !this.onlyGraphics,
            acceptImage: "asset_library" === this.type || this.onlyGraphics,
            fragmentDuration: t._fragmentDuration,
          }).render(this._columns[e])),
          (e = (e + 1) % this.numberOfColumns),
          this.appendChild(t.customImageUploader),
          t.record.allowCustomUpload || t.customImageUploader.hide(),
          (t.customImageUploader.originallyRenderedOnColumn = this._columns[e]),
          t.customImageUploader.customGraphicPreview.render(this._columns[e]),
          t.customImageUploader.customVideoPreview.render(this._columns[e]),
          t.customImageUploader.customGraphicPreview.hide(),
          t.customImageUploader.customVideoPreview.hide(),
          this._customAssetBindings();
      },
      _getViewportData: function () {
        return this._viewportData
          ? this._viewportData
          : ((this._viewportData = this.viewport
              ? this.viewport
              : Helpers.StageType.isFusionVideo() === !0
              ? {
                  width: this.record.width,
                  height: this.record.height,
                }
              : this.getGraphicDimensions()),
            this._viewportData);
      },
      getGraphicDimensions: function () {
        var e, t, n, i, r;
        return (
          (e = this),
          (t = window.structureData),
          Engine.prototype._treeWalker(t, "layers", function (t) {
            t.name.replace("_original", "") === e.record.name && (n = t);
          }),
          (i = n.layers[0]),
          (r = i.smartObject),
          {
            width: r.width,
            height: r.height,
          }
        );
      },
      _customAssetBindings: function () {
        return (
          this.bind("cropSuccess", this._cropSuccessHandler.bind(this)),
          this.bind(
            "localCropSuccess",
            this._localCropSuccessHandler.bind(this)
          ),
          this.bind(
            "crop",
            function () {
              this.customImageUploader.showWorkingFeedback("Cropping ");
            }.bind(this)
          ),
          this
        );
      },
      _cropSuccessHandler: function (e) {
        this._assetCropSuccess(e, !1);
      },
      _localCropSuccessHandler: function (e) {
        this._assetCropSuccess(e, !0);
      },
      _assetCropSuccess: function (e, t) {
        this.dispatch("AddLogoSuccess", {
          triggeredByLocalCropSuccess: t,
        }),
          e.stopPropagation();
        var n,
          i,
          r,
          s = this;
        (n = e.data),
          (r = this._buildCustomPreviewItem(n)),
          (i = r.record.image),
          this.customImageUploader.updatePreview(
            n.thumbnailUrl,
            n.croppedVideoPreviewUrl,
            r.isPremium
          ),
          this.customImageUploader.hideUploadingFeedback(),
          n.moveBeforeElement
            ? n.moveBeforeElement.before(r.element)
            : n.restoreThumbnailPosition &&
              this.customImageUploader.originallyRenderedOnColumn.prepend(
                r.element
              );
        var o = {
          triggeredByPopState: n.triggeredByPopState,
          triggeredByUser: !n.triggeredByPopState,
          triggeredByLocalCropSuccess: t,
          errorCallback: function (e) {
            "abort" !== e.statusText &&
              400 === e.status &&
              (s.customImageUploader.record.image = i);
          },
        };
        e.data.shouldSelectItem !== !1 &&
          this._selectThumb(r, o, "_assetCropSuccess");
      },
      _buildCustomPreviewItem: function (e) {
        var t,
          n = /^data:image/;
        return (
          e.isVideo
            ? ((t = this.customImageUploader.customVideoPreview),
              (t.record.video = e.croppedVideoUrl),
              (t.record.type = "." + e.croppedVideoUrl.split(".").pop()),
              (t.record.image = e.thumbnailUrl))
            : ((t = this.customImageUploader.customGraphicPreview),
              (t.record.image = e.croppedImageUrl),
              (t.record.type =
                n.test(e.croppedImageUrl) === !0
                  ? "." + e.croppedImageUrl.split(";").shift().split("/").pop()
                  : "." + e.croppedImageUrl.split(".").pop())),
          (t.record.record_hash = e.id),
          (t.record.id = this.customType),
          (t.record.visible = !0),
          (t.cropParams = e.cropParams),
          (t.userImagePath = e.userImagePath),
          (t.userVideoPath = e.userVideoPath),
          (t.originalVideoUrl = e.originalVideoUrl),
          (t.timelineUrls = e.timelineUrls),
          (t.duration = e.duration),
          (t.videoWidth = e.videoWidth),
          (t.videoHeight = e.videoHeight),
          (t.isPremium = Helpers.App.parseBoolean(e.cropParams.isPremium)),
          t
        );
      },
      _assetJSONDataCallback: function (e, t, n) {
        n.crop_params.isVideo
          ? (this.customImageUploader.customVideoPreview.record.userImageFileName =
              n.user_image_filename)
          : (this.customImageUploader.customGraphicPreview.record.userImageFileName =
              n.user_image_filename),
          this.dispatch("cropSuccess", {
            id: e,
            userImageFileName: n.user_image_filename,
            croppedImageUrl: n.cropped_image_url,
            croppedVideoUrl: n.cropped_video_url,
            croppedVideoPreviewUrl: n.preview_url,
            isVideo: n.crop_params.isVideo,
            thumbnailUrl: n.thumbnail_url,
            cropParams: n.crop_params,
            userImagePath: n.user_image_url,
            userVideoPath: n.user_video_url,
            originalVideoUrl: n.original_video_url,
            timelineUrls: n.timeline_urls,
            duration: n.duration,
            videoWidth: n.video_width,
            videoHeight: n.video_height,
            triggeredByPopState: !0,
            shouldSelectItem: t,
          });
      },
      _getCustomAssetData: function (e) {
        var t = this;
        this.cancelGetCustomAssetDataTask();
        var n = P.cancelable(function (e) {
          return t.fetchCustomAssetData(e);
        });
        return (
          (this.getCustomAssetDataTask = n(e)), this.getCustomAssetDataTask
        );
      },
      cancelGetCustomAssetDataTask: function () {
        null !== this.getCustomAssetDataTask &&
          (this.getCustomAssetDataTask.cancel(),
          (this.getCustomAssetDataTask = null));
      },
      fetchCustomAssetData: function (e) {
        return CustomAsset.fetch(e);
      },
      resetCustomAsset: function () {
        this.customImageUploader.reset();
      },
      setUrlParameter: function (e) {
        return (
          this.dispatch("changeUrlParam", {
            value: e,
          }),
          this
        );
      },
      showFilePicker: function () {
        this.customImageUploader.showFilePicker();
      },
    },
  }),
  Class("Draft")({
    _URL: "/api/v2/saved_drafts/",
    _map: {
      id: "id",
      previewImage: "preview_image",
      previewVideo: "preview_video",
      stageId: "stage_id",
      params: "params",
      uiJson: "ui_jsons",
      audioEnable: "audio_enable",
      audioTrackUUID: "audio_track_uuid",
      userId: "user_id",
      videoPreviewStatus: "video_preview_status",
      videoStatus: "video_status",
    },
    prototype: {
      id: null,
      previewImage: null,
      previewVideo: null,
      stageId: null,
      params: null,
      uiJson: null,
      audioEnable: !1,
      audioTrackUUID: null,
      hasVideo: !1,
      userId: null,
      videoPreviewStatus: !1,
      videoStatus: null,
      _map: null,
      init: function (e) {
        return (this._map = this.constructor._map), this.set(e), this;
      },
      save: function () {
        var e = this,
          t = e._transformToBackend(),
          n = {};
        Object.keys(t).forEach(function (e) {
          var i = t[e];
          void 0 !== i && null !== i && (n[e] = t[e]);
        });
        var i = {
          type: "POST",
          url: e.constructor._URL,
          data: {
            saved_draft: n,
          },
          dataType: "json",
        };
        return Draft._promiseRequest(i).then(function (t) {
          return e.set(e._transform(t)).get();
        });
      },
      remove: function () {
        var e = this,
          t = e.constructor._URL + e.id,
          n = {
            url: t,
            type: "DELETE",
          };
        return Draft._promiseRequest(n).then(function (t) {
          return e._transform(t);
        });
      },
      get: function () {
        var e = this,
          t = {};
        return (
          Object.keys(e._map).forEach(function (n) {
            t[n] = e[n];
          }),
          (t.hasVideo = t.hasVideo || Helpers.StageType.isFusionVideo()),
          t
        );
      },
      set: function (e) {
        var t = this,
          n = e || {};
        return (
          Object.keys(t._map).forEach(function (e) {
            t[e] = n[e] || t[e];
          }),
          this
        );
      },
      _transformToBackend: function () {
        var e = this,
          t = {};
        return (
          Object.entries(e._map).forEach(function (n) {
            t[n[1]] = e[n[0]];
          }),
          t
        );
      },
      _transform: function (e) {
        return this.constructor._transform(e);
      },
      _promiseRequest: function (e) {
        return this.constructor._promiseRequest(e);
      },
    },
    find: function (e) {
      var t = this,
        n = {
          url: t._URL + e,
          type: "GET",
          dataType: "JSON",
        };
      return this._promiseRequest(n).then(function (e) {
        return new Draft(t._transform(e));
      });
    },
    findByStageId: function (e) {
      var t = this,
        n = {
          url: this._URL + "?stage_id=" + e,
          type: "GET",
          dataType: "JSON",
        };
      return this._promiseRequest(n).then(function (e) {
        var n = e.saved_drafts
          .map(function (e) {
            return t._transform(e.saved_drafts);
          })
          .reverse();
        return n;
      });
    },
    findByAuthUser: function () {
      var e = this,
        t = {
          url: e._URL,
          type: "GET",
          dataType: "JSON",
        };
      return this._promiseRequest(t).then(function (t) {
        var n = t.saved_drafts
          .map(function (t) {
            return e._transform(t.saved_drafts);
          })
          .reverse();
        return n;
      });
    },
    remove: function (e) {
      var t = {
        url: this._URL + e,
        type: "DELETE",
      };
      return this._promiseRequest(t);
    },
    _transform: function (e) {
      var t = this,
        n = e || {},
        i = {};
      return (
        Object.entries(t._map).forEach(function (e) {
          i[e[0]] = n[e[1]] || null;
        }),
        (i.hasVideo = i.hasVideo || Helpers.StageType.isFusionVideo()),
        i
      );
    },
    _promiseRequest: function (e) {
      return new Promise(function (t, n) {
        $.ajax(e).then(t).fail(n);
      });
    },
  }),
  Module("FetchLayersSupport").includes(CDNSupport)({
    prototype: {
      setSelectedLayers: function (e) {
        var t = UI.AlgoliaSearch.getInstance();
        e.filter(function (e) {
          return e.selectedLayer;
        }).forEach(function (e) {
          t.craftPaths(e.selectedLayer), (e.selectedLayer.visible = !0);
        });
      },
      fetchAndSetAssetLayers: function (e, t) {
        return new Promise(
          function (n) {
            var i;
            if (!e || !e.id || "document" !== e.type) return n(e);
            i = this._cdnBasePath() + "/image_library/" + e.id + "/ui.json";
            var r = new UI.JsonFetcher({
              path: i,
            });
            r.fetch()
              .then(function (i) {
                var r = Helpers.App.getLayerFromRecordByName("accent", i),
                  s = null,
                  o = null;
                r &&
                  ((s = Helpers.App.getLayerFromRecordByName("accent", e)),
                  (o = Array.isArray(t) && t.length > 0 ? t[0] : r.color),
                  (r.color = s ? s.color : o)),
                  (e.layers = i.layers),
                  n(e);
              })
              ["catch"](function () {
                (e.layers = e.layers || []), n(e);
              });
          }.bind(this)
        );
      },
      fetchGraphicLayers: function (e) {
        var t = e.map(function (e) {
          var t, n, i, r, s;
          return (
            (t = e.layers
              .map(function (e) {
                return e.visible;
              })
              .indexOf(!0)),
            (s = e.layers[t]),
            !s || "document" !== s.type || Array.isArray(s.layers)
              ? Promise.resolve()
              : ((n =
                  this._cdnBasePath() + "/image_library/" + s.id + "/ui.json"),
                (i = new UI.JsonFetcher({
                  path: n,
                })),
                (r = i.fetch()),
                r.then(
                  function (n) {
                    e.layers[t] = $.extend({}, s, n);
                  },
                  function () {}
                ))
          );
        }, this);
        return Promise.all(t);
      },
      fetchLayers: function (e) {
        var t, n;
        return (
          (t = UI.AlgoliaSearch.getInstance()),
          (n = e.map(function (e) {
            return "undefined" == typeof e.layer
              ? Promise.resolve()
              : new Promise(function (n, i) {
                  t.assetIndex.search(
                    "",
                    {
                      filters: "id: " + e.layer,
                    },
                    function (r, s) {
                      return r
                        ? void i(r)
                        : (s.hits[0] &&
                            (t.craftPaths(s.hits[0]),
                            (e.layers = [s.hits[0]]),
                            (e.layers[0].visible = !0)),
                          void n());
                    }
                  );
                });
          })),
          Promise.all(n)
        );
      },
    },
  }),
  Class(
    Helpers,
    "Image"
  )({
    getImageFromSrc: function (e) {
      return new Promise(function (t, n) {
        var i = new Image();
        (i.crossOrigin = "Anonymous"),
          (i.onload = function () {
            t(i);
          }),
          (i.onerror = function () {
            n(new Error("Error loading image"));
          }),
          (i.src = e);
      });
    },
    getCanvasFromImage: function (e) {
      var t = document.createElement("canvas");
      return (
        (t.width = e.width),
        (t.height = e.height),
        t.getContext("2d").drawImage(e, 0, 0),
        t
      );
    },
    getBase64FromImage: function (e) {
      return Helpers.Image.getCanvasFromImage(e).toDataURL("image/png");
    },
    getBase64FromSrc: function (e) {
      return Helpers.Image.getImageFromSrc(e).then(
        Helpers.Image.getBase64FromImage
      );
    },
    getBase64FromBlob: function (e) {
      return new Promise(function (t, n) {
        var i = new FileReader();
        i.readAsDataURL(e),
          (i.onload = function () {
            t(i.result);
          }),
          (i.onerror = function (e) {
            n(e);
          });
      });
    },
    getCanvasFromImageData: function (e) {
      var t = document.createElement("canvas");
      return (
        (t.width = e.width),
        (t.height = e.height),
        t.getContext("2d").putImageData(e, 0, 0),
        t
      );
    },
    getImageDataFromImage: function (e) {
      return Helpers.Image.getCanvasFromImage(e)
        .getContext("2d")
        .getImageData(0, 0, e.width, e.height);
    },
    getImageDataFromSrc: function (e) {
      return Helpers.Image.getImageFromSrc(e).then(
        Helpers.Image.getImageDataFromImage
      );
    },
    diffImageDatas: function (e, t, n, i) {
      var r,
        s,
        o = document.createElement("canvas"),
        a = o.getContext("2d");
      return (
        (o.width = e.width),
        (o.height = e.height),
        (s = a.getImageData(0, 0, e.width, e.height)),
        (r = pixelmatch(e.data, t.data, s.data, e.width, e.height, {
          threshold: n,
          includeAA: i,
        })),
        a.putImageData(s, 0, 0),
        {
          score: r,
          result: o,
        }
      );
    },
    hasTransparency: function (e, t) {
      var n,
        i,
        r,
        s,
        o,
        a,
        l,
        c,
        u,
        d,
        h = document.createElement("canvas"),
        p = h.getContext("2d");
      for (t = t || 1024, n = e.width / t, i = e.height / t, r = 0; i > r; r++)
        for (s = 0; n > r; r++)
          for (
            a = r * t,
              l = s * t,
              c = Math.min(t, e.width - a),
              u = Math.min(t, e.height - l),
              h.width = c,
              h.height = u,
              p.drawImage(e, a, l, c, u, 0, 0, c, u),
              d = p.getImageData(0, 0, c, u).data,
              o = 0;
            o < d.length;
            o += 4
          )
            if (255 !== d[o + 3]) return !0;
      return !1;
    },
    crop: function (e) {
      var t, n, i;
      return (
        (t = this),
        (uploadData = e.uploadData),
        (n = uploadData.userImage),
        (i = Object.assign({}, e)),
        (i.uploadData = void 0),
        CropResize.run(n, i)
          .then(function (e) {
            return CropResize.generateThumbnail(e).then(function (t) {
              return {
                cropParams: i,
                userImage: n,
                thumbnail: t,
                croppedImage: e,
              };
            });
          })
          .then(function (e) {
            var t = new Promise(function (t, n) {
              $.ajax({
                method: "POST",
                url: "/cropper/persist",
                data: JSON.stringify(e),
                processData: null,
                contentType: "application/json",
              })
                .done(function (e) {
                  t(e);
                })
                .fail(function (e) {
                  n(e.responseText);
                });
            });
            return {
              id: uploadData.id,
              user_image_filename: uploadData.userImageFilename,
              crop_params: e.cropParams,
              user_image_url: "".concat(e.userImage),
              cropped_image_url: "".concat(e.croppedImage),
              thumbnail_url: "".concat(e.thumbnail),
              persistCall: t,
            };
          })
      );
    },
  }),
  Module("PreviewThumbSupport")({
    prototype: {
      tapCounter: 0,
      tapCallback: [],
      helpText: null,
      textViewsLimit: 1,
      setMobileBindings: function () {
        var e = this,
          t = e.thumbContainer || e.element;
        if (Helpers.App.isMobile() && !e.previewDisabled) {
          var n = function (e) {
              e.preventDefault();
            },
            i = function () {
              "function" == typeof e.tapCallback[e.tapCounter]
                ? (e.tapCallback[e.tapCounter](), e.tapCounter++)
                : "undefined" == typeof e.tapCallback[e.tapCounter] &&
                  (e.resetTap(), t.unbind("click", n));
            },
            r = function (t) {
              t.preventDefault(),
                t.stopPropagation(),
                e._dispatchForPreviewOverlay();
            };
          this.disablePreviewOverlay === !0
            ? (this.tapCallback.length > 0 && t.bind("mousedown", i),
              t.bind("click", n))
            : t.bind("click", r);
        }
      },
      _setPreviewData: function () {
        var e = this,
          t = {};
        return (
          (t.imageSrc = e._getThumbnailImage()),
          (t.videoSrc = e._getThumbnailVideo()),
          (t.imageType = this.element.attr("data-stage-type-id")),
          (t.anchor = e.anchor[e.anchor.length - 1].href),
          (t.isBookmarked =
            "true" === e.element.attr("data-bookmarked") ? !0 : !1),
          (t.stageId = e.stageID),
          (t.bookmark = e.element.find(".bookmark")),
          t
        );
      },
      _getThumbnailImage: function () {
        var e,
          t = this;
        if ("true" === t.img.attr("data-processed")) e = t.img.attr("src");
        else if (
          (t.previewSrc.length > 0 && (e = t.previewSrc),
          !this._isImagePreview(e))
        ) {
          if (!(t.img.length > 0)) return "";
          e = t.img.attr("data-src");
        }
        return e;
      },
      _getThumbnailVideo: function () {
        var e,
          t = this;
        return (
          t.video.length > 0
            ? (e = t.video.attr("data-src"))
            : t.previewSrc.length > 0 && (e = t.previewSrc),
          this._isImagePreview(e) ? "" : e
        );
      },
      _isImagePreview: function (e) {
        if (void 0 === e) return !1;
        var t = e.split(".").pop();
        return "jpg" === t || "png" === t || "jpeg" === t ? !0 : !1;
      },
      _dispatchForPreviewOverlay: function () {
        var e = this;
        e.dispatch("thumbnailPreview", {
          title: "",
          listAnchor: "",
          previews: [e._setPreviewData()],
        });
      },
      resetTap: function () {
        this.tapCounter = 0;
      },
      showHelpText: function () {
        var e = this;
        if (
          !(Helpers.App.getMobileHelpTextCounter() > e.textViewsLimit) ||
          this.alwaysShowHelpText
        ) {
          if (
            ($(".help-text", e.element).length ||
              ((e.helpText = $(
                '<div class="help-text">' + e.helpString + "</div>"
              )),
              e.badge.append(e.helpText)),
            this.useOffsetInHelpText)
          ) {
            var t = $(".figcaption", e.element).css("height");
            t && e.helpText.css("bottom", t);
          }
          e.helpText.show(), Helpers.App.setMobileHelpTextCounter();
        }
      },
      hideHelpText: function () {
        this.helpText && this.helpText.hide();
      },
      cleanUpVideo: function () {
        if (Helpers.App.isMobile() !== !1 && 0 !== this.video.length) {
          var e = this.video;
          (this.video = this.video.clone(!0, !0)),
            this.video.load(),
            this.video.hide(),
            this.video.insertAfter(e),
            e.hide(),
            (e[0].src = ""),
            e[0].load(),
            e.remove();
        }
      },
      setTapCounter: function (e) {
        e ? (this.tapCounter = e) : this.tapCounter++;
      },
    },
  }),
  Class("IntegrityCheck")({
    _bannedBrowsers: [
      /(AppleWebKit\/).+(Version\/9\.[0-1]).+(Safari\/)/,
      /(Macintosh; Intel Mac OS X 10_11_6).*(Version\/(10|11)).*(Safari\/)/,
      /(Macintosh; Intel Mac OS X 10_11_6).*(Chrome\/)/,
      /(Windows NT 10).*(Edge\/18)/,
    ],
    isRunning: !1,
    getIntegrityTestCookie: function () {
      return document.cookie.replace(
        /(?:(?:^|.*;\s*)new_integrity_result\s*\=\s*([^;]*).*$)|^.*$/,
        "$1"
      );
    },
    checkCapability: function () {
      var e = !0,
        t = Helpers.App.getUrlParam("ngin"),
        n = this.getIntegrityTestCookie(),
        i = Helpers.App.isMobile(),
        r = Helpers.StageType.getStageData();
      if ("off" === t)
        return console.log("Test param found, using backend server"), (e = !1);
      if ("on" === t)
        return console.log("Test param found, forcing engine"), (e = !0);
      if (r.force_fallback === !0) return (e = !1);
      if (window.defaultToV4Engine === !0)
        return (
          console.log("Default to engine flag found, using engine"), (e = !0)
        );
      try {
        new ImageData(200, 200);
      } catch (s) {
        return (
          console.log("Older browser found, using backend server"),
          Helpers.GlobalEventTracker.track("3dCheck:missingFeature", {
            eventCategory: Helpers.StageType._types[r.image_type],
            eventAction: "3dCheck:missingFeature",
            resultUrl: window.location.href,
          }),
          (e = !1)
        );
      }
      for (var o = 0; o < this._bannedBrowsers.length; o++)
        if (navigator && this._bannedBrowsers[o].test(navigator.userAgent))
          return (
            console.log("Older browser found, using backend server"),
            Helpers.GlobalEventTracker.track("3dCheck:unsupportedBrowser", {
              eventCategory: Helpers.StageType._types[r.image_type],
              eventAction: "3dCheck:missingFeature",
              resultUrl: window.location.href,
            }),
            (e = !1)
          );
      var a = this.isWebGLSupported();
      return a.result === !1
        ? (console.log(
            "WebGL is not supported by browser, using backend server"
          ),
          Helpers.GlobalEventTracker.track("noWebGL", {
            eventCategory: Helpers.StageType._types[r.image_type],
            eventAction: "noWebGL",
            errorMessage: a.errorMessage,
            errorContext: a.errorContext,
            resultUrl: window.location.href,
          }),
          (e = !1))
        : navigator.cookieEnabled
        ? i &&
          window.forceMobileFallbackForMockups === !0 &&
          "Mockups" === r.category_name
          ? (console.log(
              "Mobile device found and force mobile fallback for mockups on"
            ),
            (e = !1))
          : i && window.forceMobileFallback === !0
          ? (console.log("Mobile device found and force mobile fallback on"),
            (e = !1))
          : this.isInFallbackExperiment() === !0
          ? (console.log("Using fallback per experiment"), (e = !1))
          : (console.log("Integrity cookie: " + n),
            (e = n && "true" !== n ? !1 : !0))
        : (console.log(
            "No access to cookies, defaulting to backend low res server"
          ),
          (e = !1));
    },
    isInFallbackExperiment: function () {
      $.cookie("gtmc_prefer_fallback"), $.cookie("gtmc_user_location");
      return !1;
    },
    isWebGLSupported: function () {
      var e,
        t = {
          stencil: !0,
        },
        n = "",
        i = "";
      try {
        if (!window.WebGLRenderingContext)
          return (
            (n = "3dCheck:noWebGLContext"),
            {
              result: !1,
              errorMessage: n,
              errorContext: i,
            }
          );
        var r = document.createElement("canvas");
        e = r.getContext("webgl", t) || r.getContext("experimental-webgl", t);
        var s = !(!e || !e.getContextAttributes().stencil);
        if (
          (!!e == !1
            ? (n = "3dCheck:noGLContext")
            : !!e.getContextAttributes().stencil == !1 &&
              (n = "3dCheck:noStencil"),
          e)
        ) {
          var o = e.getExtension("WEBGL_lose_context");
          o && o.loseContext();
        }
        return (
          window.WebGLMemoryEstimator &&
            WebGLMemoryEstimator.stopTrackingContext(e),
          {
            result: s,
            errorMessage: n,
            errorContext: i,
          }
        );
      } catch (a) {
        return (
          (n = "3dCheck:genericError"),
          (i = a && a.toString && a.toString()),
          window.WebGLMemoryEstimator &&
            WebGLMemoryEstimator.stopTrackingContext(e),
          {
            result: !1,
            errorMessage: n,
            errorContext: i,
          }
        );
      }
    },
    shouldRunIntegrityTest: function (e, t, n) {
      var i = this.getIntegrityTestCookie();
      return "development" === window.environment
        ? (console.log("Not running integrity because of local environment."),
          !1)
        : e && !i && t && n
        ? !0
        : !1;
    },
    setIntegrityResultCookie: function (e) {
      var t = Helpers.App.isMobile(),
        n = t === !0 ? 10 : 30,
        i = new Date();
      (i = new Date(i.getTime() + 6e4 * n)),
        (document.cookie =
          "integrity_result=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/"),
        (document.cookie =
          "new_integrity_result=" +
          e +
          "; expires=" +
          i.toUTCString() +
          "; path=/"),
        (document.cookie =
          "integrity_version=v3; expires=" + i.toUTCString() + "; path=/");
    },
    _uploadIntegrityImage: function (e, t) {
      e.toBlob(function (e) {
        let url = window.URL.createObjectURL(e);
        t(url);
        // var n = new FormData();
        // n.append("inputFile", e),
        //   $.ajax({
        //     url: NICE_DOMAIN.protocol + "://" + NICE_DOMAIN.hostname + "/files",
        //     type: "POST",
        //     data: n,
        //     processData: !1,
        //     contentType: !1,
        //   })
        //     .done(function (e) {
        //       t(e.url);
        //     })
        //     .fail(function () {
        //       console.log("Failed to upload integrity image"), t("");
        //     });
      });
    },
    saveTransparencyResult: function (e) {
      var t,
        n = "3dCheck:transparencyFail",
        i = this;

      "function" != typeof e.toBlob
        ? void t("")
        : void this._uploadIntegrityImage(e, function (e) {
            // t(e)
          });
    },
    runTransparencyTest: function () {
      var e = engine.getTransformationsBounds(),
        t = !0;
      return (
        console.log("Running transparency test"),
        e.forEach(function (e) {
          var n = e.right - e.left,
            i = e.bottom - e.top;
          e.visible !== !1 && (0 === n || 0 === i) && (t = !1);
        }),
        console.log("Transparency test result: " + t),
        t
      );
    },
    runIntegrity: function (e, t, n, i, r) {
      var s,
        o,
        a = this,
        l = !0,
        c = {};
      a.isRunning !== !0 &&
        ((a.isRunning = !0),
        console.log("Running integrity..."),
        (s = function (e) {
          var t = document.createElement("canvas"),
            n = t.getContext("2d");
          return (
            (t.width = e.naturalWidth),
            (t.height = e.naturalHeight),
            n.drawImage(
              e,
              0,
              0,
              e.naturalWidth,
              e.naturalHeight,
              0,
              0,
              e.naturalWidth,
              e.naturalHeight
            ),
            t
          );
        }),
        (o = function (e, t, n) {
          var i = 0.3,
            r = document.createElement("canvas"),
            s = (r.width = n.right - n.left),
            o = (r.height = n.bottom - n.top),
            a = e.getContext("2d"),
            l = t.getContext("2d"),
            c = l.getImageData(n.left, n.top, s, o),
            u = a.getImageData(n.left, n.top, s, o),
            d = r.getContext("2d"),
            h = d.createImageData(s, o),
            p = {
              diffCanvas: r,
            };
          return (
            (p.pixelDiff = pixelmatch(c.data, u.data, h.data, s, o, {
              threshold: i,
            })),
            d.putImageData(h, 0, 0),
            p.pixelDiff > 0 ? ((p.passed = !1), p) : ((p.passed = !0), p)
          );
        }),
        (e.noText = !0)); /*,
        i.niceImageRequest(
          e,
          function (e) {
            var u,
              d,
              h = s(e),
              p = engine.getTransformationsBounds(),
              f = IntegrityCheck.runTransparencyTest();
            return f === !1
              ? (i.reportTransparencyFail(t), void (a.isRunning = !1))
              : (p.forEach(function (e) {
                  if (e.visible !== !1) {
                    var n = o(h, t, e);
                    n.passed === !1 &&
                      ((u = n.diffCanvas), (d = n.pixelDiff), (l = !1));
                  }
                }),
                (c = {
                  passed: l,
                  engineCanvas: t,
                  fallbackCanvas: h,
                  pixelDiff: d,
                  diffCanvas: u,
                }),
                Helpers.GlobalEventTracker.track("3dCheck:validation", {
                  eventAction: "3dCheck:validation",
                  resultUrl: r,
                  testPassed: c.passed,
                  isMobile: Helpers.App.isMobile(),
                }),
                a.setIntegrityResultCookie(c.passed),
                void (
                  n &&
                  (console.log("Integrity finished, result: " + l),
                  (a.isRunning = !1),
                  n(c))
                ));
          },
          function (e, t, n) {
            (a.isRunning = !1),
              Helpers.GlobalEventTracker.track("3dCheck:requestFail", {
                error: n,
              });
          }
        ));*/
    },
    getIntegrityVersionCookie: function () {
      return document.cookie.replace(
        /(?:(?:^|.*;\s*)integrity_version\s*\=\s*([^;]*).*$)|^.*$/,
        "$1"
      );
    },
    saveIntegrityResult: function (e, t) {
      var n,
        i,
        r,
        s,
        o,
        a = e.passed === !0 ? "3dCheck:log" : "3dCheck:fail",
        l = this;
      return (
        (o = /(Windows NT 10.0; Win64; x64).*(Chrome\/)/.test(
          navigator.userAgent
        )),
        0 == Helpers.App.isLoggedIn() &&
          Helpers.GlobalEventTracker.identifyNotLoggedUser(),
        (s = function (n, r) {
          Helpers.GlobalEventTracker.track(a, {
            eventCategory:
              Helpers.StageType._types[window._stageData.stage_data.image_type],
            eventAction: a,
            integrityTestResult: n,
            fallbackResult: i,
            diffResult: r,
            pixelDiff: e.pixelDiff,
            resultUrl: t,
            testPassed: e.passed,
            isMobile: Helpers.App.isMobile(),
            integrityVersion: l.getIntegrityVersionCookie() || "v1",
          }),
            0 == Helpers.App.isLoggedIn() && analytics.user().traits({});
        }),
        "function" != typeof e.engineCanvas.toBlob
          ? void s("")
          : e.passed !== !0 || o
          ? (l._uploadIntegrityImage(e.engineCanvas, function (e) {
              (n = e), r && i && s(n, r, i);
            }),
            e.diffCanvas
              ? l._uploadIntegrityImage(e.diffCanvas, function (e) {
                  (r = e), n && i && s(n, r, i);
                })
              : (r = " "),
            void l._uploadIntegrityImage(e.fallbackCanvas, function (e) {
              (i = e), r && n && s(n, r, i);
            }))
          : void s("")
      );
    },
  }),
  Module("LayerDataSupport")({
    _layerJSONDataCallbackExecuted: !1,
    prototype: {
      _getLayerJSONData: function (e, t) {
        var n = this,
          i = !1,
          r = !1;
        this._layerJSONDataCallbackExecuted = !1;
        var s = [Helpers.App.getUserUploadsUrl(), e, "data.json"].join("/"),
          o = this._layerJSONDataCallback.bind(this, e, t);
        $.get(s)
          .done(o)
          .fail(function (t) {
            (r = !0),
              r &&
                i &&
                (404 === t.status || 403 === t.status) &&
                n._jsonDataNotFound(e);
          }),
          $.get("/uploads/tmp/" + e + "/data.json")
            .done(o)
            .fail(function (t) {
              (i = !0), r && i && 404 === t.status && n._jsonDataNotFound(e);
            });
      },
    },
  }),
  Class(UI, "TemporalContainer").inherits(Widget).includes(BubblingSupport)({
    html: '<div class="overlay-container"></div>',
    prototype: {
      enableCloseButton: !0,
      isActive: !1,
      activeClass: "",
      defaultClass: "",
      activeContainer: null,
      defaultContainer: null,
      content: null,
      init: function (e) {
        Widget.prototype.init.call(this, e),
          this.content && this.element.append(this.content),
          this.defaultClass && this.element.addClass(this.defaultClass),
          this.enableCloseButton === !0 && this._createCloseBtn();
      },
      activate: function (e) {
        return (
          Widget.prototype.render.call(this, this.activeContainer, !0),
          this.element.addClass(this.activeClass),
          (this.isActive = !0),
          this.showCloseButton(),
          "function" == typeof e && e(),
          this.dispatch("active", {
            originalDispatcher: this,
          }),
          this
        );
      },
      deactivate: function (e) {
        return (
          Widget.prototype.render.call(this, this.defaultContainer, !0),
          this.element.removeClass(this.activeClass),
          this.hideCloseButton(),
          (this.isActive = !1),
          "function" == typeof e && e(),
          this.dispatch("inactive", {
            originalDispatcher: this,
          }),
          this
        );
      },
      _createCloseBtn: function () {
        (this.$btnClose = $(
          '<button type="button" class="close"><span >\xd7</span></button>'
        )),
          this.$btnClose.hide(),
          this.element.prepend(this.$btnClose),
          this.$btnClose.bind("click", this._btnCloseOnClickHandler.bind(this));
      },
      _btnCloseOnClickHandler: function () {
        this.deactivate();
      },
      hideCloseButton: function () {
        this.$btnClose.length > 0 && this.$btnClose.hide();
      },
      showCloseButton: function () {
        return this.$btnClose.length > 0 && this.$btnClose.show(), this;
      },
    },
  }),
  Module("MultiControlExpandSupport")({
    prototype: {
      autoExpandEnable: !0,
      collapseTask: null,
      autoCollapseDelayTime: 1500,
      _expandMobileHandler: function () {
        return this.isMobilePhone !== !0
          ? this
          : ((this.graphicBodyMaxheight = this.$graphicBody.css("max-height")),
            this.$graphicBody.css("max-height", "unset"),
            this.search.triggerFocus(),
            this.grid.hideMoreFader().showMoreFader(),
            this);
      },
      _collapseMobileHandler: function () {
        return this.isMobilePhone !== !0
          ? this
          : (this.$graphicBody.css("max-height", this.graphicBodyMaxheight),
            this);
      },
      _autoExpandHandler: function () {
        return this.isMobilePhone === !0 || this.autoExpandEnable === !1
          ? this
          : (this.expand(), this);
      },
      _autoCollapse: function () {
        var e,
          t,
          n,
          i = this,
          r = null;
        return this.isMobilePhone === !0 ||
          this.autoExpandEnable === !1 ||
          this.collapseTask
          ? this
          : ((e = function (e) {
              return new Promise(function (t) {
                setTimeout(t, e);
              });
            }),
            (t = function () {
              i.collapse();
            }),
            (n = function (e) {
              if ("Cancelation Error" === e.message)
                return void console.warn("collapse: cancel");
              throw e;
            }),
            (r = P.cancelable(e)),
            (this.collapseTask = r(this.autoCollapseDelayTime)),
            this.collapseTask.then(t)["catch"](n),
            this);
      },
      _cancelAutoCollapse: function () {
        this.collapseTask &&
          (this.collapseTask.cancel(), (this.collapseTask = null));
      },
      expand: function () {
        var e = this.$expandCollapseBtn.find("span");
        return (
          e.text("COLLAPSE"),
          this.$expandCollapseBtn.attr("class", "collapse-btn"),
          this.element.addClass("expand"),
          this.dispatch("expand.control"),
          this.grid.getColumnsContainerHeight() <
            this.parent.element.height() && this.grid.nextPage(),
          this
        );
      },
      collapse: function () {
        var e = this.$expandCollapseBtn.find("span");
        return (
          e.text("EXPAND"),
          this.$expandCollapseBtn.attr("class", "expand-btn"),
          this.element.removeClass("expand"),
          this.dispatch("collapse.control"),
          this
        );
      },
      _expandCollapseBtnClickHandler: function () {
        this._cancelAutoCollapse(),
          this.element.hasClass("expand") === !0
            ? (this.collapse(), (this.autoExpandEnable = !0))
            : (this.expand(), (this.autoExpandEnable = !1));
      },
      _enableFullScreenSearchToMobile: function () {
        if (this.isMobilePhone === !0) {
          var e = this.element.attr("class") + " multi-control-overlay";
          this.container = new UI.TemporalContainer({
            name: "container",
            activeClass: e,
            activeContainer: $(document.body),
            element: this.element.find(".overlay-container"),
            defaultContainer: this.element,
          });
          var t = function () {
              this.container.isActive !== !0 && this.container.activate();
            },
            n = function () {
              this.container.isActive !== !1 && this.container.deactivate();
            },
            i = function () {
              this._expandMobileHandler(),
                this.scrollToActive(),
                this.dispatch("active", {
                  originalDispatcher: this,
                });
            },
            r = function () {
              this._collapseMobileHandler(),
                this.scrollToActive(),
                this.dispatch("inactive", {
                  originalDispatcher: this,
                });
            },
            s = function () {
              this.search.triggerBlur();
            };
          this.search.bind("focus", t.bind(this)),
            this.container.bind("active", i.bind(this)),
            this.container.bind("inactive", r.bind(this)),
            this.bind("change", n.bind(this)),
            this.grid.bind("scroll", s.bind(this));
        }
      },
    },
  }),
  Module("CompoundButtonSupport")({
    prototype: {
      shouldRenderCompoundButton: function () {
        return this.isMobilePhone && this.hasAssets();
      },
      _createCompoundButton: function () {
        var e = this;
        e.appendChild(
          new UI.MulticontrolCompoundButton({
            name: "compoundButton",
            title: e.title || e.record.name,
            selectedItem: e.grid.getThumbSelected(),
            shouldTrimTitles: this.shouldTrimTitles,
            isMobile: Helpers.App.isMobile(),
          })
        ),
          e._bindCompoundButtonEvents();
      },
      _bindCompoundButtonEvents: function () {
        if (this.shouldRenderCompoundButton() !== !1) {
          var e,
            t,
            n,
            i = this;
          (e = function (e) {
            e.stopPropagation(),
              i.controlInView(),
              i.show(),
              i.dispatch("showModal", {
                originalDispatcher: i,
              });
          }),
            (t = function (e) {
              e.stopPropagation(),
                i.grid.setNoImage({
                  triggeredByUser: !0,
                  triggeredByPopState: !1,
                }),
                i.dispatch("setNoImage", {
                  originalDispatcher: i,
                });
            }),
            (n = function () {
              i.grid.showFilePicker();
            }),
            i.compoundButton
              .bind("showModal", e)
              .bind("setNoImage", t)
              .bind("showFilePicker", n),
            (this._onClickOutsidePopup = function (e) {
              i.isVisible() !== !1 &&
                ((i.container && i.container.isActive) ||
                  i.element.has(e.target).length ||
                  (i.compoundButton.isDropdownOpen() !== !0 &&
                    (i.dispatch("hideModal", {
                      originalDispatcher: this,
                    }),
                    i.hide(),
                    i.grid.clearVideos())));
            }),
            $(document.body).click(this._onClickOutsidePopup);
        }
      },
      _bindPopupColorControlEvents: function (e) {
        if (this.shouldRenderCompoundButton() !== !1) {
          var t = this,
            n = function () {
              t.hide();
            },
            i = function (e) {
              e.stopPropagation(), t.show();
            };
          e.bind("showModal", n).bind("hideModal", i);
        }
      },
      renderCompoundButtonAfter: function (e) {
        e.after(this.compoundButton.element);
      },
      renderAfterCompoundButton: function (e) {
        this.compoundButton.element.after(e);
      },
    },
  }),
  Module("AddGraphicDropdownSupport")({
    prototype: {
      _buildDropdown: function () {
        var e;
        (e = this),
          e.appendChild(
            new UI.SimpleDropdown({
              name: "dropdownControl",
              cssClass: "composite-button",
              cssOptionsContainer: "add-graphic-dropdown-options-container",
              label: "Add Graphics",
              options: [
                {
                  label: "Upload from Your Device",
                  value: "uploadFromDevice",
                  cssClass: "device-gray",
                },
                {
                  label: "Upload from Our Gallery",
                  value: "uploadFromGallery",
                  cssClass: "gallery-gray",
                },
              ],
            })
          ),
          e.dropdownControl.render(e.element),
          e.showDropdown(),
          e._bindDropdownEvents();
      },
      _bindDropdownEvents: function () {
        var e;
        (e = this),
          e.dropdownControl.bind("selectoption", function () {
            var t;
            switch ((t = e.dropdownControl.getValue())) {
              case "uploadFromDevice":
                e.dropdownControl.unselectOptions(), e.showFilePicker();
                break;
              case "uploadFromGallery":
                e.dropdownControl.unselectOptions(), e.showModal();
            }
          }),
          e.bind("selectitem", function () {
            e.hideDropdown();
          }),
          e.bind("removeitem", function () {
            e.showDropdown();
          });
      },
      showDropdown: function () {
        var e;
        (e = this), e.$compositeButton.hide(), e.dropdownControl.show();
      },
      hideDropdown: function () {
        var e;
        (e = this), e.dropdownControl.hide(), e.$compositeButton.show();
      },
      isDropdownOpen: function () {
        var e;
        return (e = this), e.dropdownControl.isOpen();
      },
    },
  }),
  Class("Queue")({
    prototype: {
      init: function (e) {
        $.extend(this, e), (this._items = []);
      },
      push: function (e) {
        var t = this;
        e.forEach(function (e) {
          t._items.push(e);
        });
      },
      next: function () {
        return this._items.shift();
      },
      clear: function () {
        var e = this._items;
        return (this._items = []), e;
      },
      size: function () {
        return this._items.length;
      },
    },
  }),
  Class(UI, "ShowMoreContainer").inherits(Widget).includes(BubblingSupport)({
    SHOW_MORE_TEXT: 'Show More <i class="show-more-down-arrow"></i>',
    SHOW_LESS_TEXT: 'Show Less <i class="show-more-down-arrow"></i>',
    SIZE_GAP: 50,
    OPEN_CLASS: "show-more-open",
    ANIMATION_DURATION: 500,
    html: '    <div class="show-more-container hidden">        <div class="show-more-container-bottom">            <button class="show-more-btn">Show More <i class="show-more-down-arrow"></i></button>        </div>    </div>',
    prototype: {
      innerComponent: null,
      $loadMoreButton: null,
      size: 585,
      init: function (e) {
        Widget.prototype.init.call(this, e),
          (this.$loadMoreButton = this.element.find(
            ".show-more-container-bottom button.show-more-btn"
          )),
          this.element.css({
            "max-height": this.size,
            "min-height": this.size,
          }),
          (this.$loadMoreButtonContainer = this.element.find(
            ".show-more-container-bottom"
          )),
          this._bindEvents();
      },
      _bindEvents: function () {
        (this._handleClickEvent = this._handleClick.bind(this)),
          this.$loadMoreButton.click(this._handleClickEvent);
      },
      addComponent: function (e) {
        (this.innerComponent = e), this.innerComponent.render(this.element);
      },
      _isOpen: function () {
        return this.element.hasClass(this.constructor.OPEN_CLASS);
      },
      show: function () {
        this.element.removeClass("hidden");
      },
      _handleClick: function () {
        var e = this.size;
        (this.animationFinishHandler = this._updateState.bind(this)),
          this._isOpen() === !1 &&
            ((e =
              this.innerComponent.element.innerHeight() +
              this.constructor.SIZE_GAP),
            (this.scrollPosition = document.documentElement.scrollTop));
        var t = [this._changeSize(e), this._scrollPage(this.scrollPosition)];
        Promise.all(t).then(this.animationFinishHandler);
      },
      _changeSize: function (e) {
        var t = this;
        return new Promise(function (n) {
          t.element.animate(
            {
              "max-height": e,
            },
            t.constructor.ANIMATION_DURATION,
            n
          );
        });
      },
      _scrollPage: function (e) {
        return new Promise(function (t) {
          return null === e
            ? t()
            : void $("html, body").animate(
                {
                  scrollTop: e,
                },
                this.constructor.ANIMATION_DURATION,
                t
              );
        });
      },
      _updateState: function () {
        this.element.toggleClass(this.constructor.OPEN_CLASS);
        var e = this.constructor.SHOW_MORE_TEXT;
        this._isOpen() === !0 && (e = this.constructor.SHOW_LESS_TEXT),
          this.$loadMoreButton.html(e);
      },
      hideLoadMoreButtonContainer: function () {
        this.$loadMoreButtonContainer.hide();
      },
      showLoadMoreButtonContainer: function () {
        this.$loadMoreButtonContainer.show();
      },
      changeContainerSize: function (e) {
        (this.size = e),
          this.element.css({
            "max-height": this.size,
            "min-height": this.size,
          }),
          this._isOpen() === !0 && this._updateState();
      },
    },
  }),
  Module("SaveDraftSupport")({
    prototype: {
      nDrafts: 0,
      nChanges: 0,
      _debounceChangeHandler: null,
      allowEnableSaveButton: !1,
      currentDraftState: null,
      initializeSaveDraft: function () {
        (this.$buttonContainer = Helpers.App.isMobile()
          ? this.$moreContextMenu.find(".save-button")
          : this.element.find(".save-button")),
          this.$buttonContainer.removeClass("hidden"),
          this._buildSaveButton(),
          this.changeSaveButtonState(),
          (this._debounceChangeHandler = Helpers.App.debounce(
            this._changeDraftHandler.bind(this),
            150,
            !1
          ));
      },
      _buildSaveButton: function () {
        var e = new ButtonPopover({
          name: "saveButton",
          contentPopover: "content",
          typeTriggerPopover: "manual",
          element: this.$buttonContainer,
          cssClass: "save-button disabled",
          cssClassPopover: "save-draft",
        });
        this.appendChild(e),
          this.saveButton.bind(
            "click",
            function () {
              if (0 === Helpers.App.getUser().id) {
                var e = {
                  type: "warning",
                  content:
                    'Please create an account to save a draft of this stage.<br /> Already have an account?                             <a href="#" onclick="event.preventDefault();page.appNavBar.ssoModal.showTab(\'' +
                    UI.SsoModal.TAB_LOGIN +
                    '\')" class="trigger_login_link" role="button">Log In</a>',
                  contentForceLogIn:
                    'Please log in to save a draft of this stage.<br /> Don\'t have an account?                             <a href="#" onclick="event.preventDefault();page.appNavBar.ssoModal.showTab(\'' +
                    UI.SsoModal.TAB_SIGNUP +
                    '\')" class="trigger_signup_link" role="button">Sign Up</a> today!',
                };
                page.appNavBar.ssoModal.activate(),
                  page.appNavBar.ssoModal.showMessage(e);
              } else this.dispatch("save");
            }.bind(this)
          );
      },
      changeSaveButtonState: function (e) {
        var t = {
          nChanges: this.nChanges,
          nDrafts: this.nDrafts,
          state: e,
        };
        (this.currentDraftState = this.getSaveDraftState(t)),
          this.allowEnableSaveButton ||
            (this.currentDraftState.disabled === !0
              ? this.disableSaveButton()
              : this.enableSaveButton(),
            this.currentDraftState.loading === !0
              ? this.saveButton.startLoading()
              : this.saveButton.endLoading(),
            this.saveButton.changeContentPopover(
              this.currentDraftState.contentPopover
            ));
      },
      changeDraftHandler: function (e) {
        this._debounceChangeHandler(e);
      },
      _changeDraftHandler: function (e) {
        var t = this;
        (t.nChanges = t.nChanges + e),
          t.changeSaveButtonState(),
          10 === t.nChanges &&
            t.saveButton.showPopover(5e3, function () {
              t.saveButton.hidePopover();
            });
      },
      syncDraftHandler: function (e, t) {
        this.nDrafts = e;
        var n = this.nChanges - t;
        (this.nChanges = n > 0 ? n : 0),
          this.saveButtonLoading(!1),
          this.changeSaveButtonState();
      },
      getSaveDraftState: function (e) {
        var t = this._getSaveDraftStates(e).filter(function (e) {
          return e.condition === !0;
        });
        return t[0].data;
      },
      getSaveDraftCurrentState: function () {
        return this.currentDraftState;
      },
      saveButtonLoading: function (e) {
        e
          ? ((this.saveButton.isPopoverVisible = !1),
            this.changeSaveButtonState("saving"),
            this.saveButton.isMouseOver && this.saveButton.showPopover())
          : (this.saveButton.hidePopover(), this.changeSaveButtonState());
      },
      getSaveCurrentStage: function () {
        return this.currentDraftState;
      },
      _getSaveDraftStates: function (e) {
        return [
          {
            data: {
              state: "nothing-to-save",
              disabled: !0,
              contentPopover: "Nothing to Save! Please Add a Slide",
            },
            condition: "nothing-to-save" === e.state,
          },
          {
            data: {
              state: "processing",
              disabled: !0,
              contentPopover: "Processing Changes...",
            },
            condition: "processing" === e.state,
          },
          {
            data: {
              state: "saving",
              loading: !0,
              disabled: !0,
              contentPopover: "Saving...",
            },
            condition: "saving" === e.state,
          },
          {
            data: {
              state: "no-changes",
              disabled: !0,
              contentPopover: "To Save a Draft, Make Some Changes First",
            },
            condition: 0 === e.nChanges,
          },
          {
            data: {
              state: "ten-changes",
              disabled: !1,
              contentPopover: "Click Here to Save a Draft!",
            },
            condition: 10 === e.nChanges,
          },
          {
            data: {
              state: "has-changes",
              disabled: !1,
              contentPopover: "Save Draft",
            },
            condition: e.nChanges > 0 && 10 !== e.nChanges,
          },
          {
            data: {
              state: "default",
              disabled: !1,
              contentPopover: "Save Draft",
            },
            condition: !0,
          },
        ];
      },
      enableSaveButton: function () {
        return (
          this.saveButton &&
            this.allowEnableSaveButton === !1 &&
            this.saveButton.enable(),
          this
        );
      },
      disableSaveButton: function () {
        return this.saveButton && this.saveButton.disable(), this;
      },
    },
  }),
  Class("SmartConsumer")({
    prototype: {
      init: function (e) {
        $.extend(this, e), (this.keepRunning = !1);
      },
      start: function () {
        (this.keepRunning = !0), this.run();
      },
      run: function () {
        if (this.keepRunning !== !1) {
          var e = this,
            t = this.queue.next();
          return t
            ? void (this.queue.actionName
                ? t[this.queue.actionName].call(t, function () {
                    setTimeout(function () {
                      e.run();
                    });
                  })
                : this.queue.action(t, function () {
                    setTimeout(function () {
                      e.run();
                    });
                  }))
            : void (this.queue.consumers.length > this.queue.minConsumers
                ? this.destroy()
                : this.stop());
        }
      },
      stop: function () {
        this.keepRunning = !1;
      },
      destroy: function () {
        this.stop(), this.queue.removeConsumer(this), (this.queue = null);
      },
    },
  }),
  Class("SmartQueue").inherits(Queue)({
    prototype: {
      consumers: [],
      maxConsumers: 1,
      minConsumers: 1,
      itemsPerConsumer: 1,
      consumerClass: null,
      init: function (e) {
        (this.consumers = []),
          Queue.prototype.init.call(this, e),
          null === this.consumerClass && (this.consumerClass = SmartConsumer);
        for (var t = 0; t < this.minConsumers; t++) this.instantiateConsumer();
      },
      push: function (e) {
        Queue.prototype.push.call(this, e);
        for (
          var t = this.consumers.length,
            n = this._items.length,
            i = Math.floor(n / this.itemsPerConsumer - t),
            r = Math.min(this.maxConsumers - t, i),
            s = 0;
          r > s;
          s++
        )
          this.instantiateConsumer();
        this.consumers.forEach(function (e) {
          0 == e.keepRunning && e.start();
        });
      },
      instantiateConsumer: function () {
        var e = new this.consumerClass();
        (e.queue = this), this.consumers.push(e);
      },
      removeConsumer: function (e) {
        var t = this.consumers.indexOf(e);
        this.consumers.splice(t, 1);
      },
    },
  }),
  Module("StageControlsDestroySupport")({
    prototype: {
      clearTimeouts: function () {
        this._timeouts.forEach(function (e) {
          clearTimeout(e);
        });
      },
      clearPopstateEventHandler: function () {
        window.removeEventListener("popstate", this._popstateHandler);
      },
    },
  }),
  Module("UiJsonSupport")({
    prototype: {
      map: {
        color_control: "colorPicker_",
        custom_image: "customG_",
        video: {
          video: "video",
          search: "search",
          color: "color",
        },
        graphic: {
          graphic: "multi",
          color: "color",
          search: "search",
        },
        audio: {
          enabled: "audio_enabled",
          track: "audio_track",
        },
        asset_library: {
          graphic: "multi",
          color: "color",
          search: "search",
        },
        text_control: {
          color: "color",
          text: "text",
          checkbox: "checkbox",
          font: "font",
          font_size: "_fontSize",
        },
        alternate_values: "option_",
      },
      _getSeparator: function (e) {
        var t = "?";
        return e.indexOf(t) > -1 && (t = "&"), t;
      },
      _getUrlParams: function (e, t) {
        var n,
          i,
          r = this;
        return (
          (n = ""),
          e.text.forEach(function (e) {
            return (
              (i = "Text_" + e.name),
              e.visible === !1
                ? ((n = n.concat(
                    this._getSeparator(n),
                    encodeURIComponent("checkbox" + i),
                    "=",
                    !1
                  )),
                  void (
                    t &&
                    (n = n.concat(
                      this._getSeparator(n),
                      encodeURIComponent("text" + i),
                      '=""'
                    ))
                  ))
                : (e.contents
                    ? (n = n.concat(
                        this._getSeparator(n),
                        encodeURIComponent("text" + i),
                        "=",
                        encodeURIComponent(e.contents)
                      ))
                    : t &&
                      (n = n.concat(
                        this._getSeparator(n),
                        encodeURIComponent("text" + i),
                        '=""'
                      )),
                  (n = n.concat(
                    this._getSeparator(n),
                    encodeURIComponent("color" + i),
                    "=",
                    encodeURIComponent(e.color)
                  )),
                  void (
                    t &&
                    (n = n.concat(
                      this._getSeparator(n),
                      encodeURIComponent("font" + i),
                      "=",
                      encodeURIComponent(e.font)
                    ))
                  ))
            );
          }, this),
          e.graphic.forEach(function (e) {
            if (
              ((i = "Folder_" + e.name),
              e.layers &&
                1 === e.layers.length &&
                0 === Object.keys(e.layers[0]).length)
            )
              return void (n = n.concat(
                this._getSeparator(n),
                encodeURIComponent("graphic" + i),
                "=-1"
              ));
            if (e.layer) {
              var t = e.preconfiguredSearch || "";
              (n = n.concat(
                this._getSeparator(n),
                encodeURIComponent("multi" + i),
                "=",
                encodeURIComponent(e.layer)
              )),
                this.isNlpEnabled === !0 &&
                  (this.selectedByUser === !0
                    ? (t = "")
                    : this.query && (t = this.query)),
                null !== t &&
                  (n = n.concat(
                    this._getSeparator(n),
                    "search",
                    encodeURIComponent(i),
                    "=",
                    encodeURIComponent(t)
                  ));
            } else e.selectedLayer && "null" === e.selectedLayer.id && (n = n.concat(this._getSeparator(n), encodeURIComponent("multi" + i), "=null"));
            if (e.layers) {
              var s = e.layers.filter(function (e) {
                return e.visible === !0;
              })[0];
              s &&
                s.layers &&
                s.layers.forEach(function (e) {
                  "accent" === e.name.toLowerCase().trim() &&
                    (n = n.concat(
                      r._getSeparator(n),
                      encodeURIComponent("colorAccent" + i),
                      "=",
                      encodeURIComponent(e.color)
                    ));
                });
            }
            n = n.concat(
              this._getSeparator(n),
              encodeURIComponent("color" + i),
              "=",
              encodeURIComponent(e.color)
            );
          }, this),
          e.customGraphic.forEach(function (e, t) {
            e.hash &&
              ((i = "customG_" + t),
              (n = n.concat(
                this._getSeparator(n),
                encodeURIComponent(i),
                "=",
                encodeURIComponent(e.hash)
              )));
          }, this),
          e.backgroundColor &&
            e.backgroundColor.color &&
            ((i = "colorFolder_Background"),
            (n = n.concat(
              this._getSeparator(n),
              encodeURIComponent(i),
              "=",
              encodeURIComponent(e.backgroundColor.color)
            ))),
          n
        );
      },
      _getUrlParamsForVideo: function (e, t) {
        this.slidePrefix = t + "_";
        var n = "";
        return (
          (n = this.getTextParams(e.text, n)),
          (n = this.getColorPickerParams(e.color_picker, n)),
          (n = this.getAudioParams(e.audio, n)),
          (n = this.getOptionParams(e.options, n)),
          (n = this.getImagesParams(e.images, n)),
          (n = this.getAssetLibraryParams(e.asset_library, n)),
          (n = this.getVideoParams(e.video, n)),
          (n = this.getGraphicParams(e.graphic, n))
        );
      },
      getTextParams: function (e, t) {
        var n = this;
        return (
          e.forEach(function (e, i) {
            var r = i + e.name,
              s = n.slidePrefix + n.map.text_control.color + r;
            t = t.concat(
              n._getSeparator(t),
              s,
              "=",
              encodeURIComponent(e.color)
            );
            var o = n.slidePrefix + n.map.text_control.text + r,
              a = e.contents;
            e.visible === !1 && (a = ""),
              (t = t.concat(n._getSeparator(t), o, "=", encodeURIComponent(a)));
            var l = n.slidePrefix + n.map.text_control.font + r;
            t = t.concat(
              n._getSeparator(t),
              l,
              "=",
              encodeURIComponent(e.font)
            );
          }),
          t
        );
      },
      getColorPickerParams: function (e, t) {
        var n = this;
        return (
          e.forEach(function (e, i) {
            var r = i + e.name,
              s = n.slidePrefix + n.map.color_control + r;
            t = t.concat(
              n._getSeparator(t),
              s,
              "=",
              encodeURIComponent(e.color)
            );
          }),
          t
        );
      },
      getAudioParams: function (e, t) {
        if (e) {
          var n = this.map.audio.enabled;
          t = t.concat(
            this._getSeparator(t),
            n,
            "=",
            encodeURIComponent(e.enabled)
          );
          var i = this.map.audio.track;
          t = t.concat(
            this._getSeparator(t),
            i,
            "=",
            encodeURIComponent((e.track && e.track.id) || null)
          );
        }
        return t;
      },
      getOptionParams: function (e, t) {
        var n = this;
        return (
          e.forEach(function (e) {
            var i = n.map.alternate_values + e.name;
            t = t.concat(
              n._getSeparator(t),
              i,
              "=",
              encodeURIComponent(e.selectedOptions[0].value)
            );
          }),
          t
        );
      },
      getImagesParams: function (e, t) {
        var n = this;
        return (
          e.forEach(function (e, i) {
            var r = n.slidePrefix + n.map.custom_image + i;
            e.hash &&
              (t = t.concat(
                n._getSeparator(t),
                r,
                "=",
                encodeURIComponent(e.hash)
              ));
          }),
          t
        );
      },
      getAssetLibraryParams: function (e, t) {
        var n = this;
        return (
          e.forEach(function (e, i) {
            var r = i + e.name,
              s = n.slidePrefix + n.map.asset_library.color + r;
            if (
              ((t = t.concat(
                n._getSeparator(t),
                s,
                "=",
                encodeURIComponent(e.color)
              )),
              e.selectedLayer)
            ) {
              var o = n.slidePrefix + n.map.asset_library.graphic + r,
                a =
                  "customGraphic" !== e.selectedLayer.id
                    ? e.selectedLayer.id
                    : e.selectedLayer.record_hash;
              t = t.concat(n._getSeparator(t), o, "=", encodeURIComponent(a));
            }
            var l = n.slidePrefix + n.map.asset_library.search + r;
            t = t.concat(
              n._getSeparator(t),
              l,
              "=",
              encodeURIComponent(
                e.preconfiguredSearch ? e.preconfiguredSearch.toLowerCase() : ""
              )
            );
          }),
          t
        );
      },
      getVideoParams: function (e, t) {
        var n = this;
        return (
          e.forEach(function (e, i) {
            var r = i + e.name;
            if (e.selectedLayer) {
              var s = n.slidePrefix + n.map.video.video + r;
              t = t.concat(
                n._getSeparator(t),
                s,
                "=",
                encodeURIComponent(e.selectedLayer.id)
              );
            }
            var o = n.slidePrefix + n.map.video.color + r;
            t = t.concat(
              n._getSeparator(t),
              o,
              "=",
              encodeURIComponent(e.color)
            );
            var a = n.slidePrefix + n.map.video.search + r;
            t = t.concat(
              n._getSeparator(t),
              a,
              "=",
              encodeURIComponent(
                e.preconfiguredSearch ? e.preconfiguredSearch.toLowerCase() : ""
              )
            );
          }),
          t
        );
      },
      getGraphicParams: function (e, t) {
        var n = this;
        return (
          e.forEach(function (e, i) {
            var r = i + e.name,
              s = n.slidePrefix + n.map.graphic.color + r;
            if (
              ((t = t.concat(
                n._getSeparator(t),
                s,
                "=",
                encodeURIComponent(e.color)
              )),
              e.selectedLayer)
            ) {
              var o = n.slidePrefix + n.map.graphic.graphic + r;
              (t = t.concat(
                n._getSeparator(t),
                o,
                "=",
                encodeURIComponent(e.selectedLayer.id)
              )),
                Array.isArray(e.selectedLayer.layers) &&
                  e.selectedLayer.layers
                    .filter(function (e) {
                      return e.allowColorpicker;
                    })
                    .forEach(function (e) {
                      var i = n.slidePrefix + n.map.graphic.color + e.name + r;
                      t = t.concat(
                        n._getSeparator(t),
                        i,
                        "=",
                        encodeURIComponent(e.color)
                      );
                    });
            }
            var a = n.slidePrefix + n.map.graphic.search + r;
            t = t.concat(
              n._getSeparator(t),
              a,
              "=",
              encodeURIComponent(
                e.preconfiguredSearch ? e.preconfiguredSearch.toLowerCase() : ""
              )
            );
          }),
          t
        );
      },
    },
  }),
  Class("AlgoliaClient")({
    TEMPLATE_INDEX: window.algoliaConfig.niceTemplatesIndex,
    FONTS_INDEX: window.algoliaConfig.niceFontsIndex,
    ASSET_INDEX: window.algoliaConfig.niceAssetsIndex,
    algolia: window.algoliasearch(
      window.algoliaConfig.appId,
      window.algoliaConfig.readApiKey,
      {
        timeouts: {
          connect: 1e3,
          read: 7e3,
          write: 3e4,
        },
      }
    ),
    getAssetIndex: function () {
      return AlgoliaClient.algolia.initIndex(this.ASSET_INDEX);
    },
    getTemplateIndex: function () {
      return AlgoliaClient.algolia.initIndex(this.TEMPLATE_INDEX);
    },
    getFontsIndex: function () {
      return AlgoliaClient.algolia.initIndex(this.FONTS_INDEX);
    },
    searchFonts: function (e, t) {
      var n = AlgoliaClient.getFontsIndex();
      return new Promise(function (i, r) {
        n.search(e, t).then(i)["catch"](r);
      });
    },
    findFontsBy: function (e, t) {
      var n = Object.entries(e)
        .map(function (e) {
          return e[1]
            .map(function (t) {
              return e[0] + ":" + t;
            })
            .join(" OR ");
        })
        .join(" OR ");
      return AlgoliaClient.searchFonts("", {
        hitsPerPage: t,
        filters: n,
      });
    },
    findTemplate: function (e) {
      var t, n, i;
      return (
        (t = ""),
        (n = {
          filters: "templateID:" + e,
          distinct: 0,
          hitsPerPage: 1e3,
        }),
        (i = AlgoliaClient.getTemplateIndex()),
        new Promise(function (e, r) {
          i.search(t, n).then(e)["catch"](r);
        })
      );
    },
    searchAssets: function (e, t) {
      var n = AlgoliaClient.getAssetIndex();
      return new Promise(function (i, r) {
        n.search(e, t).then(i)["catch"](r);
      });
    },
    findAsset: function (e) {
      if (null === e || "undefined" == typeof e)
        return Promise.resolve(AlgoliaClient._buildFakeResponse());
      var t = {
        filters: "id:" + e,
      };
      return AlgoliaClient.searchAssets("", t);
    },
    findAssetsBy: function (e, t) {
      var n = "string" != typeof e,
        i = null === t || void 0 === t;
      if (n === !0 || i === !0)
        return Promise.resolve(AlgoliaClient._buildFakeResponse());
      var r = {
        filters: e + ":" + t,
      };
      return AlgoliaClient.searchAssets("", r);
    },
    _buildFakeResponse: function () {
      return {
        hits: [],
        nbHits: 0,
        page: 0,
        nbPages: 0,
        hitsPerPage: 0,
        exhaustiveNbHits: !1,
        query: "",
        params: "",
        processingTimeMS: 0,
      };
    },
    getEmptyResponse: function () {
      return this._buildFakeResponse();
    },
    getAssignedAssets: function (e, t, n) {
      var i = n.search;
      return AlgoliaClient.findTemplate(e)
        .then(function (e) {
          var i = e.hits
            .filter(function (e) {
              return (
                e.propertyName === t.propertyName && e.position === t.position
              );
            })
            .reduce(function (e, t) {
              return e.concat(t.graphics);
            }, [])
            .map(function (e) {
              return "id:" + e;
            })
            .join(" OR ");
          return (
            t.selectedLayerId && (i += " AND NOT id:" + t.selectedLayerId),
            {
              page: n.page || 0,
              hitsPerPage: n.perPage || 1e3,
              filters: i,
            }
          );
        })
        .then(function (e) {
          var t = UI.AlgoliaSearch.getInstance();
          return new Promise(function (n, r) {
            t.assetIndex
              .search(i, e)
              .then(function (e) {
                n({
                  hits: e.hits,
                  page: e.page,
                  hitsPerPage: e.hitsPerPage,
                });
              })
              ["catch"](r);
          });
        });
    },
    getAssetByTags: function (e) {
      var t = e.search || "",
        n = e.groupTags || [],
        i = e.exclusions || [];
      e.selectedId &&
        i.push({
          property: "id",
          value: e.selectedId,
        });
      var r = {
        page: e.page || 0,
        perPage: e.perPage || 1e3,
        filter: {
          property: "tags",
          values: n,
        },
        exclusions: i,
      };
      "object" == typeof r.filter && (r.filter.operator = "OR");
      var s = Asset._buildQuery(r);
      return AlgoliaClient.searchAssets(t, s).then(function (e) {
        return {
          hits: e.hits,
          page: e.page,
          hitsPerPage: e.hitsPerPage,
        };
      });
    },
  }),
  Class("Asset")({
    page: 0,
    hitsPerPage: 20,
    client: window.AlgoliaClient,
    _map: {
      data: "hits",
      page: "page",
      perPage: "hitsPerPage",
      totalPages: "nbPages",
      total: "nbHits",
      search: "search",
      filters: "filters",
      queryID: "queryID",
    },
    search: function (e, t, n) {
      "object" == typeof t.filter && (t.filter.operator = "OR"),
        Array.isArray(t.exclusions) === !1 && (t.exclusions = []),
        t.exclusions.push({
          property: "type",
          value: "noun-asset",
        });
      var i = this._buildQuery(t);
      n &&
        n.triggeredByUser &&
        ((i.clickAnalytics = !0), (i.analyticsTags = ["multicontrolSearch"]));
      var r = function (t) {
        return (
          (t.search = e), (t.filters = i.filters), Asset.buildAssetsResponse(t)
        );
      };
      return this.client.searchAssets(e, i).then(r.bind(this));
    },
    buildAssetsResponse: function (e) {
      return e && Object.keys(e).length > 0
        ? (e.hits.forEach(function (t, n) {
            Asset._craftPaths(t), (t.queryID = e.queryID), (t.position = n + 1);
          }),
          Asset._transform(e))
        : Asset._getBaseResponse();
    },
    _getBaseResponse: function () {
      return {
        data: [],
        page: 0,
        perPage: 0,
        totalPages: 0,
        total: 0,
        search: "",
        filters: null,
        queryID: null,
      };
    },
    find: function (e) {
      return this.client.findAsset(e).then(function (e) {
        return Asset.buildResponse(e);
      });
    },
    buildResponse: function (e) {
      return 0 === e.hits.length
        ? null
        : (this._craftPaths(e.hits[0]), e.hits[0]);
    },
    findBy: function (e, t) {
      var n = function (e) {
        return 0 === e.hits.length
          ? null
          : (this._craftPaths(e.hits[0]), e.hits[0]);
      };
      return this.client.findAssetsBy(e, t).then(n.bind(this));
    },
    _craftPaths: function (e) {
      if (e)
        switch (
          (delete e._highlightResult,
          Helpers.App.shouldPreferVideoAsset(e) && (e.assetType = "animated"),
          e.assetType)
        ) {
          case "image":
            (e.image = Helpers.App.isMobile()
              ? "/image_library/" + e.id + "/images/medium.jpg"
              : "/image_library/" + e.id + "/images/small.jpg"),
              (e.path = "image_library/" + e.id + "/image" + e.type);
            break;
          case "video":
            (e.image = "/video_library/" + e.id + "/images/small.jpg"),
              (e.video = "/video_library/" + e.id + "/videos/preview.mp4");
            break;
          case "animated":
            (e.image = Helpers.App.isMobile()
              ? "/image_library/" + e.id + "/images/medium.jpg"
              : "/image_library/" + e.id + "/images/small.jpg"),
              (e.video = "/image_library/" + e.id + "/animated_preview.mp4"),
              (e.assetType = "video");
        }
    },
    _transform: function (e) {
      var t = e || {},
        n = Asset._getBaseResponse();
      return (
        Object.entries(Asset._map).forEach(function (e) {
          n[e[0]] = t[e[1]] || n[e[0]];
        }),
        n
      );
    },
    _buildQuery: function (e) {
      var t = {
          page: e.page || Asset.page,
          hitsPerPage: e.perPage || Asset.hitsPerPage,
        },
        n = Asset._buildFilters(e.filter, e.exclusions);
      return n && (t.filters = n), t;
    },
    _buildFilters: function (e, t) {
      var n = null,
        i = null,
        r = e.values.filter(function (e) {
          return e;
        });
      return (
        r.length > 0 &&
          (n = r
            .map(function (t) {
              return e.property.trim() + ":" + t.trim();
            })
            .join(" " + e.operator + " ")),
        "string" == typeof n &&
          Array.isArray(t) &&
          ((i = t
            .map(function (e) {
              return " AND NOT " + e.property + ":" + e.value;
            })
            .join(" ")),
          (n += i)),
        n
      );
    },
  }),
  Class("AssetsCached")({
    getAssets: function (e, t, n) {
      var i, r;
      return (
        (r = Helpers.App.matchInitialAssets(
          Helpers.StageType.getStageRecordId()
        )),
        r === !1
          ? null
          : "undefined" == typeof window.initialAssets[e]
          ? null
          : ((i = window.initialAssets[e].find(function (e) {
              return e.name === t;
            })),
            "undefined" == typeof i
              ? null
              : AssetsCached._buildResponse(i.layers, i.selectedLayer, n))
      );
    },
    _buildResponse: function (e, t, n) {
      var i = Asset.buildAssetsResponse(e);
      return (
        (i.selectedLayer = null),
        n && ((i.search = n.search || ""), (i.searchTerm = i.search)),
        t && (i.selectedLayer = Asset.buildResponse(t)),
        i
      );
    },
  }),
  Class("CustomAsset")({
    fetch: function (e) {
      var t = [Helpers.App.getUserUploadsUrl(), e, "data.json"].join("/"),
        n = "/uploads/tmp/" + e + "/data.json",
        i = [
          new Promise(function (e, n) {
            $.get(t)
              .then(e)
              .fail(function (e) {
                n({
                  bucket: "S3",
                  data: e,
                });
              });
          }),
          new Promise(function (e, t) {
            $.get(n)
              .then(e)
              .fail(function (e) {
                t({
                  bucket: "tmp",
                  data: e,
                });
              });
          }),
        ];
      return Promise.any(i)["catch"](function (e) {
        var t = "S3" === e[0].bucket ? e[0] : e[1];
        return Promise.reject(t.data);
      });
    },
  }),
  Class("Font").includes(CustomEventSupport)({
    prototype: {
      name: null,
      displayName: !1,
      init: function (e) {
        var t = this;
        (this.originalData = e.data), (this.isSaved = !1);
        for (var n in e.data) e.data.hasOwnProperty(n) && (t[n] = e.data[n]);
      },
      setProperty: function (e, t) {
        (this[e] = t), this.dispatch("change"), this.dispatch(e + "_change");
      },
      getProperty: function (e) {
        return this[e];
      },
    },
  }),
  Class("SavedFonts").includes()({
    prototype: {
      readingEndpoint: null,
      writingEndpoint: null,
      deletionEndpoint: null,
      init: function (e) {
        (this.name = e.name),
          (this.readingEndpoint = e.readingEndpoint),
          (this.writingEndpoint = e.writingEndpoint),
          (this.deletionEndpoint = e.deletionEndpoint);
      },
      fetchFonts: function () {
        var e = this;
        return new Promise(function (t, n) {
          $.ajax({
            url: e.readingEndpoint,
            type: "GET",
            success: function (e) {
              t(e);
            },
            error: function (t) {
              e._fetchFontsError(t), n(t);
            },
          });
        });
      },
      deleteFont: function (e) {
        var t = this;
        return new Promise(function (n, i) {
          $.ajax({
            url: t.deletionEndpoint + e,
            method: "DELETE",
            success: function (e) {
              n(e);
            },
            error: function (e) {
              t._deleteFontError(e), i(e);
            },
          });
        });
      },
      addFont: function (e) {
        var t = this;
        return new Promise(function (n, i) {
          $.ajax({
            url: t.writingEndpoint,
            method: "POST",
            data: {
              font_id: e,
            },
            success: function (e) {
              n(e);
            },
            error: function (e) {
              t._addFontError(e), i(e);
            },
          });
        });
      },
      _fetchFontsError: function (e) {
        var t = new Error(
          "SavedFonts:FetchError " +
            JSON.stringify({
              error: e,
            })
        );
        window.newrelic.noticeError(t);
      },
      _deleteFontError: function (e) {
        var t = new Error(
          "SavedFonts:DeleteError " +
            JSON.stringify({
              error: e,
            })
        );
        window.newrelic.noticeError(t);
      },
      _addFontError: function (e) {
        var t = new Error(
          "SavedFonts:AddError " +
            JSON.stringify({
              error: e,
            })
        );
        window.newrelic.noticeError(t);
      },
    },
  }),
  Class("ObjectListManager").includes(CustomEventSupport)({
    prototype: {
      data: null,
      isDataFormatted: !1,
      init: function (e) {
        (this.name = e.name), (this.listNames = []);
      },
      getList: function (e) {
        return this[e];
      },
      createList: function (e, t) {
        var n = this;
        n.listNames.push(e),
          (n[e] = new ObjectList({
            list: [],
            limit: t.limit,
          }));
      },
      deleteList: function (e) {
        delete this[e];
      },
      findInList: function (e, t) {
        for (var n = null, i = 0; i < this[e].list.length; i++) {
          var r = this[e].list[i];
          if (r.name === t) {
            (n = r), (i = this[e].list.length);
            break;
          }
        }
        return n;
      },
    },
  }),
  Class("ObjectList").includes(CustomEventSupport)({
    prototype: {
      list: null,
      limit: null,
      init: function (e) {
        (this.list = e.list), (this.limit = e.limit);
      },
      add: function (e, t) {
        return (
          this.remove(e[t], t),
          this.list.push(e),
          this.list.length > this.limit ? this.list.shift() : null
        );
      },
      remove: function (e, t) {
        for (var n = this, i = 0; i < n.list.length; i++)
          n.list[i][t] === e && n.list.splice(i, 1);
      },
    },
  }),
  Module("TapEventSupport")({
    _touchStartHandler: null,
    prototype: {
      addTapEventSupport: function (e) {
        var t = this;
        (this._touchStartHandler = function (n) {
          t._touchEventListener(e, n);
        }),
          e.addEventListener("touchstart", this._touchStartHandler);
      },
      removeTapEventSupport: function (e) {
        e.removeEventListener("touchstart", this._touchStartHandler);
      },
      _touchEventListener: function (e, t) {
        var n = this,
          i = [],
          r = [];
        if (((i = t.touches), !(i.length > 1))) {
          var s = function () {},
            o = function () {
              return new Promise(function (t) {
                e.removeEventListener("touchend", s),
                  (s = function () {
                    t();
                  }),
                  e.addEventListener("touchend", s);
              });
            };
          r = [P.timeout(250), o()];
          var a = function () {
              e.removeEventListener("touchend", s), n.dispatch("tap", t);
            },
            l = function (t) {
              return (
                e.removeEventListener("touchend", s),
                "timeout" === t.message
                  ? t
                  : void setTimeout(function () {
                      throw new Error(t);
                    }, 10)
              );
            };
          return Promise.race(r).then(a)["catch"](l);
        }
      },
    },
  }),
  Module("DraggableSupport")({
    prototype: {
      setAsDraggable: function (e) {
        (this.$draggableEl = e.$draggableEl),
          (this.$control = e.$control),
          (this.$boundingEl = e.$boundingEl),
          this._setDefaultPosition(),
          this.$draggableEl.draggable({
            containment: this.$boundingEl,
            scroll: !1,
          }),
          this.restorePosition(this.$draggableEl);
      },
      _setDefaultPosition: function () {
        if (void 0 !== this.$control && void 0 !== this.$draggableEl) {
          var e = this.$control.offset().left - $("#container").offset().left,
            t = this.$control.offset().top - $("#container").offset().top;
          this.resetDefaultPosition(this.$draggableEl, e, t);
        }
      },
      restorePosition: function (e) {
        e.css("left", parseInt(e.attr("originx"))),
          e.css("top", parseInt(e.attr("originy")));
      },
      resetDefaultPosition: function (e, t, n) {
        void 0 !== e && (e.attr("originx", t), e.attr("originy", n));
      },
    },
  }),
  Class(
    UI,
    "AlgoliaSearch"
  )({
    _instance: null,
    getInstance: function () {
      return UI.AlgoliaSearch._instance
        ? UI.AlgoliaSearch._instance
        : ((UI.AlgoliaSearch._instance = new this()),
          UI.AlgoliaSearch._instance);
    },
    prototype: {
      APP_ID: window.algoliaConfig.appId,
      READ_API_KEY: window.algoliaConfig.readApiKey,
      TEMPLATE_INDEX: window.algoliaConfig.niceTemplatesIndex,
      ASSET_INDEX: window.algoliaConfig.niceAssetsIndex,
      algolia: null,
      templatesIndex: null,
      assetIndex: null,
      controls: null,
      queries: [],
      requests: [],
      stageData: [],
      layersCache: [],
      init: function () {
        (this.algolia = window.algoliasearch(
          window.algoliaConfig.appId,
          window.algoliaConfig.readApiKey,
          {
            timeouts: {
              connect: 1e3,
              read: 7e3,
              write: 3e4,
            },
          }
        )),
          (this.templatesIndex = this.algolia.initIndex(this.TEMPLATE_INDEX)),
          (this.assetIndex = this.algolia.initIndex(this.ASSET_INDEX));
      },
      initialize: function () {
        return Promise.resolve({});
      },
      _successGetControls: function (e) {
        var t = this;
        t.requests.forEach(function (n) {
          var i = t._getQuery(e, n);
          null === i
            ? n.resolve(t.buildResponseLayers())
            : ((n.query.filters = i.queryLayer),
              t.assetIndex
                .search(n.search, n.query)
                .then(function (e) {
                  n.successFn(e, i.querySelectedLayer);
                })
                ["catch"](function (e) {
                  n.reject(e);
                })),
            (n.done = !0);
        }),
          (t.requests = t.requests.filter(function (e) {
            return e.done !== !0;
          }));
      },
      changeSlide: function (e) {
        var t = this;
        return (
          (t.requests = []),
          (t.controls = null),
          (t.queries = []),
          new Promise(function (n, i) {
            t.getControls(e)
              .then(function (e) {
                t._successGetControls(e), n(e);
              })
              ["catch"](function (e) {
                i(e);
              });
          })
        );
      },
      _getQuery: function (e, t) {
        var n,
          i,
          r,
          s = this,
          o = null,
          a = "";
        if (0 === e.length) return null;
        var l = s.queries.find(function (e) {
          return e.propertyName === t.propertyName && e.position === t.position;
        });
        if (l && l.query) return l.query;
        (i = e.filter(function (e) {
          return e.propertyName === t.propertyName && e.position === t.position;
        })),
          (r = []),
          i.forEach(function (e) {
            r = r.concat(e.graphics);
          }),
          (n = t.selectedLayerId);
        var c = {
          graphics: r,
          selectedLayer: n,
        };
        return (
          (a = s.buildFilterByAssigned(c)),
          (o =
            "" === a
              ? null
              : {
                  queryLayer: a,
                  querySelectedLayer: n ? "id:" + n : null,
                }),
          s.queries.push({
            query: o,
            position: t.position,
            propertyName: t.propertyName,
          }),
          o
        );
      },
      buildFilterByAssigned: function (e) {
        var t = "";
        return (t =
          1 === e.graphics.length
            ? "id:" + e.graphics[0]
            : e.graphics
                .filter(function (t) {
                  return t !== e.selectedLayer;
                })
                .map(function (e) {
                  return "id:" + e;
                })
                .join(" OR "));
      },
      updateQuery: function (e, t) {
        this.queries.forEach(function (n) {
          n.position === e.position &&
            n.propertyName === e.propertyName &&
            (n.query = t);
        });
      },
      getControls: function (e) {
        var t = this,
          n = "",
          i = {
            filters: "templateID:" + e,
            distinct: 0,
            hitsPerPage: 1e3,
          };
        return new Promise(function (r, s) {
          var o = t.stageData.find(function (t) {
            return e === t.templateId;
          });
          void 0 === o
            ? t.templatesIndex
                .search(n, i)
                .then(function (n) {
                  var i = [];
                  n.hits.forEach(function (e) {
                    i.push({
                      position: e.position,
                      propertyName: e.propertyName,
                      graphics: e.graphics,
                      selectedLayer: e.selectedLayer,
                    });
                  }),
                    t.stageData.push({
                      templateId: e,
                      data: i,
                    }),
                    (t.controls = i),
                    r(t.controls);
                })
                ["catch"](function (e) {
                  s(e);
                })
            : ((t.controls = o.data), r(t.controls));
        });
      },
      getLayersByControl: function (e, t) {
        var n,
          i,
          r,
          s = this;
        (n = (t && t.search) || ""),
          (i = {}),
          (i.page = (t && t.page) || 0),
          (i.hitsPerPage = (t && t.perPage) || 30),
          (r = (e && e.selectedLayerId) || null);
        var o = s.buildResponseLayers();
        return new Promise(function (t, a) {
          if (
            "number" != typeof e.position ||
            "string" != typeof e.propertyName ||
            "" === e.propertyName
          )
            return void a({
              error: "all control params are requires",
              controlParams: e,
            });
          var l = s._buildRequest({
            propertyName: e.propertyName,
            position: e.position,
            search: n,
            query: i,
            selectedLayerId: r,
            resolve: t,
            reject: a,
          });
          if (null === s.controls) return void s.requests.push(l);
          var c = s._getQuery(s.controls, l);
          if (null === c) return void t(o);
          l.query.filters = c.queryLayer;
          var u = c.querySelectedLayer;
          s.assetIndex
            .search(n, l.query)
            .then(function (e) {
              l.successFn(e, u);
            })
            ["catch"](function (e) {
              a(e);
            });
        });
      },
      _buildRequest: function (e) {
        var t = this,
          n = e.resolve,
          i = e.reject;
        return (
          (e.successFn = function (r, s) {
            (r.searchTerm = e.search),
              1 === r.hits.length &&
                r.hits[0].id === e.selectedLayerId &&
                (r.hits = []);
            var o = t.buildResponseLayers(r);
            return "string" == typeof s
              ? void t.assetIndex.search(
                  "",
                  {
                    filters: s,
                  },
                  function (e, r) {
                    return e
                      ? void i(e)
                      : (r.hits.length > 0 &&
                          ((o.selectedLayer = r.hits[0]),
                          t.craftPaths(o.selectedLayer)),
                        void n(o));
                  }
                )
              : void n(o);
          }),
          e
        );
      },
      getLayers: function (e) {
        var t = this,
          n = null,
          i = [],
          r = [];
        return (
          e.forEach(function (e) {
            var n = t.layersCache.find(function (t) {
              return t.id === e;
            });
            void 0 === n ? r.push(e) : i.push(n);
          }),
          new Promise(function (s, o) {
            if (Array.isArray(e) !== !0)
              return void o({
                error: "layerIds is required",
              });
            if (r.length > 0) {
              n = r
                .map(function (e) {
                  return "id:" + e;
                })
                .join(" OR ");
              var a = AlgoliaClient.getAssetIndex();
              a.search("", {
                filters: n,
              })
                .then(function (e) {
                  e.hits.forEach(function (e) {
                    t.craftPaths(e);
                  }),
                    t.craftPaths(e.selectedLayer),
                    (t.layersCache = t.layersCache.concat(e.hits)),
                    (i = i.concat(e.hits)),
                    s(i);
                })
                ["catch"](function (e) {
                  o(e);
                });
            } else s(i);
          })
        );
      },
      changeSelectedLayer: function () {},
      buildResponseLayers: function (e) {
        var t = this;
        return (
          e &&
            (e.hits.forEach(function (e) {
              t.craftPaths(e);
            }),
            t.craftPaths(e.selectedLayer)),
          {
            data: (e && e.hits) || [],
            selectedLayer: (e && e.selectedLayer) || null,
            page: e && e.page,
            perPage: (e && e.hitsPerPage) || null,
            totalPages: (e && e.nbPages) || null,
            total: (e && e.nbHits) || null,
            searchTerm: e && e.searchTerm,
          }
        );
      },
      craftPaths: function (e) {
        if (e)
          switch (
            (delete e.objectID,
            delete e._highlightResult,
            Helpers.App.shouldPreferVideoAsset(e) && (e.assetType = "animated"),
            e.assetType)
          ) {
            case "image":
              (e.image = Helpers.App.isMobile()
                ? "/image_library/" + e.id + "/images/medium.jpg"
                : "/image_library/" + e.id + "/images/small.jpg"),
                (e.path = "image_library/" + e.id + "/image" + e.type);
              break;
            case "video":
              (e.image = "/video_library/" + e.id + "/images/small.jpg"),
                (e.video = "/video_library/" + e.id + "/videos/preview.mp4");
              break;
            case "animated":
              (e.image = Helpers.App.isMobile()
                ? "/image_library/" + e.id + "/images/medium.jpg"
                : "/image_library/" + e.id + "/images/small.jpg"),
                (e.video = "/image_library/" + e.id + "/animated_preview.mp4"),
                (e.assetType = "video");
          }
      },
      getLayer: function (e) {
        var t = this;
        return new Promise(function (n, i) {
          t.assetIndex
            .search("", {
              filters: "id:" + e,
            })
            .then(function (e) {
              return 0 === e.hits.length
                ? void n({})
                : (t.craftPaths(e.hits[0]), void n(e.hits[0]));
            })
            ["catch"](function (e) {
              i(e);
            });
        });
      },
      getLayersByGroups: function (e) {
        var t,
          n,
          i = this,
          r = "",
          s = "";
        return (
          (t = (e && e.search) || ""),
          (n = {}),
          (n.page = (e && e.page) || 0),
          (n.hitsPerPage = (e && e.perPage) || 30),
          (n.filters = ""),
          e.assetGroups &&
            (r = e.assetGroups
              .trim()
              .split(" ")
              .map(function (e) {
                return "assetGroups:" + e;
              })
              .join(" OR ")),
          e.selectedLayerId && "null" !== e.selectedLayerId
            ? ((n.filters = r + " AND NOT id:" + e.selectedLayerId),
              (s = r + " AND id:" + e.selectedLayerId))
            : (n.filters = r),
          new Promise(function (r, o) {
            i.assetIndex
              .search(t, n)
              .then(function (n) {
                (n.searchTerm = t),
                  e.selectedLayerId &&
                  "null" !== e.selectedLayerId &&
                  0 === e.page
                    ? i.assetIndex
                        .search(t, {
                          filters: s,
                        })
                        .then(function (e) {
                          e.hits.length > 0
                            ? ((n.selectedLayer = e.hits[0]),
                              i.craftPaths(n.selectedLayer),
                              n.hits.unshift(n.selectedLayer))
                            : (n.selectedLayer = null),
                            r(i.buildResponseLayers(n));
                        })
                    : ((n.selectedLayer = null), r(i.buildResponseLayers(n)));
              })
              ["catch"](function (e) {
                o(e);
              });
          })
        );
      },
    },
  }),
  Class(UI, "AssetsGrid")
    .inherits(Widget)
    .includes(
      BubblingSupport,
      CustomAssetSupport,
      GenericDestroySupport,
      CDNSupport
    )({
    html: '<div class="grid-container">            <div class="columns-container"></div>        </div>',
    BLANK_ITEM_NAME: "blankItem",
    prototype: {
      _columns: null,
      numberOfColumns: null,
      defaultNumberOfColumns: 2,
      separationBetweenColumns: 10,
      assetData: null,
      assets: null,
      search: null,
      allowBlankItem: !0,
      allowCustomUpload: !0,
      maxSize: null,
      videoMaxSize: null,
      acceptedFiles: null,
      previousValue: null,
      selected: null,
      selectedId: null,
      thumbs: null,
      blankItemText: "No Image",
      customUploadText: "Custom Video",
      popStateHandler: null,
      loading: !1,
      renderResolve: null,
      viewportData: null,
      fragmentDuration: null,
      excludeToRender: null,
      onlyGraphics: null,
      isMobile: null,
      columnsBreakpoints: null,
      canBeRender: !0,
      pendingThumbs: null,
      renderThumbTask: null,
      init: function (e) {
        this._initVariables(),
          Widget.prototype.init.call(this, e),
          (this.$gridContainer = this.element),
          (this.$columnsContainer = this.element.find(".columns-container")),
          (this.numberOfColumns = this._getNumberOfColumns()),
          this._initQueues()._createColumns(),
          this.addFooter(),
          this._initBlankItem(0),
          this._initCustomUpload(0),
          this.assets.length > 0 && this.set(e),
          this._bindings();
      },
      set: function (e) {
        return (
          (this.page = Number.isInteger(e.page) ? e.page : this.page),
          (this.perPage = Number.isInteger(e.perPage)
            ? e.perPage
            : this.perPage),
          (this.totalPages = Number.isInteger(e.totalPages)
            ? e.totalPages
            : this.totalPages),
          (this.selected = null === e.selected ? null : e.selected),
          (this.assets = Array.isArray(e.assets) ? e.assets : this.assets),
          this
        );
      },
      setInitValues: function () {
        null === this.selected &&
          this.allowBlankItem === !0 &&
          this._selectThumb(
            this.blankItem,
            {
              triggeredByUser: !1,
            },
            "setInitValues"
          ),
          this.isMobile === !0 &&
            (this.previousValue = $.extend({}, this.selected));
      },
      _initVariables: function () {
        return (
          (this.renderPromises = []),
          (this.pendingThumbs = []),
          (this.assets = []),
          (this._columns = []),
          (this.thumbs = []),
          (this.columnsBreakpoints = []),
          (this.excludeToRender = ["customGraphic", "customBg", "null"]),
          this
        );
      },
      _bindings: function () {
        window.addEventListener("popstate", this._popstateHandler.bind(this)),
          window.addEventListener("resize", this._rebuild.bind(this)),
          this.$gridContainer.bind(
            "scroll",
            this._scrollEventHandler.bind(this)
          ),
          this.bind("graphicClicked", this._clickItemHandler.bind(this)),
          this.bind(
            "repositionGraphicActivate",
            this._repositionGraphicEventHandler.bind(this)
          );
      },
      _repositionGraphicEventHandler: function (e) {
        var t, n;
        (t = e.data),
          (n = t.target),
          "ImageUploader" === n.constructor.className &&
            (n = n.customGraphicPreview),
          e.stopPropagation(),
          this.dispatch("repositionGraphic", {
            _target: n,
            layerName: this.record.name,
          });
      },
      _rebuild: function () {
        var e = this._getNumberOfColumns();
        if (e !== this.numberOfColumns) {
          this.numberOfColumns = e;
          var t = function (e) {
              if ("Cancelation Error" === e.message)
                return void console.warn("Cancel rebuild assets");
              throw e;
            },
            n = function (e) {
              var t = function () {
                return this.canBeRender === !0
                  ? this.renderAssets(e)
                  : Promise.resolve(e);
              };
              return (
                (this.rebuildAssetsTask = P.cancelable(t.bind(this, e))()),
                (this.rebuildCustomAssetTask = P.cancelable(
                  this._rebuildCustomUpload.bind(this)
                )()),
                P.allSettled([this.rebuildAssetsTask, this.rebuildAssetsTask])
              );
            },
            i = function () {
              var e = [],
                t = null;
              return (
                (t = this.selected && this.selected.id),
                (e = this.getThumbs().map(function (e) {
                  return e.record;
                })),
                t &&
                  (e = e.filter(function (e) {
                    return e.id !== t;
                  })),
                this.rebuildColumns(),
                Promise.resolve(e)
              );
            };
          this.cancelRebuildTask(),
            (this.delayTask = P.cancelable(P.delay)(250)),
            this.delayTask
              .then(i.bind(this))
              .then(n.bind(this))
              ["catch"](t.bind(this));
        }
      },
      rebuildColumns: function () {
        this.clearThumbs(),
          this.blankItem.destroy(),
          this.$columnsContainer.empty(),
          this._createColumns(),
          this._initBlankItem(0);
      },
      cancelRebuildTask: function () {
        this.rebuildAssetsTask &&
          (this.rebuildAssetsTask.cancel(), (this.rebuildAssetsTask = null)),
          this.rebuildCustomAssetTask &&
            (this.rebuildCustomAssetTask.cancel(),
            (this.rebuildCustomAssetTask = null)),
          this.delayTask && (this.delayTask.cancel(), (this.delayTask = null));
      },
      _rebuildCustomUpload: function () {
        var e,
          t = this,
          n = null,
          i = null;
        if (this.allowCustomUpload === !0) {
          i = this.selected && this.selected.id;
          var r = this[this.customType];
          return (
            (n = r.getGraphicRecord().record_hash),
            n || (n = r.getVideoRecord().record_hash),
            i && i.indexOf("custom") > -1 && (e = !0),
            r.destroy(),
            this._initCustomUpload(0),
            n
              ? this._getCustomAssetData(n)
                  .then(function (i) {
                    t._assetJSONDataCallback(n, e, i);
                  })
                  .then(function () {
                    return "endCustomAssetRender";
                  })
              : Promise.resolve("endCustomAssetRender")
          );
        }
      },
      _isAssetGridThumbSelected: function (e) {
        var t,
          n = "id";
        return (
          e.record.id.indexOf("custom") > -1 && (n = "record_hash"),
          (t = this.previousValue && this.previousValue[n]),
          t === e.record[n]
        );
      },
      _clickItemHandler: function (e) {
        var t = e.data.item,
          n = t.record;
        this._isAssetGridThumbSelected(t) !== !0 &&
          (this._selectThumb(
            t,
            {
              triggeredByUser: !0,
            },
            "_clickItemHandler"
          ),
          n.queryID &&
            AlgoliaAnalyticsClient.sendMulticontrolClickEvent(
              n.queryID,
              n.objectID,
              n.position
            ));
      },
      selectItem: function (e, t) {
        var n = this.getThumb(e.id);
        if (n && n.record.id === e.id)
          return (
            this._selectThumb(
              n,
              {
                triggeredByUser: !t,
                triggeredByPopState: t,
              },
              "selectItem"
            ),
            Promise.resolve(e)
          );
        var i = this._buildItem(e);
        return (
          this.appendChild(i),
          this._renderItem(i, 1, !0).then(function (e) {
            return e.record;
          })
        );
      },
      _renderItem: function (e, t, n) {
        var i = this;
        return e.requestImage().then(function () {
          return (
            e
              .bind("renderItem", function () {
                i._selectThumb(
                  e,
                  {
                    triggeredByUser: !1,
                    triggeredByPopState: !1,
                  },
                  "_renderItem"
                );
              })
              .render(i._columns[t], t, n),
            e
          );
        });
      },
      _selectThumb: function (e, t, n) {
        (null === e.record || "undefined" == typeof e.record) &&
          (console.warn("Thumb record: " + e.record, e),
          Helpers.GlobalEventTracker.noticeError("Thumb record:" + e.record, {
            method: n,
            image: e.image,
            itemName: e.itemName,
            hostname: e.hostname,
          }));
        var i,
          r = "id";
        return (
          e.record.id.indexOf("custom") > -1 && (r = "record_hash"),
          this.deselectAll(),
          this.hideThumbPreviews(e),
          e.select(),
          (e.selected = !0),
          (i = this.previousValue && this.previousValue[r]),
          (t.asset = this.selected),
          (t.item = e),
          (t.triggeredByPopState = !!t.triggeredByPopState),
          (t.triggeredByUser = !!t.triggeredByUser),
          (t.originalDispatcher = this),
          i === e.record[r]
            ? ("record_hash" === r &&
                ((this.selected = e.record),
                (this.previousValue = $.extend({}, this.selected)),
                this.dispatch("change", t)),
              this)
            : ((this.selected = e.record),
              (this.previousValue = $.extend({}, this.selected)),
              this.dispatch("change", t),
              this)
        );
      },
      setNoImage: function (e) {
        var t = this.children.filter(function (e) {
          return -1 === e.index;
        })[0];
        return void 0 === t
          ? this
          : (this.deselectAll(),
            t.select(),
            (t.selected = !0),
            (e.asset = this.selected),
            (e.item = t),
            (e.triggeredByPopState = !!e.triggeredByPopState),
            (e.triggeredByUser = !!e.triggeredByUser),
            (e.originalDispatcher = this),
            (this.selected = t.record),
            (this.previousValue = $.extend({}, this.selected)),
            this.dispatch("change", e),
            this);
      },
      _popstateHandler: function () {
        "function" == typeof this.popStateHandler && this.popStateHandler();
      },
      getAsset: function (e) {
        var t = this.getThumb(e);
        return void 0 !== t && void 0 !== t.record ? t.record : t;
      },
      getThumb: function (e) {
        return this.getThumbs().filter(function (t) {
          return t.record.id === e;
        })[0];
      },
      _scrollEventHandler: function () {
        var e = 0.9 * this.getMaxScroll();
        this.showMoreFader(),
          this.$gridContainer.scrollTop() > e && this.nextPage(),
          this.dispatch("scroll", {
            originalDispatcher: this,
          });
      },
      getAssets: function () {
        return this.assets;
      },
      cancelRendering: function () {
        return (
          (this.pendingThumbs = []),
          this.renderQueue.clear(),
          this.loadQueue.clear(),
          this.renderResolve &&
            (this.renderResolve.resolve("cancelRenderThumbs"),
            (this.renderResolve = null)),
          (this._renderThumbCallBack = function () {}),
          (this.renderOnDOM = function () {}),
          this.dispatch("cancelRender"),
          this
        );
      },
      stopRendering: function () {
        return (
          (this.pendingThumbs = this.renderQueue.clear()),
          (this.canBeRender = !1),
          this.dispatch("stopRender", {
            thumbs: this.pendingThumbs,
          }),
          this
        );
      },
      resumeRendering: function () {
        return (
          (this.canBeRender = !0),
          this.renderQueue.push(this.pendingThumbs),
          this.dispatch("resumeRender", {
            thumbs: this.pendingThumbs,
          }),
          this
        );
      },
      renderAssets: function (e) {
        var t = Array.isArray(e) === !0 && e.length > 0;
        t === !0 && (this.assets = e);
        var n = [].concat(this.assets),
          i = this.selected && this.selected.id,
          r = this.excludeToRender.indexOf(i) > -1;
        return (
          this.getThumbSelected() ||
            null === i ||
            r !== !1 ||
            n.unshift(this.selected),
          this._renderAssets(n)
        );
      },
      renderSelectedAsset: function (e) {
        var t, n, i, r, s;
        return (
          (t = this),
          (n = e && e.id),
          (i = 1),
          ("undefined" !== t.getThumbSelected() &&
            this.isLibraryAsset(n) === !0) == !1
            ? Promise.resolve(null)
            : ((r = t._buildItem(e)),
              r.bind("destroy", function () {
                t.cancelRenderThumbTask();
              }),
              (s = P.cancelable(function (e) {
                return t.requestThumbResource(e);
              })),
              (this.renderThumbTask = s(r)),
              this.renderThumbTask
                .then(function () {
                  return (
                    t.appendChild(r).render(t._columns[i], i),
                    t._selectThumb(
                      r,
                      {
                        triggeredByUser: !1,
                        triggeredByPopState: !1,
                      },
                      "renderSelectedAsset"
                    ),
                    r
                  );
                })
                ["catch"](function (e) {
                  if ("Cancelation Error" === e.message)
                    return console.warn("Cancelation Error"), e;
                  throw new Error(e);
                }))
        );
      },
      cancelRenderThumbTask: function () {
        null !== this.renderThumbTask &&
          (this.renderThumbTask.cancel(), (this.renderThumbTask = null));
      },
      _renderAssets: function (e) {
        var t = this;
        if (0 === e.length)
          return this.hideLoader(), Promise.resolve("no assets");
        var n = e.map(function (e, n) {
          var i = t._buildItem(e, n);
          return t.appendChild(i), i;
        });
        return (
          t.dispatch("startRender", {
            thumbs: n,
          }),
          new Promise(function (e, i) {
            (t.renderResolve = {
              resolve: e,
              reject: i,
            }),
              t.renderQueueProcess(n, t.renderResolve);
          })
        );
      },
      _buildItem: function (e, t) {
        var n,
          i,
          r,
          s,
          o = !1;
        (n = {
          video: "_buildVideoItem",
          animated: "_buildVideoItem",
          image: "_buildGraphicItem",
        }),
          (r = this.selected && this.selected.id),
          (s = t),
          (null === s || "undefined" == typeof s) &&
            (s = this.getThumbs().length),
          r === e.id && (o = !0);
        var a = "";
        e.hasAnimated && (a = " double-version-item "),
          (i = {
            itemName: e.name,
            name: "graphicItem_" + (s + 2),
            record: e,
            index: s,
            parentName: this.name,
            loaded: !1,
            rendered: !1,
            selected: o,
            cssClass: "multi_item" + a,
            hostname: this._cdnBasePath(),
            fragmentDuration: this.fragmentDuration,
            viewportData: this._getViewportData(),
            excludeTrimmer:
              this.record.allowTrimmer === !1 || e.allowTrimmer === !1,
          });
        var l = this[n[e.assetType]].call(this, i);
        if (Helpers.StageType.getStageInfo().is_free && e.isPremium) {
          var c = new UI.SmartTemplate.AssetPremiumBadge();
          c.render(l.element), l.appendChild(c);
        }
        return l;
      },
      _buildVideoItem: function (e) {
        return (
          (e.cssClass += " video_item hidden_after"),
          new UI.SmartTemplate.VideoItem(e)
        );
      },
      _buildGraphicItem: function (e) {
        return (
          this.onlyGraphics === !1 &&
            (e.record.image =
              "/image_library/" + e.record.id + "/images/medium.jpg"),
          (e.cssClass += " multi_item graphic_item"),
          new UI.SmartTemplate.GraphicItem(e)
        );
      },
      shortestColumn: function () {
        var e = this._columns.map(function (e) {
          return e.height();
        });
        return e.indexOf(
          e.reduce(function (e, t) {
            return Math.min(e, t);
          })
        );
      },
      _getNumberOfColumns: function () {
        var e = window.innerWidth;
        if (Array.isArray(this.columnsBreakpoints) === !0) {
          var t = this.columnsBreakpoints.filter(function (t) {
            return e >= t.min && e <= t.max;
          })[0];
          if (t && t.columns) return t.columns;
        }
        return this.defaultNumberOfColumns;
      },
      _createColumns: function () {
        var e,
          t,
          n = this,
          i = document.createDocumentFragment();
        this._columns = [];
        for (var r = 0; r < n.numberOfColumns; r++)
          (e = document.createElement("div")),
            e.classList.add("column", "column-" + (r + 1)),
            (e.style.width =
              "calc((100% / " +
              n.numberOfColumns +
              ") - " +
              n.separationBetweenColumns / 2 +
              "px)"),
            (e.style.maxWidth = "unset"),
            (e.style.boxSizing = "border-box"),
            (e.style.margin = 0),
            (t = document.createElement("ul")),
            t.classList.add("list"),
            e.appendChild(t),
            i.appendChild(e),
            n._columns.push($(t));
        return (
          n.$columnsContainer.css({
            display: "flex",
            "justify-content": "space-between",
          }),
          n.$columnsContainer[0].appendChild(i),
          n
        );
      },
      _initQueues: function () {
        return (
          (this.loadQueue = new SmartQueue({
            actionName: "load",
            minConsumers: 2,
            maxConsumers: 8,
            itemsPerConsumer: 1,
          })),
          (this.renderQueue = new SmartQueue({
            actionName: "render",
            minConsumers: 1,
            maxConsumers: 1,
            itemsPerConsumer: 1,
          })),
          this
        );
      },
      renderQueueProcess: function (e, t) {
        var n = this,
          i = e.map(function (e) {
            return {
              item: e,
              promise: n._requestRunner(n.requestThumbResource(e)),
              load: function (e) {
                this.promise.run(), this.promise.then(e);
              },
              render: function (e) {
                this.promise.then(n._renderOnDOM.bind(n, e, t));
              },
            };
          });
        n.loadQueue.push([].concat(i)), n.renderQueue.push([].concat(i));
      },
      _requestRunner: function (e) {
        var t,
          n = {};
        return (
          (t = new Promise(function (e, t) {
            (n.resolve = e), (n.reject = t);
          })),
          (t.run = function () {
            e.then(n.resolve)["catch"](n.reject);
          }),
          t
        );
      },
      requestThumbResource: function (e) {
        return new Promise(function (t) {
          e.requestImage()
            .then(function (n) {
              (e.imgNaturalHeight = n.height),
                (e.imgNaturalWidth = n.width),
                t(e);
            })
            ["catch"](function (n) {
              var i = {
                message: "Asset image load fail",
                assetURL: n.src,
                assetId: e.record.id,
              };
              Helpers.GlobalEventTracker.imageLoadFail(i),
                t(e),
                console.warn(i);
            });
        });
      },
      _renderOnDOM: function (e, t, n) {
        if (!n.record || !n.element) return void e();
        var i = this,
          r = i.shortestColumn(),
          s = i._columns[r],
          o = s.width(),
          a = (n.imgNaturalHeight / n.imgNaturalWidth) * o;
        n.setSize(o, a),
          n.render(s),
          n.selected === !0 &&
            (i._selectThumb(
              n,
              {
                triggeredByUser: !1,
              },
              "_renderOnDOM"
            ),
            n.showVideoPreview()),
          0 === i.renderQueue.size() && i._endRenderHandler(t),
          i._renderTask && (i._renderTask.cancel(), (i._renderTask = null)),
          (i._renderTask = P.cancelable(P.delay)(100)),
          i._renderTask
            .then(n.setSize.call(n, "auto", "auto"))
            .then(e)
            ["catch"](function (t) {
              if ((e(), "Cancelation Error" === t)) return void console.warn(t);
              throw new Error(t);
            });
      },
      _endRenderHandler: function (e) {
        if (this.canBeRender !== !1) {
          this.hideLoader();
          var t = this.$columnsContainer.height(),
            n = this.element.find(".footer-layers").height(),
            i = this.element.height();
          i >= t + n && this.totalPages > 1 && this.nextPage();
          var r = 0;
          this.element.find(".footer-layers").length > 0 &&
            (r = this.element.find(".footer-layers").height()),
            this.$columnsContainer.height() + r >
              this.$gridContainer.height() && this.showMoreFader(),
            e.resolve("endRender"),
            (this.renderResolve = null),
            this.dispatch("endRender");
        }
      },
      _initBlankItem: function (e) {
        if (this.allowBlankItem === !1 || this.excludable === !1) return this;
        var t = new UI.SmartTemplate.GraphicItem({
          name: this.constructor.BLANK_ITEM_NAME,
          text: this.blankItemText,
          record: {
            id: "null",
            image: null,
          },
          index: -1,
          cssClass: "graphic_item none_option",
        }).render(this._columns[e]);
        return (e = (e + 1) % this.numberOfColumns), this.appendChild(t), this;
      },
      nextPage: function () {
        var e = this;
        if (e.loading !== !0) {
          if (e.page + 1 >= e.totalPages)
            return (
              this.hideMoreFader(),
              void this.element.find(".item-contact-info").show()
            );
          e.page++,
            e.dispatch("pageChange", {
              pagination: this.getPagination(),
            });
        }
      },
      getPagination: function () {
        return {
          page: this.page,
          totalPages: this.totalPages,
          perPage: this.perPage,
        };
      },
      getMaxScroll: function () {
        return (
          this.$columnsContainer.outerHeight() - this.$gridContainer.height()
        );
      },
      showMoreFader: function () {
        var e,
          t,
          n = 0,
          i = this.element.find(".footer-layers");
        return (
          i.length > 0 && (n = i.height()),
          this.$columnsContainer.height() + n < this.$gridContainer.height()
            ? this
            : ((e = this.$gridContainer.find(".more-fader")),
              (t = '<div class="more-fader"></div>'),
              this.$columnsContainer.innerHeight() >
                this.$gridContainer.innerHeight() &&
                0 === e.length &&
                this.$gridContainer.append(t),
              this)
        );
      },
      hideMoreFader: function () {
        var e;
        return (e = this.$gridContainer.find(".more-fader")), e.remove(), this;
      },
      showLoader: function () {
        return (
          (this.loading = !0),
          this.element.find(".footer-layers .layer-spinner").show(),
          this.element.find(".item-contact-info").hide(),
          this
        );
      },
      hideLoader: function () {
        return (
          (this.loading = !1),
          this.element.find(".footer-layers .layer-spinner").hide(),
          this.element.find(".item-contact-info").show(),
          this
        );
      },
      deselectAll: function () {
        var e = ["GraphicItem", "VideoItem", "ImageUploader"];
        return (
          this.children.forEach(function (t) {
            -1 !== e.indexOf(t.constructor.className) &&
              ("ImageUploader" === t.constructor.className
                ? (t.customGraphicPreview.deselect(),
                  t.customVideoPreview.deselect())
                : t.deselect(),
              (t.selected = !1));
          }),
          this
        );
      },
      clearThumbs: function () {
        return (
          this.getThumbs().forEach(function (e) {
            e.destroy();
          }),
          this
        );
      },
      getThumbs: function () {
        var e = ["GraphicItem", "VideoItem", "ImageUploader"];
        return this.children.filter(function (t) {
          return e.indexOf(t.constructor.className) > -1 && t.index > -1;
        });
      },
      getThumbSelected: function () {
        var e = this,
          t = e.selected && e.selected.id;
        return this.children.filter(function (e) {
          return e.record.id === t;
        })[0];
      },
      addFooter: function () {
        var e = $(
          '<div class="footer-layers">                                <div class="layer-spinner" style="display: none;"></div>                                <p class="item-contact-info">Don"t see what you need? <br><a href="mailto:hi@placeit.net?subject=Please add more assets like this...">Let us know!</a></p>                            </div>'
        );
        return this.element.append(e), this;
      },
      getColumnsContainerHeight: function () {
        return this.$columnsContainer.height();
      },
      destroy: function () {
        this.cancelRendering(),
          this.cancelRebuildTask(),
          this.cancelGetCustomAssetDataTask(),
          this.cancelRenderThumbTask(),
          this.genericDestroy();
      },
      hideThumbPreviews: function (e) {
        var t = this;
        t.children.forEach(function (t) {
          t.video && t.name !== e.name && t.mouseleaveHandler();
        }),
          t.customImageUploader.hasVideoPreview() &&
            "customVideoPreview" !== e.name &&
            t.customImageUploader.hideVideoPreview();
      },
      clearVideos: function () {
        var e = this;
        e.children.forEach(function (e) {
          e.video && e.mouseleaveHandler();
        });
      },
      isLibraryAsset: function (e) {
        return "string" == typeof e &&
          e.length > 0 &&
          ("null" !== e) == !0 &&
          "customGraphic" !== e
          ? !0
          : !1;
      },
    },
  }),
  Class(UI, "AssetsSearch").inherits(Widget).includes(BubblingSupport)({
    html: ' <div class="form-group search-container">                <input type="text" class="img-search-box textbox form-control" placeholder="Search">                <span id="searchClear" class="glyphicon glyphicon-remove-circle clear-search hidden"></span>            </div>',
    prototype: {
      _timeouts: null,
      _initialValue: "",
      _pendingChange: null,
      value: "",
      caseSensitivity: !1,
      placeholder: "",
      debounceTime: null,
      init: function (e) {
        (this._timeouts = []),
          Widget.prototype.init.call(this, e),
          (this.$input = this.element.find("input.img-search-box")),
          (this.$clearSearchBtn = this.element.find(".clear-search")),
          this.setInput(),
          this._bindings();
      },
      setInput: function () {
        this.value && (this.$input.val(this.value), this.showClearButton()),
          this.placeholder && this.$input.attr("placeholder", this.placeholder);
      },
      _bindings: function () {
        var e = this;
        this.$input.bind("input", this._changeHandler.bind(this)),
          this.$input.bind("focus", this._focusHandler.bind(this)),
          this.$input.bind("blur", this._blurHandler.bind(this)),
          this.$input.bind("touchstart", this._touchStartHandler.bind(this)),
          this.$clearSearchBtn.bind("click", function () {
            e._clickHandler();
          });
      },
      _touchStartHandler: function () {
        this.dispatch("touchstart", {
          originalDispatcher: this,
        });
      },
      _focusHandler: function () {
        this.dispatch("focus", {
          originalDispatcher: this,
        });
      },
      _blurHandler: function () {
        this.dispatch("blur", {
          originalDispatcher: this,
        });
      },
      _changeHandler: function () {
        this._matchPreviousText() || this._debounceChange(!0);
      },
      _clickHandler: function () {
        this.clear(), this.hideClearButton();
      },
      _change: function (e) {
        (this.value = this.getValue()),
          this.isDirty() ? this.showClearButton() : this.hideClearButton(),
          this.dispatch("change", {
            value: this.value,
            triggeredByUser: e,
            originalDispatcher: this,
          });
      },
      getValue: function () {
        return this.caseSensitivity === !0
          ? this.$input.val()
          : this.$input.val().toLowerCase();
      },
      setValue: function (e) {
        this.$input.val(e), this._change(!1);
      },
      _debounceChange: function (e) {
        return null === this.debounceTime
          ? void this._change(e)
          : (this._pendingChange && clearTimeout(this._pendingChange),
            (this._pendingChange = setTimeout(
              function () {
                this._change(e);
              }.bind(this),
              this.debounceTime
            )),
            this._timeouts.push(this._pendingChange),
            this);
      },
      _matchPreviousText: function () {
        return this.caseSensitivity === !0
          ? this.value === this.$input.val()
          : this.value.toLowerCase() === this.$input.val().toLowerCase();
      },
      triggerFocus: function () {
        this.isFocus() !== !0 && this.$input.focus();
      },
      triggerBlur: function () {
        this.isFocus() !== !1 && this.$input.blur();
      },
      clear: function () {
        this.$input.val(""), this._debounceChange(!0);
      },
      isFocus: function () {
        return this.$input.is(":focus");
      },
      isDirty: function () {
        return this.$input.val().length > 0;
      },
      showClearButton: function () {
        this.$clearSearchBtn.removeClass("hidden");
      },
      hideClearButton: function () {
        this.$clearSearchBtn.addClass("hidden");
      },
    },
  }),
  Class(UI, "BasePage").inherits(Widget)({
    supTitleHTML: "<sup>Ready Instantly!</sup>",
    prototype: {
      isTagPage: !1,
      isCategoryPage: !1,
      heroPushTimeout: null,
      youtubeAPILoaded: !1,
      youTubePlayer: null,
      bindFilter: !1,
      filterDropdown: null,
      detached: !1,
      $navbarMain: null,
      init: function (e) {
        Widget.prototype.init.call(this, e),
          (this.$window = $(window)),
          (this.$navbarMain = $(".navbar-main")),
          (this.navbar = $(".navbar-container")),
          (this.subNavbar = $(".navbar-container .sub-navbar")),
          (this.windowHeight = this.$window.height()),
          (this.elementParent = this.element.parent()),
          (this.filterBar = this.element.find(".homepage-filter")),
          (this.mobileFilterBtn = this.filterBar.find(".dropdown-toggle")),
          (this.mobileFilterInner = this.filterBar.find(
            "ul.dropdown-menu.inner:not(#additional-tags):not(#additional-devices)"
          )),
          (this.desktopDropdown = this.filterBar.find(".dropdown-menu.open")),
          (this.gridContainer = this.element.find(
            ".gridalicious__grid-wrapper"
          )),
          (this.paginationElement = $(".pagination")),
          (this.supTitleHTML = $(this.constructor.supTitleHTML)),
          (this.playerBtn = this.element.find(".intro-play-button")),
          (this.linksIndexWrapper = this.element.find("#links-index")),
          (this.loadingUI = function () {
            return !1;
          }),
          (this.loadedUI = function () {
            return !1;
          }),
          this.filterBar.get(0) &&
            this.appendChild(
              new UI.Filters({
                name: "filters",
                element: this.filterBar,
              })
            ),
          this.filtersOff && this.filterBar.hide(),
          this.paginationElement.get(0) &&
            this.appendChild(
              new UI.Pagination({
                name: "paginator",
                element: this.paginationElement,
              })
            );
      },
      _bindings: function () {
        this.$window.resize(
          function () {
            (this.windowHeight = this.$window.height()), this.checkOffsets();
          }.bind(this)
        ),
          this.playerBtn.click(
            function () {
              this.showSignupForm();
            }.bind(this)
          ),
          this.$window.scroll(
            function () {
              return this.checkOffsets(), !1;
            }.bind(this)
          );
      },
      hide: function () {
        return (
          (this.bindFilter = !1),
          (this.detached = !0),
          this.element.detach(),
          this.thumbnailList &&
            (this.thumbnailList.stopCurrentProcess().clearData(),
            this.removeChild(this.thumbnailList)),
          (document.getElementsByTagName("html")[0].style.overflow = ""),
          this
        );
      },
      showSignupForm: function () {
        return this.isTagPage === !0 ? this : (this._handleHeroPush(), this);
      },
      hideSignupForm: function () {
        return this.isTagPage === !0 ? this : (this._handleHeroPush(), this);
      },
      playIntroVideo: function () {
        return this.isTagPage === !0 ? this : this;
      },
      stopIntroVideo: function () {
        return this.isTagPage === !0 ? this : this;
      },
      applyFiltered: function (e, t) {
        return (
          this.thumbnailList.renderThumbnailsByStages(e.matches),
          this.filterDropdown.setCountersByFilter(e.counts, t),
          this.showElementsInViewport().checkOffsets(),
          this
        );
      },
      handleFilterOverflow: function () {
        this.classList.contains("open")
          ? document
              .getElementsByClassName("page-container homepage")[0]
              .classList.remove("filter-no-overflow")
          : document
              .getElementsByClassName("page-container homepage")[0]
              .classList.add("filter-no-overflow");
      },
      createFilterBar: function (e) {
        var t;
        return (
          (this.bindFilter = !0),
          null !== this.filterDropdown
            ? this
            : (e.appendTo(this.filterBar),
              this.appendChild(
                new UI.FilterDropdown({
                  name: "filterDropdown",
                  element: e,
                  type: "devices",
                  hasAllOption: !0,
                  areAllUnactive: !0,
                })
              ),
              this.filterDropdown
                .bind(
                  "sidebar:filter",
                  function (e) {
                    var t = e.data;
                    this._filterHandler(e),
                      null !== this.linksIndexWrapper &&
                        (t.types.length > 0 ||
                          t.devices.length > 0 ||
                          t.tags.length > 0) &&
                        (this.linksIndexWrapper.remove(),
                        (this.linksIndexWrapper = null)),
                      this.thumbnailList.resetConfig(t);
                  }.bind(this)
                )
                .refresh(),
              (t = this.filterBar
                .find(".bootstrap-select")
                .bind("scroll", function (e) {
                  return e.stopPropagation(), !1;
                })
                .bind("mouseenter", function () {
                  this.scrollTop += 0;
                })),
              Helpers.App.isMobile() &&
                t.bind("mouseup", this.handleFilterOverflow),
              this.showElementsInViewport().checkOffsets(),
              this)
        );
      },
      selectFilters: function (e) {
        return (
          this.bindFilter === !0 &&
            e.length > 0 &&
            this.filterDropdown &&
            this.filterDropdown.selectOptionsForFilters(e).filter(),
          this
        );
      },
      showAllThumbnails: function () {
        this.bindFilter === !0 &&
          this.filterDropdown &&
          this.filterDropdown.selectAll().filter();
      },
      _filterHandler: function (e) {
        return this.dispatch("sidebar:filter", e.data), this;
      },
      _handleHeroPush: function () {
        return (
          this.heroPushTimeout && clearTimeout(this.heroPushTimeout),
          this.filterBar.addClass("hero-pushing"),
          (this.heroPushTimeout = setTimeout(
            function () {
              this.showElementsInViewport().checkOffsets(),
                this.filterBar.removeClass("hero-pushing");
            }.bind(this),
            600
          )),
          this
        );
      },
      checkOffsets: function () {
        var e;
        (e = 0),
          Helpers.App.isMobile() || (e = this.$navbarMain.outerHeight()),
          Helpers.App.elementFixedOnScroll(this.filterBar, e);
        var t, n, i, r;
        (t =
          0 !== this.gridContainer.length
            ? this.gridContainer.offset().top
            : 0),
          (i = t),
          (r = 0);
        var s = 0;
        if (this.$window.width() < 1024) {
          (i = 0), (n = "relative");
          var o = t - $(window).scrollTop();
          (o = 0 > o ? 0 : o),
            (s = Helpers.App.isIOSSafari()
              ? this.$window.height() - o - 85
              : this.$window.height() -
                o -
                this.mobileFilterBtn.outerHeight(!0) -
                20),
            this.mobileFilterInner.css("max-height", s);
        } else this.desktopDropdown.css("height", "auto");
        return !1;
      },
      showElementsInViewport: function () {
        return this;
      },
      loadEllipsis: function () {
        var e, t;
        return (
          document.querySelectorAll(
            '[src="' + window._pl_clampPluginPath + '"]'
          ).length < 1 &&
            ((e = document.createElement("script")),
            (t = document.getElementsByTagName("head")[0]),
            (e.src = window._pl_clampPluginPath),
            t.appendChild(e)),
          this
        );
      },
      showCouponText: function () {
        var e,
          t = $("#heading-title"),
          n = $("#heading-subtitle"),
          i = t.html(),
          r = n.html();
        return (
          this.supTitleHTML.hide(),
          t.html(
            'Pick from one of the stages below<span style="font-size: 0.6em;">\u2193</small>'
          ),
          n.text(
            "Your discount will be applied when you buy an image or subscription!"
          ),
          (e = function () {
            this.supTitleHTML.show(),
              t.html(i),
              n.html(r),
              this.body.off("scroll", e);
          }.bind(this)),
          this.body.on("scroll", e),
          this
        );
      },
    },
  }),
  Class(UI, "Bookmark").inherits(Widget)({
    BOOKMARK_BUTTON:
      '<div class="bookmark hvr-grow bookmark-off">                        <button></button>                    </div>',
    prototype: {
      stageId: null,
      isBookmarked: !1,
      bookmarkAfterLogin: !1,
      bookmarkingNotSupported: !1,
      setParent: function (e) {
        return (
          null === e
            ? this.parent && this.parent.element.removeClass("bookmarkable")
            : e.element.addClass("bookmarkable"),
          Widget.prototype.setParent.call(this, e),
          this
        );
      },
      init: function (e) {
        Widget.prototype.init.call(this, e);
        var t = this;
        return (
          (t.isBookmarked = "true" === t.element.attr("data-bookmarked")),
          (t.stageId = t.element.attr("data-stage-id")),
          t.element.hasClass("type-list") || !t.stageId
            ? void (t.bookmarkingNotSupported = !0)
            : ((t.$button = $(UI.Bookmark.BOOKMARK_BUTTON)),
              t.$button.click(t._clickHandler.bind(t)),
              t.element.append(this.$button),
              void t._setBookmarkedStyle(t.isBookmarked))
        );
      },
      _setBookmarkedStyle: function (e) {
        var t = this;
        e
          ? t.$button.removeClass("bookmark-off").addClass("bookmark-on")
          : t.$button.removeClass("bookmark-on").addClass("bookmark-off");
      },
      _clickHandler: function (e) {
        var t = this;
        return (
          e.preventDefault(),
          e.stopPropagation(),
          Helpers.App.isLoggedIn()
            ? void t.setBookmarked(t.isBookmarked ? !1 : !0)
            : (t.dispatch("notLoggedIn"),
              (t.bookmarkAfterLogin = !0),
              void page.appNavBar.ssoModal.activate())
        );
      },
      _isBookmarksPage: function () {
        return $(".page-container.bookmarks").length > 0;
      },
      afterLogin: function (e) {
        this.bookmarkingNotSupported ||
          ((e = !!e),
          (this.isBookmarked = e),
          this._setBookmarkedStyle(e),
          this.element.attr("data-bookmarked", e));
      },
      afterLogout: function () {
        this.bookmarkingNotSupported ||
          ((this.isBookmarked = !1),
          this.element.attr("data-bookmarked", !1),
          this._setBookmarkedStyle(!1));
      },
      setBookmarked: function (e) {
        var t,
          n,
          i,
          r,
          s,
          o = this;
        o.bookmarkingNotSupported ||
          ((t = Helpers.App.getUser().id),
          (n = o.stageId),
          (s = "/bookmarks/" + n),
          (i = {
            user: t,
            stage: n,
          }),
          (r = e ? "POST" : "DELETE"),
          $.ajax({
            url: s,
            type: r,
            success: function (t) {
              var n = Helpers.App.getBookmarksCount() || 0;
              o._setBookmarkedStyle(e),
                (o.isBookmarked = e),
                o.element.attr("data-bookmarked", e),
                window.page &&
                  window.page.dispatch &&
                  (o.isBookmarked
                    ? ((i.tags = t.tags.join(",")),
                      Helpers.GlobalEventTracker.track(
                        "BookmarkedStageEvent:Bookmark",
                        i
                      ),
                      Helpers.App.setBookmarksCount(++n),
                      window.page.dispatch("user-has-bookmarks", !0))
                    : (Helpers.GlobalEventTracker.track(
                        "BookmarkedStageEvent:Unbookmark",
                        i
                      ),
                      Helpers.App.setBookmarksCount(--n),
                      0 === n &&
                        window.page.dispatch("user-has-bookmarks", !1)),
                  (window._pl_numberOfBookmarks = n)),
                o._isBookmarksPage() &&
                  o.isBookmarked === !1 &&
                  o.element.fadeOut(400, function () {
                    o.parent.parent.element.gridalicious("resize", !0);
                  });
            },
            error: function () {
              (i.method = r),
                (i.url = s),
                (o.bookmarkingNotSupported = !0),
                o.$button.hide(),
                Helpers.GlobalEventTracker.track("bookmark:errorOnRequest", i);
            },
          }));
      },
    },
  }),
  Class("ButtonPopover").inherits(Widget).includes(BubblingSupport)({
    html: "<button></button>",
    elementClass: "button-widget",
    prototype: {
      contentPopover: null,
      content: null,
      popoverContainer: "body",
      typeTriggerPopover: "hover",
      popoverPosition: "top",
      disabled: !1,
      type: "button",
      isPopoverVisible: !1,
      pendingChangeContentPopover: null,
      isMouseOver: !1,
      cssClassPopover: null,
      init: function (e) {
        Widget.prototype.init.call(this, e),
          this.element.attr("type", this.type),
          this.content && this.element.html(this.content),
          this.contentPopover && this._buildPopover(),
          this.bindings();
      },
      bindings: function () {
        var e = this;
        this.element.bind("click", function () {
          e.disabled !== !0 && e.dispatch("click");
        }),
          this.element.bind("mouseenter", function () {
            e.showPopover(), (e.isMouseOver = !0), e.dispatch("mouseenter");
          }),
          this.element.bind("mouseleave", function () {
            e.hidePopover(), (e.isMouseOver = !1), e.dispatch("mouseleave");
          });
      },
      _buildPopover: function () {
        var e = this,
          t = $("<div>" + this.contentPopover + "</div>");
        e.cssClassPopover && t.addClass(e.cssClassPopover),
          this.element.popover({
            html: !0,
            content: t,
            container: this.popoverContainer,
            trigger: this.typeTriggerPopover,
            placement: this.popoverPosition,
          }),
          this.element.on("shown.bs.popover", function () {
            (e.isPopoverVisible = !0), e.dispatch("showPopover");
          }),
          this.element.on("hidden.bs.popover", function () {
            (e.isPopoverVisible = !1),
              e.pendingChangeContentPopover &&
                e.changeContentPopover(e.pendingChangeContentPopover),
              e.dispatch("hidePopover");
          });
      },
      changeContentPopover: function (e) {
        if (this.contentPopover !== e) {
          if (this.isPopoverVisible === !0)
            return void (this.pendingChangeContentPopover = e);
          (this.pendingChangeContentPopover = null),
            (this.contentPopover = e),
            this.element.popover("destroy"),
            this._buildPopover();
        }
      },
      showPopover: function (e, t) {
        return this.contentPopover
          ? (this.element.popover("show"),
            Number.isInteger(e) &&
              setTimeout(function () {
                "function" == typeof t && t();
              }, e),
            this)
          : this;
      },
      hidePopover: function () {
        return this.contentPopover
          ? (this.element.popover("hide"), this)
          : this;
      },
      startLoading: function () {
        return this.element.addClass("loading"), this;
      },
      endLoading: function () {
        return this.element.removeClass("loading"), this;
      },
      enable: function () {
        return (this.disabled = !1), this.element.removeClass("disabled"), this;
      },
      disable: function () {
        return (this.disabled = !0), this.element.addClass("disabled"), this;
      },
    },
  }),
  "undefined" == typeof UI && (window.UI = {}),
  Class(UI, "AudioTags")
    .inherits(Widget)
    .includes(
      CustomEventSupport,
      BubblingSupport,
      GenericDestroySupport
    )({
    hiddenItemsHTML:
      '<li class="audio-tag-show-more">            <a class="tag">&#9662;</a>            <div class="tags-box">                <div class="tags-dropdown"></div>            </div>        </li>',
    mouseLeaveDelay: 500,
    maxVisibleTags: 2,
    prototype: {
      items: [],
      hiddenItems: [],
      closeTimeout: null,
      $tagsContainer: null,
      $tagShowMore: null,
      init: function (e) {
        Widget.prototype.init.call(this, e);
        var t = this;
        (t.items = []),
          (t.hiddenItems = []),
          (t.$tagsContainer = {}),
          (t.closeTimeout = null),
          (t.$tagShowMore = null),
          (t.$tagsContainer = t.element.find(".tags-list")),
          t._setupTags(e.tags);
      },
      _setupTags: function (e) {
        var t = this,
          n = t.maxVisibleTags
            ? t.maxVisibleTags
            : t.constructor.maxVisibleTags;
        if (e.length) {
          t.element.on("click", "[data-tag]", t._handleTagClick.bind(t)),
            Helpers.App.isMobile() && t.$tagsContainer.addClass("is-mobile"),
            e.length > n &&
              ((t.$tagShowMore = $(t.constructor.hiddenItemsHTML)),
              (t.$hiddenTagsContainer = t.$tagShowMore.find(".tags-dropdown")),
              (t.hiddenItems = []),
              t.$tagShowMore.mouseenter(function () {
                t.$tagShowMore.addClass("is-open"),
                  clearTimeout(t.closeTimeout),
                  (t.closeTimeout = null);
              }),
              t.$tagShowMore.mouseleave(function () {
                t.closeTimeout = setTimeout(function () {
                  t.$tagShowMore.removeClass("is-open");
                }, t.constructor.mouseLeaveDelay);
              }));
          for (var i = 0; i < e.length; i++) {
            var r = e[i],
              s = $(
                '<li><a class="tag" data-tag="' +
                  r +
                  '" title="' +
                  r +
                  '" >' +
                  r +
                  "</a></li>"
              );
            n > i
              ? (t.$tagsContainer.append(s), t.items.push(s))
              : (t.$hiddenTagsContainer.append(s), t.hiddenItems.push(s));
          }
          t.$tagsContainer.append(t.$tagShowMore);
        }
      },
      _handleTagClick: function (e) {
        var t = $(e.target).attr("data-tag");
        this.dispatch("tagclicked", {
          tag: t,
        });
      },
      destroy: function () {
        clearTimeout(this.closeTimeout), this.genericDestroy();
      },
    },
  }),
  Class(UI, "MobileControlsModal").inherits(Widget)({
    html: '  <div class="floating-container">      <div class="head">          <button type="button" class="close" aria-label="Close">              <span aria-hidden="true">\xd7</span>          </button>      </div>      <div class="body"></div>  </div>',
    MAX_ELEMENT_HEIGHT: 360,
    prototype: {
      init: function (e) {
        Widget.prototype.init.call(this, e),
          (this.$closeButton = this.element.find(".close")),
          (this.$container = this.element.find(".body")),
          (this._boundHide = this.hide.bind(this)),
          (this._boundClose = this.close.bind(this)),
          this._bindEvents(),
          this.hide();
      },
      _bindEvents: function () {
        this.$closeButton.bind("click", this._boundClose),
          this.element.bind("click", !1);
      },
      close: function () {
        this.dispatch("close"), this.hide();
      },
      show: function () {
        Widget.prototype.show.call(this),
          this._calculatePosition(),
          $(window).bind("click", this._boundClose);
      },
      hide: function () {
        Widget.prototype.hide.call(this),
          $(window).unbind("click", this._boundClose);
      },
      setContent: function (e) {
        this.$container.append(e);
      },
      getContents: function () {
        return this.$container.contents();
      },
      _calculatePosition: function () {
        var e = this.$canvas.offset().top + this.$canvas.outerHeight() / 2,
          t = $(window).height() + window.scrollY;
        t - e <= this.constructor.MAX_ELEMENT_HEIGHT
          ? (this.element.css("top", e + "px"),
            this.element.css("height", t - e + "px"))
          : (this.element.css(
              "top",
              t - this.constructor.MAX_ELEMENT_HEIGHT + "px"
            ),
            this.element.css(
              "height",
              this.constructor.MAX_ELEMENT_HEIGHT + "px"
            ));
      },
      undelegatePaletteElements: function () {
        this.element
          .find(".sp-palette")
          .undelegate(".sp-thumb-el", "touchstart.spectrum");
      },
    },
  }),
  Class(UI, "ComponentPopupBackdrop").inherits(Widget)({
    html: '      <div class="component-popup-backdrop smart-templates__sidebar" style="display: none;"></div>',
    prototype: {
      init: function (e) {
        Widget.prototype.init.call(this, e);
      },
    },
  }),
  Class(UI, "ComponentPopup").inherits(Widget)({
    html: '        <div class="component-popup smart-templates__sidebar" style="display: none;">            <div class="component-popup-action">                <button type="button" class="close" aria-label="Close">                    <span aria-hidden="true">\xd7</span>                </button>            </div>            <div class="component-popup-container">            </div>        </div>',
    prototype: {
      _activeControl: null,
      init: function (e) {
        Widget.prototype.init.call(this, e),
          (this.$componentContainer = this.element.find(
            ".component-popup-container"
          ));
      },
      show: function (e) {
        var t = "ColorControl" === e.constructor.className,
          n = "TabbedColorPicker" === e.constructor.className;
        (this._activeControl = e),
          (t !== !0 || e.colorPickerDataSet.flat !== !0) &&
            (this.element.show(),
            t || this.$componentContainer.scrollTop(0),
            (t === !0 || n === !0) &&
              this.element
                .find(".sp-palette")
                .undelegate(".sp-thumb-el", "touchstart.spectrum"),
            this.dispatch("show"));
      },
      hide: function () {
        this.element.hide(),
          null !== this._activeControl &&
            (this._activeControl.constructor.className ===
              UI.SmartTemplate.MultiControl.className &&
              this._activeControl.hide(),
            this.dispatch("hide"));
      },
      getComponentContainer: function () {
        return this.$componentContainer;
      },
      getContentHeight: function () {
        return this.$componentContainer.get(0).scrollHeight;
      },
    },
  }),
  Class(UI, "ShareModal").inherits(Widget)({
    modalTitle: {
      productshot: "Share Your Image!",
      gift: "Share a free download with a friend!",
      videoProduct: "Share Your Video!",
    },
    modalMessage: {
      productshot: "Choose one of the options below",
      gift: "Share the link below with a friend (new accounts only)",
      videoProduct: "Choose one of the options below",
    },
    shareResources: {
      TGIFT:
        '<iframe id="twitter-widget-2" scrolling="no" frameborder="0" allowtransparency="true" src="//platform.twitter.com/widgets/tweet_button.1411706120.html#_=1412094440698&amp;count=none&amp;id=twitter-widget-2&amp;lang=en&amp;original_referer=&amp;url=/&amprelated=canonical&amp;size=m&amp;text=I%20have%20one%20free%20Placeit%20download!%20Grab%20it%20here%20{URL}%20&amp;via=placeitapp" class="twitter-share-button twitter-tweet-button twitter-share-button twitter-count-none" title="Twitter Tweet Button" data-twttr-rendered="true" style="width: 57px; height: 20px;"></iframe>',
      FGIFT:
        '<fb:send href="{URL}" width="57" height="20" colorscheme="dark"></fb:send>',
      TWITTER:
        '<iframe id="twitter-widget-2" scrolling="no" frameborder="0" allowtransparency="true" src="//platform.twitter.com/widgets/tweet_button.1411706120.html#_=1412094440698&amp;count=none&amp;hashtags=placeit&amp;id=twitter-widget-2&amp;lang=en&amp;original_referer={LOCATION_HREF}&amp;related=placeitapp&amp;size=m&amp;text={TEXT}&amp;url={URL}&amp;via=placeitapp" class="twitter-share-button twitter-tweet-button twitter-share-button twitter-count-none" title="Twitter Tweet Button" data-twttr-rendered="true" style="width: 57px; height: 20px;"></iframe>',
      FACEBOOK:
        '<iframe src="https://www.facebook.com/plugins/share_button.php?href={URL}&layout=button&size=small&width=59&height=20&locale=en_US" width="59" height="20" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true" allow="encrypted-media"></iframe>',
      PINTEREST:
        '<a href="http://pinterest.com/pin/create/button/?url={URL}&media={IMAGE_URL}" class="pin-it-button" count-layout="none" title="pinterest share button"><img border="0" src="//assets.pinterest.com/images/PinExt.png" title="Pin It" /></a>',
    },
    html: '        <div class="modal share-stage fade" id="shareStage" tabindex="-1" role="dialog" aria-labelledby="shareStageLabel" aria-hidden="true">          <div class="modal-dialog">            <div class="modal-content">                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>              <div class="modal-header">                <h4>Share Your Image!</h4>              </div>              <div class="modal-body">                <div class="overlay--subtitle"><span>Choose one of the options below</span></div>                <div class="">                    <div class="short-url">                      <input type="text" class="" id="shareURLInput" readonly>                      <button data-clipboard-target="#shareURLInput" class="copytoclipboard button primary"                         data-toggle="tooltip" data-placement="bottom" title="Copied!" data-trigger="manual" disabled>Copy</button>                    </div>                  <div class="share-stage__social-buttons-wrapper">                    <div class="share-social-title">SHARE VIA SOCIAL MEDIA</div>                    <ul class="list-unstyled share-stage__social-buttons">                      <li class="share-stage__social-buttons-item twitter"></li>                      <li class="share-stage__social-buttons-item facebook"></li>                      <li class="share-stage__social-buttons-item pinterest"></li>                      <li class="share-stage__social-buttons-item linkedin"></li>                      <li class="share-stage__social-buttons-item email"></li>                    </ul>                  </div>                </div>              </div>            </div><!-- /.modal-content -->          </div><!-- /.modal-dialog -->        </div>',
    prototype: {
      type: null,
      $shareURLInput: null,
      $copyButton: null,
      $shareSocialButtons: null,
      $shareTwitter: null,
      $shareFacebook: null,
      $sharePinterest: null,
      $shareLinkedin: null,
      ogData: null,
      animationTimeout: null,
      clipboard: null,
      ANIMATION_DELAY_MS: 500,
      init: function (e) {
        Widget.prototype.init.call(this, e),
          (this.modalTitle = this.element
            .find(".modal-header h4")
            .text(this.constructor.modalTitle[e.type])),
          (this.modalMessage = this.element
            .find(".modal-body .overlay--subtitle span")
            .text(this.constructor.modalMessage[e.type])),
          (this.$shareURLInput = this.element.find("#shareURLInput")),
          (this.$copyButton = this.element.find(".copytoclipboard")),
          (this.$shareSocialButtons = this.element.find(
            ".share-stage__social-buttons"
          )),
          (this.$closeBtn = this.element.find("button.close")),
          (this.$shareTwitter = this.$shareSocialButtons.find(".twitter")),
          (this.$shareFacebook = this.$shareSocialButtons.find(".facebook")),
          (this.$sharePinterest = this.$shareSocialButtons.find(".pinterest")),
          (this.$shareLinkedin = this.$shareSocialButtons.find(".linkedin")),
          (this.$shareEmail = this.$shareSocialButtons.find(".email")),
          this.type && this.element.addClass(this.type),
          (this.clipboard = new Clipboard(this.$copyButton.get(0))),
          this._bindEvents();
      },
      _bindEvents: function () {
        var e = this,
          t = function () {
            e.$copyButton.tooltip("hide");
          };
        return (
          this.element.on(
            "hidden.bs.modal",
            function () {
              this.element.data("modal", null), this.destroy();
            }.bind(this)
          ),
          this.clipboard
            .on("success", function (n) {
              e.$copyButton
                .attr("data-original-title", "Copied!")
                .tooltip("show"),
                n.clearSelection(),
                setTimeout(t, 1e3);
            })
            .on("error", function () {
              e.$copyButton
                .attr(
                  "data-original-title",
                  "Copy failed! Please try manually."
                )
                .tooltip("show"),
                setTimeout(t, 1e3);
            }),
          this
        );
      },
      activate: function () {
        return (
          Widget.prototype.activate.call(this), this.element.modal("show"), this
        );
      },
      deactivate: function () {
        return (
          Widget.prototype.deactivate.call(this),
          this.element.modal("hide"),
          this
        );
      },
      updateInput: function (e) {
        return (
          null !== this.animationTimeout && clearTimeout(this.animationTimeout),
          this.$shareURLInput.val(e),
          this
        );
      },
      addAnimatedEllipsis: function () {
        var e, t, n, i;
        return (
          (this.animationTimeout = setTimeout(
            function () {
              clearTimeout(this.animationTimeout),
                (e = this.$shareURLInput.val()),
                (t = e.split(".")[0]),
                (n = e.split(".").length - 1),
                (i = 3 === n ? t : e + "."),
                this.updateInput(i).addAnimatedEllipsis();
            }.bind(this),
            this.ANIMATION_DELAY_MS
          )),
          this
        );
      },
      loader: function (e) {
        return (
          e
            ? (this.$shareURLInput.addClass("disabled"),
              this.$copyButton.addClass("disabled"),
              this.$copyButton.prop("disabled", !0))
            : (this.$shareURLInput.removeClass("disabled"),
              this.$copyButton.removeClass("disabled"),
              this.$copyButton.prop("disabled", !1)),
          this
        );
      },
      unloadShareSocialButtons: function () {
        return this.$shareSocialButtons.hide(), this;
      },
      loadShareSocialButtons: function (e) {
        var t, n, i, r, s, o;
        (t = this),
          (n = Helpers.StageType.getProductshotInfo()),
          (i = e || Helpers.StageType.getProductshotURL()),
          (r = ""),
          (s = t.constructor.shareResources),
          "productshot" === this.type && (r = n.share_image.url);
        var a =
            '<a href="mailto:emailhere?subject=Service for making product shots and videos&body=' +
            i +
            '"></a>',
          l =
            '<script src="//platform.linkedin.com/in.js" type="text/javascript"></script><script type="IN/Share" data-url="' +
            i +
            '"></script>';
        return (
          "productshot" === this.type || "videoProduct" === this.type
            ? ((o = s.TWITTER.replace("{URL}", i)),
              (o = o.replace("{LOCATION_HREF}", window.location.href)),
              (o = this.ogData.title
                ? o.replace("{TEXT}", this.ogData.title)
                : o.replace("{TEXT}", "")),
              this.$shareTwitter.empty(),
              this.$shareTwitter.append(o),
              this.$shareFacebook
                .empty()
                .append(s.FACEBOOK.replace("{URL}", encodeURIComponent(i))),
              "productshot" === this.type &&
                this.$sharePinterest
                  .empty()
                  .append(
                    s.PINTEREST.replace("{URL}", i).replace("{IMAGE_URL}", r)
                  ),
              this.$shareLinkedin.empty().append(l))
            : (this.$shareTwitter.empty().append(s.TGIFT.replace("{URL}", i)),
              this.$shareFacebook.empty().append(s.FGIFT.replace("{URL}", i)),
              this.$sharePinterest.hide(),
              this.$shareLinkedin.hide()),
          this.$shareEmail.empty().append(a),
          "undefined" == typeof FB
            ? !(function (e, t, n) {
                var i,
                  r = e.getElementsByTagName(t)[0];
                e.getElementById(n) ||
                  ((i = e.createElement(t)),
                  (i.id = n),
                  (i.src =
                    "//connect.facebook.net/en_US/all.js#xfbml=1&appId=586729674734199"),
                  r.parentNode.insertBefore(i, r));
              })(document, "script", "facebook-jssdk")
            : FB.XFBML.parse(this.$shareFacebook[0]),
          this.$sharePinterest
            .find(".pin-it-button")
            .bind("click", function () {
              return (
                window.open(this.href, "_blank", "width=700, height=300"), !1
              );
            }),
          (function (e, n) {
            var i,
              r = e.getElementsByTagName(n)[0],
              s = e.createDocumentFragment(),
              o = function (t, r) {
                e.getElementById(r) ||
                  ((i = e.createElement(n)),
                  (i.src = t),
                  r && (i.id = r),
                  s.appendChild(i));
              };
            ("productshot" === t.type || "videoProduct" === t.type) &&
              o("//apis.google.com/js/plusone.js"),
              r.parentNode.insertBefore(s, r);
          })(document, "script"),
          this.$shareSocialButtons.show(),
          this
        );
      },
      destroy: function () {
        clearTimeout(this.animationTimeout),
          (this.$shareURLInput = null),
          (this.$copyButton = null),
          (this.$shareSocialButtons = null),
          (this.$shareTwitter = null),
          (this.$shareFacebook = null),
          (this.$sharePinterest = null),
          (this.$shareLinkedin = null),
          Widget.prototype.destroy.call(this);
      },
    },
  }),
  Class("ColorPickerPosition")({
    prototype: {
      $colorpicker: null,
      $control: null,
      $dragAreas: null,
      $container: null,
      $horizontalLimit: null,
      $verticalLimit: null,
      sidebarSide: null,
      $toggleButtons: null,
      $closeButton: null,
      _containerPosition: null,
      init: function (e) {
        this._isStagePage() &&
          !Helpers.App.isMobile() &&
          ((this.$colorpicker = e.$colorpicker),
          (this.$control = e.$control),
          (this.$dragAreas = e.$dragAreas),
          (this.$container = e.$container),
          (this.$horizontalLimit = e.$horizontalLimit),
          (this.$verticalLimit = e.$verticalLimit),
          (this.sidebarSide = e.sidebarSide),
          (this.$toggleButtons = e.$toggleButtons),
          (this.$closeButton = $('<div class="close-button"><div>')),
          this._addTopBar(),
          this._bindEvents(),
          this._bindDragEvents(),
          this._setDefaultContainerPosition());
      },
      setSidebarSide: function (e) {
        this.sidebarSide = e;
      },
      _isStagePage: function () {
        return window.page && window.page.isStagePage();
      },
      _addTopBar: function () {
        var e = $('<div class="colorpicker-top-bar"></div>');
        e.append(this.$closeButton),
          (this.$dragAreas = this.$dragAreas.add(e)),
          this.$container.prepend(e);
      },
      _bindEvents: function () {
        var e = this;
        this.$control.on("click touchstart", function () {
          e._setDefaultContainerPosition();
        }),
          this.$closeButton.click(function () {
            e.$control.click();
          }),
          this.$toggleButtons.bind("click.spectrum", function () {
            e._alignContainerVerticallyInsideBounds();
          }),
          this.$colorpicker &&
            this.$colorpicker.bind("reflow.spectrum", function () {
              e._restoreContainerPosition();
            }),
          $(window).resize(function () {
            e._alignContainerHorizontallyInsideBounds();
          });
      },
      _setDefaultContainerPosition: function () {
        this.sidebarSide &&
          (this.$container.css("right", "initial"),
          this["_" + this.sidebarSide + "EdgeAlign"](),
          this._alignContainerVerticallyToControl());
      },
      _restoreContainerPosition: function () {
        this._containerPosition && this.$container.css(this._containerPosition);
      },
      _leftEdgeAlign: function () {
        var e = page.stage.leftSideBar.element;
        this._setNewContainerPosition({
          left: e.offset().left,
        });
      },
      _rightEdgeAlign: function () {
        var e = page.stage.rightSideBar.element;
        this._setNewContainerPosition({
          left: e.offset().left + e.outerWidth() - this.$container.outerWidth(),
        });
      },
      _alignContainerVerticallyToControl: function () {
        var e = this.$control.offset().top,
          t = this._getMovAreaBounds(!0).bottom;
        e + this.$container.outerHeight() > t &&
          (e = t - this.$container.outerHeight()),
          this._setNewContainerPosition({
            top: e,
          });
      },
      _alignContainerVerticallyInsideBounds: function () {
        var e = this._getElementBounds(this.$container),
          t = this._getMovAreaBounds(!0).bottom;
        e.bottom > t &&
          this._setNewContainerPosition({
            top: t - this.$container.outerHeight(),
          });
      },
      _alignContainerHorizontallyInsideBounds: function () {
        var e = this._getElementBounds(this.$container),
          t = this._getMovAreaBounds(!0).right;
        e.right > t &&
          this._setNewContainerPosition({
            left: t - this.$container.outerWidth(),
          });
      },
      _setNewContainerPosition: function (e) {
        var t = this._containerPosition || {};
        (e = $.extend({}, t, e)),
          this.$container.css(e),
          (this._containerPosition = e);
      },
      _bindDragEvents: function () {
        var e,
          t = this,
          n = !1;
        $(document).bind("mousedown", function (t) {
          e = t.target;
        }),
          this.$container.on("mousedown", function (e) {
            if (2 != e.button && t.$dragAreas.is(e.target)) {
              (n = !0), e.preventDefault();
              var i = {
                x: e.pageX,
                y: e.pageY,
              };
              $(document).bind("mousemove", function (e) {
                var n = {
                    x: e.pageX,
                    y: e.pageY,
                  },
                  r = t._getNewPosition(i, n);
                t._setNewContainerPosition(r), (i = n);
              });
            }
          }),
          $(document).bind("mouseup", function (e) {
            $(document).unbind("mousemove"),
              n &&
                (e.stopImmediatePropagation(),
                setTimeout(function () {
                  n = !1;
                }, 0));
          }),
          $(document).bind("click.spectrum", function (t) {
            e !== t.target && t.stopImmediatePropagation();
          }),
          this.$dragAreas.bind("click.spectrum", function (e) {
            e.stopImmediatePropagation(), e.stopPropagation();
          });
      },
      _getNewPosition: function (e, t) {
        var n = t.x - e.x,
          i = t.y - e.y,
          r = this._getElementBounds(this.$container),
          s = this._getMovAreaBounds(),
          o = this._getContainerOutOfBoundsSides(e, t);
        return (
          o.top && (i = s.top - r.top),
          o.bottom && (i = s.bottom - r.bottom),
          o.left && (n = s.left - r.left),
          o.right && (n = s.right - r.right),
          t.y < s.top && i > 0 && (i = 0),
          t.y > s.bottom && 0 > i && (i = 0),
          t.x < s.left && n > 0 && (n = 0),
          t.x > s.right && 0 > n && (n = 0),
          {
            top: parseInt(this.$container.css("top"), 10) + Math.floor(i),
            left: parseInt(this.$container.css("left"), 10) + Math.floor(n),
          }
        );
      },
      _getElementBounds: function (e) {
        return {
          top: e.offset().top,
          left: e.offset().left,
          right: e.offset().left + e.outerWidth(),
          bottom: e.offset().top + e.outerHeight(),
        };
      },
      _getMovAreaBounds: function (e) {
        var t = this._getElementBounds(this.$horizontalLimit),
          n = this._getElementBounds(this.$verticalLimit),
          i = $(window).scrollTop() + $(window).height(),
          r = e && i < n.bottom ? i : n.bottom;
        return {
          top: n.top,
          left: t.left,
          right: t.right,
          bottom: r,
        };
      },
      _getContainerOutOfBoundsSides: function (e, t) {
        var n = this._getElementBounds(this.$container),
          i = this._getMovAreaBounds(),
          r = t.x - e.x,
          s = t.y - e.y;
        return {
          top: n.top + s < i.top,
          left: n.left + r < i.left,
          right: n.right + r > i.right,
          bottom: n.bottom + s > i.bottom,
        };
      },
    },
  }),
  Class("ColorpickerSharedColors")({
    RECENTLY_USED_COLORS_LIMIT: 15,
    prototype: {
      _colors: null,
      _buttonsState: null,
      _timestampedRecentlyUsedColors: null,
      _recentlyUsedChanged: !1,
      init: function () {
        var e = this;
        (this._colors = {
          templateDefaults: [],
          recentlyUsed: [],
        }),
          (this._buttonsState = {
            templateDefaults: {
              active: !1,
            },
            recentlyUsed: {
              active: !1,
            },
          }),
          this.setRecentlyUsedColors(),
          $(window).bind("beforeunload", function () {
            e.saveRecentlyUsedColors();
          });
      },
      saveRecentlyUsedColors: function () {
        this._saveUserRecentlyUsed(), this._saveLocalRecentlyUsed();
      },
      setRecentlyUsedColors: function () {
        var e = this;
        this._getRecentlyUsed(function (t) {
          (e._timestampedRecentlyUsedColors = t || []),
            (e._colors.recentlyUsed =
              t.map(function (e) {
                return e.color;
              }) || []);
        });
      },
      setColor: function e(t, n) {
        var i = this,
          r = this._colors[n],
          e = {};
        (e.templateDefaults = function (e) {
          i._colorIsInColorCollection(e, r) || r.push(e);
        }),
          (e.recentlyUsed = function (e) {
            var t = i._timestampColor(e);
            i._setTimestampedRecentlyUsedColor(t),
              i._colorIsInColorCollection(e, r) ||
                (r.unshift(e),
                (i._colors.recentlyUsed = r.filter(function (e) {
                  return (
                    this.map(function (e) {
                      return e.color;
                    }).indexOf(e) >= 0
                  );
                }, i._timestampedRecentlyUsedColors)));
          }),
          e[n](t);
      },
      getButtonState: function (e) {
        return this._buttonsState[e].active;
      },
      setButtonState: function (e, t) {
        this._buttonsState[e].active = t;
      },
      getColors: function (e) {
        return this._colors[e];
      },
      _timestampColor: function (e) {
        var t = new Date();
        return {
          color: e,
          timestamp: t.getTime(),
        };
      },
      _colorIsInColorCollection: function (e, t) {
        return -1 != t.indexOf(e);
      },
      _setTimestampedRecentlyUsedColor: function (e) {
        var t = this._timestampedRecentlyUsedColors
          .map(function (e) {
            return e.color;
          })
          .indexOf(e.color);
        -1 != t && this._timestampedRecentlyUsedColors.splice(t, 1),
          this._timestampedRecentlyUsedColors.unshift(e),
          this._timestampedRecentlyUsedColors.length >
            this.constructor.RECENTLY_USED_COLORS_LIMIT &&
            (this._timestampedRecentlyUsedColors.length =
              this.constructor.RECENTLY_USED_COLORS_LIMIT),
          (this._recentlyUsedChanged = !0);
      },
      _getRecentlyUsed: function (e) {
        var t = this,
          n = this._getLocalRecentlyUsed();
        return Helpers.App.getUser().email
          ? void this._getUserRecentlyUsed(function (i) {
              var r = $.merge(n, i || []);
              r.sort(function (e, t) {
                return t.timestamp - e.timestamp;
              }),
                (r = t._getUnique(r, "color")),
                r.length > this.constructor.RECENTLY_USED_COLORS_LIMIT &&
                  (r.length = this.constructor.RECENTLY_USED_COLORS_LIMIT),
                e(r);
            })
          : void e(n);
      },
      _getUnique: function (e, t) {
        var n = e
          .map(function (e) {
            return e[t];
          })
          .map(function (e, t, n) {
            return n.indexOf(e) === t && t;
          })
          .filter(function (t) {
            return e[t];
          })
          .map(function (t) {
            return e[t];
          });
        return n;
      },
      _getLocalRecentlyUsed: function () {
        var e = null;
        return (
          this._localStoreSupport() &&
            (e = window.localStorage.getItem("recentlyUsedColors")),
          JSON.parse(e) || []
        );
      },
      _getUserRecentlyUsed: function (e) {
        return window._userRecentlyUsedColors
          ? void e(window._userRecentlyUsedColors)
          : void $.ajax({
              url: "/recently_used_colors",
              method: "GET",
            })
              .done(function (t) {
                var n = t.recently_used_colors;
                if (n || n[0]) {
                  var i = JSON.parse(n[0]);
                  e(i);
                }
              })
              .error(function () {
                e();
              });
      },
      _saveUserRecentlyUsed: function () {
        Helpers.App.getUser().email &&
          this._recentlyUsedChanged &&
          $.ajax({
            url: "/recently_used_colors",
            method: "POST",
            data:
              "user[recently_used_colors]=" +
              JSON.stringify(this._timestampedRecentlyUsedColors),
            context: this,
          }).done(function () {
            this._recentlyUsedChanged = !1;
          });
      },
      _saveLocalRecentlyUsed: function () {
        var e = JSON.stringify(this._timestampedRecentlyUsedColors);
        this._localStoreSupport() &&
          window.localStorage.setItem("recentlyUsedColors", e);
      },
      _localStoreSupport: function () {
        var e = "localStoreSupport";
        try {
          return (
            window.localStorage.setItem(e, e),
            window.localStorage.removeItem(e),
            !0
          );
        } catch (t) {
          return !1;
        }
      },
    },
  }),
  Class("SpectrumWrapper")({
    SHARED_COLORS_TYPES: ["templateDefaults", "recentlyUsed"],
    SHOW_BUTTONS_TEXTS: {
      templateDefaults: {
        active: "Hide Defaults",
        inactive: "Show Defaults",
      },
      recentlyUsed: {
        active: "Hide Recently Used",
        inactive: "Show Recently Used",
      },
    },
    prototype: {
      $colorpicker: null,
      $container: null,
      $toggleButton: null,
      $chooseButton: null,
      $dragger: null,
      $dragHelper: null,
      $pickerContainer: null,
      $buttonContainer: null,
      $paletteElements: null,
      $palette: null,
      $paletteContainer: null,
      $inputContainer: null,
      $spInput: null,
      $inputColorPreviewInner: null,
      $colorCircle: null,
      $popupContainer: null,
      $modal: null,
      spectrumConfig: null,
      limitedColors: null,
      colorIsTemplateDefault: null,
      _chooseButtonVisible: !1,
      _colorFromURLParams: null,
      _customDefaultColor: null,
      _colorpickerEventHandlers: {},
      init: function (e) {
        return !this._isStagePage() || e.standardBehavior
          ? void e.$colorpicker.spectrum(e.spectrumConfig)
          : ((this.$colorpicker = e.$colorpicker),
            (this.$popupContainer = e.$popupContainer),
            (this.$modal = e.$modal),
            (this.spectrumConfig = e.spectrumConfig),
            (this.limitedColors = e.limitedColors),
            (this.colorIsTemplateDefault = e.colorIsTemplateDefault !== !1),
            this._setCustomDefaultColor(),
            this._configureSpectrum(),
            (this.$container = this.$colorpicker.spectrum("container")),
            (this.$toggleButton = this.$container.find(".sp-palette-toggle")),
            (this.$chooseButton = this.$container.find(".sp-choose")),
            (this.$dragger = this.$container.find(".sp-color")),
            (this.$dragHelper = this.$container.find(".sp-dragger")),
            (this.$pickerContainer = this.$container.find(
              ".sp-picker-container"
            )),
            (this.$buttonContainer = this.$container.find(
              ".sp-palette-button-container"
            )),
            (this.$paletteElements = this.$container.find(".sp-thumb-el")),
            (this.$palette = this.$container.find(".sp-palette")),
            (this.$paletteContainer = this.$container.find(
              ".sp-palette-container"
            )),
            (this.$inputContainer = this.$container.find(
              ".sp-input-container"
            )),
            (this.$spInput = this.$container.find(".sp-input")),
            (this.$inputColorPreviewInner = $(
              '<div class="input-color-preview-inner"></div>'
            )),
            (this.$colorCircle = $('<div class="color-circle"></div>')),
            (this.$showColorsButtons = {
              templateDefaults: $(
                '<button class="button show-defaults"></button>'
              ),
              recentlyUsed: $(
                '<button class="button show-recently-used"></button>'
              ),
            }),
            (this._isMobile = Helpers.App.isMobile()),
            this.$container.addClass("new-color-picker"),
            this.limitedColors && this.$buttonContainer.hide(),
            this._appendChooseButtonToPicker(),
            this._appendColorCircleToPicker(),
            this._appendInputColorPreview(),
            this._setShowColorsButtons(),
            this._bindEvents(),
            void this._updateColorInputPreview());
      },
      _isStagePage: function () {
        return window.page && window.page.isStagePage();
      },
      _setCustomDefaultColor: function () {
        this.colorIsTemplateDefault
          ? ((this._customDefaultColor =
              this.spectrumConfig.color.toLowerCase()),
            page.stage.colorpickerSharedColors.setColor(
              this._customDefaultColor,
              "templateDefaults"
            ))
          : (this._colorFromURLParams =
              this.spectrumConfig.color.toLowerCase());
      },
      _configureSpectrum: function () {
        var e = $.extend({}, this.spectrumConfig, {
          hideAfterPaletteSelect: !0,
          clickoutFiresChange: !1,
          showSelectionPalette: !1,
          palette: this._getFullPalette(),
          showButtons: !0,
        });
        this.$colorpicker.spectrum(e);
      },
      _appendChooseButtonToPicker: function () {
        this.$pickerContainer.append(this.$chooseButton),
          this.$chooseButton.hide();
      },
      _appendColorCircleToPicker: function () {
        this._isMobile &&
          (this.$pickerContainer.append(this.$colorCircle),
          this.$colorCircle.hide());
      },
      _appendInputColorPreview: function () {
        var e = $('<div class="input-color-preview"></div>');
        e.append(this.$inputColorPreviewInner), this.$inputContainer.append(e);
      },
      _setShowColorsButtons: function () {
        var e = $('<div class="show-colors-buttons-container"></div>');
        e.prepend(this.$showColorsButtons.recentlyUsed),
          e.prepend(this.$showColorsButtons.templateDefaults),
          this.$buttonContainer.prepend(e),
          this._handleShowColorsButtonsState();
      },
      _bindEvents: function () {
        var e = this;
        (this._colorpickerEventHandlers = {
          "dragstop.spectrum": function () {
            e._repositionChooseButton(),
              e._hideColorCircle(),
              e._removePaletteClone(),
              e._showChooseButton();
          },
          "dragstart.spectrum": function () {
            e._hideChooseButton(), e._showColorCircle(), e._placePaletteClone();
          },
          "change.spectrum": function () {
            return e.$container.is(":visible")
              ? (e._hideChooseButton(),
                e._setRecentlyUsedColor(),
                e._updatePalette(),
                void e._handleShowColorsButtonsState())
              : void e._setcolorFromURLParams();
          },
          "show.spectrum": function () {
            e._updatePalette(),
              e._handleShowColorsButtonsState(),
              $(window).unbind("resize.spectrum");
          },
          "reflow.spectrum move.spectrum": function () {
            e._highlightPaletteColors();
          },
          "move.spectrum": function () {
            e._updateColorInputPreview(), e._repositionColorCircle();
          },
          "hide.spectrum": function () {
            e._hideChooseButton(),
              setTimeout(function () {
                e.$container.is(":visible") ||
                  page.stage.colorpickerSharedColors.saveRecentlyUsedColors();
              }, 0);
          },
        }),
          Object.keys(this._colorpickerEventHandlers).forEach(function (t) {
            e.$colorpicker.bind(t, e._colorpickerEventHandlers[t]);
          }),
          this.$chooseButton.bind("click.spectrum", function () {
            e.$colorpicker.spectrum("show");
          }),
          this.$palette.delegate(".sp-thumb-el", "click.spectrum", function () {
            e.$colorpicker.spectrum("show");
          }),
          this.$toggleButton.bind("click.spectrum", function () {
            e._updatePalette(),
              e._handleToggleButtonClick(),
              e._scrollPopupToBottom(),
              e._chooseButtonVisible && e._showChooseButton();
          }),
          this.$spInput.on("change", function () {
            e.$spInput.hasClass("sp-validation-error") ||
              (e._repositionChooseButton(),
              e._updateColorInputPreview(),
              e._showChooseButton());
          }),
          this.$spInput.bind("paste", function () {
            setTimeout(function () {
              e.$spInput.hasClass("sp-validation-error") ||
                (e._repositionChooseButton(),
                e._updateColorInputPreview(),
                e._hideChooseButton(),
                e.$chooseButton.click());
            }, 1);
          }),
          this.constructor.SHARED_COLORS_TYPES.forEach(function (t) {
            e.$showColorsButtons[t].click(function () {
              e._handleShowColorsButtonClick(t);
            });
          });
      },
      destroy: function () {
        var e = this;
        Object.keys(this._colorpickerEventHandlers).forEach(function (t) {
          e.$colorpicker.unbind(t, e._colorpickerEventHandlers[t]);
        }),
          this.$colorpicker.spectrum("destroy");
      },
      _placePaletteClone: function () {
        this.$paletteClone && this.$paletteClone.remove(),
          (this.$paletteClone = this.$palette.clone()),
          this.$paletteContainer.prepend(this.$paletteClone),
          this._isMobile && this.$palette.hide(),
          this.$colorpicker.spectrum("option", "palette", []);
      },
      _removePaletteClone: function () {
        this._isMobile && this.$palette.show(),
          this._updatePalette(),
          this.$paletteClone.remove(),
          this._highlightPaletteColors();
      },
      _showChooseButton: function () {
        this.$chooseButton.fadeIn(200), (this._chooseButtonVisible = !0);
      },
      _hideChooseButton: function () {
        this.$chooseButton.hide(), (this._chooseButtonVisible = !1);
      },
      _handleToggleButtonClick: function () {
        var e = this.$container.hasClass("sp-palette-only");
        e
          ? this.$buttonContainer.append(this.$toggleButton)
          : this.$inputContainer.append(this.$toggleButton);
      },
      _handleShowColorsButtonClick: function (e) {
        var t = page.stage.colorpickerSharedColors.getButtonState(e);
        page.stage.colorpickerSharedColors.setButtonState(e, !t),
          this._handleShowColorsButtonsState(),
          this._updatePalette();
      },
      _handleShowColorsButtonsState: function () {
        var e = this;
        this.constructor.SHARED_COLORS_TYPES.forEach(function (t) {
          var n = e.$showColorsButtons[t];
          0 === page.stage.colorpickerSharedColors.getColors(t).length
            ? n.hide()
            : page.stage.colorpickerSharedColors.getButtonState(t)
            ? (n.show(), n.text(e.constructor.SHOW_BUTTONS_TEXTS[t].active))
            : (n.show(), n.text(e.constructor.SHOW_BUTTONS_TEXTS[t].inactive));
        });
      },
      _colorIsCustomDefault: function (e) {
        return e.toLowerCase() === this._customDefaultColor;
      },
      _updatePalette: function () {
        this.$colorpicker.spectrum("option", "palette", this._getFullPalette()),
          this._highlightPaletteColors();
      },
      _updateColorInputPreview: function () {
        this.$colorCircle.css("background-color", this.$spInput.val()),
          this.$inputColorPreviewInner.css(
            "background-color",
            this.$spInput.val()
          );
      },
      _scrollPopupToBottom: function () {
        if (this.$popupContainer && this.$container.is(":visible")) {
          var e = this.$modal || this.$container,
            t = e.outerHeight() - this.$popupContainer.outerHeight();
          this.$popupContainer.scrollTop(t);
        }
      },
      _highlightPaletteColors: function () {
        var e = this;
        this.constructor.SHARED_COLORS_TYPES.forEach(function (t) {
          if (page.stage.colorpickerSharedColors.getButtonState(t)) {
            var n = page.stage.colorpickerSharedColors.getColors(t);
            n.forEach(function (n) {
              e._highlightColorInPalette(n, t);
            });
          }
        });
      },
      _highlightColorInPalette: function (e, t) {
        var n;
        if ("transparent" === e)
          n = this.$container.find(
            '.sp-thumb-el[data-color="rgba(0, 0, 0, 0)"]'
          );
        else {
          var i =
            '[title="' + e.toLowerCase() + '"][data-color!="rgba(0, 0, 0, 0)"]';
          n = this.$container.find(".sp-thumb-el" + i);
        }
        if (0 !== n.length) {
          if (2 === n.length) {
            var r = "templateDefaults" === t ? 0 : 1;
            n = n.eq(r);
          }
          n.addClass("highlight");
        }
      },
      _getFullPalette: function () {
        if (this.limitedColors) return this.spectrumConfig.palette;
        var e = $.merge([], this.spectrumConfig.palette),
          t = e.push(this._getSelectionPalette());
        return (
          this._colorFromURLParams &&
            !this._colorIsInPalette(this._colorFromURLParams, e) &&
            e[t - 1].unshift(this._colorFromURLParams),
          e
        );
      },
      _getSelectionPalette: function () {
        var e = [];
        return (
          this._customDefaultColor &&
            !this._colorIsInPalette(
              this._customDefaultColor,
              this.spectrumConfig.palette
            ) &&
            e.push(this._customDefaultColor),
          page.stage.colorpickerSharedColors.getButtonState(
            "templateDefaults"
          ) && (e = e.concat(this._getColorsForPalette("templateDefaults"))),
          (e = e.concat(this._getColorsForPalette("recentlyUsed"))),
          this._getUniqueColors(e)
        );
      },
      _getColorsForPalette: function (e) {
        var t = this,
          n = page.stage.colorpickerSharedColors.getColors(e);
        return n.filter(function (n) {
          return "transparent" === n
            ? !1
            : t._colorIsInPalette(n, t.spectrumConfig.palette)
            ? !1
            : "recentlyUsed" === e
            ? !0
            : !t._colorIsCustomDefault(n);
        });
      },
      _colorIsInPalette: function (e, t) {
        for (var n = 0; n < t.length; n++) {
          var i = t[n].map(function (e) {
            return e.toLowerCase();
          });
          if (i.indexOf(e.toLowerCase()) >= 0) return !0;
        }
        return !1;
      },
      _setRecentlyUsedColor: function () {
        page.stage.colorpickerSharedColors.setColor(
          this._getCurrentHexColor(),
          "recentlyUsed"
        );
      },
      _setcolorFromURLParams: function () {
        this._colorFromURLParams ||
          (this._colorFromURLParams = this._getCurrentHexColor());
      },
      _getCurrentHexColor: function () {
        var e = this.$colorpicker.spectrum("get");
        if (e.toHexString) {
          if (0 === e._a) return "transparent";
          var t = e.toHexString();
          return t.toLowerCase();
        }
      },
      _repositionChooseButton: function () {
        var e = this._getElementPosition(this.$dragHelper),
          t = this._getElementPaddings(this.$pickerContainer),
          n =
            (this.$dragHelper.outerWidth() - this.$chooseButton.outerWidth()) /
            2,
          i = this._getChooseButtonTopOffset(e, 8, -10);
        (e.top += i + 2 * t.top),
          (e.left += n + 2 * t.left),
          this.$chooseButton.css(e);
      },
      _getElementPosition: function (e) {
        return {
          top: parseInt(e.css("top"), 10),
          left: parseInt(e.css("left"), 10),
        };
      },
      _getElementPaddings: function (e) {
        return {
          top: parseInt(e.css("padding-top"), 10),
          left: parseInt(e.css("padding-left"), 10),
        };
      },
      _getChooseButtonTopOffset: function (e, t, n) {
        var i = this._getElementPaddings(this.$pickerContainer),
          r =
            e.top +
            i.top +
            this.$dragHelper.outerHeight() +
            this.$chooseButton.outerHeight() +
            t;
        return r > this.$pickerContainer.find(".sp-top-inner").outerHeight() - n
          ? -t - this.$chooseButton.outerHeight()
          : t + this.$dragHelper.outerHeight();
      },
      _repositionColorCircle: function () {
        var e = this._getElementPosition(this.$dragHelper),
          t = this._getElementPaddings(this.$pickerContainer),
          n =
            (this.$dragHelper.outerWidth() - this.$colorCircle.outerWidth()) /
            2,
          i = -this.$colorCircle.outerWidth() - 18;
        (e.top += i + 2 * t.top),
          (e.left += n + 2 * t.left),
          this.$colorCircle.css(e);
      },
      _showColorCircle: function () {
        this.$colorCircle.fadeIn(200);
      },
      _hideColorCircle: function () {
        this.$colorCircle.hide();
      },
      _getUniqueColors: function (e) {
        var t = {};
        return (
          e.forEach(function (e) {
            t[e] = !0;
          }),
          Object.keys(t)
        );
      },
      undelegateTouchStartEvents: function () {
        this.$palette.undelegate(".sp-thumb-el", "touchstart.spectrum");
      },
    },
  }),
  Class(UI, "OnboardingOverlay")
    .inherits(Widget)
    .includes(GenericDestroySupport)({
    html: '        <div class="onboarding-overlay">            <div class="onboarding-overlay__container">                <div class="onboarding-overlay__left"></div>                <div class="onboarding-overlay__right"></div>            </div>        </div>',
    prototype: {
      $button: null,
      init: function (e) {
        Widget.prototype.init.call(this, e),
          (this.leftContainer = this.element.find(".onboarding-overlay__left")),
          (this.rightContainer = this.element.find(
            ".onboarding-overlay__right"
          )),
          this.row && this.element.addClass("onboarding-overlay__row"),
          this.img &&
            this.leftContainer.append('<img src="' + this.img + '"/>'),
          this.text &&
            this.rightContainer.append("<span>" + this.text + "</span>"),
          this.button &&
            this.rightContainer.append(
              '<button type="button">' + this.button + "</button>"
            ),
          (this.$button = this.element.find("button")),
          this.$button.length &&
            ("function" == typeof this.callback
              ? this.$button.bind("click", this.callback)
              : this.$button.bind("click", this.destroy.bind(this)));
      },
      render: function (e, t) {
        Widget.prototype.render.call(this, e, t);
        return this.target.addClass("has-onboarding-overlay"), this;
      },
      destroy: function () {
        this.target.removeClass("has-onboarding-overlay"),
          this.genericDestroy();
      },
    },
  }),
  Class(UI, "OnboardingPopover")
    .inherits(Widget)
    .includes(GenericDestroySupport)({
    html: '        <div class="onboarding-popover-overlay"></div>',
    prototype: {
      _popoverBtn: null,
      _popoverBtnHandler: null,
      _resizeDebounce: null,
      template:
        '<div class="popover onboarding-bs-popover" role="tooltip"><div class="arrow"></div><div class="popover-content"></div></div>',
      init: function (e) {
        var t, n;
        Widget.prototype.init.call(this, e),
          (t = document.createElement("div")),
          t.classList.add("content"),
          this.text &&
            ((n = document.createElement("span")),
            (n.innerText = this.text),
            t.appendChild(n)),
          this.button &&
            ((this._popoverBtn = document.createElement("button")),
            (this._popoverBtn.innerText = this.button),
            (this._popoverBtnHandler =
              "function" == typeof this.callback
                ? this.callback
                : this.destroy.bind(this)),
            this._popoverBtn.addEventListener("click", this._popoverBtnHandler),
            t.appendChild(this._popoverBtn)),
          this.element
            .popover({
              template: this.template,
              html: !0,
              content: t,
              trigger: "manual",
              placement: this.placement ? this.placement : "top",
            })
            .addClass("onboarding-popover"),
          this._bindings();
      },
      _bindings: function () {
        var e;
        e = this;
        var t = function () {
          clearTimeout(e._resizeDebounce),
            (e._resizeDebounce = setTimeout(e.refresh.bind(e), 200));
        };
        this.element.on("shown.bs.popover", function () {
          window.addEventListener("resize", t);
        }),
          this.element.on("hide.bs.popover", function () {
            window.removeEventListener("resize", t);
          });
      },
      _calculatePosition: function () {
        var e;
        this.target &&
          this.target.length &&
          ((e = this.target.offset()),
          this.element.css("top", e.top),
          this.element.css("left", e.left),
          this.element.css("width", this.target.outerWidth()),
          this.element.css("height", this.target.outerHeight()));
      },
      refresh: function () {
        this._calculatePosition(), this.element.popover("show");
      },
      show: function () {
        Widget.prototype.show.call(this),
          this._calculatePosition(),
          this.element.popover("show");
      },
      hide: function () {
        this.element.popover("hide"), Widget.prototype.hide.call(this);
      },
      destroy: function () {
        this.element.popover("destroy"),
          this._popoverBtnHandler &&
            this._popoverBtn.removeEventListener(
              "click",
              this._popoverBtnHandler
            ),
          clearTimeout(this._resizeDebounce),
          this.genericDestroy();
      },
      render: function (e, t) {
        return Widget.prototype.render.call(this, e, t), this.show(), this;
      },
    },
  }),
  Class(UI, "OnboardingWizard")
    .inherits(Widget)
    .includes(GenericDestroySupport)({
    TYPE_TOOLTIP: "tooltip",
    TYPE_OVERLAY: "overlay",
    prototype: {
      stepCounter: 0,
      completedCookies: [],
      init: function (e) {
        Widget.prototype.init.call(this, e),
          (this.stepCounter = 0),
          (this.dataCookies = Helpers.App.getCookie(this.name)),
          this.setCurrentStep();
      },
      setCurrentStep: function () {
        this.dataCookies.includes(this.steps[this.stepCounter].key)
          ? this.nextStep()
          : this.createWidget(this.steps[this.stepCounter]);
      },
      nextStep: function () {
        void 0 !== this.steps[this.stepCounter + 1]
          ? (this.stepCounter++, this.setCurrentStep())
          : this.endOnboarding();
      },
      endOnboarding: function () {
        this.completedCookies.push("onboarding_completed"),
          this.setCookie(this.name, this.completedCookies, 1e4),
          this.destroy();
      },
      setCompletion: function () {
        this.children.forEach(function (e) {
          e.destroy();
        }),
          this.deleteCookie(this.name),
          this.completedCookies.push(this.steps[this.stepCounter].key),
          this.setCookie(this.name, this.completedCookies, 1e4),
          this.nextStep();
      },
      setCookie: function (e, t, n) {
        var i = new Date();
        (t = t.join()),
          i.setTime(i.getTime() + 864e5 * n),
          (document.cookie =
            e + "=" + t + ";path=/;expires=" + i.toGMTString());
      },
      deleteCookie: function (e) {
        this.setCookie(e, [], -1);
      },
      destroy: function () {
        this.genericDestroy();
      },
      createWidget: function (e) {
        var t = this;
        e.settings.forEach(function (e) {
          switch (((e.callback = t.setCompletion.bind(t)), e.type)) {
            case UI.OnboardingWizard.TYPE_OVERLAY:
              t.appendChild(new UI.OnboardingOverlay(e)).render(e.target);
              break;
            case UI.OnboardingWizard.TYPE_TOOLTIP:
              t.appendChild(new UI.OnboardingPopover(e)).render($("body"));
          }
        });
      },
      refreshPopovers: function () {
        this.children.forEach(function (e) {
          e.type === UI.OnboardingWizard.TYPE_TOOLTIP &&
            (e.show(), e.refresh());
        });
      },
      hidePopovers: function () {
        this.children.forEach(function (e) {
          e.type === UI.OnboardingWizard.TYPE_TOOLTIP && e.hide();
        });
      },
    },
  }),
  Class(UI, "ParentSlider").inherits(Widget).includes(GenericDestroySupport)({
    prototype: {
      $parent: null,
      autoHeight: !1,
      autoScroll: 0,
      clickToSet: !1,
      centerMode: !1,
      draggable: !1,
      dragSpeed: 1,
      infinite: !1,
      itemsAlignment: null,
      sliderAtStart: null,
      sliderAtEnd: null,
      $next: null,
      $prev: null,
      scrollCallback: null,
      scrollSnap: !1,
      showScrollbar: !1,
      speed: 200,
      swipeable: !0,
      itemsToScroll: 1,
      itemsToShow: 1,
      responsive: null,
      singleItemSwipe: !1,
      dragTolerance: 30,
      fixedHeight: null,
      current: {
        element: null,
        num: null,
      },
      init: function (e) {
        Widget.prototype.init.call(this, e),
          this.$parent.addClass("parent-slider"),
          this.$parent.children().each(function (e) {
            this.classList.add("parent-item"),
              this.setAttribute("parent_num", e);
          }),
          this.$parent.get(0).children[0].classList.add("parent-active"),
          (this.current = {
            element: this.$parent.get(0).children[0],
            num: 0,
          }),
          this.setStyling(),
          this.setBindings();
      },
      destroy: function () {
        this._unbindEvents(), this.genericDestroy();
      },
      _unbindEvents: function () {
        window.removeEventListener("resize", this.resizeListener),
          null !== this.$prev && this._prevUnbindEvents(),
          null !== this.$next && this._nextUnbindEvents(),
          this.clickToSet
            ? this._clickUnbindEvents()
            : this._scrollUnbindEvents();
      },
      setStyling: function () {
        this.styleWidth(),
          this._styleAlignment(),
          this._styleScrollBar(),
          this._styleSwipable();
      },
      setBindings: function () {
        null !== this.$next && this._nextBindings(),
          null !== this.$prev && this.prevBindings(),
          this.singleItemSwipe ||
            (this.clickToSet
              ? this._clickBindings()
              : this.infinite
              ? this._scrollInfinite()
              : this._scrollBindings()),
          this._dragBindings(),
          this._responsiveBindings();
      },
      nextAction: function () {
        this.scrollToItem(this.current.num + this.itemsToScroll);
      },
      _nextBindings: function () {
        (this.nextListener = this.nextAction.bind(this)),
          this.$next.bind("click", this.nextListener);
      },
      _nextIsDisabled: function (e) {
        this.$next.get(0).disabled = e;
      },
      _nextUnbindEvents: function () {
        this.$next.unbind("click", this.nextListener);
      },
      prevAction: function () {
        this.scrollToItem(this.current.num - this.itemsToScroll);
      },
      _prevBindings: function () {
        (this.prevListener = this.prevAction.bind(this)),
          this.$prev.bind("click", this.prevListener);
      },
      _prevIsDisabled: function (e) {
        this.$prev.get(0).disabled = e;
      },
      _prevUnbindEvents: function () {
        this.$prev.bind("click", this.prevListener);
      },
      _responsiveBindings: function () {
        (this.isResizing = 0),
          (this.resizeListener = this._responsiveHandler.bind(this)),
          window.addEventListener("resize", this.resizeListener);
      },
      _responsiveHandler: function () {
        var e = this;
        clearTimeout(this.isResizing),
          (this.isResizing = setTimeout(function () {
            e.scrollToItem(e.current.num),
              e._responsiveOverride(),
              (e.isResizing = null);
          }, 200));
      },
      _responsiveOverride: function () {
        if (null !== this.responsive)
          for (var e = 0; e < this.responsive.length; e++)
            if (
              this.responsive[e].breakpoint > window.innerWidth &&
              (void 0 === this.responsive[e + 1] ||
                this.responsive[e + 1].breakpoint < window.innerWidth)
            ) {
              (this._responsiveCase = e),
                this._responsiveApply(this.responsive[e].settings);
              break;
            }
      },
      _responsiveApply: function (e) {
        var t = Object.keys(e),
          n = this;
        t.forEach(function (t) {
          n[t] = e[t];
        }),
          this.init();
      },
      centerFirstItem: function () {
        this.$parent.get(0).children[0].style.marginLeft =
          "calc(50% - " +
          parseInt(this.$parent.get(0).children[0].offsetWidth / 2) +
          "px)";
      },
      styleWidth: function () {
        if (this.itemsToShow > 0) {
          var e = (100 / this.itemsToShow).toFixed(6);
          this.centerMode &&
            !this.infinite &&
            (this.$parent.get(0).children[0].style.marginLeft =
              50 - e / 2 + "%");
          for (var t = 0; t < this.$parent.get(0).children.length; t++)
            (this.$parent.get(0).children[t].style.minWidth = e + "%"),
              (this.$parent.get(0).children[t].style.maxWidth = e + "%"),
              this.$parent.get(0).children[t].classList.add("parent-item-" + t);
        } else
          this.centerMode &&
            !this.infinite &&
            1 !== this.itemsToShow &&
            this.centerFirstItem();
      },
      _styleAlignment: function () {
        "center" === this.itemsAlignment
          ? (this.$parent.addClass("parent-al-center"),
            this.$parent.removeClass("parent-al-bottom"))
          : "bottom" === this.itemsAlignment
          ? (this.$parent.addClass("parent-al-bottom"),
            this.$parent.removeClass("parent-al-center"))
          : (this.$parent.removeClass("parent-al-center"),
            this.$parent.removeClass("parent-al-bottom"));
      },
      _styleScrollBar: function () {
        this.showScrollbar
          ? this.$parent.addClass("parent-scrollbar")
          : this.$parent.removeClass("parent-scrollbar");
      },
      _styleSliderHeight: function (e) {
        this.$parent.get(0).style.height = e + "px";
      },
      _styleSwipable: function () {
        this.swipeable
          ? this.$parent.removeClass("parent-no-swipe")
          : this.$parent.addClass("parent-no-swipe");
      },
      setSwipeable: function (e) {
        (this.swipeable = e), this._styleSwipable();
      },
      _scrollBindings: function () {
        (this.isScrolling = 0),
          (this.scrollListener = this._scrollHandler.bind(this)),
          this.$parent.bind("scroll", this.scrollListener);
      },
      _scrollHandler: function () {
        var e = this;
        clearTimeout(this.isScrolling),
          (this.isScrolling = setTimeout(function () {
            e._scrollCurrent();
          }, 100));
      },
      _scrollUnbindEvents: function () {
        this.$parent.unbind("scroll", this.scrollListener);
      },
      __scrollInfinite: function () {
        var e,
          t,
          n = this;
        this.$parent
          .get(0)
          .insertBefore(
            this.$parent.get(0).children[
              this.$parent.get(0).children.length - 1
            ],
            this.$parent.get(0).children[0]
          ),
          this._setCurrent(this.$parent.get(0).children[1], 1),
          this.$parent.bind("scroll", function () {
            clearTimeout(e),
              clearTimeout(t),
              (e = setTimeout(function () {
                n.$parent.get(0).scrollLeft + n.$parent.get(0).offsetLeft >=
                n.$parent.get(0).children[1].offsetLeft +
                  n.$parent.get(0).children[1].offsetWidth
                  ? ((n.$parent.get(0).scrollLeft =
                      n.$parent.get(0).children[1].offsetWidth),
                    n.$parent.get(0).appendChild(n.$parent.get(0).children[0]))
                  : 0 === n.$parent.get(0).scrollLeft &&
                    ((n.$parent.get(0).scrollLeft =
                      n.$parent.get(0).children[1].offsetWidth),
                    n.$parent
                      .get(0)
                      .insertBefore(
                        n.$parent.get(0).children[
                          n.$parent.get(0).children.length - 1
                        ],
                        n.$parent.get(0).children[0]
                      )),
                  (t = setTimeout(function () {
                    this.clickToSet || n._scrollCurrent();
                  }, 400));
              }, 10));
          });
      },
      scrollToItem: function (e, t) {
        var n;
        (n = this.centerMode
          ? this.$parent.get(0).children[e].offsetLeft +
            this.$parent.get(0).children[e].offsetWidth / 2 -
            this.$parent.get(0).offsetWidth / 2
          : this.$parent.get(0).children[e].offsetLeft),
          this.$parent.get(0).scrollLeft != n &&
            this.$parent.animate(
              {
                scrollLeft: n,
              },
              this.speed,
              t
            ),
          (this.clickToSet || this.singleItemSwipe) &&
            this._setCurrent(this.$parent.get(0).children[e], e);
      },
      _setCurrent: function (e, t) {
        this.current.element.classList.remove("parent-active"),
          e.classList.add("parent-active"),
          (this.current.element = e),
          (this.current.num = t),
          this.setCurrentHeight();
      },
      setCurrentHeight: function (e) {
        if (this.autoHeight !== !1 && !this.isResizing) {
          var t = this._currentHeigth();
          e > t && (t = e),
            this._styleSliderHeight(
              this.maxHeight > 0 && this.maxHeight < t ? this.maxHeight : t
            );
        }
      },
      _currentHeigth: function () {
        var e = 0;
        return (
          $(this.current.element)
            .children()
            .each(function () {
              e += $(this).outerHeight(!0);
            }),
          e
        );
      },
      _scrollCurrent: function () {
        var e;
        if (
          ((e = this.centerMode
            ? this.current.element.offsetLeft +
              this.current.element.offsetWidth / 2 -
              this.$parent.get(0).offsetWidth / 2
            : this.current.element.offsetLeft),
          this.$parent.get(0).scrollLeft != e)
        ) {
          var t, n, i;
          i = this.centerMode
            ? this.$parent.get(0).scrollLeft +
              this.$parent.get(0).offsetWidth / 2
            : this.$parent.get(0).scrollLeft;
          for (var r = 0; r < this.$parent.get(0).children.length; r++)
            if (
              ((t =
                this.$parent.get(0).children[r].offsetLeft -
                this.$parent.get(0).offsetLeft),
              (n = t + this.$parent.get(0).children[r].offsetWidth),
              i >= t && n > i)
            ) {
              this._setCurrent(this.$parent.get(0).children[r], r);
              break;
            }
          this.scrollToItem(this.current.num),
            this._scrollControls(),
            "function" == typeof this.scrollCallback &&
              this.scrollCallback(this.current);
        }
      },
      _scrollControls: function () {
        this.infinite ||
          (null === this.$next && null === this.$prev) ||
          (this.current.num + this.itemsToScroll >
          this.$parent.get(0).children.length - this.itemsToShow
            ? (this._nextIsDisabled(!0),
              this._prevIsDisabled(!1),
              "function" == typeof this.sliderAtEnd && this.sliderAtEnd())
            : this.current.num < 1
            ? (this._nextIsDisabled(!1),
              this._prevIsDisabled(!0),
              "function" == typeof this.sliderAtStart && this.sliderAtStart())
            : (this._nextIsDisabled(!1), this._prevIsDisabled(!1)));
      },
      _dragBindings: function () {
        if (this.draggable || this.singleItemSwipe) {
          var e = this;
          this.singleItemSwipe &&
            (this.$parent.get(0).style.overflow = "hidden"),
            Helpers.App.isMobile()
              ? this.$parent.bind("touchstart", function (t) {
                  e._dragEventStart(t);
                })
              : this.$parent.bind("mousedown", function (t) {
                  e._dragEventStart(t);
                });
        }
      },
      _dragEventStart: function (e) {
        (this.hLock = !0),
          (this.hasDragged = !1),
          (this._dragMove = this._dragEventMove.bind(this)),
          (this._dragEnd = this._dragEventEnd.bind(this)),
          (this._dragPos = this.$parent.get(0).scrollLeft),
          (this._rightLimit =
            this.current.element.offsetLeft + this.current.element.offsetWidth),
          (this._leftLimit =
            this.current.element.offsetLeft - this.current.element.offsetWidth),
          this.$parent.removeClass("parent-dragging"),
          Helpers.App.isMobile()
            ? ((this._dragStartX =
                e.originalEvent.touches[0].pageX -
                this.$parent.get(0).offsetLeft),
              (this._dragStartY =
                e.originalEvent.touches[0].pageY -
                this.$parent.get(0).offsetTop),
              this.$parent.unbind("touchmove", this._dragMove),
              this.$parent.unbind("touchend", this._dragEnd),
              this.$parent.bind("touchmove", this._dragMove),
              this.$parent.bind("touchend", this._dragEnd),
              this.$parent.bind("touchcancel", this._dragEnd))
            : ((this._dragStartX =
                e.originalEvent.touches[0].pageX -
                this.$parent.get(0).offsetLeft),
              (this._dragStartY =
                e.originalEvent.touches[0].pageY -
                this.$parent.get(0).offsetTop),
              this.$parent.unbind("mousemove", this._dragMove),
              this.$parent.unbind("mouseup", this._dragEnd),
              this.$parent.bind("mousemove", this._dragMove),
              this.$parent.bind("mouseup", this._dragEnd));
      },
      _dragEventMove: function (e) {
        var t;
        return (
          Helpers.App.isMobile()
            ? ((t =
                e.originalEvent.touches[0].pageX -
                this.$parent.get(0).offsetLeft -
                this._dragStartX),
              (walkY =
                e.originalEvent.touches[0].pageY -
                this.$parent.get(0).offsetTop -
                this._dragStartY))
            : ((t =
                e.pageX - this.$parent.get(0).offsetLeft - this._dragStartX),
              (walkY =
                e.pageY - this.$parent.get(0).offsetTop - this._dragStartY)),
          (Math.abs(walkY) > this.dragTolerance && !this.hasDragged) ||
          !this.hLock
            ? void (this.hLock = !1)
            : void (
                (this.hasDragged || Math.abs(t) > this.dragTolerance) &&
                (e.cancelable && e.preventDefault(),
                e.stopPropagation(),
                (t *= this.dragSpeed),
                this.dragTranslate(this._dragPos - t),
                this.$parent.addClass("parent-dragging"),
                (this.hasDragged = !0))
              )
        );
      },
      _dragEventEnd: function () {
        this.$parent.removeClass("parent-dragging"),
          Helpers.App.isMobile()
            ? (this.$parent.unbind("touchmove", this._dragMove),
              this.$parent.unbind("touchend", this._dragEnd),
              this.$parent.unbind("touchcancel", this._dragEnd))
            : (this.$parent.unbind("mousemove", this._dragMove),
              this.$parent.unbind("mouseup", this._dragEnd)),
          this._scrollCurrent();
      },
      dragTranslate: function (e) {
        this.singleItemSwipe &&
          (e > this._rightLimit
            ? (e = this._rightLimit)
            : e < this._leftLimit && (e = this._leftLimit)),
          (this.$parent.get(0).scrollLeft = e);
      },
      _clickBindings: function () {
        (this._clickListener = this._clickHandler.bind(this)),
          this.$parent.bind("click", this._clickListener);
      },
      _clickHandler: function () {
        var e = event.target.closest(".parent-item");
        null === e ||
          e.isSameNode(this.current.element) ||
          (event.preventDefault(),
          event.stopPropagation(),
          this._clickCurrent(e));
      },
      _clickCurrent: function (e) {
        this.dispatch("slider.beforeScroll"),
          this._setCurrent(e, parseInt(e.getAttribute("parent_num"))),
          "function" == typeof this.scrollCallback &&
            this.scrollCallback(this.current),
          this._clickPositionItem();
      },
      _clickPositionItem: function () {
        this.scrollToItem(this.current.num);
      },
      _clickUnbindEvents: function () {
        this.$parent.unbind("click", this._clickListener);
      },
      getSlider: function (e) {
        return this.$parent.find('[parent_num="' + e + '"]');
      },
    },
  }),
  Class(UI, "PreviewThumbnail")
    .inherits(Widget)
    .includes(
      BubblingSupport,
      PreviewThumbSupport
    )({
    prototype: {
      keepLoader: !1,
      firstLoad: !0,
      img: null,
      previewSrc: null,
      stageID: null,
      video: null,
      loadingOverlay: null,
      isImage: null,
      onPreview: !1,
      helpString: "",
      init: function (e) {
        Widget.prototype.init.call(this, e),
          (this.badge = this.element.find(".badge")),
          (this.anchor = this.element.find("a")),
          (this.img = this.element.find("img").not(".loading-gif")),
          (this.previewSrc = this.img.attr("data-preview-image")),
          (this.stageID = this.element.attr("data-stage-id")),
          (this.video = this.element.find("video")),
          (this.loadingOverlay = this.element.find(".loading-overlay")),
          (this.isImage = this.getTypeOfPreview()),
          (this.helpString = e.helpString || "Tap Again to Open"),
          (this.onPreview = !1),
          this.setBindings();
      },
      setBindings: function () {
        this.setOverlayBind(),
          this.isMobileDevice()
            ? ((this.tapCallback = []),
              this.tapCallback.push(this.showPreview.bind(this)),
              this.setMobileBindings())
            : (this.setHoverBind(), this.setUnhoverBind());
      },
      setHoverBind: function () {
        this.element.mouseenter(this.showPreview.bind(this));
      },
      setUnhoverBind: function () {
        this.element.mouseleave(this.hidePreview.bind(this));
      },
      isMobileDevice: function () {
        return Helpers.App.isMobileDevice();
      },
      isVideoAvailable: function () {
        return 0 == this.video.length
          ? !1
          : this.isImage
          ? !1
          : this.isProcessing()
          ? !1
          : !0;
      },
      isImageAvailable: function () {
        return this.previewSrc
          ? 0 == this.previewSrc.length
            ? !1
            : this.isImage
            ? this.isProcessing()
              ? !1
              : !0
            : !1
          : !1;
      },
      isProcessed: function () {
        return this.img[0].dataset.processed
          ? JSON.parse(this.img[0].dataset.processed)
          : !1;
      },
      isProcessing: function () {
        return this.img[0].dataset.busy
          ? JSON.parse(this.img[0].dataset.busy)
          : !1;
      },
      setFirstLoad: function (e) {
        "image" === e &&
          (this.loadingOverlay.fadeIn("fast"),
          (this.img[0].src = this.previewSrc),
          (this.firstLoad = !1)),
          "video" === e &&
            (this.loadingOverlay.fadeIn("fast"),
            (this.video[0].src = this.video.attr("data-src")),
            (this.firstLoad = !1));
      },
      setOverlayBind: function () {
        var e = this;
        this.video &&
          this.video.length > 0 &&
          this.video[0].addEventListener(
            "loadeddata",
            this.hideLoader.bind(this),
            !1
          ),
          this.previewSrc &&
            this.previewSrc.length > 0 &&
            this.img[0].addEventListener(
              "load",
              function () {
                return e.keepLoader === !0
                  ? void (e.keepLoader = !1)
                  : void e.loadingOverlay.fadeOut("fast");
              },
              !1
            );
      },
      showVideo: function () {
        this.video.show(),
          this.video[0].play(),
          Helpers.App.isMobileDevice() && (this.video[0].loop = !0);
      },
      hideVideo: function () {
        this.video.hide();
      },
      hideImage: function () {
        this.img[0].src = this.img.attr("data-src");
      },
      showImage: function () {
        this.img[0].src = this.previewSrc;
      },
      isHovered: function () {
        return this.element.hasClass("hover");
      },
      getTypeOfPreview: function () {
        if (this.video && this.video.attr("data-src")) {
          var e = this.video.attr("data-src").split(".").pop();
          return "jpg" == e || "png" == e || "jpeg" == e ? !0 : !1;
        }
        return !1;
      },
      showPreview: function () {
        this._showImgPreview(),
          this._showVideoPreview(),
          Helpers.App.isMobile() &&
            (this.showHelpText(), this.dispatch("preview.shown")),
          (this.onPreview = !0);
      },
      hidePreview: function () {
        this._hideVideoPreview(),
          this._hideImgPreview(),
          Helpers.App.isMobile() && (this.hideHelpText(), this.resetTap()),
          (this.onPreview = !1);
      },
      _showVideoPreview: function () {
        this.isVideoAvailable() &&
          (this.isProcessed() ||
            (this.firstLoad && this.setFirstLoad("video"),
            this.element.addClass("hover"),
            this.showVideo()));
      },
      _hideVideoPreview: function () {
        Helpers.App.isMobile() &&
          (this.video.length > 0 &&
            this.video[0].removeEventListener(
              "loadeddata",
              this.hideLoader.bind(this)
            ),
          this.cleanUpVideo(),
          this.hideLoader(),
          (this.firstLoad = !0),
          this.video.length > 0 &&
            this.video[0].addEventListener(
              "loadeddata",
              this.hideLoader.bind(this)
            )),
          this.isVideoAvailable() &&
            (this.element.removeClass("hover"), this.hideVideo());
      },
      _showImgPreview: function () {
        this.isImageAvailable() &&
          (this.isProcessed() ||
            (this.firstLoad && this.setFirstLoad("image"),
            this.element.addClass("hover"),
            this.showImage()));
      },
      _hideImgPreview: function () {
        this.isImageAvailable() &&
          this.previewSrc &&
          !this.isProcessed() &&
          (this.element.removeClass("hover"), this.hideImage());
      },
      showLoader: function () {
        this.loadingOverlay.fadeOut("fast");
      },
      hideLoader: function () {
        this.loadingOverlay.fadeOut("fast");
      },
    },
  }),
  Class(UI, "ImageContainer").inherits(Widget).includes(GenericDestroySupport)({
    html: '        <div>            <img class="lazyload">        </div>',
    elementClass: "image-container",
    prototype: {
      imgRegExp: /(^data:image)|(jpg|gif|jpeg|png$)/,
      imageURL: null,
      cssClass: null,
      hideByDefault: !1,
      init: function (e) {
        Widget.prototype.init.call(this, e);
        var t = this,
          n = /^-?[_a-zA-Z-]+[_-a-zA-Z0-9]*\S$/;
        if (!this.cssClass || !n.test(this.cssClass))
          throw new Error("Invalid class name passed");
        if (!this.imageURL || !t.imgRegExp.test(this.imageURL))
          throw new Error("Invalid image source passed");
        (t.$image = this.element.find("img")),
          this.element.addClass(this.cssClass),
          t.$image.attr("data-src", e.imageURL),
          e.hideByDefault && this.hide();
      },
      show: function () {
        Widget.prototype.show.call(this);
      },
      hide: function () {
        Widget.prototype.hide.call(this);
      },
      update: function (e) {
        var t = this;
        if (!e || !t.imgRegExp.test(e))
          throw new Error("Invalid image path passed");
        t.$image.attr("data-src", ""), t.$image.attr("src", e);
      },
    },
  }),
  Module(
    UI,
    "ThumbItemSupport"
  )({
    supportedRepositionTypes: [".jpg", ".jpeg", ".png", ".mp4", ".mov"],
    librarySupportedRepositionTypes: [".jpg", ".jpeg", ".png", ".mp4", ".mov"],
    prototype: {
      imgNaturalWidth: null,
      imgNaturalHeight: null,
      _bindings: function () {
        this.element.bind(
          "click",
          function () {
            this.dispatch("graphicClicked", {
              item: this,
            });
          }.bind(this)
        ),
          this.bind("render", function (e) {
            e.stopPropagation();
          });
      },
      select: function (e) {
        if (
          ((this.record.visible = !0),
          this.element.addClass("active"),
          this.excludeTrimmer === !1)
        ) {
          var t;
          this.canReposition() &&
            (t = new UI.SmartTemplate.RepositionAssetButton({
              name: "repositionAssetButton",
              isCustomUpload: this.isCustomUpload,
              type: this.record.assetType,
            })),
            t &&
              (this.appendChild(t),
              t.bind("render", function (e) {
                e.stopPropagation();
              }),
              t.render(this.element),
              this.repositionAssetButtonCanActivate() && t.activate(),
              e && t.showPopover());
        }
        this.repositionAssetButton &&
          this.repositionAssetButton.bind(
            "click",
            function (e) {
              if (
                (e.stopPropagation(),
                this.repositionAssetButton.hidePopover(),
                "image" === this.record.assetType &&
                  this.dispatch("repositionGraphicActivate"),
                "video" === this.record.assetType)
              ) {
                var t = this._getRepositionVideoEvent(),
                  n = this._getRepositionVideoEventData();
                this.dispatch(t, n);
              }
            }.bind(this)
          );
      },
      deselect: function () {
        (this.record.visible = !1),
          this.element.removeClass("active"),
          this.repositionAssetButton &&
            (this.repositionAssetButton.hidePopover(),
            this.repositionAssetButton.destroy());
      },
      focus: function (e) {
        return this.parent.$graphicBody.scrollTop(e), this;
      },
      destroy: function () {
        (this.className = null),
          (this.record = null),
          this.element.unbind("click"),
          Widget.prototype.destroy.call(this);
      },
      loadImage: function (e) {
        if (this.element) {
          var t = this,
            n = this.element.find("img").get(0),
            i = new Image();
          if (!n || !n.dataset) return e();
          (i.src = n.dataset.src),
            (i.onload = function () {
              (n.src = n.dataset.src),
                t.dispatch("thumbImageLoaded", {
                  success: !0,
                  listItem: t,
                }),
                e();
            }),
            (i.onerror = function () {
              t.dispatch("thumbImageLoaded", {
                success: !1,
                listItem: t,
              }),
                e();
            });
        }
      },
      requestImage: function () {
        var e,
          t,
          n = this;
        return (
          (t = this.element.find("img").get(0)),
          (e = new Image()),
          (e.src = t.dataset.src),
          new Promise(function (i, r) {
            (e.onload = function () {
              (t.src = t.dataset.src),
                (n.imgNaturalHeight = this.height),
                (n.imgNaturalWidth = this.width),
                i({
                  width: this.width,
                  height: this.height,
                });
            }),
              (e.onerror = function () {
                r({
                  message: "Image load fail",
                  src: e.src,
                });
              });
          })
        );
      },
      setSize: function (e, t) {
        this.element.height(t), this.element.width(e);
      },
      getRecord: function () {
        return this.record;
      },
      showFeedbackLayer: function (e) {
        return (
          this.element.addClass("item__showing-feedback-layer"),
          this.repositionAssetButton && this.repositionAssetButton.deactivate(),
          this.feedbackLayerWidget
            ? this.feedbackLayerWidget.updateText(e)
            : this.appendChild(
                new UI.SmartTemplate.ThumbItemFeedbackLayer({
                  name: "feedbackLayerWidget",
                  text: e,
                })
              ).render(this.element),
          this
        );
      },
      hideFeedbackLayer: function () {
        return (
          this.element.removeClass("item__showing-feedback-layer"),
          this.repositionAssetButton && this.repositionAssetButton.activate(),
          this.feedbackLayerWidget && this.feedbackLayerWidget.destroy(),
          this
        );
      },
      hasAsset: function () {
        return "null" !== this.record.id;
      },
      canReposition: function () {
        var e =
            this.isCustomUpload &&
            this.constructor.supportedRepositionTypes.includes(
              this.record.type
            ),
          t =
            !this.isCustomUpload &&
            this.constructor.librarySupportedRepositionTypes.includes(
              this.record.type
            );
        return e || t;
      },
      repositionAsset: function () {
        this.repositionAssetButton._clickHandler();
      },
      getThumbImageUrl: function () {
        var e, t;
        return (
          (e = this),
          (t = e.img.attr("src") || e.img.attr("data-src")),
          e.isCustomUpload && e.userImagePath && (t = e.userImagePath),
          Promise.resolve(t)
        );
      },
      repositionAssetButtonCanActivate: function () {
        return "image" === this.record.assetType
          ? this._repositionAssetButtonCanActivateImage()
          : this._repositionAssetButtonCanActivateVideo();
      },
      _repositionAssetButtonCanActivateVideo: function () {
        return this.isCustomUpload && this.userVideoPath
          ? !0
          : !this.isCustomUpload && this.record.smallImageSize
          ? !0
          : !1;
      },
      _repositionAssetButtonCanActivateImage: function () {
        return this.isCustomUpload && this.userImagePath
          ? !0
          : !this.isCustomUpload && this.record.path
          ? !0
          : !1;
      },
      _getRepositionVideoEvent: function () {
        return this.isCustomUpload
          ? "repositionVideo"
          : "repositionLibraryVideo";
      },
      _getRepositionVideoEventData: function () {
        var e = {
          viewportData: this.viewportData,
          duration: Number(this.record.duration),
          fragmentDuration: Number(this.fragmentDuration),
          videoItem: this,
        };
        if (this.isCustomUpload)
          (e.cropParams = this.cropParams),
            (e.userVideoPath = this.userVideoPath),
            (e.recordHash = this.record.record_hash),
            (e.duration = Number(this.duration)),
            (e.videoWidth = Number(this.videoWidth)),
            (e.videoHeight = Number(this.videoHeight)),
            (e.timelineUrls = this.timelineUrls),
            (e.originalVideoUrl = this.originalVideoUrl);
        else {
          var t = this.record.smallImageSize.split("x");
          (e.libraryId = this.record.id),
            (e.videoWidth = Number(t[0])),
            (e.videoHeight = Number(t[1]));
        }
        return e;
      },
    },
  }),
  Class(UI.SmartTemplate, "ColorControl")
    .inherits(Widget)
    .includes(
      BubblingSupport,
      GenericDestroySupport,
      ColorPalettesSupport,
      SkeletonCardSupport
    )({
    html: '        <div>            <label class="title"> Color </label>            <input class="colorpicker" value="#000000" type="text" />        </div>',
    elementClass: "color-control",
    prototype: {
      initialValue: null,
      _popstateHandler: null,
      _prefillColorTimeout: null,
      allowTransparency: !1,
      _alwaysOpen: !1,
      init: function (e) {
        var t = this;
        Widget.prototype.init.call(this, e),
          (t.initialValue = e.record.color),
          (t.prefix = e.prefix || ""),
          (t.sidebarSide = e.sidebarSide || ""),
          (t.colorPickerUrlParameterName =
            e.urlParameterName || t.prefix + t.name),
          (t.changeColorEventName = t.changeColorEventName || "colorChange"),
          (t.allowTransparency = e.allowTransparency),
          void 0 === t.colorPickerPopupTopOffset &&
            (t.colorPickerPopupTopOffset = 22),
          this.label && "" != this.label
            ? this.element.find("label.title").html(this.label)
            : this.element.find("label.title").hide(),
          (this.$colorpicker = this.element.find(".colorpicker")),
          this.$colorpicker.val(this.record.color),
          this.$colorpicker.bind("change", function () {
            var e = t.$colorpicker.spectrum("get"),
              n = 0 == e._a;
            (t.record.color = n
              ? t.allowTransparency
                ? null
                : "#FFFFFF"
              : e.toHexString()),
              t.isExtraColor &&
                t.dispatch("extracolorchanged", {
                  originalDispatcher: t,
                  color: t.record.color,
                });
          }),
          (t._showSmartTemplateModal = t._showSmartTemplateModal.bind(t)),
          t.$colorpicker.bind("reflow.spectrum", t._showSmartTemplateModal),
          (t._changeColorHandler = t._changeColorHandler.bind(t)),
          t.element.bind("change", t._changeColorHandler),
          (this.previousValue = e.record.color || "transparent");
        var n = e.isMobilePhone
            ? "colorpicker-container-mobile"
            : "colorpicker-container-background-color-control",
          i = null;
        if (
          ("1" == this.record.limited_colors
            ? ((i = this.getLimitedColorsPalette()), (n += " limited-colors"))
            : (i = this.getFullPalette()),
          (this.colorPickerDataSet = {
            preferredFormat: "hex",
            showPaletteOnly: !0,
            togglePaletteOnly:
              !e.isMobilePhone &&
              ("0" == this.record.limited_colors ||
                void 0 === this.record.limited_colors),
            showInput: !0,
            allowEmpty: !1,
            clickoutFiresChange: !1,
            palette: i,
            color: this.previousValue,
            containerClassName: n,
            replacerClassName: e.isMobilePhone
              ? "colorpicker-container-mobile"
              : "colorpicker-container",
            hideAfterPaletteSelect: !0,
            appendTo: e.isMobilePhone
              ? $("#smartTemplateModal .modal-body")
              : null,
            show: function () {
              t._alwaysOpen !== !0 &&
                (t.dispatch("componentOpen", {
                  component: t.$colorpicker,
                }),
                t._colorPickerPosition.setSidebarSide(t._identifySide()));
            },
            hide: function (n) {
              return t._alwaysOpen === !0
                ? void t.$colorpicker.spectrum("show")
                : (t.previousValue &&
                    t.previousValue.toLowerCase() != "#" + n.toHex() &&
                    t.$colorpicker.trigger("change", {
                      triggeredByUser: !0,
                      originalDispatcher: t,
                    }),
                  e.isMobilePhone &&
                    t.dispatch("hideModal", {
                      originalDispatcher: t,
                    }),
                  void t.dispatch("componentOpen"));
            },
            change: function () {
              t.$colorpicker.trigger("change", {
                triggeredByPopState: !1,
                triggeredByUser: !0,
                originalDispatcher: t,
              });
            },
          }),
          (this.colorPickerDataSet = $.extend(
            {},
            this.colorPickerDataSet,
            this.spectrumOptions
          )),
          (this._spectrumWrapper = new SpectrumWrapper({
            $colorpicker: this.$colorpicker,
            spectrumConfig: this.colorPickerDataSet,
            limitedColors: "1" == this.record.limited_colors,
            standardBehavior: e.isMobilePhone,
          })),
          (t._popstateHandler = function () {
            var e = Helpers.App.getAllURLParams(),
              n = e[t.colorPickerUrlParameterName];
            "null" === n && (n = "rgba(0,0,0,0)"),
              t.$colorpicker.spectrum("set", n || t.initialValue || "#F1F1F1"),
              t.$colorpicker.trigger("change", {
                triggeredByPopState: !0,
              });
          }),
          e.isMobilePhone &&
            this.element.find(".sp-replacer").unbind("touchstart"),
          window.addEventListener("popstate", t._popstateHandler),
          this._setColorPickerPositioning(),
          this.bindSkeleton(),
          e.prefillColor)
        ) {
          var r = e.prefillColor;
          "null" === r && (r = "rgba(0,0,0,0)"),
            (t._prefillColorTimeout = setTimeout(function () {
              t.$colorpicker.spectrum("set", r),
                t.skipDispatchChangeForPrefillColor &&
                  (t.record.color = t.prefillColor),
                t.$colorpicker.trigger("change", {
                  triggeredByPopState: !0,
                });
            }, 0));
        } else {
          var s = t.record.color,
            o = {
              triggeredByUser: !1,
              originalDispatcher: t,
              color: s,
            };
          t._prefillColorTimeout = setTimeout(function () {
            t.dispatch("colorControlReady", o);
          }, 0);
        }
      },
      _changeColorHandler: function (e, t, n) {
        var i = this,
          r = i.record.color,
          s = t && t.triggeredByPopState;
        n = t && t.triggeredByUser;
        var o = {
            triggeredByPopState: s,
            triggeredByUser: n,
            originalDispatcher: i,
            color: r,
          },
          a = i.previousValue && i.previousValue.toLowerCase();
        a !== r &&
          (i.record.visible === !1
            ? i.dispatch("notVisible")
            : i.dispatch("change", o),
          s ||
            Helpers.App.replaceUrlParamWithHistory(
              i.colorPickerUrlParameterName,
              r
            ),
          window._stageData &&
            Helpers.GlobalEventTracker.smartTemplateEvent(
              i.changeColorEventName,
              Object.assign(
                {
                  name: i.name,
                  previous: i.previousValue,
                  new: r,
                },
                Helpers.App.getProductShownData()
              )
            ),
          (i.previousValue = r)),
          i.dispatch("colorControlReady", o);
      },
      _showSmartTemplateModal: function () {
        var e = this;
        return e.isMobilePhone
          ? e.dispatch("showModal", {
              originalDispatcher: e,
            })
          : void 0;
      },
      _identifySide: function () {
        for (var e = this.parent; e; ) {
          if ("leftSideBar" === e.name) return "left";
          e = e.parent;
        }
        return "right";
      },
      _setColorPickerPositioning: function () {
        var e = this.$colorpicker.spectrum("container"),
          t = this._identifySide(),
          n = $("#main-content-wrapper");
        Helpers.StageType.isSmartTemplate() &&
          !Helpers.App.isMobile() &&
          (n = $(".smart-templates__sidebar." + t)),
          (this._colorPickerPosition = new ColorPickerPosition({
            $colorpicker: this.$colorpicker,
            $control: this.element.find(".sp-replacer"),
            $container: e,
            $toggleButtons: e.find(".sp-palette-toggle"),
            $horizontalLimit: $("body"),
            $verticalLimit: n,
            $dragAreas: e
              .find(
                ".sp-container, .sp-palette-container, .sp-picker-container, .show-colors-buttons-container"
              )
              .add(e),
            sidebarSide: t,
          }));
      },
      updatePrefix: function (e) {
        (this.prefix = e),
          (this.colorPickerUrlParameterName = this.prefix + this.name);
      },
      refreshColorpicker: function () {
        var e = this,
          t = e.record.color;
        null === t && (t = "rgba(0,0,0,0)"), e.$colorpicker.spectrum("set", t);
      },
      destroy: function () {
        this.element &&
          (this.$colorpicker.spectrum("destroy"),
          clearTimeout(this._prefillColorTimeout),
          window.removeEventListener("popstate", this._popstateHandler),
          this.genericDestroy());
      },
      callSpectrumWrapper: function (e) {
        return this.$colorpicker.spectrum(e);
      },
      enableColorControlAlwaysOpen: function () {
        this._alwaysOpen = !0;
      },
      disableColorControlAlwaysOpen: function () {
        this._alwaysOpen = !1;
      },
    },
  }),
  Class("ImageValidation")({
    run: function (e) {
      return ImageValidation.getRealMimeType(e).then(
        ImageValidation._validateMimeType
      );
    },
    getRealMimeType: function (e) {
      return new Promise(function (t) {
        var n,
          i,
          r = "unknown",
          s = "";
        for (
          n = ImageValidation._b64toUint8Array(
            e.slice(0, 50).split(",")[1],
            0,
            4
          ),
            i = 0;
          i < n.length;
          i++
        )
          s += n[i].toString(16);
        "ffd8" === s.slice(0, 4)
          ? (r = "image/jpeg")
          : "89504e47" === s && (r = "image/png"),
          t({
            realMimeType: r,
            base64: e,
          });
      });
    },
    _validateMimeType: function (e) {
      return new Promise(function (t, n) {
        -1 === ["image/jpeg", "image/png"].indexOf(e.realMimeType) &&
          n("Image mime type is not png or jpeg"),
          t(e);
      });
    },
    _b64toUint8Array: function (e, t, n) {
      var i = atob(e).slice(t, n).split("");
      return new Uint8Array(
        i.map(function (e) {
          return e.charCodeAt();
        })
      );
    },
  }),
  Class("CropResize")({
    TILE_SIZE: 1024,
    BLUR_THRESHOLD: 2 / 3,
    BLUR_DOWNSAMPLE_THRESHOLD: 0.25,
    JPG_BLUR_FACTOR: 0.18,
    PNG_BLUR_FACTOR: 0.28,
    TRANSP_BLUR_FACTOR: 0.37,
    FAST_DOWNSAMPLE_THRESHOLD: 0.3,
    UNIT_SQUARE: new Float32Array([1, 1, -1, 1, 1, -1, -1, -1]),
    _GL_CONFIGS: {
      alpha: !0,
      antialias: !1,
      depth: !1,
      stencil: !1,
    },
    run: function (e, t) {
      var n = new CropResize();
      return CropResize.downsampleInput(e, t).then(function (e) {
        return n._cropResize(e.base64, e.params);
      });
    },
    resize: function (e, t, n) {
      return ImageValidation.run(e)
        .then(function () {
          return Helpers.Image.getImageFromSrc(e);
        })
        .then(function (i) {
          var r = i.width,
            s = i.height;
          return CropResize.run(e, {
            converted: !0,
            srcX: 0,
            srcY: 0,
            srcW: r,
            srcH: s,
            dstX: 0,
            dstY: 0,
            dstW: t,
            dstH: n,
            inW: r,
            inH: s,
            outW: t,
            outH: n,
            scale: t / r,
          });
        });
    },
    crop: function (e, t) {
      var n = CropResize.convertParams(t),
        i = document.createElement("canvas");
      return (
        (i.width = n.outW),
        (i.height = n.outH),
        ImageValidation.run(e)
          .then(function () {
            return Helpers.Image.getImageFromSrc(e);
          })
          .then(function (e) {
            return (
              i
                .getContext("2d")
                .drawImage(
                  e,
                  n.srcX,
                  n.srcY,
                  n.srcW,
                  n.srcH,
                  n.dstX,
                  n.dstY,
                  n.dstW,
                  n.dstH
                ),
              i.toDataURL("image/png")
            );
          })
      );
    },
    generateThumbnail: function (e) {
      return Helpers.Image.getImageFromSrc(e).then(function (t) {
        var n = t.width,
          i = t.height,
          r = n / i,
          s = 110,
          o = Math.round(s / r);
        return CropResize.run(e, {
          converted: !0,
          srcX: 0,
          srcY: 0,
          srcW: n,
          srcH: i,
          dstX: 0,
          dstY: 0,
          dstW: s,
          dstH: o,
          inW: n,
          inH: i,
          outW: s,
          outH: o,
          scale: s / n,
        });
      });
    },
    convertParams: function (e) {
      var t, n, i, r, s, o, a, l, c, u, d, h;
      return e.converted
        ? e
        : (e.x
            ? ((i = parseFloat(e.x)),
              (r = parseFloat(e.y)),
              (s = e.width),
              (o = e.height),
              (a = e["viewport[width]"]),
              (l = e["viewport[height]"]))
            : ((a = e.viewport.width),
              (l = e.viewport.height),
              "width" === e.longer_side
                ? ((t = e.actual_width / a), (n = e.new_width / a))
                : ((t = e.actual_height / l), (n = e.new_height / l)),
              (i = e.left / n),
              (r = e.top / n),
              (s = (e.actual_width / t) * e.zoom),
              (o = (e.actual_height / t) * e.zoom)),
          (c = s / e.actual_width),
          (u = {
            x: 0,
            y: 0,
            w: a,
            h: l,
          }),
          (d = {
            x: i,
            y: r,
            w: s,
            h: o,
          }),
          (h = CropResize._getRectIntersection(u, d)),
          {
            converted: !0,
            srcX: (h.x - i) / c,
            srcY: (h.y - r) / c,
            srcW: h.w / c,
            srcH: h.h / c,
            dstX: Math.round(h.x),
            dstY: Math.round(h.y),
            dstW: Math.round(h.w),
            dstH: Math.round(h.h),
            inW: e.actual_width,
            inH: e.actual_height,
            outW: a,
            outH: l,
            scale: c,
          });
    },
    downsampleInput: function (e, t) {
      var n,
        i,
        r,
        s = CropResize.convertParams(t),
        o = 2,
        a = CropResize.FAST_DOWNSAMPLE_THRESHOLD;
      if (s.scale > a / 2)
        return Promise.resolve({
          base64: e,
          params: s,
        });
      for (; s.scale * o < a; ) o *= 2;
      return Helpers.Image.getImageFromSrc(e).then(function (e) {
        return (
          (n = Helpers.Image.getCanvasFromImage(e)),
          (i = document.createElement("canvas")),
          (r = i.getContext("2d")),
          (i.width = n.width / o),
          (i.height = n.height / o),
          (r.imageSmoothingEnabled = !0),
          (r.imageSmoothingQuality = "low"),
          (r.globalCompositeOperation = "copy"),
          r.drawImage(e, 0, 0, n.width, n.height, 0, 0, i.width, i.height),
          (s.scale *= o),
          (s.srcX /= o),
          (s.srcY /= o),
          (s.srcW /= o),
          (s.srcH /= o),
          (s.inW = i.width),
          (s.inH = i.height),
          {
            base64: i.toDataURL("image/png"),
            params: s,
          }
        );
      });
    },
    _getRectIntersection: function (e, t) {
      var n, i, r, s;
      return (
        (n = Math.max(e.x, t.x)),
        (i = Math.max(e.y, t.y)),
        (r = Math.min(e.x + e.w, t.x + t.w)),
        (s = Math.min(e.y + e.h, t.y + t.h)),
        {
          x: n,
          y: i,
          w: r - n,
          h: s - i,
        }
      );
    },
    prototype: {
      _image: null,
      _canvas: null,
      _ctx: null,
      _glCanvas: null,
      _gl: null,
      _fb1: null,
      _fb2: null,
      _tex1: null,
      _tex2: null,
      _shaders: null,
      _programs: null,
      _cropResize: function (e, t) {
        var n,
          i,
          r,
          s,
          o,
          a = this,
          l = CropResize.convertParams(t),
          c = Date.now();
        return 1 === l.scale
          ? CropResize.crop(e, l)
          : ImageValidation.run(e)
              .then(function (e) {
                n = e;
              })
              .then(function () {
                return Helpers.Image.getImageFromSrc(e);
              })
              .then(function (e) {
                return (
                  (a._image = e),
                  a._initGL(l),
                  (i =
                    "image/jpeg" === n ? !1 : Helpers.Image.hasTransparency(e)),
                  (r = a._getResizingStrategy(n, i, l.scale)),
                  (s = a._getTiles(l, r)),
                  (o = a._processTiles(s, r)),
                  a._cleanGL(),
                  Helpers.GlobalEventTracker.track("clientCropResize", {
                    eventAction: "clientCropResize",
                    time: Date.now() - c,
                    cropParams: l,
                    isMobile: Helpers.App.isMobile(),
                  }),
                  o
                );
              });
      },
      _initGL: function (e) {
        var t,
          n = document.createElement("canvas"),
          i =
            n.getContext("webgl", CropResize._GL_CONFIGS) ||
            n.getContext("experimental-webgl", CropResize._GL_CONFIGS),
          r = document.createElement("canvas"),
          s = r.getContext("2d");
        i.disable(i.BLEND),
          i.disable(i.CULL_FACE),
          i.disable(i.DEPTH_TEST),
          i.disable(i.DITHER),
          i.disable(i.POLYGON_OFFSET_FILL),
          i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),
          i.disable(i.SAMPLE_COVERAGE),
          i.disable(i.SCISSOR_TEST),
          i.disable(i.STENCIL_TEST),
          i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL, !0),
          i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL, i.NONE),
          i.activeTexture(i.TEXTURE0),
          i.clearColor(0, 0, 0, 0),
          (r.width = e.outW),
          (r.height = e.outH),
          (n.width = CropResize.TILE_SIZE),
          (n.height = CropResize.TILE_SIZE),
          (this._canvas = r),
          (this._ctx = s),
          (this._glCanvas = n),
          (this._gl = i),
          (this._fb1 = i.createFramebuffer()),
          (this._fb2 = i.createFramebuffer()),
          (this._tex1 = this._createTexture()),
          (this._tex2 = this._createTexture()),
          (this._shaders = []),
          (this._programs = []),
          i.bindTexture(i.TEXTURE_2D, this._tex1),
          i.bindFramebuffer(i.FRAMEBUFFER, this._fb1),
          i.framebufferTexture2D(
            i.FRAMEBUFFER,
            i.COLOR_ATTACHMENT0,
            i.TEXTURE_2D,
            this._tex1,
            0
          ),
          i.bindTexture(i.TEXTURE_2D, this._tex2),
          i.bindFramebuffer(i.FRAMEBUFFER, this._fb2),
          i.framebufferTexture2D(
            i.FRAMEBUFFER,
            i.COLOR_ATTACHMENT0,
            i.TEXTURE_2D,
            this._tex2,
            0
          ),
          (t = i.createBuffer()),
          i.bindBuffer(i.ARRAY_BUFFER, t),
          i.bufferData(i.ARRAY_BUFFER, CropResize.UNIT_SQUARE, i.STATIC_DRAW);
      },
      _createTexture: function () {
        var e = this._gl,
          t = e.createTexture();
        return (
          e.bindTexture(e.TEXTURE_2D, t),
          e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MIN_FILTER, e.LINEAR),
          e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MAG_FILTER, e.LINEAR),
          e.texParameteri(e.TEXTURE_2D, e.TEXTURE_WRAP_S, e.CLAMP_TO_EDGE),
          e.texParameteri(e.TEXTURE_2D, e.TEXTURE_WRAP_T, e.CLAMP_TO_EDGE),
          t
        );
      },
      _processTiles: function (e, t) {
        var n = this;
        return (
          e.forEach(function (e) {
            n._loadTileIntoTexture(e),
              t.forEach(function (t) {
                t.draw(e);
              });
          }),
          this._canvas.toDataURL("image/png")
        );
      },
      _getTiles: function (e, t) {
        var n,
          i,
          r,
          s,
          o,
          a,
          l,
          c,
          u,
          d,
          h,
          p,
          f,
          m,
          g,
          _,
          v,
          y,
          b,
          w,
          C,
          k,
          T = [],
          S = e.scale;
        for (
          n =
            t.reduce(function (e, t) {
              return Math.max(e, t.radius);
            }, 0) + 2,
            1 > S
              ? ((r = CropResize.TILE_SIZE),
                (i = r - 2 * n),
                (s = Math.floor(i * S)),
                (i = s / S),
                (n = (r - i) / 2),
                (o = Math.ceil(e.dstW / s)),
                (a = Math.ceil(e.dstH / s)))
              : ((s = CropResize.TILE_SIZE),
                (i = s / S),
                (r = Math.ceil(i + 2 * n)),
                (o = Math.ceil(e.dstW / s)),
                (a = Math.ceil(e.dstH / s))),
            C = 0;
          a > C;
          C++
        )
          for (
            c = C * s,
              d = Math.min(s, e.dstH - c),
              p = c / S,
              m = d / S,
              p += e.srcY,
              c += e.dstY,
              _ = Math.max(0, Math.floor(p - n)),
              w = p - _,
              y = Math.min(r, e.inH - _),
              k = 0;
            o > k;
            k++
          )
            (l = k * s),
              (u = Math.min(s, e.dstW - l)),
              (h = l / S),
              (f = u / S),
              (h += e.srcX),
              (l += e.dstX),
              (g = Math.max(0, Math.floor(h - n))),
              (b = h - g),
              (v = Math.min(r, e.inW - g)),
              T.push({
                srcW: f,
                srcH: m,
                dstX: l,
                dstY: c,
                dstW: u,
                dstH: d,
                texX: g,
                texY: _,
                texW: v,
                texH: y,
                srcOffsetX: b,
                srcOffsetY: w,
              });
        return T;
      },
      _getResizingStrategy: function (e, t, n) {
        var i,
          r = [];
        return n > 1
          ? [this._generateBicubicResize()]
          : (n < CropResize.BLUR_THRESHOLD &&
              ((i =
                n < CropResize.BLUR_DOWNSAMPLE_THRESHOLD
                  ? this._generateDownsampleBlur.bind(this)
                  : this._generateBlur.bind(this)),
              r.push(
                "image/jpeg" === e
                  ? i(this._calcBlurSigma(n, CropResize.JPG_BLUR_FACTOR))
                  : t
                  ? i(this._calcBlurSigma(n, CropResize.TRANSP_BLUR_FACTOR))
                  : i(this._calcBlurSigma(n, CropResize.PNG_BLUR_FACTOR))
              )),
            n >= CropResize.BLUR_DOWNSAMPLE_THRESHOLD &&
              r.push(this._generateBicubicResize()),
            r);
      },
      _calcBlurSigma: function (e, t) {
        return t / e;
      },
      _loadTileIntoTexture: function (e) {
        var t = this._gl,
          n = document.createElement("canvas"),
          i = n.getContext("2d");
        (n.width = e.texW),
          (n.height = e.texH),
          (i.globalCompositeOperation = "copy"),
          i.drawImage(
            this._image,
            e.texX,
            e.texY,
            e.texW,
            e.texH,
            0,
            0,
            e.texW,
            e.texH
          ),
          t.bindTexture(t.TEXTURE_2D, this._tex1),
          t.texImage2D(t.TEXTURE_2D, 0, t.RGBA, t.RGBA, t.UNSIGNED_BYTE, n);
      },
      _getGaussian: function (e) {
        var t = e * e;
        return function (n) {
          return (
            (1 / (Math.sqrt(2 * Math.PI) * e)) * Math.exp((-n * n) / (2 * t))
          );
        };
      },
      _getGaussianKernel: function (e) {
        var t,
          n = this._getGaussian(e),
          i = Math.max(Math.ceil(2 * e), 2),
          r = new Array(i + 1),
          s = 0;
        for (r[0] = n(0), s += r[0], t = 1; i >= t; t++)
          (r[t] = n(t)), (s += 2 * r[t]);
        for (t = 0; i >= t; t++) r[t] /= s;
        return {
          array: r,
          radius: i,
        };
      },
      _generateBlur: function (e) {
        var t,
          n = this._gl,
          i = this,
          r = this._getGaussianKernel(e),
          s = CropResizeShaders.vert1,
          o = CropResizeShaders.generateBlurFrag(r.array),
          a = this._initShaderProgram(s, o),
          l = n.getAttribLocation(a, "pos"),
          c = n.getUniformLocation(a, "direction"),
          u = n.getUniformLocation(a, "srcSize"),
          d = n.getUniformLocation(a, "invTexSize"),
          h = n.getUniformLocation(a, "offset"),
          p = n.getUniformLocation(a, "tex");
        return (
          (t = function (e) {
            var t, r;
            for (
              n.useProgram(a),
                n.viewport(0, 0, e.texW, e.texH),
                n.enableVertexAttribArray(l),
                n.vertexAttribPointer(l, 2, n.FLOAT, !1, 0, 0),
                n.uniform2f(u, e.texW, e.texH),
                n.uniform2f(d, 1 / e.texW, 1 / e.texH),
                n.uniform2f(h, 0, 0),
                n.uniform1i(p, 0),
                n.bindFramebuffer(n.FRAMEBUFFER, i._fb2),
                n.bindTexture(n.TEXTURE_2D, i._tex2),
                n.texImage2D(
                  n.TEXTURE_2D,
                  0,
                  n.RGBA,
                  e.texW,
                  e.texH,
                  0,
                  n.RGBA,
                  n.UNSIGNED_BYTE,
                  null
                ),
                t = 0;
              2 > t;
              t++
            )
              (r = t % 2 === 0),
                n.bindFramebuffer(n.FRAMEBUFFER, r ? i._fb2 : i._fb1),
                n.clear(n.COLOR_BUFFER_BIT),
                n.bindTexture(n.TEXTURE_2D, r ? i._tex1 : i._tex2),
                n.uniform2fv(c, r ? [1, 0] : [0, 1]),
                n.drawArrays(n.TRIANGLE_STRIP, 0, 4);
          }),
          {
            draw: t,
            radius: r.radius,
          }
        );
      },
      _generateDownsampleBlur: function (e) {
        var t,
          n = this._gl,
          i = this,
          r = this._getGaussianKernel(e),
          s = CropResizeShaders.vert1,
          o = CropResizeShaders.generateBlurFrag(r.array),
          a = this._initShaderProgram(s, o),
          l = n.getAttribLocation(a, "pos"),
          c = n.getUniformLocation(a, "direction"),
          u = n.getUniformLocation(a, "srcSize"),
          d = n.getUniformLocation(a, "invTexSize"),
          h = n.getUniformLocation(a, "offset"),
          p = n.getUniformLocation(a, "flip"),
          f = n.getUniformLocation(a, "tex");
        return (
          (t = function (e) {
            var t, r, s, o, m, g;
            for (
              n.useProgram(a),
                n.enableVertexAttribArray(l),
                n.vertexAttribPointer(l, 2, n.FLOAT, !1, 0, 0),
                n.uniform1i(f, 0),
                n.bindTexture(n.TEXTURE_2D, i._tex2),
                n.texImage2D(
                  n.TEXTURE_2D,
                  0,
                  n.RGBA,
                  e.dstW,
                  e.texH,
                  0,
                  n.RGBA,
                  n.UNSIGNED_BYTE,
                  null
                ),
                t = 0;
              2 > t;
              t++
            )
              (r = t % 2 === 0),
                (s = r ? [e.dstW, e.texH] : [e.dstW, e.dstH]),
                (o = r ? [e.srcW, e.texH] : [e.dstW, e.srcH]),
                (m = r ? [1 / e.texW, 1 / e.texH] : [1 / e.dstW, 1 / e.texH]),
                (g = r ? [e.srcOffsetX, 0] : [0, e.srcOffsetY]),
                n.viewport(0, 0, s[0], s[1]),
                n.uniform2fv(u, o),
                n.uniform2fv(d, m),
                n.uniform2fv(h, g),
                n.uniform1f(p, !r),
                n.bindFramebuffer(n.FRAMEBUFFER, r ? i._fb2 : null),
                n.clear(n.COLOR_BUFFER_BIT),
                n.bindTexture(n.TEXTURE_2D, r ? i._tex1 : i._tex2),
                n.uniform2fv(c, r ? [1, 0] : [0, 1]),
                n.drawArrays(n.TRIANGLE_STRIP, 0, 4);
            i._ctx.drawImage(
              i._glCanvas,
              0,
              CropResize.TILE_SIZE - e.dstH,
              e.dstW,
              e.dstH,
              e.dstX,
              e.dstY,
              e.dstW,
              e.dstH
            );
          }),
          {
            draw: t,
            radius: r.radius,
          }
        );
      },
      _generateBicubicResize: function () {
        var e,
          t = this._gl,
          n = this,
          i = CropResizeShaders.bicubicVert,
          r = CropResizeShaders.bicubicFrag,
          s = this._initShaderProgram(i, r),
          o = t.getAttribLocation(s, "pos"),
          a = t.getUniformLocation(s, "srcSize"),
          l = t.getUniformLocation(s, "invTexSize"),
          c = t.getUniformLocation(s, "offset"),
          u = t.getUniformLocation(s, "tex"),
          d = t.getUniformLocation(s, "flip");
        return (
          (e = function (e) {
            t.useProgram(s),
              t.enableVertexAttribArray(o),
              t.vertexAttribPointer(o, 2, t.FLOAT, !1, 0, 0),
              t.uniform1i(u, 0),
              t.uniform1f(d, !0),
              t.uniform2f(c, e.srcOffsetX, e.srcOffsetY),
              t.uniform2f(a, e.srcW, e.srcH),
              t.uniform2f(l, 1 / e.texW, 1 / e.texH),
              t.bindFramebuffer(t.FRAMEBUFFER, null),
              t.viewport(0, CropResize.TILE_SIZE - e.dstH, e.dstW, e.dstH),
              t.clear(t.COLOR_BUFFER_BIT),
              t.bindTexture(t.TEXTURE_2D, n._tex1),
              t.drawArrays(t.TRIANGLE_STRIP, 0, 4),
              n._ctx.drawImage(
                n._glCanvas,
                0,
                0,
                e.dstW,
                e.dstH,
                e.dstX,
                e.dstY,
                e.dstW,
                e.dstH
              );
          }),
          {
            draw: e,
            radius: 2,
          }
        );
      },
      _initShaderProgram: function (e, t) {
        var n = this._gl,
          i = this._loadShader(n.VERTEX_SHADER, e),
          r = this._loadShader(n.FRAGMENT_SHADER, t),
          s = n.createProgram();
        if (
          (n.attachShader(s, i),
          n.attachShader(s, r),
          n.linkProgram(s),
          this._shaders.push(i),
          this._shaders.push(r),
          this._programs.push(s),
          !n.getProgramParameter(s, n.LINK_STATUS))
        )
          throw (
            (this._cleanGL(),
            new Error(
              "Unable to initialize the shader program:\n" +
                n.getProgramInfoLog(s)
            ))
          );
        return s;
      },
      _loadShader: function (e, t) {
        var n = this._gl,
          i = n.createShader(e);
        if (
          (n.shaderSource(i, t),
          n.compileShader(i),
          !n.getShaderParameter(i, n.COMPILE_STATUS))
        )
          throw (
            (this._cleanGL(),
            new Error(
              "An error occurred compiling the shaders:\n" +
                n.getShaderInfoLog(i) +
                t
            ))
          );
        return i;
      },
      _cleanGL: function () {
        var e = this._gl;
        this._shaders.forEach(function (t) {
          e.deleteShader(t);
        }),
          this._programs.forEach(function (t) {
            e.deleteProgram(t);
          }),
          e.deleteTexture(this.tex1),
          e.deleteTexture(this.tex2),
          e.deleteFramebuffer(this.fb1),
          e.deleteFramebuffer(this.fb2),
          window.WebGLMemoryEstimator &&
            WebGLMemoryEstimator.stopTrackingContext(this._gl),
          (this._gl = null),
          (this._glCanvas = null),
          (this._ctx = null),
          (this._canvas = null),
          (this._image = null);
      },
    },
  }),
  Class("CropResizeShaders")({
    vert1:
      "precision mediump float;\nattribute vec4 pos;\nvarying vec2 uv;\nuniform bool flip;\nuniform vec2 srcSize;\nuniform vec2 invTexSize;\nuniform vec2 offset;\nvoid main() {\n   gl_Position = pos;\n   uv = (pos.xy + 1.0) * 0.5;\n   if (flip) {\n	    uv.y = 1.0 - uv.y;\n   }\n   uv = (uv * srcSize + offset) * invTexSize;\n}",
    bicubicVert:
      "precision mediump float;\nattribute vec4 pos;\nvarying vec2 uv;\nuniform bool flip;\nuniform vec2 srcSize;\nuniform vec2 offset;\nvoid main(void) {\n    gl_Position = pos;\n    uv = (pos.xy + 1.0) * 0.5;\n    if (flip) {\n        uv.y = 1.0 - uv.y;\n    }\n    uv = uv * srcSize - 0.5 + offset;\n}",
    // Copyright :copyright: 2014 Inigo Quilez
    // Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions: The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
    bicubicFrag:
      "precision mediump float;\nuniform sampler2D tex;\nuniform vec2 invTexSize;\nvarying vec2 uv;\n#define SAM(a,b)  texture2D(tex, (i+vec2(a,b)+0.5) * invTexSize)\nvec4 ca = vec4(  21.0, -36.0,   0.0, 16.0 ) / 18.0;\nvec4 cb = vec4(  -7.0,  36.0, -60.0, 32.0 ) / 18.0;\nvec4 powers( float x ) { return vec4(x*x*x, x*x, x, 1.0); }\nvec4 spline( float x, vec4 c0, vec4 c1, vec4 c2, vec4 c3 )\n{\n    return c0 * dot( cb, powers(x + 1.0)) + \n        c1 * dot( ca, powers(x      )) +\n        c2 * dot( ca, powers(1.0 - x)) +\n        c3 * dot( cb, powers(2.0 - x));\n}\nvoid main() {\n    vec2 f = fract(uv);\n    vec2 i = floor(uv);\n    gl_FragColor = spline( f.y, spline( f.x, SAM(-1.0,-1.0), SAM( 0.0,-1.0), SAM( 1.0,-1.0), SAM( 2.0,-1.0)),\n                                spline( f.x, SAM(-1.0, 0.0), SAM( 0.0, 0.0), SAM( 1.0, 0.0), SAM( 2.0, 0.0)),\n                                spline( f.x, SAM(-1.0, 1.0), SAM( 0.0, 1.0), SAM( 1.0, 1.0), SAM( 2.0, 1.0)),\n                                spline( f.x, SAM(-1.0, 2.0), SAM( 0.0, 2.0), SAM( 1.0, 2.0), SAM( 2.0, 2.0)));\n}",
    generateBlurFrag: function (e) {
      var t,
        n =
          "precision mediump float;\nuniform sampler2D tex;\nuniform vec2 invTexSize;\nuniform vec2 direction;\nvarying vec2 uv;\nvoid main() {\n    vec4 color = vec4(0.0);\n    vec2 offset = direction * invTexSize;";
      for (
        n += "color += texture2D(tex, uv) * " + e[0].toFixed(8) + " ;\n", t = 1;
        t < e.length;
        t++
      )
        (n +=
          "color += texture2D(tex, uv + " +
          t +
          ".0 * offset) * " +
          e[t].toFixed(8) +
          ";\n"),
          (n +=
            "color += texture2D(tex, uv - " +
            t +
            ".0 * offset) * " +
            e[t].toFixed(8) +
            ";\n");
      return (n += "gl_FragColor = color;\n}");
    },
  }),
  Class(UI.SmartTemplate, "CustomGraphicControl")
    .inherits(Widget)
    .includes(
      BubblingSupport,
      GenericDestroySupport,
      StageControlsDestroySupport,
      SkeletonCardSupport
    )({
    elementClass: "custom-graphic-control",
    STATE_FROM_FILE: "upload",
    STATE_FROM_URL: "from_url",
    STATE_FROM_DOWNLOADS: "from_downloads",
    FOCUS_ANIMATION_DURATION: 500,
    FOCUS_ANIMATION_CLASS: "wobble-vertical",
    DROPDOWN_OPTIONS: {
      removePlacholder: {
        label: "Remove this Image",
        cssClass: "remove-placeholder",
      },
      uploadFromDevice: {
        label: "Upload from Your Device",
        cssClass: "upload-from-device",
      },
      importFromDownloads: {
        label: "Import from Downloads",
        cssClass: "import-from-downloads",
      },
      fromUrl: {
        label: "From URL",
        cssClass: "from-url",
      },
    },
    TEXT_INSERT_IMAGE: "Insert Image",
    TEXT_REPLACE_IMAGE: "Replace",
    TEXT_DROP_FILE: "Drop File Here!",
    prototype: {
      record: null,
      fileInputControl: null,
      id: null,
      userImageFilePath: null,
      pendingImageUrl: null,
      _popstateHandler: null,
      isMobilePhone: null,
      presetValue: null,
      $dropdownControl: null,
      _dropdownOptions: [],
      nextState: null,
      currentState: null,
      userDownloadsModal: null,
      controlTitle: null,
      thumbImageUrl: null,
      _tmpFile: null,
      fetchCustomAssetDataTask: null,
      init: function (e) {
        var t = this;
        Widget.prototype.init.apply(this, e),
          (this.prefix = e.prefix || ""),
          (this.name = this.prefix + e.name),
          (this.urlParameterName = this.name),
          (this.record = e.record),
          (this.showPreview = e.showPreview),
          (this.allowImportFromDownloads = e.allowImportFromDownloads),
          (this.allowPlaceholderRemoval = e.allowPlaceholderRemoval),
          (this.allowPlaceholderThumbnail = e.allowPlaceholderThumbnail),
          (this.controlTitle = e.controlTitle),
          (this.isMobilePhone = Helpers.App.isMobileDevice()),
          (this.presetValue = this.record.layers
            .filter(function (e) {
              return e.visible;
            })
            .map(function (e) {
              return e.image.split("/")[3];
            })[0]);
        var n = this.isMobilePhone && !e.record.viewport ? "primary" : null;
        (this.fileInputControl = new UI.SmartTemplate.FileInputControl({
          name: e.name + "-file-input",
          acceptedFiles: e.acceptedFiles,
          isMobilePhone: e.isMobilePhone,
          maxSize: e.maxSize,
          record: e.record,
          controlTitle: e.controlTitle,
          buttonClass: n,
          allowPlaceholderRemoval: this.allowPlaceholderRemoval,
          allowPlaceholderThumbnail: this.allowPlaceholderThumbnail,
        })),
          this.appendChild(this.fileInputControl),
          this.fileInputControl.render(this.element);
        var i = this.fileInputControl.$fileRepositionLabel;
        e.record.viewport &&
          ((this.urlInputControl = new UI.SmartTemplate.URLInputControl({
            name: e.name + "Scr",
            record: e.record,
            userAgent: e.userAgent || navigator.userAgent,
          })),
          this.appendChild(this.urlInputControl),
          this.urlInputControl.element.insertBefore(i),
          this.urlInputControl.urlButton.addClass("composite right"),
          this.fileInputControl.$fileLabel.addClass("composite left"),
          this.urlInputControl.bind(
            "screenshotLoad",
            function (e) {
              var n = e.data;
              (this.id = n.id),
                (t.nextState =
                  UI.SmartTemplate.CustomGraphicControl.STATE_FROM_URL),
                t.hideDropdownControl(),
                t.fileInputControl && (t.fileInputControl.file = n.file),
                e.stopPropagation(),
                this.dispatch("screenshotLoad", {
                  file: n.file,
                });
            }.bind(this)
          )),
          this.fileInputControl.bind("removePlaceholder", function () {
            t._hidePlaceholderRemovalOption(),
              t.dispatch("customGraphicChange");
          }),
          this.fileInputControl.bind("addPlaceholder", function () {
            t._showPlaceholderRemovalOption(),
              t.dispatch("customGraphicChange");
          }),
          this.fileInputControl.bind(
            "removeFile",
            function () {
              (t.nextState = null),
                t.setState(!0),
                Helpers.App.replaceUrlParamWithHistory(
                  this.urlParameterName,
                  ""
                );
            }.bind(this)
          ),
          (this._popstateHandler = this._popstateEventHandler.bind(this)),
          window.addEventListener("popstate", this._popstateHandler),
          this.bindSkeleton(),
          this.addTapBinding(),
          this.setFileInputControlBindings(),
          this.allowImportFromDownloads &&
            this._setUserDownloadsModalInstance(),
          this.allowPlaceholderThumbnail &&
            this.element.addClass("has-placeholder"),
          (this.allowImportFromDownloads === !0 ||
            this.allowPlaceholderRemoval === !0) &&
            (this._buildDropdown(),
            this.fileInputControl.$compositeButton.addClass("primary"));
      },
      _popstateEventHandler: function () {
        var e = this,
          t = this.getUrlParameter();
        if (((this.fileInputControl.file = null), t))
          this.fetchData(t)
            .then(function (n) {
              return e._layerJSONDataCallback(t, n);
            })
            ["catch"](function (n) {
              return "Cancelation Error" === n.message
                ? void console.warn(n)
                : void e._jsonDataNotFound(t);
            });
        else if (this.id) {
          if (this.presetValue)
            return void this.fetchData(this.presetValue)
              .then(function (t) {
                return e._layerJSONDataCallback(e.presetValue, t);
              })
              ["catch"](function (n) {
                return "Cancelation Error" === n.message
                  ? void console.warn(n)
                  : void e._jsonDataNotFound(t);
              });
          this.removeFile(), this.setDefaultState();
        }
      },
      setDefaultState: function () {
        this.fileInputControl.show(),
          this.urlInputControl && this.urlInputControl.show(),
          this.showDropdownControl();
      },
      setUrlParameter: function (e) {
        return (
          Helpers.App.replaceUrlParamWithHistory(this.urlParameterName, e),
          Helpers.GlobalEventTracker.smartTemplateEvent(
            "customGraphicChange",
            Helpers.App.getProductShownData()
          ),
          this
        );
      },
      getUrlParameter: function () {
        var e, t;
        return (
          (e = Helpers.App.getAllURLParams()), (t = e[this.urlParameterName])
        );
      },
      checkUrlParams: function () {
        var e,
          t,
          n = this;
        if (((e = this.getUrlParameter()), (t = e || this.presetValue)))
          this.fetchData(t)
            .then(function (e) {
              return n._layerJSONDataCallback(t, e);
            })
            ["catch"](function (e) {
              return "Cancelation Error" === e.message
                ? void console.warn(e)
                : void n._jsonDataNotFound(t);
            })
            ["finally"](function () {
              n.dispatch("customGraphicReady", n);
            });
        else {
          if (this.id) return this.removeFile(), void this.setDefaultState();
          Promise.resolve().then(function () {
            n.dispatch("customGraphicReady", n);
          });
        }
      },
      _layerJSONDataCallback: function (e, t) {
        t.cropped_image_url || (t.cropped_image_url = t.user_image_url),
          (this.id = e),
          (this.userImagePath = t.user_image_url),
          (this.cropParams = t.crop_params),
          this.dispatch("graphicCropSuccess", {
            croppedImageUrl: t.cropped_image_url,
            customGraphicControl: this,
            triggeredByPopState: !0,
            id: e,
          }),
          this.fileInputControl.showFileButton(),
          (this.thumbImageUrl = t.thumbnail_url
            ? t.thumbnail_url
            : t.cropped_image_url),
          this.updatePreviewThumb(),
          (this.nextState =
            UI.SmartTemplate.CustomGraphicControl.STATE_FROM_FILE),
          this.setState(!0),
          this.dispatch("customGraphicChange");
      },
      _jsonDataNotFound: function (e) {
        this.dispatch("customGraphicNotFound", {
          id: e,
        }),
          this.dispatch("customGraphicChange");
      },
      showDiscardButton: function () {
        return this.fileInputControl.showDiscardButton();
      },
      showUrlDiscardButton: function () {
        return (
          this.urlInputControl.urlButton.removeClass("right"),
          this.urlInputControl.showDiscardButton()
        );
      },
      removeFile: function () {
        return (
          (this.userImagePath = null),
          (this.id = null),
          this.fileInputControl.removeFile()
        );
      },
      getRecordLayerImage: function () {
        return this.record.layers && this.record.layers.length
          ? this.record.layers[0].image
          : null;
      },
      hideDiscardButton: function () {
        return this.fileInputControl.hideDiscardButton();
      },
      showRepositionButton: function () {
        return this.fileInputControl.showRepositionButton();
      },
      hideRepositionButton: function () {
        return this.fileInputControl.hideRepositionButton();
      },
      showFileButton: function () {
        this.fileInputControl && this.fileInputControl.showFileButton();
      },
      hideFileButton: function () {
        return this.fileInputControl.hideFileButton();
      },
      disableUpload: function () {
        this.urlInputControl && this.disableUploadByUrl(),
          this.disableDropdownControl(),
          this.disableUploadByFile();
      },
      enableUpload: function () {
        return (
          this.urlInputControl &&
            (this.fileInputControl.$fileLabel.addClass("composite left"),
            this.enableUploadByUrl()),
          this.enableDropdownControl(),
          this.enableUploadByFile()
        );
      },
      disableUploadByUrl: function () {
        this.urlInputControl.disableUpload();
      },
      enableUploadByUrl: function () {
        this.urlInputControl.enableUpload();
      },
      disableUploadByFile: function () {
        this.fileInputControl.disableUpload();
      },
      showLoader: function () {
        return this.isMobilePhone === !1
          ? this
          : void this.fileInputControl.showLoader();
      },
      hideLoader: function () {
        return this.isMobilePhone === !1
          ? this
          : void (this.fileInputControl && this.fileInputControl.hideLoader());
      },
      enableUploadByFile: function () {
        this.fileInputControl.enableUpload();
      },
      setLabelDragged: function () {
        return (
          this.$dropdownControl &&
            this.element
              .find(
                ".custom-graphic-dropdown.bootstrap-select .dropdown-toggle .filter-option"
              )
              .fadeOut(500, function () {
                $(this)
                  .html(UI.SmartTemplate.CustomGraphicControl.TEXT_DROP_FILE)
                  .fadeIn(500);
              }),
          this.fileInputControl.setLabelDragged()
        );
      },
      resetLabel: function () {
        this.$dropdownControl
          ? (this.$dropdownControl.selectpicker("refresh"),
            this.setLabel(this.constructor.TEXT_REPLACE_IMAGE))
          : this.fileInputControl.resetLabel();
      },
      getLabel: function () {
        return this.fileInputControl.getLabel();
      },
      setFile: function (e) {
        (this.nextState =
          UI.SmartTemplate.CustomGraphicControl.STATE_FROM_FILE),
          this.fileInputControl.setFile(e);
      },
      getFile: function () {
        return this.fileInputControl.getFile();
      },
      getFileInput: function () {
        return this.fileInputControl.getFileInput();
      },
      hideUrlInputControl: function () {
        this.urlInputControl && this.urlInputControl.hide();
      },
      updatePrefix: function (e) {
        (this.prefix = e),
          (this.name = this.name.replace(/^\d+_/, e)),
          (this.urlParameterName = this.name);
      },
      destroy: function () {
        this.$dropdownControl && this.$dropdownControl.selectpicker("destroy"),
          this.clearPopstateEventHandler(),
          this.cancelFetchCustomAssetDataTask(),
          this.genericDestroy();
      },
      hasUpload: function () {
        return this.urlInputControl && this.urlInputControl.hasUrl === !0
          ? !0
          : this.thumbImageUrl || this.fileInputControl.getFile()
          ? !0
          : !1;
      },
      getLayerByName: function (e) {
        return this.record.layers.filter(function (t) {
          return t.name === e;
        })[0];
      },
      getSelectedLayer: function () {
        return this.record.layers[0];
      },
      hasImage: function () {
        var e = this.getSelectedLayer();
        if ("undefined" == typeof e) return !1;
        var t = e.image;
        return "string" == typeof t && t.length > 0 ? !0 : !1;
      },
      getReplacementArea: function () {
        var e = this.getSelectedLayer();
        return e
          ? {
              name: e.name,
              x: e.x,
              y: e.y,
              width: e.width,
              height: e.height,
            }
          : null;
      },
      setTapHandler: function (e) {
        var t = function () {};
        "function" == typeof e && (t = e), (this._tapHandler = t);
      },
      fetchData: function (e) {
        this.cancelFetchCustomAssetDataTask();
        var t = P.cancelable(function (e) {
          return CustomAsset.fetch(e);
        });
        return (
          (this.fetchCustomAssetDataTask = t(e)), this.fetchCustomAssetDataTask
        );
      },
      addTapBinding: function () {
        var e = this,
          t = Helpers.StageType.getStageData().category_name;
        this.isMobilePhone !== !1 &&
          "Mockups" === t &&
          (e.setTapHandler(function () {}),
          e.bind("fileUploadClick", function (t) {
            e._tapHandler(t), e.setTapHandler(function () {});
          }),
          e.bind("repositionClicked", function (t) {
            e._tapHandler(t), e.setTapHandler(function () {});
          }),
          e.bind("removeFile", function (t) {
            e._tapHandler(t), e.setTapHandler(function () {});
          }));
      },
      updatePreviewThumb: function () {
        var e, t;
        (e = this),
          e.showPreview &&
            e.fileInputControl &&
            ((t = e.getFile()),
            t
              ? Helpers.Image.getBase64FromBlob(t)
                  .then(function (t) {
                    e.fileInputControl.updatePreviewThumb(t);
                  })
                  ["catch"](function () {
                    e.dispatch("updatePreviewThumb.fail");
                  })
              : e.thumbImageUrl &&
                e.fileInputControl.updatePreviewThumb(e.thumbImageUrl));
      },
      setFileByUrl: function (e) {
        var t = this,
          n = new XMLHttpRequest();
        n.open("GET", e),
          (n.responseType = "blob"),
          (n.onload = function () {
            if (200 === this.status) {
              var i = n.response,
                r = e.split("/").pop(),
                s = new File([i], r, {
                  type: i.type,
                });
              t.dispatch("setFileByUrl.success"), t.fileInputControl.setFile(s);
            } else
              t.dispatch("setFileByUrl.fail", {
                url: e,
              });
          }),
          (n.onerror = function () {
            t.dispatch("setFileByUrl.fail", {
              url: e,
            });
          }),
          t.dispatch("setFileByUrl.start"),
          n.send();
      },
      showDropdownControl: function () {
        var e = this;
        e.$dropdownControl &&
          (e.fileInputControl.$fileLabel.addClass("composite left"),
          e.$dropdownControl.selectpicker("show"),
          e.hideUrlInputControl(),
          e.hideFileButton());
      },
      hideDropdownControl: function () {
        var e = this;
        e.$dropdownControl && e.$dropdownControl.selectpicker("hide"),
          e.showFileButton();
      },
      enableDropdownControl: function () {
        var e = this;
        e.$dropdownControl &&
          (e.$dropdownControl.prop("disabled", !1),
          e.$dropdownControl.selectpicker("refresh"));
      },
      disableDropdownControl: function () {
        var e = this;
        e.$dropdownControl &&
          (e.$dropdownControl.prop("disabled", !0),
          e.$dropdownControl.selectpicker("refresh"));
      },
      _addDropdownOption: function (e, t, n) {
        var i = this;
        void 0 === n && (n = null),
          i._dropdownOptions.push({
            label: e,
            callback: t,
            cssClass: n,
          });
      },
      _buildDropdown: function () {
        var e, t, n, i, r, s;
        (e = this),
          e.$dropdownControl && e.$dropdownControl.selectpicker("destroy"),
          e._setDropdownOptions(),
          e.element.addClass("with-dropdown"),
          (n = document.createElement("select")),
          n.classList.add("custom-graphic-dropdown"),
          (s = e.constructor.TEXT_INSERT_IMAGE),
          e.fileInputControl &&
            ((r = e.fileInputControl.getPixelDimensions()),
            (s +=
              '<span class="pixel-dimensions">' +
              r.width +
              "x" +
              r.height +
              "px</span>")),
          n.setAttribute("title", s),
          (i = document.createElement("option")),
          i.setAttribute("value", ""),
          i.setAttribute("disable", "disable"),
          (i.dataset.hidden = !0),
          n.append(i),
          e._dropdownOptions.forEach(function (e, t) {
            (i = document.createElement("option")),
              i.append(document.createTextNode(e.label)),
              i.setAttribute("value", t),
              null !== e.cssClass && i.classList.add(e.cssClass),
              n.append(i);
          }),
          (e.$dropdownControl = $(n)),
          e.$dropdownControl.insertAfter(e.fileInputControl.$fileDeleteLabel),
          e.fileInputControl.$fileLabel.addClass("composite left"),
          Helpers.App.isMobile() &&
            ((t = $(
              '<div class="custom-graphic-dropdown-mobile-container"></div>'
            )),
            $("body").append(t)),
          e.$dropdownControl.selectpicker({
            container: t ? t : $("body"),
            dropupAuto: !0,
            mobile: !1,
          }),
          e._setDropdownDropZone(),
          e.showDropdownControl(),
          e.$dropdownControl.bind("change", function () {
            "" !== $(this).val() &&
              (e._dropdownOptions[$(this).val()].callback(),
              $(this).find("option:selected").prop("selected", !1),
              e.$dropdownControl.selectpicker("val", ""));
          });
      },
      setLabel: function (e) {
        this.fileInputControl && this.fileInputControl.setLabel(e);
      },
      setFileInputControlBindings: function () {
        var e, t;
        (e = this),
          (t = e.fileInputControl.getFileLabel()),
          t.bind("click", function () {
            e.currentState ===
            UI.SmartTemplate.CustomGraphicControl.STATE_FROM_URL
              ? e.urlInputControl.showRemoteUrlModal()
              : e.currentState ===
                UI.SmartTemplate.CustomGraphicControl.STATE_FROM_DOWNLOADS
              ? e.userDownloadsModal.activate()
              : (e.nextState =
                  UI.SmartTemplate.CustomGraphicControl.STATE_FROM_FILE);
          }),
          e.fileInputControl.bind("file.loaded", function () {
            e.hideDropdownControl();
          }),
          e.fileInputControl.bind("file.unload", function () {
            (e.nextState = null),
              e.setState(!0),
              e._showPlaceholderRemovalOption();
          });
      },
      setState: function (e) {
        var t, n, i;
        switch (
          ((t = this),
          e && t.fileInputControl
            ? (t._tmpFile = t.fileInputControl.file)
            : !e &&
              t.fileInputControl &&
              t._tmpFile &&
              ((t.fileInputControl.file = t._tmpFile), (t._tmpFile = null)),
          e ? ((n = t.nextState), (t.currentState = n)) : (n = t.currentState),
          e && n && t.updatePreviewThumb(),
          n)
        ) {
          case UI.SmartTemplate.CustomGraphicControl.STATE_FROM_FILE:
            t.fileInputControl &&
              (t.fileInputControl.enableInputControl(),
              t.fileInputControl.enablePixelDimensions()),
              (i =
                void 0 === t.controlTitle
                  ? t.constructor.TEXT_REPLACE_IMAGE
                  : t.controlTitle),
              t.setLabel(i),
              t.hideUrlInputControl(),
              t.hideDropdownControl();
            break;
          case UI.SmartTemplate.CustomGraphicControl.STATE_FROM_URL:
            t.setLabel(t.constructor.TEXT_REPLACE_IMAGE),
              t.hideUrlInputControl(),
              t.hideDropdownControl(),
              t.fileInputControl &&
                (t.fileInputControl.disableInputControl(),
                t.fileInputControl.disablePixelDimensions());
            break;
          case UI.SmartTemplate.CustomGraphicControl.STATE_FROM_DOWNLOADS:
            t.setLabel(t.constructor.TEXT_REPLACE_IMAGE),
              t.hideUrlInputControl(),
              t.hideDropdownControl(),
              t.fileInputControl &&
                (t.fileInputControl.disableInputControl(),
                t.fileInputControl.disablePixelDimensions());
            break;
          default:
            t.fileInputControl &&
              (t.fileInputControl.enableInputControl(),
              t.fileInputControl.enablePixelDimensions()),
              (i =
                void 0 === t.controlTitle
                  ? t.constructor.TEXT_INSERT_IMAGE
                  : t.controlTitle),
              t.setLabel(i),
              t.showUrlInputControl(),
              t.showDropdownControl();
        }
      },
      showUrlInputControl: function () {
        var e = this;
        e.urlInputControl &&
          (e.fileInputControl.$fileLabel.addClass("composite left"),
          e.urlInputControl.show());
      },
      _setDropdownOptions: function () {
        var e = this;
        (e._dropdownOptions = []),
          e.fileInputControl &&
            e._addDropdownOption(
              e.constructor.DROPDOWN_OPTIONS.uploadFromDevice.label,
              function () {
                e.fileInputControl.triggerUpload();
              },
              e.constructor.DROPDOWN_OPTIONS.uploadFromDevice.cssClass
            ),
          e.userDownloadsModal &&
            e._addDropdownOption(
              e.constructor.DROPDOWN_OPTIONS.importFromDownloads.label,
              function () {
                e.userDownloadsModal.activate();
              },
              e.constructor.DROPDOWN_OPTIONS.importFromDownloads.cssClass
            ),
          e.urlInputControl &&
            (e.urlInputControl.hide(),
            e._addDropdownOption(
              e.constructor.DROPDOWN_OPTIONS.fromUrl.label,
              function () {
                e.urlInputControl.showRemoteUrlModal();
              },
              e.constructor.DROPDOWN_OPTIONS.fromUrl.cssClass
            )),
          e.allowPlaceholderRemoval === !0 &&
            e._addDropdownOption(
              e.constructor.DROPDOWN_OPTIONS.removePlacholder.label,
              e.triggerRemovePlaceholder.bind(e),
              e.constructor.DROPDOWN_OPTIONS.removePlacholder.cssClass
            );
      },
      _setUserDownloadsModalInstance: function () {
        var e = this;
        (e.userDownloadsModal = new UI.UserDownloadsModal({
          name: e.name + "_UserDownloadsModal",
        })),
          e.appendChild(e.userDownloadsModal),
          e._setUserDownloadsModalBindings();
      },
      _setUserDownloadsModalBindings: function () {
        var e = this;
        e.userDownloadsModal.bind("userDownloadItem.selected", function (t) {
          (e.nextState =
            UI.SmartTemplate.CustomGraphicControl.STATE_FROM_DOWNLOADS),
            e.userDownloadsModal.deactivate(),
            Helpers.PurchasesHelper.getDownloadPathById(t.data.id)
              .then(function (t) {
                e.setFileByUrl(t);
              })
              ["catch"](function () {
                e.dispatch("stage.error", {
                  message: "Couldn't import image, please try again",
                  purchaseId: t.data.id,
                });
              });
        });
      },
      hideInStage: function () {
        var e = this;
        e.removeFile(),
          (e.nextState = null),
          e.setState(!0),
          Helpers.App.replaceUrlParamWithHistory(this.urlParameterName, "");
      },
      focus: function () {
        if (!Helpers.App.isMobile()) {
          var e = this;
          e.element.addClass(e.constructor.FOCUS_ANIMATION_CLASS),
            setTimeout(function () {
              e.element.removeClass(e.constructor.FOCUS_ANIMATION_CLASS);
            }, e.constructor.FOCUS_ANIMATION_DURATION);
        }
      },
      triggerUpload: function () {
        this.fileInputControl.triggerUpload();
      },
      triggerReposition: function () {
        this.fileInputControl.triggerReposition();
      },
      triggerRemove: function () {
        this.fileInputControl.triggerRemove();
      },
      triggerAddPlaceholder: function () {
        this.fileInputControl.addPlaceholder();
      },
      triggerRemovePlaceholder: function () {
        this.fileInputControl.removePlaceholder();
      },
      getState: function () {
        var e = !0;
        return (
          this.fileInputControl &&
            (e =
              this.getSelectedLayer().image !==
              this.fileInputControl.transparentPixel),
          {
            hasPlaceholder: e,
            hasImage:
              this.hasImage() === !0 && this.getSelectedLayer().visible === !0,
          }
        );
      },
      _getDropdownOptionByClass: function (e) {
        var t, n;
        return (
          (t = this),
          null === t.$dropdownControl
            ? null
            : ((n = t.$dropdownControl.find("." + e)), n.length ? n : null)
        );
      },
      _hidePlaceholderRemovalOption: function () {
        var e, t;
        (e = this),
          (t = e._getDropdownOptionByClass(
            e.constructor.DROPDOWN_OPTIONS.removePlacholder.cssClass
          )),
          null !== t && (t.hide(), e.$dropdownControl.selectpicker("refresh"));
      },
      _showPlaceholderRemovalOption: function () {
        var e, t;
        (e = this),
          (t = e._getDropdownOptionByClass(
            e.constructor.DROPDOWN_OPTIONS.removePlacholder.cssClass
          )),
          null !== t && (t.show(), e.$dropdownControl.selectpicker("refresh"));
      },
      _setDropdownDropZone: function () {
        var e, t;
        (e = this),
          e.fileInputControl &&
            ((t = e.element.find(
              ".custom-graphic-dropdown.bootstrap-select .dropdown-toggle .filter-option"
            )),
            t.length &&
              (t.addClass("drop-zone"),
              t.attr(
                "data-drop-target-id",
                e.fileInputControl.getFileInputId()
              )));
      },
      afterReady: function () {
        this.checkUrlParams();
        var e = {
          originalDispatcher: this,
          triggeredByUser: !1,
          triggeredByPopState: !0,
        };
        this.dispatch("render", e);
      },
      cancelFetchCustomAssetDataTask: function () {
        null !== this.fetchCustomAssetDataTask &&
          (this.fetchCustomAssetDataTask.cancel(),
          (this.fetchCustomAssetDataTask = null));
      },
    },
  }),
  Class(UI.SmartTemplate, "FileInputControl")
    .inherits(Widget)
    .includes(
      BubblingSupport,
      GenericDestroySupport
    )({
    html: '        <div class="form-group">            <label class="title file-upload-title"></label>            <div class="button composite-button">                <input class="form-control st-file-upload" accept=".jpg, .png, .jpeg" type="file" />                <label class="file-reposition-label button composite middle">                    <span class="p-icon p-sm crop-gray"></span>                    <div class="file-reposition-label__title">Resize</div>                </label>                <label class="file-upload-label button show-pixels-dimensions secondary composite">                    <span class="p-icon p-sm replace-gray"></span>                    <span class="file-upload-label__control-title"> Upload Image </span>                    <span class="file-upload-label__pixels-dimensions"></span>                </label>                <label class="file-delete-label button composite right">                    <span class="p-icon p-sm remove-gray"></span>                    <div class="file-delete-label__title">Remove</div>                </label>            </div>        </div>',
    elementClass: "input-file-control",
    prototype: {
      record: null,
      userImageFileName: null,
      userImagePath: null,
      buttonClass: null,
      previewThumb: null,
      hasPlaceholder: !0,
      placeholderThumbnail: "./assets/placeholder-thumbnail.png",
      transparentPixel:
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII",
      $compositeButton: null,
      allowPlaceholderThumbnail: !1,
      init: function (e) {
        var t = this;
        Widget.prototype.init.call(this, e),
          (t.$compositeButton = this.element.find(".composite-button")),
          (t.$label = this.element.find("label.title")),
          (t.$file = this.element.find("input")),
          (t.$fileLabel = this.element.find("label.file-upload-label")),
          (t.$fileDeleteLabel = this.element.find("label.file-delete-label")),
          (t.$fileRepositionLabel = this.element.find(
            "label.file-reposition-label"
          )),
          (t.$fileButtonLabel = this.element.find(
            "span.file-upload-label__control-title"
          ));
        var n = this.record.name;
        (n = n.substr(n.lastIndexOf(".") + 1)),
          (n = n
            .split("_")
            .map(function (e) {
              var t, n;
              return (t = e[0].toUpperCase()), (n = e.substr(1)), t + n;
            })
            .join(" ")),
          t.$label.html(n),
          t.$file.attr("id", "input" + t.name),
          t.$fileLabel.attr("for", "input" + t.name),
          t.$fileDeleteLabel.hide(),
          t.$fileRepositionLabel.hide(),
          t.allowPlaceholderThumbnail === !0 && t.showPlaceholderThumbnail(),
          (t.controlTitle = e.controlTitle || "Upload Image"),
          t.$fileLabel
            .find("span.file-upload-label__control-title")
            .html(t.controlTitle),
          this.insertPixelsDimensions(),
          t.bindings(),
          this.changeButtonClass();
      },
      bindings: function () {
        var e = this;
        (e.$file.get(0).onclick = function () {
          e.dispatch("fileUploadClick"), (this.value = null);
        }),
          e.bind("file.change", e.fileChangeHandler),
          e.$file.on("change", function () {
            e.setFile(this.files[0]);
          }),
          e.$fileDeleteLabel.on("click", function () {
            e.removeFile(), e.dispatch("removeFile");
          }),
          e.$fileRepositionLabel.bind("click", function () {
            e.dispatch("repositionClicked", e);
          });
      },
      fileChangeHandler: function () {
        return this.file.size > this.maxSize
          ? void page.flash(
              "File is too big, maximum allowed is " +
                this.maxSize / 1e3 / 1e3 +
                " MB",
              "alert",
              {
                autoclose: {
                  milliseconds: 5e3,
                },
              }
            )
          : this.acceptedFiles[this.file.type]
          ? (this.dispatch("loading"),
            void (this.file && this.dispatch("file.loaded")))
          : void alert("Invalid image file. Please upload only .png or .jpeg");
      },
      setFile: function (e) {
        (this.file = e), this.dispatch("file.change");
      },
      getFile: function () {
        return this.file;
      },
      getFileInput: function () {
        return this.$file;
      },
      getFileLabel: function () {
        return this.$fileLabel;
      },
      getPixelDimensions: function () {
        return {
          width: this.record.width,
          height: this.record.height,
        };
      },
      insertPixelsDimensions: function () {
        var e = this.getPixelDimensions();
        e.width &&
          e.height &&
          this.element
            .find(".file-upload-label__pixels-dimensions")
            .text(e.width + "x" + e.height + "px");
      },
      removeFile: function () {
        var e = this;
        (e.record.hash = null),
          (e.record.layers[0].image = null),
          (e.record.layers[0].visible = !1),
          (e.file = null),
          e.hideDiscardButton(),
          e.hideRepositionButton(),
          e._hidePreviewThumb(),
          e.allowPlaceholderThumbnail === !0 && e.showPlaceholderThumbnail(),
          e.dispatch("file.unload");
      },
      changeButtonClass: function () {
        this.buttonClass &&
          (this.$fileLabel.hasClass("left") ||
          this.$fileLabel.hasClass("has-placeholder")
            ? (this.$fileLabel.removeClass(this.buttonClass),
              this.$fileLabel.addClass("secondary"))
            : (this.$fileLabel.removeClass("secondary"),
              this.$fileLabel.addClass(this.buttonClass)));
      },
      showDiscardButton: function () {
        this.$fileDeleteLabel.show(),
          this.$fileLabel.addClass("left-spacing"),
          this.changeCompositeButtonClass(),
          this.allowPlaceholderThumbnail === !0 &&
            this.hidePlaceholderRemovalOptions();
      },
      hideDiscardButton: function () {
        this.$fileDeleteLabel.hide(),
          this.$fileLabel.removeClass("left-spacing"),
          this.changeCompositeButtonClass();
      },
      showRepositionButton: function () {
        this.$fileRepositionLabel.show(),
          this.$fileLabel.addClass("left"),
          this.$fileLabel.addClass("left-spacing"),
          this.changeButtonClass(),
          this.changeCompositeButtonClass();
      },
      hideRepositionButton: function () {
        this.$fileRepositionLabel.hide(),
          this.$fileLabel.removeClass("left"),
          this.$fileLabel.removeClass("left-spacing"),
          this.changeButtonClass(),
          this.changeCompositeButtonClass();
      },
      hideFileButton: function () {
        this.$fileLabel.hide();
      },
      showFileButton: function () {
        this.$fileLabel.show();
      },
      disableUpload: function () {
        var e = this;
        e.$fileLabel.addClass("disabled"),
          e.$fileDeleteLabel.addClass("disabled"),
          e.$fileRepositionLabel.addClass("disabled"),
          e.$fileLabel.removeAttr("for");
      },
      enableUpload: function () {
        var e = this;
        e.$fileLabel.removeClass("disabled"),
          e.$fileDeleteLabel.removeClass("disabled"),
          e.$fileRepositionLabel.removeClass("disabled"),
          e.$fileLabel.attr("for", "input" + e.name);
      },
      showLoader: function () {
        return this.$fileButtonLabel.addClass("ellipsing"), this;
      },
      hideLoader: function () {
        return this.$fileButtonLabel.removeClass("ellipsing"), this;
      },
      setLabelDragged: function () {
        var e = this;
        return (
          e.$fileLabel
            .find("span.file-upload-label__control-title")
            .fadeOut(500, function () {
              $(this).html("Drop File Here!").fadeIn(500);
            }),
          e
        );
      },
      setLabel: function (e) {
        this.$fileButtonLabel.text(e);
      },
      resetLabel: function () {
        var e = this;
        return (
          e.$fileLabel
            .find("span.file-upload-label__control-title")
            .fadeOut(500, function () {
              $(this).html(e.controlTitle).fadeIn(500);
            }),
          e
        );
      },
      getLabel: function () {
        return this.$label.text();
      },
      triggerUpload: function () {
        this.$fileLabel.trigger("click");
      },
      triggerReposition: function () {
        this.$fileRepositionLabel.trigger("click");
      },
      triggerRemove: function () {
        this.$fileDeleteLabel.trigger("click");
      },
      destroy: function () {
        this.genericDestroy();
      },
      _createPreviewThumb: function (e) {
        var t = this;
        (this.previewThumb = new UI.ImageContainer({
          name: t.name + "-preview",
          imageURL: e,
          cssClass: "file-input-preview",
        })),
          t.appendChild(this.previewThumb),
          this.previewThumb.render(t.$compositeButton, !0);
      },
      _hidePreviewThumb: function () {
        this.previewThumb &&
          (this.previewThumb.hide(), this.element.removeClass("has-preview"));
      },
      _showPreviewThumb: function () {
        this.previewThumb &&
          (this.element.addClass("has-preview"), this.previewThumb.show());
      },
      updatePreviewThumb: function (e) {
        var t = this;
        t.previewThumb ? t.previewThumb.update(e) : t._createPreviewThumb(e),
          t.element.addClass("has-preview"),
          t.previewThumb.show();
      },
      enableInputControl: function () {
        var e = this;
        e.$file.prop("disabled", !1);
      },
      disableInputControl: function () {
        var e = this;
        e.$file.prop("disabled", !0);
      },
      enablePixelDimensions: function () {
        var e = this;
        e.$fileLabel.addClass("show-pixels-dimensions");
      },
      disablePixelDimensions: function () {
        var e = this;
        e.$fileLabel.removeClass("show-pixels-dimensions");
      },
      showPlaceholderThumbnail: function () {
        this.updatePreviewThumb(this.placeholderThumbnail),
          this.$fileLabel.addClass("left-spacing has-placeholder"),
          this.changeButtonClass();
      },
      hidePlaceholderRemovalOptions: function () {
        this.$fileLabel.removeClass("left-spacing has-placeholder");
      },
      removePlaceholder: function () {
        (this.record.layers[0].image = this.transparentPixel),
          (this.record.layers[0].visible = !1),
          (this.hasPlaceholder = !1),
          this.hidePlaceholderRemovalOptions(),
          this._hidePreviewThumb(),
          this.dispatch("change"),
          this.dispatch("removePlaceholder");
      },
      addPlaceholder: function () {
        (this.record.layers[0].image = null),
          (this.record.layers[0].visible = !0),
          (this.hasPlaceholder = !0),
          this.showPlaceholderThumbnail(),
          this._showPreviewThumb(),
          this.dispatch("change"),
          this.dispatch("addPlaceholder");
      },
      changeCompositeButtonClass: function () {
        this.$compositeButton &&
          (this.$fileRepositionLabel.is(":visible") ||
          this.$fileDeleteLabel.is(":visible")
            ? this.$compositeButton.addClass("btn-group")
            : this.$compositeButton.removeClass("btn-group"));
      },
      getFileInputId: function () {
        return this.$file.attr("id");
      },
    },
  }),
  Class(UI.SmartTemplate, "AssetPremiumBadge")
    .inherits(Widget)
    .includes(BubblingSupport)({
    html: '<div class="premium-badge-widget">               <div class="badge-container">                <img class="premium-crown" src="./assets/crown-icon-empty-bg.svg">                <span class="premium-text">Premium</span>              </div>            </div>',
    popoverContent:
      '<div class="premium-badge-popover">Premium Graphics are only free for Unlimited Subscribers.</div>',
    prototype: {
      $premiumBadge: null,
      init: function (e) {
        Widget.prototype.init.call(this, e),
          (this.$premiumBadge = $(
            this.element[0].querySelector(".badge-container")
          )),
          this._initPremiumPopover();
      },
      _initPremiumPopover: function () {
        this.$premiumBadge.popover({
          content: UI.SmartTemplate.AssetPremiumBadge.popoverContent,
          html: !0,
          container: "body",
          trigger: "hover",
          placement: function (e) {
            return $(e).addClass("premium-popover"), "top";
          },
        });
      },
      showPopover: function () {
        this.$premiumBadge.popover("show");
      },
      hidePopover: function () {
        this.$premiumBadge.popover("hide");
      },
    },
  }),
  Class(UI.SmartTemplate, "GraphicItem")
    .inherits(Widget)
    .includes(
      BubblingSupport,
      UI.ThumbItemSupport,
      CDNSupport
    )({
    html: "<li></li>",
    prototype: {
      className: null,
      record: null,
      text: "",
      init: function (e) {
        var t;
        if (
          (Widget.prototype.init.call(this, e),
          (t = this.element.get(0)),
          t.setAttribute("data-value", this.record.id),
          t.setAttribute("name", e.itemName),
          this.hasAsset() === !0)
        ) {
          this.image = this.record.image;
          var n = '<img data-src="' + this._cdnBasePath() + this.image + '" />';
          (t.innerHTML = n), (this.img = this.element.find("img"));
        } else
          t.innerHTML = t.classList.contains("multi_item")
            ? "None"
            : e.text || "No Image";
        this._bindings();
      },
      showVideoPreview: function () {
        return this;
      },
      repositionFinished: function (e, t, n) {
        var i = n ? "localCropSuccess" : "cropSuccess";
        return (
          this.dispatch(i, {
            moveBeforeElement: t,
            id: e.id,
            cropParams: e.crop_params,
            croppedImageUrl: e.cropped_image_url,
            thumbnailUrl: e.thumbnail_url,
            userImageFileName: e.user_image_filename,
            userImagePath: e.user_image_url,
            isVideo: e.isVideo || !1,
          }),
          this
        );
      },
      getImageUrl: function () {
        return this.isCustomUpload
          ? this.userImagePath
          : [this._cdnBasePublicPath(), this.record.path].join("/");
      },
      isCustom: function () {
        return this.isCustomUpload === !0;
      },
    },
  }),
  Class(UI.SmartTemplate, "VideoItem")
    .inherits(Widget)
    .includes(
      BubblingSupport,
      UI.ThumbItemSupport,
      CDNSupport
    )({
    html: "<li></li>",
    prototype: {
      className: null,
      record: null,
      isMobile: !1,
      video: null,
      hostname: "",
      init: function (e) {
        Widget.prototype.init.call(this, e),
          (this.isMobile = Helpers.App.isMobileDevice()),
          (this.firstLoad = !0),
          this.buildVideoTemplate(),
          (this.anchor = this.element.find("a")),
          (this.img = this.element.find("img:not(.premium-crown)")),
          (this.video = this.element.find("video")),
          (this.loadingOverlay = this.element.find(".loading-overlay")),
          this._createImageLoadBinding(),
          this.isMobile ||
            this.element.bind("mouseleave", this.mouseleaveHandler.bind(this)),
          this.element.bind("mouseenter", this.mouseenterHandler.bind(this)),
          this._bindings();
      },
      _createImageLoadBinding: function () {
        if (0 !== this.img.length) {
          var e = this;
          this.img.bind("load", function () {
            e.loadingOverlay.fadeOut("fast"),
              e.element && e.element.removeClass("hidden_after");
          });
        }
      },
      mouseleaveHandler: function () {
        this.loadingOverlay.is(":visible") && this.loadingOverlay.fadeOut(150),
          this.removeVideo();
      },
      mouseenterHandler: function () {
        this.firstLoad === !0 && this.loadingOverlay.fadeIn("fast"),
          this.addVideo();
      },
      buildVideoTemplate: function () {
        var e = this.element;
        return (
          e.attr("data-value", this.record.id),
          e.attr("name", this.itemName),
          this.record.image
            ? (e.append(
                '<div class="loading-overlay"><div class="video-loading-icon"></div></div>'
              ),
              void e.append(
                '<img data-src="' +
                  this._cdnBasePath() +
                  this.record.image +
                  '" />'
              ))
            : (e.html("No Video"), this)
        );
      },
      addVideo: function () {
        return this.record.video
          ? void (
              (this.video && 0 !== this.video.length) ||
              ((this.videoSrc = this.hostname + this.record.video),
              (this.video = $(
                '<video muted playsinline style="display:none" src=' +
                  this.videoSrc +
                  "></video>"
              )),
              this.video.insertBefore(
                this.element.find("img:not(.premium-crown)")
              ),
              (this.video = this.element.find("video")),
              this.video
                .bind("loadedmetadata", this.canPlayHandler.bind(this))
                .bind("ended", this.endVideoHandler.bind(this)))
            )
          : this;
      },
      endVideoHandler: function () {
        this.video.fadeOut(150);
      },
      canPlayHandler: function () {
        return (
          (this.firstLoad = !1),
          this.loadingOverlay.fadeOut(150, "swing"),
          this.video.fadeIn(150),
          Helpers.App.isMobileDevice() && (this.video[0].loop = !0),
          this.video[0].play(),
          this
        );
      },
      removeVideo: function () {
        return null !== this.video && 0 === this.video.length
          ? this
          : (this.video.fadeOut(150, "swing"),
            this.video.unbind("canplay", this.canPlayHandler.bind(this)),
            this.video.unbind("ended", this.endVideoHandler.bind(this)),
            this.video.remove(),
            (this.video[0].src = ""),
            this.video[0].load(),
            (this.video = null),
            this);
      },
      showVideoPreview: function () {
        return Helpers.App.isMobile() ? void this.mouseenterHandler() : this;
      },
      repositionFinished: function (e, t, n) {
        var i = n ? "localCropSuccess" : "cropSuccess";
        return (
          this.dispatch(i, {
            moveBeforeElement: t,
            id: e.id,
            cropParams: e.crop_params,
            croppedImageUrl: e.cropped_image_url,
            croppedVideoUrl: e.cropped_video_url,
            croppedVideoPreviewUrl: e.preview_url,
            thumbnailUrl: e.thumbnail_url,
            userImageFileName: e.user_image_filename,
            userImagePath: e.user_image_url,
            userVideoPath: e.user_video_url,
            originalVideoUrl: e.original_video_url,
            timelineUrls: e.timeline_urls,
            duration: e.duration,
            videoWidth: e.video_width,
            videoHeight: e.video_height,
            isVideo: e.isVideo || !0,
          }),
          this
        );
      },
    },
  }),
  Class(UI.SmartTemplate, "FontItem")
    .inherits(Widget)
    .includes(
      CustomEventSupport,
      BubblingSupport,
      GenericDestroySupport,
      CDNSupport
    )({
    html: '<div>        <div class="icon">            <div class="saved star-off"></div>        </div>        <div class="preview">            <img class="img">        </div>        <div class="font-tags item-track tags">            <ul class="tags-list"></ul>        </div>        <div class="selection">            <i class="glyphicon glyphicon-ok icon-ok check-mark"></i>        </div>    </div>',
    elementClass: "fontitem",
    prototype: {
      isActive: !1,
      isSelectable: !1,
      tags: [],
      toRender: null,
      init: function (e) {
        Widget.prototype.init.call(this, e),
          (this.$image = this.element.find(".img")),
          (this.$tags = this.element.find(".font-tags")),
          (this.$icon = this.element.find(".icon")),
          (this.$star = this.$icon.find(".saved")),
          this.isSelectable === !0 && this.element.addClass("selectable"),
          this.tags && this.tags.length > 0 && this._createTags(),
          this._setPreviewImg(),
          this._bindEvents(),
          this.setSavedState();
      },
      _bindEvents: function () {
        (this._boundSetSavedState = this.setSavedState.bind(this)),
          (this._boundSaveDispatch = this._fontItemSaveDispatch.bind(this)),
          this.$tags.bind("click", !1),
          this.$icon.bind("click", this._boundSaveDispatch),
          this.fontData.bind("isSaved_change", this._boundSetSavedState),
          this.element.bind("click", this.activate.bind(this));
      },
      destroy: function () {
        this.fontData.unbind("isSaved_change", this._boundSetSavedState),
          this.genericDestroy();
      },
      _setPreviewImg: function () {
        this.$image.attr("src", this._cdnBasePath() + this.fontData.image);
      },
      setSavedState: function () {
        var e = this.fontData;
        e.getProperty("isSaved") === !0
          ? (this.$star.removeClass("star-off"), this.$star.addClass("star-on"))
          : (this.$star.removeClass("star-on"),
            this.$star.addClass("star-off"));
      },
      _fontItemSaveDispatch: function (e) {
        var t = this;
        e.stopPropagation(), t.dispatch("saved");
      },
      _createTags: function () {
        (this.tags = this.tags.map(function (e) {
          return e.toLowerCase();
        })),
          this.appendChild(
            new UI.AudioTags({
              maxVisibleTags: 1,
              element: this.$tags,
              tags: this.tags,
              name: "tagsWidget",
            })
          ).render(this.$tags);
      },
      activate: function () {
        (this.element.hasClass("active") && this.isSelectable) ||
          Widget.prototype.activate.call(this);
      },
      queuedRender: function (e) {
        this.toRender && this.render(this.toRender), void 0 !== e && e();
      },
      getFontData: function () {
        return this.fontData;
      },
    },
  }),
  Class(UI.SmartTemplate, "FontInput")
    .inherits(Widget)
    .includes(BubblingSupport)({
    html: '<input type="text" placeholder="Search" class="">',
    elementClass: "search-input",
    prototype: {
      keyCodeForImmediateChange: null,
      debounceTimeout: 0,
      init: function (e) {
        Widget.prototype.init.call(this, e);
        var t = this;
        this.element.bind("keydown", function (e) {
          return (
            t._searchInputTimeout && clearTimeout(t._searchInputTimeout),
            e.keyCode === t.keyCodeForImmediateChange
              ? void t.dispatch("change")
              : void (t._searchInputTimeout = setTimeout(function () {
                  t.dispatch("change");
                }, t.debounceTimeout))
          );
        });
      },
    },
  }),
  Class(UI.SmartTemplate, "FontFilter")
    .inherits(Widget)
    .includes(BubblingSupport)({
    html: '<li>        <a class="link-filter text-capitalize">            <span class="filter"></span>            <span class="text-muted"></span>        </a>        <div class="toggleable-icons">            <i class="check-filters icon-ok check-mark toggleable"></i>            <i class="delete-filters remove-mark toggleable"></i>        </div>    </li>',
    elementClass: "item-tag",
    prototype: {
      value: "",
      count: 0,
      label: "",
      init: function (e) {
        Widget.prototype.init.call(this, e);
        var t = this;
        (this.$label = this.element.find(".link-filter .filter")),
          (this.$counter = this.element.find(".text-muted")),
          (this.isActive = !1),
          this.element.attr("data-tag", this.value),
          this.$label.text(this.label),
          this.$counter.text("(" + this.count + ")"),
          this.element.bind("click", function () {
            this.isActive === !1
              ? (t.activate(), (this.isActive = !0))
              : (t.deactivate(), (this.isActive = !1));
          });
      },
      deactivate: function () {
        return (
          Widget.prototype.deactivate.call(this),
          this.dispatch("deactivate"),
          this
        );
      },
    },
  }),
  Class("AlgoliaFontDataAdapter")({
    adaptAlgoliaHit: function (e) {
      var t = {
        name: e.name,
        image: "/" === e.url[0] ? e.url : "/" + e.url,
        visible: !1,
        displayName: e.displayName,
        file: 0 === e.file.indexOf("/fonts/") ? e.file : "/fonts/" + e.file,
        id: e.id,
        tags: e.tags,
        isPremium: e.isPremium,
      };
      for (var n in e) e.hasOwnProperty(n) && delete e[n];
      $.extend(e, t);
    },
    adaptAlgoliaResponse: function (e) {
      e.hits.forEach(window.AlgoliaFontDataAdapter.adaptAlgoliaHit);
    },
  }),
  Class(UI, "FontsModal").inherits(UI.SimpleModal)({
    _BODY_CONTENT:
      '<aside class="filter-panel">                        <div class="search-filter">                        </div>                        <div class="filter-control dropdown mb-sm">                            <button type="button" class="button dropdown-toggle" id="dropdownFontsFilters" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">                                <div class="filter-option">Filter</div>                                <span class="dropdown-filters" aria-hidden="true"></span>                            </button>                            <div id="filter-list" class="dropdown-menu" aria-labelledby="dropdownFontsFilters">                                <ul class="filter-all list-unstyled" role="menu">                                    <li class="item-all is-selected" data-view-all>                                        <a class="all">                                            <span class="item-caret-right">View all</span>                                        </a>                                        <div class="toggleable-icons">                                            <i class="check-filters icon-ok check-mark"></i>                                        </div>                                    </li>                                </ul>                                <div class="title-tag"><span>Tags</span></div>                                <ul class="filter-tag-list list-unstyled" role="menu">                                </ul>                            </div>                        </div>                    </aside>                    <section class="fonts-list">                        <div class="empty-state">                            <div class="p-icon p-lg sad-face mb-sm"></div>                            <div class="main-message">Your Search has returned no results</div>                            <div class="suggestions">Try <a>option1</a> or <a>option 2</a> or <a>option 3</a>!</div>                            <div class="contact-us">                                <span class="small-message">Didn\'t find what you were looking for?</span>                                <a href="mailto:hi@placeit.net?subject=Couldn\'t find a font that..." class="link"> Let us know!</a>                            </div>                        </div>                    </section>                    <div class="scroll-to-top is-hidden">                    </div>',
    html: '<div class="modal fade in modal-tab-panel fonts-modal" id="" tabindex="-1" role="dialog" aria-hidden="false" data-backdrop="static" data-keyboard="false">                <div class="modal-dialog">                    <div class="modal-content">                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">\xd7</button>                        <div class="modal-body">                        </div>                    </div>                </div>            </div>',
    SCROLL_NEXT__PAGE_TRESHOLD: 50,
    MAX_SUGGESTIONS: 3,
    SCROLL_TO_TOP_TRESHOLD: 200,
    SEARCH_INPUT_TIMEOUT_TIME: 1e3,
    prototype: {
      filteredTags: [],
      search: "",
      page: 0,
      totalPages: 1 / 0,
      isLoading: !1,
      _searchInputTimeout: null,
      filterList: null,
      resultsList: null,
      init: function (e) {
        UI.SimpleModal.prototype.init.call(this, e);
        var t = this;
        (this.$fontsContainer = this.getBodyContainer().find(".fonts-list")),
          (this.$tagsContainer = this.getBodyContainer().find(
            "aside ul.filter-tag-list"
          )),
          (this.$viewAll = this.element.find("[data-view-all]")),
          (this.$scrollToTop = this.element.find(".scroll-to-top")),
          (this.$emptyState = this.element.find(".empty-state")),
          (this.$searchContainer = this.element.find(".search-filter")),
          (this._boundTagClick = this._filterClickHandler.bind(this)),
          (this._boundViewAll = this._viewAllClickHandler.bind(this)),
          (this._boundFontTag = this._fontItemTagClicked.bind(this)),
          (this._boundFontsContainerScrollHandler =
            this._fontsContainerScrollHandler.bind(this)),
          (this._boundShownPageHandler = this._shownPageHandler.bind(this)),
          this.appendChild(
            new Widget({
              name: "filterList",
              element: this.$tagsContainer,
            })
          ),
          this.appendChild(
            new Widget({
              name: "resultsList",
              element: this.$fontsContainer,
            })
          ),
          this.appendChild(
            new UI.SmartTemplate.FontInput({
              name: "searchInput",
              keyCodeForImmediateChange: 13,
              debounceTimeout: t.constructor.SEARCH_INPUT_TIMEOUT_TIME,
            })
          ).render(this.$searchContainer),
          (this.renderQueue = new SmartQueue({
            actionName: "queuedRender",
            minConsumers: 1,
            maxConsumers: 1,
            itemsPerConsumer: 1,
          })),
          (this.filteredTags = []),
          this.renderTags(),
          this._buildEmptyState(),
          this.queueSearch(),
          this._applyBindings();
      },
      _buildEmptyState: function () {
        var e,
          t,
          n,
          i = this,
          r = [];
        if (i.tags.length <= i.constructor.MAX_SUGGESTIONS)
          r = r.concat(i.tags);
        else
          for (var s = 0; s < i.constructor.MAX_SUGGESTIONS; s++) {
            do
              (e = Math.round(Math.random() * (i.tags.length - 1))),
                (n = i.tags[e].tag);
            while (~r.indexOf(n));
            r.push(n);
          }
        (t =
          "Try " +
          r
            .map(function (e) {
              return '<a data-tag="' + e + '">' + e + "</a>";
            })
            .join(" or ") +
          "!"),
          i.$emptyState.find(".suggestions").html(t),
          i.element.on("click", ".suggestions a[data-tag]", function (e) {
            var t = e.target.getAttribute("data-tag");
            i._viewAllClickHandler(),
              i.searchInput.element.val(t),
              i.queueSearch(t);
          });
      },
      _fontsContainerScrollHandler: function (e) {
        var t = this,
          n = e.target;
        t._boundShownPageHandler(),
          n.scrollTop > t.constructor.SCROLL_TO_TOP_TRESHOLD
            ? t._showScrollToTopButton()
            : t._hideScrollToTopButton();
      },
      _scrollToTop: function () {
        this.$fontsContainer.animate(
          {
            scrollTop: 0,
          },
          300
        );
      },
      _applyBindings: function () {
        var e = this;
        e.$fontsContainer.on("scroll", e._boundFontsContainerScrollHandler),
          e.bind("shownPage", e._boundShownPageHandler),
          e.$scrollToTop.click(e._scrollToTop.bind(e)),
          e.$viewAll.bind("click", this._boundViewAll),
          this.filterList.bind("activate", function (e) {
            this.dispatch("tagSelected", {
              originalEvent: e,
            }),
              e.stopPropagation();
          }),
          this.filterList.bind("deactivate", function (e) {
            this.dispatch("tagSelected", {
              originalEvent: e,
            }),
              e.stopPropagation();
          }),
          this.filterList.bind("tagSelected", function (t) {
            e._filterClickHandler(t);
          }),
          this.searchInput.bind("change", function (t) {
            e.queueSearch(t.target.element.val(), e.filteredTags);
          }),
          this.resultsList.bind("tagclicked", this._boundFontTag),
          Helpers.App.isMobile() || e.element.on("click", !1);
      },
      _hideScrollToTopButton: function () {
        this.$scrollToTop.addClass("is-hidden");
      },
      _showScrollToTopButton: function () {
        this.$scrollToTop.removeClass("is-hidden");
      },
      _shownPageHandler: function () {
        var e = this,
          t = 0,
          n = e.constructor.SCROLL_NEXT__PAGE_TRESHOLD;
        return "function" == typeof e.enqueuedqueueSearch
          ? (e.enqueuedqueueSearch(), void (e.enqueuedqueueSearch = null))
          : void (
              e.page + 1 !== e.totalPages &&
              ((t =
                e.$fontsContainer.outerHeight(!0) +
                e.$fontsContainer.scrollTop()),
              this.active &&
                e.$fontsContainer.prop("scrollHeight") - t < n &&
                e.loadNextPage())
            );
      },
      renderTags: function () {
        var e = this;
        e.tags.forEach(function (t) {
          e.filterList
            .appendChild(
              new UI.SmartTemplate.FontFilter({
                name: t.tag + "_tag",
                value: t.tag,
                label: t.tag,
                count: t.count,
              })
            )
            .render(e.filterList.element);
        });
      },
      clearFonts: function () {
        for (var e = this; e.resultsList.children.length; )
          e.resultsList.children.pop().destroy();
        e._hideScrollToTopButton(), (e.$fontsContainer[0].scrollTop = 0);
      },
      searchResultsPage: function (e, t, n) {
        var i = this,
          r = t
            .map(function (e) {
              return "tags:" + e;
            })
            .join(" OR ");
        (i.isLoading = !0),
          i
            ._fetchAlgoliaFonts(e, r, n)
            .then(function (r) {
              return (
                window.AlgoliaFontDataAdapter.adaptAlgoliaResponse(r),
                i._storeLatestSearchParams(e, t, n, r),
                i._showResultsPage(r),
                new Promise.resolve()
              );
            })
            ["catch"](function (e) {
              var t = new Error(
                "FontsModal:searchError " +
                  JSON.stringify({
                    search: this.newSearch,
                    filters: this.newFilters,
                    error: e,
                  })
              );
              return window.newrelic.noticeError(t), new Promise.resolve();
            });
      },
      _formatFiltersQuery: function (e) {
        return e
          .map(function (e) {
            return "tags:" + e;
          })
          .join(" OR ");
      },
      _fetchAlgoliaFonts: function (e, t, n) {
        return AlgoliaClient.searchFonts(e, {
          filters: t,
          page: n,
          hitsPerPage: 30,
        });
      },
      _storeLatestSearchParams: function (e, t, n, i) {
        var r = this;
        (r.filteredTags = t),
          (r.search = e),
          (r.page = n),
          (r.totalPages = i.nbPages);
      },
      _showResultsPage: function (e) {
        var t = this;
        t.renderFonts(e.hits), (t.isLoading = !1), t.dispatch("shownPage");
      },
      loadNextPage: function () {
        var e = this;
        e.isLoading ||
          e.page + 1 >= e.totalPages ||
          e.searchResultsPage(e.search, e.filteredTags, e.page + 1, !0);
      },
      queueSearch: function (e, t, n) {
        var i = this,
          r = function () {
            (e = e || ""),
              (t = t || []),
              i.clearFonts(),
              i.searchResultsPage(e, t, 0, n);
          };
        return i.isLoading
          ? ((i.enqueuedqueueSearch = r), i.enqueuedqueueSearch)
          : void r();
      },
      renderFonts: function (e) {
        var t = this;
        return 0 === e.length
          ? void this.$emptyState.show()
          : (this.$emptyState.hide(),
            void e.forEach(function (e, n) {
              var i,
                r = t.fontListManager.findInList("all", e.name);
              i =
                null !== r
                  ? r
                  : new Font({
                      data: e,
                    });
              var s = new UI.SmartTemplate.FontItem({
                name: "fontItem-" + n,
                fontData: i,
                tags: e.tags,
                toRender: t.$fontsContainer,
              });
              if (Helpers.StageType.getStageInfo().is_free && i.isPremium) {
                var o = new UI.SmartTemplate.AssetPremiumBadge();
                o.render(s.element),
                  s.appendChild(o),
                  s.element.addClass("premium");
              }
              t.resultsList.appendChild(s), t.renderQueue.push([s]);
            }));
      },
      _filterClickHandler: function (e) {
        var t,
          n,
          i = this,
          r = e.data.originalEvent.data.target.element,
          s = !1,
          o = null;
        if (
          (e.stopPropagation(),
          i.$viewAll.removeClass("is-selected"),
          r.is("[data-tag]")
            ? r.hasClass("is-selected")
              ? ((s = !0), (t = r.closest("[data-tag]")))
              : (t = r)
            : (r.is(".toggleable") && (s = !0), (t = r.closest("[data-tag]"))),
          (o = t.attr("data-tag")),
          (n = i.filteredTags.indexOf(o)),
          s)
        ) {
          if (
            -1 !== n &&
            (t.removeClass("is-selected"),
            i.filteredTags.splice(n, 1),
            0 === i.filteredTags.length)
          )
            return i._viewAllClickHandler();
        } else -1 === n && (t.addClass("is-selected"), i.filteredTags.push(o));
        i.renderQueue.clear(), i.queueSearch(i.search, i.filteredTags);
      },
      _viewAllClickHandler: function () {
        var e = this;
        e.element.find("li.is-selected").removeClass("is-selected"),
          e.$viewAll.addClass("is-selected"),
          e.searchInput.element.val(""),
          (e.filteredTags = []),
          e.queueSearch();
      },
      _fontItemTagClicked: function (e) {
        e.stopPropagation(), e.preventDefault();
        var t = this,
          n = e.data,
          i = t._getFilter(n.tag);
        i.hasClass("is-selected") ||
          (i.addClass("is-selected"), t.filteredTags.push(n.tag)),
          this.$viewAll.hasClass("is-selected") &&
            this.$viewAll.removeClass("is-selected"),
          t.queueSearch(t.search, t.filteredTags);
      },
      _getFilter: function (e) {
        return $('.item-tag[data-tag="' + e + '"]');
      },
      activate: function () {
        return (
          (this.active = !0),
          Widget.prototype.activate.call(this),
          this.element.modal("show"),
          $("body").addClass("modal-without-scroll"),
          this
        );
      },
      deactivate: function () {
        return (
          this.dispatch("fontsModal:deactivate"),
          (this.active = !1),
          Widget.prototype.deactivate.call(this),
          this.element.modal("hide"),
          $("body").removeClass("modal-without-scroll"),
          this
        );
      },
    },
  }),
  Class(UI.SmartTemplate, "FontPicker")
    .inherits(Widget)
    .includes(
      GenericDestroySupport,
      DraggableSupport
    )({
    html: '<div>            <div class="head">                <div class="listings"></div>                <div class="morefonts">                    <button class="morefonts-btn button secondary">More Fonts</button>                </div>            </div>            <div class="contents"></div>        </div>',
    headTemplate: '<div class="tab-header"></div>',
    bodyTemplate: '<div class="tab-body"></div>',
    elementClass: "fontpicker",
    topBar:
      '<div class="topbar">            <div class="close-button"><div>            </div>',
    _timeouts: [],
    prototype: {
      init: function (e) {
        Widget.prototype.init.call(this, e);
        var t = this;
        (this.$listingsHead = this.element.find(".listings")),
          (this.$listingsBody = this.element.find(".contents")),
          (this.$modalButon = this.element.find(".morefonts-btn")),
          (this.listings = []),
          (this._timeouts = []),
          (this._boundFontSelect = this._fontItemSelect.bind(this)),
          (this._closeListener = this.deactivate.bind(this)),
          this.isMobileVersion === !1 &&
            this.element.prepend($(this.constructor.topBar)),
          this.listingsData.forEach(function (e) {
            t._createListing(e);
          }),
          this.selectListing(this.listings[0]),
          this._setBindings(),
          this.hide();
      },
      _createListing: function (e) {
        var t = this,
          n = $(this.constructor.headTemplate),
          i = $(this.constructor.bodyTemplate),
          r = {
            name: e.name,
            headEl: n,
            bodyEl: i,
            fonts: [],
          };
        n.text(e.name),
          n.attr("font_listing", this.listings.length),
          i.hide(),
          t.$listingsHead.append(n),
          t.$listingsBody.append(i),
          this.listings.push(r),
          this._setEmptyState(r, e.emptyState);
      },
      addRecentFont: function (e) {
        var t = this[e.name + "_recent"],
          n = this.getListing("recent");
        void 0 !== t && this.removeFromListing(n, t.id),
          this.addToListing(n, this.createFontItem(e, "_recent"), !0);
      },
      addSuggestedFont: function (e) {
        this.addToListing(
          this.getListing("suggested"),
          this.createFontItem(e, "_suggested"),
          !1
        );
      },
      addSavedFont: function (e) {
        var t = this.createFontItem(e, "_saved");
        t.fontData.setProperty("isSaved", !0),
          this.addToListing(this.getListing("saved"), t, !1);
      },
      createFontItem: function (e, t) {
        var n = this.fontListManager.findInList("all", e.name),
          i = new UI.SmartTemplate.FontItem({
            name: n.name + t,
            fontData: n,
            isSelectable: !0,
            id: n.id,
          });
        return i.deactivate(), this.addPremiumBadgeToFontItem(i), i;
      },
      addPremiumBadgeToFontItem: function (e) {
        var t = Helpers.StageType.getStageInfo().is_free,
          n = e.getFontData().getProperty("originalData").isPremium;
        if (t && n && !e.premiumBadge) {
          var i = new UI.SmartTemplate.AssetPremiumBadge();
          i.render(e.element), e.appendChild(i), e.element.addClass("premium");
        }
      },
      updateSuggestedFonts: function (e) {
        var t = this,
          n = this.getListing("suggested").fonts;
        n.forEach(function (n, i) {
          n.getFontData().setProperty("originalData", e[i]),
            t.addPremiumBadgeToFontItem(n);
        });
      },
      addToListing: function (e, t, n) {
        0 === e.fonts.length && e.bodyEl.html(""),
          this.appendChild(t),
          n
            ? (e.fonts.unshift(t), t.render(e.bodyEl, !0))
            : (e.fonts.push(t), t.render(e.bodyEl)),
          t.id === this.activeFont.id && t.element.addClass("active");
      },
      removeFromListing: function (e, t) {
        for (var n, i, r = 0; r < e.fonts.length; r++)
          e.fonts[r].fontData.id === t && ((n = e.fonts[r]), (i = r));
        e.fonts.splice(i, 1), n.destroy();
      },
      selectListing: function (e) {
        this.activeListing &&
          (this.activeListing.headEl.removeClass("active"),
          this.activeListing.bodyEl.hide()),
          e.headEl.addClass("active"),
          e.bodyEl.show(),
          (this.activeListing = e);
      },
      _fontItemSelect: function (e) {
        var t,
          n,
          i = e.data.target.fontData;
        (t = this.fontListManager.getList("recent").add(i, "name")),
          this.fontListManager.getList("all").add(i, "name"),
          this.addRecentFont(i),
          this.selectFont(i.name),
          null !== t &&
            ((n = this[t.name + "_recent"]),
            n.fontData.id !== this.activeFont.id &&
              this.removeFromListing(this.getListing("recent"), n.fontData.id));
      },
      deselectFontItems: function () {
        this.children.forEach(function (e) {
          e.deactivate();
        });
      },
      selectFont: function (e) {
        var t = this.getFontInstances(e);
        this.deselectFontItems(),
          this.setActiveFont(t[0].fontData),
          t.forEach(function (e) {
            e.element.addClass("active");
          }),
          this._changeDispatcher();
      },
      setActiveFont: function (e) {
        this.activeFont = Object.assign({}, e);
      },
      _setBindings: function () {
        (this._boundListingSelect = this._listingSelectHandler.bind(this)),
          (this._boundActivateFontsModal =
            this._activateFontsModalHandler.bind(this));
        for (var e = 0; e < this.listings.length; e++)
          this.listings[e].headEl.bind("click", this._boundListingSelect);
        this.bind("activate", this._boundFontSelect),
          this.$modalButon.bind("click", this._boundActivateFontsModal),
          this.element.bind("click", !1),
          this.bind("saved", this._fontItemSave.bind(this)),
          this.isMobileVersion === !1 &&
            ((this.$closeButton = this.element.find(".close-button")),
            (this._boundCloseEvent = this.deactivate.bind(this)),
            this.$closeButton.bind("click", this._boundCloseEvent),
            this.setAsDraggable({
              $draggableEl: this.element,
              $boundingEl: $(".draggable-area"),
              $control: this.control,
            }));
      },
      _fontItemSave: function (e) {
        var t = this;
        if (Helpers.App.isLoggedIn() === !1)
          return void t._notLoggedInSaveFont();
        var n = e.data.target.fontData;
        n.getProperty("isSaved")
          ? t.savedFonts.deleteFont(n.id).then(t._fontUnsaveHandler(n))
          : t.savedFonts.addFont(n.id).then(t._fontSaveHandler(n));
      },
      _fontUnsaveHandler: function (e) {
        var t = this;
        t.fontListManager.getList("saved").remove(e.name, "name"),
          e.setProperty("isSaved", !1),
          t.removeFromListing(t.getListing("saved"), e.id);
      },
      _fontSaveHandler: function (e) {
        var t = this;
        t.fontListManager.getList("saved").add(e, "name"),
          t.fontListManager.getList("all").add(e, "name"),
          t.addSavedFont(e);
      },
      _notLoggedInSaveFont: function () {
        var e = {
          type: "warning",
          content:
            'Please create an account to add this font to saved.<br /> Already have an account?                     <a href="#" onclick="event.preventDefault();page.appNavBar.ssoModal.showTab(\'' +
            UI.SsoModal.TAB_LOGIN +
            '\')" class="trigger_login_link" role="button">Log In</a>',
          contentForceLogIn:
            'Please log in to add this font to saved.<br /> Don\'t have an account?                     <a href="#" onclick="event.preventDefault();page.appNavBar.ssoModal.showTab(\'' +
            UI.SsoModal.TAB_SIGNUP +
            '\')" class="trigger_signup_link" role="button">Sign Up</a> today!',
        };
        this.deactivate(),
          page.appNavBar.ssoModal.activate(),
          page.appNavBar.ssoModal.showMessage(e);
      },
      _activateFontsModalHandler: function (e) {
        e.preventDefault(), e.stopPropagation(), this._bindActiveFontsModal();
      },
      _bindActiveFontsModal: function () {
        this.fontsModal.activate(),
          (this._boundModalSelect = this._modalSelectHandler.bind(this)),
          (this._boundModalDeactivate =
            this._deactivateFontsModalHandler.bind(this)),
          (this._boundModalSave = this._fontItemSave.bind(this)),
          this.fontsModal.resultsList.bind("activate", this._boundModalSelect),
          this.fontsModal.resultsList.bind("saved", this._boundModalSave),
          this.fontsModal.bind(
            "fontsModal:deactivate",
            this._boundModalDeactivate
          ),
          $(window).unbind("click", this._closeListener);
      },
      _deactivateFontsModalHandler: function () {
        this.fontsModal.resultsList.unbind("saved", this._boundModalSave),
          this.fontsModal.resultsList.unbind(
            "activate",
            this._boundModalSelect
          ),
          this.fontsModal.unbind(
            "fontsModal:deactivate",
            this._boundModalDeactivate
          ),
          $(window).bind("click", this._closeListener);
      },
      _modalSelectHandler: function (e) {
        var t = e.data.target.fontData;
        this.fontsModal.deactivate(),
          void 0 !== this[t.name + "_recent"]
            ? this.selectFont(t.name)
            : this._fontItemSelect(e),
          this.selectListing(this.listings[1]);
      },
      _setEmptyState: function (e, t) {
        e.bodyEl.html(t);
      },
      _listingSelectHandler: function (e) {
        e.preventDefault(),
          e.stopPropagation(),
          this.selectListing(
            this.listings[e.target.getAttribute("font_listing")]
          );
      },
      _changeDispatcher: function () {
        this.dispatch("fontpicker:change", this.activeFont.originalData);
      },
      getFontInstances: function (e) {
        return this.children.filter(function (t) {
          return t.fontData.name === e;
        });
      },
      deactivate: function () {
        this.element.hide(),
          this.dispatch("fontpicker:hide"),
          $(window).unbind("click", this._closeListener);
      },
      _clearPickerFontsByList: function (e) {
        e.fonts.forEach(function (e) {
          e.destroy();
        }),
          (e.fonts = []);
      },
      activate: function () {
        this.resetPickerDefaultPosition(),
          this.dispatch("fontpicker:show"),
          this._clearPickerFontsByList(this.getListing("recent")),
          this._clearPickerFontsByList(this.getListing("saved")),
          this._syncWithFontList("recent", "addRecentFont"),
          this._syncWithFontList("saved", "addSavedFont");
        var e = this;
        this.getListing("suggested").fonts.forEach(function (t) {
          e.addPremiumBadgeToFontItem(t);
        }),
          0 === this.getFontInstances(this.activeFont.name).length &&
            this.addRecentFont(this.activeFont),
          this.isMobileVersion === !1 && this.restorePosition(this.element),
          this.element.show(),
          $(window).bind("click", this._closeListener);
      },
      getListing: function (e) {
        for (var t = 0; t < this.listings.length; t++)
          if (this.listings[t].name === e) return this.listings[t];
      },
      _unbindEvents: function () {
        for (var e = 0; e < this.listings.length; e++)
          this.listings[e].headEl.unbind("click", this._boundListingSelect);
        this.unbind("activate", this._boundFontSelect),
          this.$modalButon.unbind("click", this._boundActivateFontsModal),
          this.element.unbind("click", !1),
          this.isMobileVersion === !1 &&
            this.$closeButton.unbind("click", this._boundCloseEvent);
      },
      destroy: function () {
        this._unbindEvents(), Widget.prototype.destroy.call(this);
      },
      resetPickerDefaultPosition: function () {
        this.isMobileVersion !== !0 && this._setDefaultPosition();
      },
      _syncWithFontList: function (e, t) {
        for (
          var n = this.fontListManager.getList(e).list, i = 0;
          i < n.length;
          i++
        )
          this[t](n[i]);
      },
    },
  }),
  Class(UI.SmartTemplate, "ImageUploader")
    .inherits(Widget)
    .includes(BubblingSupport)({
    html: '<li class="background_item custom_image" data-value="{value}">             <div class="custom_option">                <div>                    <div data-spinner class="pl-spinner-primary-xl relative"></div>                    <span id="label" style="border:none"></span>                 </div>             </div>             <img style="display:none"/>             <video muted playsinline style="display:none"/>           </li>           <input style="display:none;" type="file" />',
    prototype: {
      viewport: null,
      record: null,
      maxSize: null,
      videoMaxSize: null,
      acceptedFiles: null,
      _onCropEnds: null,
      init: function (e) {
        Widget.prototype.init.call(this, e);
        var t = this.constructor.html.replace("{value}", this.name),
          n = this,
          i = [],
          r = [];
        this.acceptImage &&
          (i.push(UI.StageBase.acceptedFormats.image), r.push("Image")),
          this.acceptVideo &&
            (i.push(UI.StageBase.acceptedFormats.video), r.push("Video"));
        var s = i.join(",");
        (this.labelContents = "Upload " + r.join(" or ")),
          (this.element = $(t)),
          (this.$listItem = $(this.element[0])),
          (this.$image = this.$listItem.find("img:not(.premium-crown)")),
          (this.$video = this.$listItem.find("video")),
          (this.$placeholder = this.$listItem.find(".custom_option")),
          (this.$spinner = this.$listItem.find("[data-spinner]")),
          (this.$text = this.$listItem.find(".custom_option span")),
          (this.$fileInput = $(this.element[2])),
          this.$fileInput.attr("accept", s),
          (this.$label = this.$listItem.find("#label")),
          this.$label.html(this.labelContents),
          this.appendChild(
            new UI.SmartTemplate.GraphicItem({
              itemName: "customGraphicPreview",
              name: "customGraphicPreview",
              record: {
                assetType: "image",
                visible: !1,
                image: null,
                path: null,
                type: null,
              },
              cssClass: "multi_item graphic_item",
              isCustomUpload: !0,
              viewportData: this.viewport,
              excludeTrimmer: !1,
            })
          ),
          this.appendChild(
            new UI.SmartTemplate.VideoItem({
              itemName: "customVideoPreview",
              name: "customVideoPreview",
              record: {
                assetType: "video",
                visible: !1,
                image: !0,
                video: null,
                type: null,
              },
              cssClass: "multi_item video_item",
              isCustomUpload: !0,
              fragmentDuration: this.fragmentDuration,
              viewportData: this.viewport,
              excludeTrimmer: !1,
            })
          ),
          this.$listItem.bind(
            "click",
            function () {
              this.$fileInput.click();
            }.bind(this)
          ),
          this.$fileInput.bind(
            "click",
            function () {
              this.$fileInput.val(null), n.dispatch("customImageUploadClicked");
            }.bind(this)
          ),
          this.$fileInput.bind("change", function () {
            var e = this.files[0],
              t = "." + e.name.split(".").pop().toLowerCase(),
              i = n.isVideo(e.name),
              r = i ? n.videoMaxSize : n.maxSize;
            n.acceptedFiles[e.type]
              ? (!i && e.size > n.maxSize) || (i && e.size > n.videoMaxSize)
                ? page.flash(
                    "File is too big, maximum allowed for " +
                      (i ? "videos" : "images") +
                      " is " +
                      r / 1e3 / 1e3 +
                      " MB",
                    "alert",
                    {
                      autoclose: {
                        milliseconds: 5e3,
                      },
                    }
                  )
                : e &&
                  (n.element.removeClass("video_item"),
                  (n.file = e),
                  n.loadingState && n.showWorkingFeedback("Uploading "),
                  (n.customGraphicPreview.file = e),
                  n.dispatch("customImageUploaded", {
                    item: n,
                    isVideo: i,
                    type: t,
                    componentToInform: n.componentToInform,
                  }))
              : alert(
                  "Invalid file type. Please upload only " +
                    Object.keys(n.acceptedFiles).join(", ")
                );
          }),
          (this._onCropEnds = function () {
            n.hideUploadingFeedback();
          }),
          UI.StageSmartVideoProduct &&
            UI.StageSmartVideoProduct.bind("cropEnds", this._onCropEnds),
          UI.SmartTemplate.StageCanvas &&
            UI.SmartTemplate.StageCanvas.bind("cropEnds", this._onCropEnds);
      },
      isVideo: function t(e) {
        var n = e.split(".").pop().toLowerCase(),
          t = UI.StageBase.acceptedFormats.video.indexOf(n) >= 0;
        return t;
      },
      select: function () {
        return (
          (this.record.visible = !0), this.element.addClass("active"), this
        );
      },
      deselect: function () {
        return (
          (this.record.visible = !1), this.element.removeClass("active"), this
        );
      },
      focus: function (e) {
        return this.parent.$backgroundBody.scrollTop(e), this;
      },
      updateViewport: function (e) {
        return (this.viewport = e), this;
      },
      updatePreview: function (e, t, n) {
        var i,
          r,
          s,
          o,
          a = this,
          l = (this.$fileInput[0].files[0], t && this.isVideo(t));
        if (
          (l
            ? ((i = this.customVideoPreview),
              (r = this.customGraphicPreview),
              (s = i.element.find("img:not(.premium-crown)")),
              (o = i.element.find("video")))
            : ((i = this.customGraphicPreview),
              (r = this.customVideoPreview),
              (s = i.element.find("img:not(.premium-crown)"))),
          i.show(),
          r.hide(),
          s.attr("src", e),
          l
            ? this.element.addClass("video_item")
            : this.element.removeClass("video_item"),
          t && this.isVideo(t))
        ) {
          if (!this.element.hasClass("video_item")) return this;
          this.element.addClass("video_item"),
            this.$image.bind("mouseover", function () {
              a.$video.show(), a.$video[0].play();
            }),
            this.$video.bind("mouseout", function () {
              a.$video.hide();
            }),
            setTimeout(function () {
              a.$video.attr("src", t);
            }),
            Helpers.App.isMobile() && (i.removeVideo(), i.mouseenterHandler());
        } else
          this.$image.unbind("mouseover"),
            this.$video.unbind("mouseout"),
            this.element.removeClass("video_item"),
            this.$video.hide();
        return (
          Helpers.StageType.getStageInfo().is_free && n
            ? ((i.record.isPremium = !0),
              (this.record.isPremium = !0),
              i.premiumBadge ||
                ((i.premiumBadge = new UI.SmartTemplate.AssetPremiumBadge()),
                i.premiumBadge.render(i.element)))
            : ((i.record.isPremium = !1),
              (this.record.isPremium = !1),
              i.premiumBadge &&
                (i.premiumBadge.destroy(), (i.premiumBadge = null))),
          this
        );
      },
      reset: function () {
        return (
          this.$image.hide(),
          this.$placeholder.show(),
          (this.record.image = null),
          (this.record.visible = !1),
          this.$image.removeAttr("src"),
          this
        );
      },
      showWorkingFeedback: function (e) {
        this.$image.hide(),
          this.$placeholder.show(),
          this.$spinner.show(),
          this.$text.text(e),
          this.$text.addClass("ellipsing"),
          this.$label.addClass("working");
      },
      hideUploadingFeedback: function () {
        this.$spinner.hide(),
          this.$text.text(this.labelContents),
          this.$text.removeClass("ellipsing"),
          this.$label.removeClass("working");
      },
      destroy: function () {
        (this.$listItem = null),
          (this.$image = null),
          (this.$fileInput = null),
          UI.StageSmartVideoProduct &&
            UI.StageSmartVideoProduct.unbind("cropEnds", this._onCropEnds),
          UI.SmartTemplate.StageCanvas &&
            UI.SmartTemplate.StageCanvas.unbind("cropEnds", this._onCropEnds),
          Widget.prototype.destroy.call(this);
      },
      getGraphicRecord: function () {
        return this.customGraphicPreview.getRecord();
      },
      getVideoRecord: function () {
        return this.customVideoPreview.getRecord();
      },
      setPosition: function () {
        this.topPosition = this.element.position().top;
      },
      getPosition: function () {
        return this.topPosition;
      },
      getSize: function () {
        return this.element[0].clientHeight;
      },
      getFile: function () {
        return this.file;
      },
      hideVideoPreview: function () {
        this.customVideoPreview.mouseleaveHandler();
      },
      hasVideoPreview: function () {
        return this.customVideoPreview.video ? !0 : !1;
      },
      showFilePicker: function () {
        this.$fileInput.click();
      },
    },
  }),
  Class(UI.SmartTemplate.Mobile, "ChangeAssetButton")
    .inherits(Widget)
    .includes(
      BubblingSupport,
      GenericDestroySupport
    )({
    html: '<div>    <button class="button secondary">    </button>  </div>',
    prototype: {
      buttonElement: null,
      init: function (e) {
        var t = this;
        Widget.prototype.init.call(t, e),
          t.element.addClass(t.className),
          (t.buttonElement = t.element.find("button")),
          t.buttonElement.html(t.label),
          t.buttonElement.on("click", function (e) {
            e.preventDefault(),
              $(".navbar-container, .page-container").addClass("sidebar-open"),
              t.sidebar.activate();
          });
      },
      destroy: function () {
        this.genericDestroy();
      },
    },
  }),
  Class(UI.SmartTemplate.Mobile, "ChangeTextButton")
    .inherits(Widget)
    .includes(
      BubblingSupport,
      GenericDestroySupport
    )({
    elementClass: "smart_template--change_text_button",
    html: '<div>    <button class="button secondary">      Change Text / FX    </button>  </div>',
    prototype: {
      buttonElement: null,
      init: function (e) {
        var t = this;
        Widget.prototype.init.call(t, e),
          (t.buttonElement = t.element.find("button")),
          t.buttonElement.on("click", function (e) {
            e.preventDefault(),
              $(".navbar-container, .page-container").addClass("sidebar-open"),
              t.sidebar.activate();
          });
      },
      destroy: function () {
        this.genericDestroy();
      },
    },
  }),
  Class(UI.SmartTemplate.Mobile, "GoBackButton")
    .inherits(Widget)
    .includes(BubblingSupport)({
    elementClass: "smart_template--go_back_button",
    html: '<div>    <button class="button primary">      Apply Changes    </button>  </div>',
    prototype: {
      buttonElement: null,
      init: function (e) {
        var t = this;
        Widget.prototype.init.call(t, e),
          (t.buttonElement = t.element.find("button")),
          t.buttonElement.on("click", function (e) {
            e.preventDefault(),
              t.sidebar.deactivate(),
              $(".modal-backdrop.fade").remove(),
              $(".navbar-container, .page-container").removeClass(
                "sidebar-open"
              ),
              t.dispatch("applyChange");
          });
      },
      updatePrefix: function () {},
    },
  }),
  Class(UI, "MulticontrolCompoundButton")
    .inherits(Widget)
    .includes(
      BubblingSupport,
      AddGraphicDropdownSupport
    )({
    BLANK_IMG_PATH: "./assets/blank.png",
    html: '        <div>            <label class="title"></label>            <div class="compound-button button composite-button" style="display:flex;">                <div class="thumb image-container"><img></div>                <div class="reposition button" style="display:flex;">                    <span class="p-icon p-sm crop-gray"></span>                    <div>Resize</div>                </div>                <div class="edit button" style="display:flex;">                    <span class="p-icon p-sm gallery-gray"></span>                        <span class="text"></span>                    </div>                <div class="remove button" style="display:flex;">                    <span class="p-icon p-sm remove-gray"></span>                    <div>Remove</div>                </div>            </div>        </div>    ',
    elementClass: "compound-button-container",
    TEXT_REPLACE: "Edit",
    prototype: {
      thumb: null,
      selectedItem: null,
      init: function (e) {
        Widget.prototype.init.call(this, e),
          (this.$compositeButton = this.element.find(".composite-button")),
          (this.$title = this.element.find(".title")),
          (this.$edit = this.element.find(".edit")),
          (this.$remove = this.element.find(".remove")),
          (this.$reposition = this.element.find(".reposition")),
          (this.$editText = this.$edit.find(".text")),
          (this.$thumb = this.element.find(".thumb")),
          (this.$thumbImg = this.$thumb.find("img")),
          e.shouldTrimTitles && (this.title = this.title.slice(0, -2)),
          this.$title.text(this.title),
          this._update(),
          this._bindEvents(),
          this.isMobile && this._buildDropdown();
      },
      setSelectedItem: function (e) {
        (this.selectedItem = e), this._update();
      },
      _update: function () {
        var e;
        e = this;
        var t = this.selectedItem;
        return t && t.hasAsset()
          ? (this.$editText.text(this.constructor.TEXT_REPLACE),
            this.$thumb.show(),
            this.$remove.show(),
            this.$compositeButton.addClass("btn-group"),
            this.dispatch("selectitem"),
            t.getThumbImageUrl().then(function (t) {
              e.$thumbImg.attr("src", t);
            }),
            void (t.canReposition()
              ? (this.$reposition.show(),
                this.$thumbImg.removeClass(
                  "gray-filter gallery-image-mobile-thumbnail"
                ))
              : (this.$reposition.hide(),
                this.$thumbImg.addClass(
                  "gray-filter gallery-image-mobile-thumbnail"
                ))))
          : (this.$editText.text("Add Graphics"),
            this.$thumb.hide(),
            this.$remove.hide(),
            this.$reposition.hide(),
            this.$compositeButton.removeClass("btn-group"),
            void this.dispatch("removeitem"));
      },
      _bindEvents: function () {
        var e = this,
          t = function (t) {
            t.stopImmediatePropagation(), e.showModal();
          },
          n = function () {
            e.selectedItem.repositionAsset();
          },
          i = function () {
            e.dispatch("setNoImage");
          };
        e.$edit.click(t), e.$reposition.click(n), e.$remove.click(i);
      },
      showModal: function () {
        this.dispatch("showModal", {
          originalDispatcher: this,
        });
      },
      showFilePicker: function () {
        this.dispatch("showFilePicker");
      },
    },
  }),
  Class(UI.SmartTemplate, "MultiControl")
    .inherits(Widget)
    .includes(
      BubblingSupport,
      GenericDestroySupport,
      ColorPalettesSupport,
      CDNSupport,
      StageControlsDestroySupport,
      FetchLayersSupport,
      MultiControlExpandSupport,
      SkeletonCardSupport,
      CompoundButtonSupport
    )({
    HTML_CONTENT:
      '        <div class="graphic-header">            <label class="title"></label>            <button class="expand-btn">                <span>EXPAND</span><i></i>            </button>            <div class="color-controls-container"></div>            <div class="form-group search-container hidden">                <input type="text" class="img-search-box textbox form-control" placeholder="Search">                <span id="searchClear" class="glyphicon glyphicon-remove-circle clear-search hidden"></span>            </div>            <div class="white-fader hidden"></div>        </div>        <div class="graphic-body">            <div class="columns-container"></div>        </div>',
    html: "<div></div>",
    elementClass: "multi-control",
    thumbSource: null,
    ANIMATION_DURATION: 150,
    COLOR_CONTROL_HEIGHT: 52,
    FOCUS_ANIMATION_DURATION: 500,
    FOCUS_ANIMATION_CLASS: "wobble-vertical",
    prototype: {
      initialValues: {},
      numberOfColumns: 2,
      allowTransparency: !1,
      _popstateHandler: null,
      _timeouts: null,
      _algoliaData: null,
      _readyToLoadAssets: !1,
      _layerInfoReady: !1,
      _loading: !1,
      _selectedLayerId: null,
      selectedLayer: null,
      _layersToBeRendered: null,
      _totalPages: null,
      _eventSource: "nextpage",
      defaultAssetColors: [],
      transitionQueue: null,
      _fragmentDuration: null,
      _viewportData: null,
      renderedItems: null,
      title: null,
      mobileSidebarAlreadyOpened: !1,
      isMobilePhone: !1,
      grid: null,
      _domEventClickHandler: null,
      fetchAssetsTask: null,
      renderThumbTask: null,
      init: function (e) {
        this._initVariables(),
          Widget.prototype.init.call(this, e),
          this._hackPreventChangeEventRacing(),
          this._initDOMReferences()
            ._setInitialValues()
            ._setOnlyGraphics()
            ._initComponents()
            ._bindings();
      },
      _initVariables: function () {
        (this._timeouts = []),
          (this.defaultAssetColors = []),
          (this._layersToBeRendered = []),
          (this.renderedItems = []),
          (this.initialValues = {
            assetId: null,
            asset: null,
            color: null,
            search: "",
          }),
          (this.previousValues = {
            assetId: null,
            asset: null,
            color: null,
            search: "",
          }),
          (this._algoliaData = {
            control: {
              propertyName: null,
              position: null,
              selectedLayerId: null,
            },
            params: {
              search: "",
              page: 0,
              perPage: 20,
            },
          });
      },
      _initDOMReferences: function () {
        var e = this.constructor.HTML_CONTENT;
        return (
          this.isMobilePhone === !0 &&
            (e = '<div class="overlay-container">' + e + "</div>"),
          this.element.append(e),
          (this.$title = this.element.find(".title")),
          (this.$columnsContainer = this.element.find(".columns-container")),
          (this.columns = [
            this.element.find(".columns-container .column-1 .list"),
            this.element.find(".columns-container .column-2 .list"),
          ]),
          (this.searchContainer = this.element.find("div.search-container")),
          (this.$graphicBody = this.element.find(".graphic-body")),
          (this.$colorControlsContainer = this.element.find(
            ".color-controls-container"
          )),
          (this.$expandCollapseBtn = this.element.find(
            ".graphic-header button"
          )),
          (this.$whiteFader = this.element.find(".white-fader")),
          this
        );
      },
      _setInitialValues: function () {
        var e = this.title || this.record.name;
        return (
          (this.urlParamName = "multi"),
          (this.customType = "customGraphic"),
          this.shouldTrimTitles && (e = e.slice(0, -2)),
          this.$title.text(e),
          (this.transitionQueue = new Queue()),
          (this._fragmentDuration = this.record.duration),
          (this.initialValues.color = this.record.color),
          (this.previousValues.color = null),
          (this.initialValues.search = this.record.preconfiguredSearch || ""),
          "string" == typeof this.prefillSearch &&
            this.prefillSearch.length > 0 &&
            ((this.initialValues.search = this.prefillSearch),
            (this.record.preconfiguredSearch = this.prefillSearch)),
          (this.previousValues.assetId = this.prefillGraphic),
          (this.transitionQueue = new Queue()),
          this._setByType(),
          this.updatePrefix(this.prefix || "", !1),
          this.element.addClass("type-" + this.type),
          this
        );
      },
      _setByType: function () {
        return (
          "video" === this.type && (this.urlParamName = "video"),
          "background" === this.type && (this.customType = "customBg"),
          this
        );
      },
      _setOnlyGraphics: function () {
        return (
          this.onlyGraphics &&
            (this.element.addClass("graphic-control"),
            this.element.removeClass("multi-control")),
          this
        );
      },
      _initComponents: function () {
        return this.record.allowColorpicker === !1 && this.hasAssets() === !1
          ? (this.element.hide(), this)
          : (this.createColorPicker(),
            this.hasAssets() === !0 &&
              (this._initAssetsGrid(),
              this._createCompoundButton(),
              this.record.allowSearch === !0
                ? this._initAssetsSearch()
                : this.element.addClass("no-searchbar")),
            this.record.allowColorpicker === !0 &&
              this.hasAssets() === !1 &&
              this.element.addClass("no-layers"),
            this);
      },
      _initAssetsSearch: function () {
        var e = this.initialValues.search;
        return (
          this.setInitialValues({
            search: e,
          }),
          this.setPreviousValues({
            search: e,
          }),
          this.appendChild(
            new UI.AssetsSearch({
              name: "search",
              placeholder: "Search",
              value: e,
              debounceTime: 250,
              element: this.searchContainer,
            })
          ),
          this._addSearchInputBindings(),
          this._enableFullScreenSearchToMobile(),
          this.searchContainer.removeClass("hidden"),
          this
        );
      },
      _addSearchInputBindings: function () {
        this.search &&
          (this.search.bind("change", this._searchChangeHandler.bind(this)),
          this._addDomOnClickListener());
      },
      _searchChangeHandler: function (e) {
        e.stopPropagation();
        var t = e.data;
        return (
          this.grid &&
            this.doSearch(t.value, t.triggeredByUser).then(
              function () {
                this.element.hasClass("expand") === !1 &&
                  this._autoExpandHandler();
              }.bind(this)
            ),
          this
        );
      },
      _initAssetsGrid: function () {
        var e = this;
        this.algoliaSearch = UI.AlgoliaSearch.getInstance();
        var t =
          null !== this.record.selectedLayer
            ? this.record.selectedLayer.id
            : null;
        this.prefillGraphic && (t = this.prefillGraphic),
          this.setAlgoliaData({
            propertyName: this.type,
            position: this.position,
            selectedLayerId: t,
            search: this.initialValues.search,
            page: 0,
            perPage: 20,
          });
        var n = !!this.onlyGraphics;
        this._checkAssetExistence(t),
          this.appendChild(
            new UI.AssetsGrid({
              name: "grid",
              selected: this.initialValues.asset,
              selectedId: t,
              isMobile: this.isMobilePhone,
              defaultNumberOfColumns: n === !0 ? 3 : 2,
              customType: this.customType,
              record: this.record,
              maxSize: UI.StageBase.maxSizeAllowed.image,
              videoMaxSize: UI.StageBase.maxSizeAllowed.video,
              acceptedFiles: $.extend(
                {},
                UI.StageBase.acceptedFiles.image,
                UI.StageBase.acceptedFiles.video
              ),
              onlyGraphics: n,
              type: this.type,
              excludable: this.record.excludable,
              duration: this.record.duration,
              element: this.$graphicBody,
              fragmentDuration: this._fragmentDuration,
              columnsBreakpoints: [
                {
                  min: 500,
                  max: 767,
                  columns: n === !0 ? 4 : 3,
                },
                {
                  min: 768,
                  max: 1024,
                  columns: n === !0 ? 5 : 4,
                },
              ],
            })
          ),
          this.$whiteFader.removeClass("hidden"),
          this._addGridBindings(),
          this.grid.showLoader(),
          this.cancelFetchAssetsTask(),
          (this.fetchAssetsTask = P.cancelable(function () {
            return e._getInitialAssets();
          })()),
          this.fetchAssetsTask
            .then(this._getInitialAssetsCallback.bind(this))
            ["catch"](this._getAssetsFailCallback.bind(this));
      },
      getSelectedItem: function () {
        return this.grid.getThumbSelected();
      },
      cancelFetchAssetsTask: function () {
        this.fetchAssetsTask &&
          (this.fetchAssetsTask.cancel(), (this.fetchAssetsTask = null));
      },
      _addGridBindings: function () {
        var e = this.grid;
        e &&
          e
            .bind("change", this._changeAssetHandler.bind(this))
            .bind("pageChange", this._pageChangeHandler.bind(this))
            .bind("endRender", this._endRenderThumbsHandler.bind(this))
            .bind("changeUrlParam", this._changeUrlParamHandler.bind(this));
      },
      _changeUrlParamHandler: function (e) {
        var t = e.data.value;
        this.setUrlParameter(t);
      },
      _addDomOnClickListener: function () {
        (this._domEventClickHandler = function (e) {
          return $.contains(this.element[0], e.target) === !0
            ? void this._cancelAutoCollapse()
            : void (
                this.element.hasClass("expand") === !0 && this._autoCollapse()
              );
        }.bind(this)),
          document.body.addEventListener("click", this._domEventClickHandler);
      },
      _removeEventListeners: function () {
        "function" == typeof this._domEventClickHandler &&
          (document.body.removeEventListener(
            "click",
            this._domEventClickHandler
          ),
          (this._domEventClickHandler = null)),
          this._onClickOutsidePopup &&
            ($(document.body).unbind("click", this._onClickOutsidePopup),
            (this._onClickOutsidePopup = null));
      },
      _changeAssetHandler: function (e) {
        e.stopPropagation();
        var t = e.data,
          n = t.item;
        if (
          t.triggeredByLocalCropSuccess === !0 &&
          Helpers.StageType.isFusionVideo() === !1
        ) {
          var i = n.record && n.record.id,
            r = {
              asset: n.record,
              assetId: i,
            };
          return (
            this.updateRecord(r), this.dispatch("customAssetCropped"), this
          );
        }
        return this.grid.getCustomAssetDataTask &&
          this.grid.getCustomAssetDataTask.isPending() === !0
          ? void 0
          : (this.selectItem(n, t), this);
      },
      _pageChangeHandler: function (e) {
        var t = e.data.pagination;
        return (
          this.grid.showLoader(),
          this.getAssets(t, !0)
            .then(this._getAssetsCallback.bind(this))
            ["catch"](this._getAssetsFailCallback.bind(this)),
          this
        );
      },
      _endRenderThumbsHandler: function () {
        var e = this.$graphicBody.height();
        return (
          550 >= e &&
            this.element.height() < window.innerHeight - 120 &&
            this.element.hasClass("expand-enabled") === !1 &&
            this.element.addClass("expand-enabled"),
          this
        );
      },
      selectItem: function (e, t) {
        this.compoundButton.setSelectedItem(e),
          this._fetchAndSetLayersForRecord(
            e.record,
            this._fetchAndSetLayersForRecordCallback.bind(this, e, t)
          );
      },
      _fetchAndSetLayersForRecordCallback: function (e, t) {
        var n = this,
          i = e.record && e.record.id,
          r = {
            asset: e.record,
            assetId: i,
          };
        this.setPreviousValues(r),
          this.updateRecord(r),
          this.setAlgoliaData({
            selectedLayerId: i,
          }),
          this.algoliaSearch.changeSelectedLayer(this.getAlgoliaControl(), i),
          this._synchronizeMainColors({
            forceSync: !0,
          }),
          this._createAdditionalColorPickers(!0).then(function () {
            if (
              ((t.originalDispatcher = n),
              t.triggeredByUser === !0 && t.triggeredByLocalCropSuccess !== !0)
            ) {
              var r =
                e.record.id === n.customType
                  ? e.record.record_hash
                  : e.record.id;
              n.setUrlParameter(r);
            }
            Helpers.GlobalEventTracker.smartTemplateEvent(
              "graphicChange",
              Object.assign(
                {
                  previous: n.previousValues.assetId,
                  new: i,
                },
                Helpers.App.getProductShownData()
              )
            ),
              n.dispatch("multiControlReady"),
              n.dispatch("change", t);
          });
      },
      _getInitialAssetsCallback: function (e) {
        var t,
          n,
          i = this,
          r = {};
        return (
          (t = e.selectedLayer && e.selectedLayer.id),
          this.isCustomAsset(e.selectedLayer) === !0 &&
            ((t = this.prefillGraphic),
            i._getCustomAssetData(i.prefillGraphic)),
          (r.assetId = t || this.prefillGraphic),
          (r.asset = e.selectedLayer),
          this.setInitialValues(r),
          (this._layerInfoReady = !0),
          this.setAssets(e),
          this.grid.setInitValues(),
          "background" === this.type && this.dispatch("backgroundReady"),
          this.isMobilePhone !== !0
            ? void this.renderAssets()
            : (i.mobileSidebarAlreadyOpened && i.renderAssets(),
              (n = P.cancelable(function (e) {
                return i.grid.renderSelectedAsset(e);
              })),
              (i.renderThumbTask = n(r.asset)),
              void i.renderThumbTask
                .then(function (e) {
                  null !== e && i.compoundButton.setSelectedItem(e),
                    null !== i.initialValues.asset &&
                      (i._fetchAndSetLayersForRecord(
                        i.initialValues.asset,
                        i._fetchAndSetLayersForRecordCallback.bind(
                          i,
                          {
                            record: i.initialValues.asset,
                          },
                          {
                            triggeredByUser: !1,
                          }
                        )
                      ),
                      (i.grid.previousValue = i.initialValues.asset));
                })
                ["catch"](function (e) {
                  if ("Cancelation Error" === e.message)
                    return console.warn("Cancelation Error"), e;
                  throw new Error(e);
                }))
        );
      },
      _checkAssetExistence: function (e) {
        var t,
          n,
          i,
          r,
          s,
          o,
          a = this,
          l = [];
        (n = (e && e.id) || null),
          (r = "null" === n || null === n),
          r ||
            ((o = "customGraphic" === n),
            o ||
              ((i = a._cdnBasePath() + e.image),
              $.ajax({
                url: i,
                method: "HEAD",
                cache: !1,
              }).fail(function (e) {
                Helpers.GlobalEventTracker.deletedAsset({
                  id: n,
                  fullUrl: window.location.href,
                  statusCode: e.status,
                  assetURL: i,
                });
              }),
              (t = a.algoliaSearch.controls.filter(function (e) {
                return (
                  e.propertyName === a.getAlgoliaControl().propertyName &&
                  e.position === a.getAlgoliaControl().position
                );
              })),
              t.forEach(function (e) {
                l = l.concat(e.graphics);
              }),
              (s =
                void 0 ===
                l.filter(function (e) {
                  return e === n;
                })[0]),
              s &&
                Helpers.GlobalEventTracker.missingAsset({
                  id: n,
                  fullUrl: window.location.href,
                })));
      },
      isCustomAsset: function (e) {
        var t = e && e.id;
        return null !== t
          ? !1
          : void 0 === this.prefillGraphic ||
            "null" === this.prefillGraphic ||
            null === this.prefillGraphic
          ? !1
          : !0;
      },
      isLibraryAsset: function (e) {
        var t = e && e.id;
        return null === t || "null" === t
          ? !1
          : "customGraphic" !== t
          ? !0
          : !1;
      },
      createColorPicker: function () {
        if (this.record.allowColorpicker !== !0)
          return void this.element.addClass("no-colorpicker");
        var e = this,
          t = e.getFullPalette();
        this.element.addClass("has-color-picker");
        var n,
          i = "null" === e.prefillColor ? "rgba(0,0,0,0)" : e.prefillColor;
        "background" === e.type
          ? ((e.allowTransparency = !0),
            t[t.length - 1].splice(
              t[t.length - 1].length - 1,
              1,
              "transparent"
            ),
            (e.previousValues.color = e.record.color || "transparent"))
          : (e.previousValues.color = e.record.color || "#F1F1F1"),
          (n = {
            togglePaletteOnly: !e.isMobilePhone,
            containerClassName: e.isMobilePhone
              ? "colorpicker-container-mobile"
              : "colorpicker-container-graphic-control",
            replacerClassName: e.isMobilePhone
              ? "colorpicker-replacer-mobile"
              : "colorpicker-replacer",
            showSelectionPalette: !0,
            palette: t,
          });
        var r = new UI.SmartTemplate.ColorControl({
            name: "color" + e.name,
            label: null,
            record: e.record,
            isMobilePhone: e.isMobilePhone,
            prefillColor: i,
            prefix: e.prefix,
            sidebarSide: "right",
            changeColorEventName: "graphicColorChange",
            colorPickerPopupTopOffset: 0,
            spectrumOptions: n,
            isMainColor: !0,
            allowTransparency: e.allowTransparency,
          }),
          s = function () {
            r.unbind("colorControlReady", s),
              e.hasAssets() === !1 &&
                (e.dispatch("multiControlReady"), e.dispatch("change"));
          };
        r.bind("colorControlReady", s),
          r.bind("change", function (t) {
            e._synchronizeMainColors(t);
          }),
          e._bindPopupColorControlEvents(r),
          e.appendChild(r),
          r.render(e.$colorControlsContainer);
      },
      _synchronizeMainColors: function (e) {
        var t,
          n,
          i = this,
          r = i.record.selectedLayer,
          s = e.forceSync || e.target.isMainColor || !1,
          o =
            r &&
            r.layers &&
            r.layers.filter(function (e) {
              return "main" === e.name.toLowerCase().trim();
            })[0];
        o &&
          s &&
          (e.target && e.target.isExtraColor
            ? ((t = o), (n = i.record))
            : ((t = i.record), (n = o)),
          (n.color = t.color || "#000000"),
          i.record.color || (i.record.color = "#000000"),
          i._refreshColorpickersForAllColorControls());
      },
      _refreshColorpickersForAllColorControls: function () {
        var e = this;
        e._getAllChildrenExactly(["ColorControl"]).forEach(function (e) {
          e.refreshColorpicker();
        });
      },
      _createAdditionalColorPickers: function (e) {
        var t,
          n,
          i = this,
          r = i.getFullPalette(),
          s = Helpers.App.getAllURLParams(),
          o = i.record.selectedLayer || {};
        return (
          i.transitionQueue.clear(),
          (o.layers = o.layers || []),
          (n = i._getAllChildrenExactly(["ColorControl"]).filter(function (e) {
            return e.isExtraColor;
          })),
          i._synchronizeMainColors({
            forceSync: !0,
          }),
          (t = {
            togglePaletteOnly: !i.isMobilePhone,
            containerClassName: i.isMobilePhone
              ? "colorpicker-container-mobile"
              : "colorpicker-container-graphic-control",
            replacerClassName: i.isMobilePhone
              ? "colorpicker-replacer-mobile"
              : "colorpicker-replacer",
            showSelectionPalette: !0,
            palette: r,
          }),
          (this.colorSyncPromises = []),
          o.layers
            .filter(function (e) {
              return e.allowColorpicker;
            })
            .forEach(function (r) {
              var o,
                a = i.prefix || "",
                l = "color" + r.name + i.name,
                c = s[a + l],
                u = "main" === r.name.toLowerCase().trim(),
                d = "color" + i.name,
                h = null;
              u &&
                ((c = s[d]), (r.color = i.record.color), (l = i.name), (h = d)),
                i.record.keyFrame && (r.keyFrame = i.record.keyFrame);
              var p = i._reuseOrCreateColorpicker({
                name: l,
                label: r.name,
                record: r,
                isMobilePhone: i.isMobilePhone,
                prefillColor: c || r.color,
                prefix: i.prefix,
                sidebarSide: "right",
                changeColorEventName: "graphicColorChange",
                colorPickerPopupTopOffset: 0,
                spectrumOptions: t,
                isExtraColor: !0,
                isMainColor: u,
                urlParameterName: h,
                skipDispatchChangeForPrefillColor: e,
              });
              if (((o = n.indexOf(p)), -1 !== o && n.splice(o, 1), !p.reused)) {
                i.appendChild(p), p.render(i.$colorControlsContainer);
                var f = function () {
                  return new Promise(function (e) {
                    var t = function (n) {
                      p.unbind("colorControlReady", t),
                        i._synchronizeMainColors(n),
                        e();
                    };
                    p.bind("colorControlReady", t);
                  });
                };
                i.colorSyncPromises.push(f()),
                  p.element.css({
                    opacity: 0,
                    "max-height": 0,
                  }),
                  p.element.hide();
              }
            }),
          n.forEach(function (e) {
            (e.beingDestroyed = !0),
              i.transitionQueue.push([
                function () {
                  e.element &&
                    e.element.animate(
                      {
                        opacity: 0,
                        "max-height": 0,
                      },
                      i.constructor.ANIMATION_DURATION,
                      e.destroy.bind(e)
                    );
                },
              ]);
          }),
          P.allSettled(this.colorSyncPromises)
        );
      },
      _reuseOrCreateColorpicker: function (e) {
        var t,
          n = this,
          i = n._getAllChildrenExactly(["ColorControl"]).filter(function (t) {
            return t.name === e.name && !t.beingDestroyed;
          })[0];
        return (
          i
            ? ((t = i.record.color),
              (i.record = e.record),
              (i.record.color = t),
              (i.reused = !0))
            : ((i = new UI.SmartTemplate.ColorControl(e)),
              n._bindPopupColorControlEvents(i)),
          n.transitionQueue.push([
            function () {
              i.element &&
                (i.element.show(),
                i.element.animate(
                  {
                    opacity: 1,
                    "max-height": n.constructor.COLOR_CONTROL_HEIGHT,
                  },
                  n.constructor.ANIMATION_DURATION
                ));
            },
          ]),
          i
        );
      },
      _bindings: function () {
        return (
          (this._popstateHandler = this._changeHistoryHandler.bind(this)),
          window.addEventListener("popstate", this._popstateHandler),
          this.$expandCollapseBtn.bind(
            "click",
            this._expandCollapseBtnClickHandler.bind(this)
          ),
          this.bindSkeleton(),
          this
        );
      },
      hasAssets: function () {
        return this.record.hasLayers;
      },
      _sendNoResultsSearchEvent: function (e, t) {
        (this._pendingNoResultsEvent = setTimeout(function () {
          Helpers.GlobalEventTracker.assetsSearchNoResults({
            searchTerm: t,
            controlName: e.record.name,
            templateID: Helpers.StageType.getRecordId(),
            userIp: window.userIp,
            fullUrl: window.location.href,
            stageTags: Helpers.StageType.getStageTags(),
          });
        }, 1500)),
          this._timeouts.push(this._pendingNoResultsEvent);
      },
      isBelowResponsiveBreakpoint: function () {
        var e = !1;
        return $(window).width() <= 1024 && (e = !0), e;
      },
      _fetchAndSetLayersForRecord: function (e, t) {
        this.fetchAndSetAssetLayers(e, this.defaultAssetColors).then(t);
      },
      _getAllChildrenExactly: function (e) {
        var t = this;
        return e && e.length
          ? t.children.filter(function (t) {
              return e.indexOf(t.constructor.className) >= 0;
            })
          : [];
      },
      _getAllChildrenExcept: function (e) {
        var t = this;
        return e && e.length
          ? t.children.filter(function (t) {
              return -1 === e.indexOf(t.constructor.className);
            })
          : t.children;
      },
      _changeHistoryHandler: function () {
        if (this.hasAssets() !== !1) {
          var e,
            t,
            n,
            i = null;
          (e = this),
            (t = Helpers.App.getAllURLParams()),
            (n = t[e.graphicUrlParameterName] || e.initialValues.assetId),
            (i = e.getPreviousSearchValue()),
            null !== i
              ? e.search.setValue(i)
              : e.getAsset(n).then(function (t) {
                  return t && void 0 !== t.id
                    ? void e.grid.selectItem(t, !0)
                    : "null" === n || void 0 === n
                    ? void e.grid.setNoImage({
                        triggeredByUser: !1,
                        triggeredByPopState: !0,
                      })
                    : (e.previousValues.assetId === e.customType &&
                        e.grid.resetCustomAsset(),
                      void (n && e._getCustomAssetData(n)));
                });
        }
      },
      _getCustomAssetData: function (e) {
        var t = this;
        return this.grid
          ? this.grid
              ._getCustomAssetData(e)
              .then(function (n) {
                t._assetJSONDataCallback(e, !0, n);
              })
              ["catch"](function (n) {
                if ("Cancelation Error" === n.message)
                  return void console.warn("Cancelation Error");
                t.dispatch("imageDataNotFound");
                var i = {
                  data: {
                    assetId: e,
                  },
                  message: n.statusText,
                  status: n.status,
                };
                t._errorHandler("Fetch asset error", i);
              })
          : void 0;
      },
      _assetJSONDataCallback: function (e, t, n) {
        return this.grid ? this.grid._assetJSONDataCallback(e, t, n) : void 0;
      },
      getAsset: function (e) {
        if (this.grid) {
          var t = this.grid.getAsset(e);
          return t ? Promise.resolve(t) : Asset.find(e);
        }
      },
      getPreviousSearchValue: function () {
        var e,
          t = "";
        if (!this.search) return null;
        var n = this.search.getValue().toLowerCase();
        return (
          (e = Helpers.App.getAllURLParams()),
          "string" == typeof e[this.searchUrlParameterName] &&
            (t = e[this.searchUrlParameterName].toLowerCase()),
          t === n || this.initialValues.search.toLowerCase() === n
            ? null
            : null === history.state
            ? this.initialValues.search
            : t
        );
      },
      updateUI: function () {
        this.executeTransitionQueue();
      },
      executeTransitionQueue: function () {
        for (var e; (e = this.transitionQueue.next()); ) e();
      },
      setUrlParameter: function (e) {
        return (
          Helpers.App.replaceUrlParamWithHistory(
            this.graphicUrlParameterName,
            e
          ),
          this
        );
      },
      resetUrlParameter: function () {
        return (
          Helpers.App.replaceUrlParamWithHistory(
            this.graphicUrlParameterName,
            ""
          ),
          this
        );
      },
      controlInView: function () {
        this.mobileSidebarAlreadyOpened === !1 &&
          null !== this.grid &&
          (this.renderAssets(),
          (this.grid.canBeRender = !0),
          (this.mobileSidebarAlreadyOpened = !0));
      },
      updatePrefix: function (e, t) {
        (t = t || !0),
          (this.prefix = e),
          (this.searchUrlParameterName = [
            this.prefix,
            "search",
            this.name,
          ].join("")),
          (this.graphicUrlParameterName = [
            this.prefix,
            this.urlParamName,
            this.name,
          ].join("")),
          t &&
            this._getAllChildrenExactly(["ColorControl"]).forEach(function (t) {
              t.updatePrefix(e);
            });
      },
      clearThumbs: function () {
        this.grid && this.grid.cancelRendering().clearThumbs();
      },
      focusSearchInput: function () {
        this.search && this.search.triggerFocus();
      },
      focus: function () {
        var e = this;
        e.element.addClass(e.constructor.FOCUS_ANIMATION_CLASS),
          setTimeout(function () {
            e.element.removeClass(e.constructor.FOCUS_ANIMATION_CLASS);
          }, e.constructor.FOCUS_ANIMATION_DURATION);
      },
      setAlgoliaData: function (e) {
        return (
          this._setObject(this._algoliaData.control, e),
          this._setObject(this._algoliaData.params, e),
          this
        );
      },
      getAlgoliaControl: function () {
        return this._algoliaData.control;
      },
      getAlgoliaParams: function () {
        return this._algoliaData.params;
      },
      setPreviousValues: function (e) {
        return this._setObject(this.previousValues, e), this;
      },
      setInitialValues: function (e) {
        return this._setObject(this.initialValues, e), this;
      },
      updateRecord: function (e) {
        if (void 0 !== e.asset) {
          var t = e.asset;
          return null !== t && null !== t.image
            ? ((t.visible = !0),
              (this.record.selectedLayer = t),
              (this.record.layers = [t]),
              this)
            : ((this.record.layers = []),
              (this.record.selectedLayer = t),
              this);
        }
        return this;
      },
      _setObject: function (e, t) {
        Object.keys(t).forEach(function (n) {
          void 0 !== e[n] && (e[n] = t[n]);
        });
      },
      scrollToActive: function () {
        var e;
        (e = this.$graphicBody.find(".multi_item.active")),
          e.length &&
            (this.$graphicBody.get(0).scrollTop = e.get(0).offsetTop - 10);
      },
      _cancelRenderThumbs: function () {
        return this.grid && this.grid.cancelRendering().clearThumbs(), this;
      },
      _getAssetsCallback: function (e) {
        this._updateAssets(e),
          0 === e.data.length &&
            this._sendNoResultsSearchEvent(this, e.searchTerm);
      },
      doSearch: function (e, t) {
        return (
          t === !0 &&
            Helpers.App.replaceUrlParamWithHistory(
              this.searchUrlParameterName,
              e
            ),
          (this.record.preconfiguredSearch = e),
          this.setPreviousValues({
            search: e,
          }),
          this.grid.showLoader().cancelRendering().clearThumbs(),
          this.grid.hideMoreFader(),
          this.getAssets(
            {
              search: e,
              page: 0,
            },
            t
          )
            .then(this._getAssetsCallback.bind(this))
            ["catch"](this._getAssetsFailCallback.bind(this))
        );
      },
      setAssets: function (e) {
        return (
          this.grid.set({
            page: e.page,
            perPage: e.perPage,
            totalPages: e.totalPages,
            search: e.searchTerm,
            assets: e.data,
            selected: e.selectedLayer,
          }),
          this
        );
      },
      renderAssets: function () {
        return this.grid
          ? this.grid.renderAssets()
          : Promise.resolve("no assets to be rendered");
      },
      _updateAssets: function (e) {
        return this.setAssets(e).renderAssets();
      },
      getAssets: function (e, t) {
        return e && this.setAlgoliaData(e), this._fetchAssets(t);
      },
      _fetchAssets: function (e) {
        var t,
          n,
          i,
          r = null;
        (t = this._buildQueryToFetchAssets()),
          (n = t.search),
          (i = t.query),
          (r = t.selectedId);
        var s = null,
          o = null;
        try {
          var a = !!e;
          (s = {
            control: this.constructor.className,
            controlName: this.record.name,
            triggeredByUser: a,
          }),
            (o = {
              control: this.constructor.className,
              controlName: this.record.name,
              triggeredByUser: a,
            });
        } catch (l) {
          console.warn(l);
        }
        var c = [Asset.find(r, s)];
        i.filter.values &&
          i.filter.values.length > 0 &&
          c.push(Asset.search(n, i, o));
        var u = function (e) {
          try {
            var t, i, r;
            if (((i = e[0]), (r = e[1]), r && "rejected" === r.status))
              throw new Error(r.reason);
            return (
              (t = void 0 === r ? Asset.buildAssetsResponse({}) : r.value),
              (t.searchTerm = n),
              (t.selectedLayer = null),
              "fulfilled" === i.status && (t.selectedLayer = i.value),
              t
            );
          } catch (s) {
            throw new Error(s);
          }
        };
        return P.allSettled(c).then(u.bind(this));
      },
      _buildQueryToFetchAssets: function () {
        var e,
          t = [],
          n = [],
          i = {};
        return (
          (i = this.getAlgoliaParams()),
          (e = this.getAlgoliaControl().selectedLayerId),
          (e = "null" === e ? null : e),
          Array.isArray(this.record.groupTags) === !0 &&
            (n = this.record.groupTags),
          e &&
            t.push({
              property: "id",
              value: e,
            }),
          {
            search: i.search,
            selectedId: e,
            query: {
              page: i.page,
              perPage: i.perPage,
              filter: {
                property: "tags",
                values: n,
              },
              exclusions: t,
            },
          }
        );
      },
      _getAssetsFailCallback: function (e) {
        return "Cancelation Error" === e.message
          ? void console.warn(e)
          : void this._errorHandler("Get assets error", e);
      },
      setTitle: function (e) {
        (this.title = e), this.$title.text(this.title || this.record.name);
      },
      _errorHandler: function (e, t) {
        var n = JSON.stringify({
          message: t.message,
          name: t.name,
          statusCode: t.statusCode,
          data: t.data,
        });
        setTimeout(function () {
          throw new Error(e + ": " + n);
        }, 10);
      },
      hideMobileModalHandler: function () {
        this._hideModalMobileHandler();
      },
      destroy: function () {
        this.clearTimeouts(),
          this._cancelAutoCollapse(),
          this._removeEventListeners(),
          this.clearPopstateEventHandler(),
          this.cancelFetchAssetsTask(),
          this.cancelGetCustomAssetDataTask(),
          this.cancelRenderThumbTask(),
          this.genericDestroy(),
          (this._cancelRenderThumbs = function () {}),
          (this._assetJSONDataCallback = function () {}),
          (this._getInitialAssetsCallback = function () {}),
          (this._getAssetsCallback = function () {}),
          (this._fetchAndSetLayersForRecordCallback = function () {}),
          (this._getAssetsFailCallback = function () {});
      },
      getColorControls: function () {
        return this._getAllChildrenExactly(["ColorControl"]);
      },
      hideInStage: function () {
        if (
          this.hasAssets() !== !1 &&
          null !== this.grid.blankItem &&
          void 0 !== this.grid.blankItem &&
          (this.grid._selectThumb(
            this.grid.blankItem,
            {
              triggeredByUser: !0,
            },
            "hideInStage"
          ),
          this._wasWarningShown !== !0 && !this.hideWarning)
        ) {
          var e = new HideElementPopoverWarning({
            target: this.element.find(".graphic-header"),
            template:
              '<div class="popover hide-element-warning" role="tooltip"><div class="close-icon"></div><div class="popover-content"></div></div>',
            text: "You can add a new image from the gallery",
            placement: "bottom",
            cssClass: "",
          });
          setTimeout(function () {
            e.render($("body"));
          }, 1e3),
            (this._wasWarningShown = !0);
        }
      },
      render: function (e, t) {
        return (
          this.shouldRenderCompoundButton() === !0
            ? this.compoundButton.render(e, t)
            : Widget.prototype.render.call(this, e, t),
          this
        );
      },
      _getInitialAssets: function () {
        var e = this._buildQueryToFetchAssets(),
          t = {
            search: e.search,
          },
          n = this.prefix + this.name,
          i = AssetsCached.getAssets(this.type, n, t);
        if (null === i || "undefined" == typeof i)
          return this.getAssets(null, !1);
        var r = this.getAlgoliaControl().selectedLayerId,
          s = i.selectedLayer && i.selectedLayer.id;
        return r !== s ? this.getAssets(null, !1) : Promise.resolve(i);
      },
      _hackPreventChangeEventRacing: function () {
        var e = this;
        if ("graphic" === this.type || "background" === this.type)
          if (this.record.allowColorpicker === !1 && this.hasAssets() === !1)
            setTimeout(function () {
              e.dispatch("multiControlReady");
            }, 0);
          else {
            var t = function (e) {
              e.stopPropagation();
            };
            e.bind("change", t);
            var n = function () {
              e.unbind("multiControlReady", n), e.unbind("change", t);
            };
            e.bind("multiControlReady", n);
          }
      },
      stopRendering: function () {
        return this.grid && this.grid.stopRendering(), this;
      },
      resumeRendering: function () {
        return this.grid && this.grid.resumeRendering(), this;
      },
      cancelRendering: function () {
        return this.grid && this.grid.cancelRendering(), this;
      },
      cancelGetCustomAssetDataTask: function () {
        this.grid && this.grid.cancelGetCustomAssetDataTask();
      },
      isValidId: function (e) {
        return "string" == typeof e && e.length > 0 && "null" !== e ? !0 : !1;
      },
      afterReady: function () {
        var e = {
          originalDispatcher: this,
          triggeredByUser: !1,
          triggeredByPopState: !0,
        };
        this.dispatch("render", e),
          this.updateUI(),
          this.dispatch("endRender"),
          this.dispatch("multiControlReady"),
          "background" === this.type && this.dispatch("backgroundReady");
      },
      cancelRenderThumbTask: function () {
        null !== this.renderThumbTask &&
          (this.renderThumbTask.cancel(), (this.renderThumbTask = null));
      },
    },
  }),
  Class(UI.SmartTemplate, "RepositionAssetButton")
    .inherits(Widget)
    .includes(BubblingSupport)({
    html: '<button aria-label="Reposition asset"></button>',
    elementClass: "reposition-asset-button button",
    supportedStrategies: ["image", "video"],
    popoverContent: {
      image: "Crop",
      video: "Trim / Crop",
    },
    buttonIcon: {
      image:
        '        <svg viewBox="0 0 12 12">            <path d="M11.218 8.388h-1.52V3.562l1.553-1.511c.243-.236.306-.558.141-.719l-.409-.397c-.165-.16-.495-.1-.738.137l-1.6 1.557H3.836V.969C3.836.71 3.62.5 3.353.5h-.506a.476.476 0 0 0-.483.47v1.659h-1.22c-.246 0-.444.21-.444.47v.493c0 .26.198.47.443.47h1.221v5.3c0 .228.216.412.483.412H8.226v1.288c0 .242.216.438.483.438h.506c.267 0 .483-.196.483-.438V9.774h1.52c.266 0 .482-.184.482-.412v-.563c0-.226-.216-.411-.482-.411zM7.173 4.062L3.836 7.309V4.062h3.337zM4.741 8.388l3.485-3.393v3.393H4.74z"/>        </svg>',
      video:
        '        <svg viewBox="0 0 17 17">          <path d="M12.31 11.528a2.73 2.73 0 0 0-.485.366l-1.752-3.017L5.124.364l-.05-.087-.086.05.05.087-.05-.087h-.001V.33h-.005l-.016.01a2.688 2.688 0 0 0-.259.19c-.16.132-.363.329-.531.586-.17.258-.306.578-.33.955-.022.378.068.806.342 1.277L7.182 8.5l.893 1.537 3.18 5.472a2.913 2.913 0 1 0 5.04-2.928 2.916 2.916 0 0 0-3.985-1.054zm2.12 3.649a1.306 1.306 0 1 1-1.313-2.26h.001a1.306 1.306 0 1 1 1.313 2.26z"/>          <path d="M5.175 11.893a2.733 2.733 0 0 0-.486-.366 2.914 2.914 0 0 0-2.927 5.038 2.914 2.914 0 0 0 3.982-1.055l3.13-5.396.03-.05-.03-.05-1.219-2.1-.087-.15-.086.15-2.307 3.979zm-1.294 1.024a1.305 1.305 0 1 1-1.312 2.26 1.307 1.307 0 0 1 1.312-2.26zm8.931-9.57c.274-.471.365-.899.341-1.277a1.952 1.952 0 0 0-.329-.955 2.694 2.694 0 0 0-.79-.775l-.016-.01-.005-.003-.001-.001-.05.086.05-.086-.087-.05-.05.086-3.798 6.543-.03.05.03.05 1.22 2.1.087.15.086-.15c.902-1.551 1.576-2.713 2.149-3.701l1.193-2.057z"/>        </svg>',
    },
    create: function (e) {
      if (
        (Helpers.GlobalEventTracker.deprecatedMethod({
          module: "RepositionAssetButton::create",
          file: "reposition_asset_button.js",
        }),
        this.supportedStrategies.includes(e.type) === !1)
      )
        return console.warn(
          "RepositionAssetButton strategy not supported: " + e.type
        );
      var t = this.capitalizeFirstLetter(e.type);
      return new window.UI.SmartTemplate["RepositionAssetButton" + t](e);
    },
    capitalizeFirstLetter: function (e) {
      return (
        Helpers.GlobalEventTracker.deprecatedMethod({
          module: "RepositionAssetButton::capitalizeFirstLetter",
          file: "reposition_asset_button.js",
        }),
        e.charAt(0).toUpperCase() + e.slice(1)
      );
    },
    prototype: {
      isCustomUpload: !1,
      type: null,
      init: function (e) {
        Widget.prototype.init.call(this, e),
          this.element.addClass("type-" + this.type),
          this.element.addClass(
            this.isCustomUpload ? "custom-asset" : "library-asset"
          ),
          this.element[0].insertAdjacentHTML(
            "afterbegin",
            this.constructor.buttonIcon[this.type]
          ),
          this._initPopover(),
          this._bindEvents();
      },
      _bindEvents: function () {
        return (
          (this._clickHandler = this._clickHandler.bind(this)),
          this.element.on("click", this._clickHandler),
          this
        );
      },
      _clickHandler: function () {
        this.dispatch("click");
      },
      destroy: function () {
        this.element.off("click", this._clickHandler),
          Widget.prototype.destroy.call(this);
      },
      _initPopover: function () {
        var e = this,
          t = Helpers.App.isMobileDevice();
        e.element
          .popover({
            content: e.constructor.popoverContent[e.type],
            container: t ? e.element : "body",
            trigger: "manual",
            placement: "top",
          })
          .data("bs.popover")
          .tip()
          .addClass("reposition-popover reposition-popover-" + e.type),
          t ||
            e.element
              .bind("mouseenter", function () {
                e.element.popover("show");
              })
              .bind("mouseleave", function () {
                e.element.popover("hide");
              });
      },
      showPopover: function () {
        Helpers.App.isMobileDevice() &&
          (Helpers.App.getRepositionButtonPopoverCookie(this.type) ||
            (this.element.popover("show"),
            Helpers.App.setRepositionButtonPopoverCookie(this.type)));
      },
      hidePopover: function () {
        this.element.popover("hide");
      },
    },
  }),
  Class(UI.SmartTemplate, "RepositionAssetButtonImage").inherits(
    UI.SmartTemplate.RepositionAssetButton
  )({
    _html:
      '        <svg viewBox="0 0 12 12">            <path d="M11.218 8.388h-1.52V3.562l1.553-1.511c.243-.236.306-.558.141-.719l-.409-.397c-.165-.16-.495-.1-.738.137l-1.6 1.557H3.836V.969C3.836.71 3.62.5 3.353.5h-.506a.476.476 0 0 0-.483.47v1.659h-1.22c-.246 0-.444.21-.444.47v.493c0 .26.198.47.443.47h1.221v5.3c0 .228.216.412.483.412H8.226v1.288c0 .242.216.438.483.438h.506c.267 0 .483-.196.483-.438V9.774h1.52c.266 0 .482-.184.482-.412v-.563c0-.226-.216-.411-.482-.411zM7.173 4.062L3.836 7.309V4.062h3.337zM4.741 8.388l3.485-3.393v3.393H4.74z"/>        </svg>    ',
    prototype: {
      init: function (e) {
        var t = null;
        try {
          throw new Error("Get stack trace");
        } catch (n) {
          t = n.stack || "No stack trace";
        }
        Helpers.GlobalEventTracker.deprecatedClass({
          module: "UI.SmartTemplate.RepositionAssetButtonImage",
          file: "reposition_asset_button_image.js",
          stackTrace: t,
        }),
          UI.SmartTemplate.RepositionAssetButton.prototype.init.call(this, e),
          this.element[0].insertAdjacentHTML(
            "afterbegin",
            this.constructor._html
          );
      },
      _canBeActivated: function () {
        var e = this.item;
        return this.isCustomUpload && e.userImagePath
          ? !0
          : !this.isCustomUpload && e.record.path
          ? !0
          : !1;
      },
      _clickHandler: function () {
        this.dispatch("click");
      },
    },
  }),
  Class(UI, "ListContainer")
    .inherits(Widget)
    .includes(
      BubblingSupport,
      GenericDestroySupport,
      SkeletonCardSupport
    )({
    prototype: {
      name: null,
      init: function (e) {
        Widget.prototype.init.call(this, e),
          this._imagesLoaded().then(this._setContentReady.bind(this));
      },
      _setContentReady: function () {
        var e = this;
        e.dispatch("contentReady", {
          originalDispatcher: e,
        });
      },
      getItemByName: function (e) {
        return this[e];
      },
      getItems: function () {
        return this.children;
      },
      getVisibleItems: function (e) {
        var t, n, i, r, s, o;
        return (
          (s = this.children),
          e && (s = s.filter(e)),
          (o = s
            .map(function (e) {
              var t = e.element.visibleInScroll();
              return t.isVisible && "left" !== t.partlyHiddenSide;
            })
            .indexOf(!0)),
          (t = o),
          (n = this._calculateSlides()),
          (i = Math.min(t + n, this.children.length)),
          (r = i % n),
          0 !== r && (t = Math.max(0, i - n)),
          s.length > n && i > s.length && (t -= i - s.length),
          s.slice(t, i)
        );
      },
      isInsideViewport: function () {
        var e, t, n, i;
        return (
          (e = this.element.offset().top),
          (t = e + this.element.outerHeight()),
          (n = $(window).scrollTop()),
          (i = n + $(window).height()),
          t > n && i > e
        );
      },
      destroy: function () {
        this.genericDestroy();
      },
      _calculateSlides: function () {
        var e = Math.max(
            document.documentElement.clientWidth || 0,
            window.innerWidth || 0
          ),
          t = $(this.items[0]).outerWidth();
        return Math.ceil(e / t);
      },
      getElement: function () {
        return this.element;
      },
      _imagesLoaded: function () {
        var e = this.element.find("img.thumb-image"),
          t = [];
        return (
          e.each(function (e, n) {
            var i = new Image();
            t.push(
              new Promise(function (e, t) {
                i.addEventListener("load", e, !1),
                  i.addEventListener("error", t, !1);
              })
            ),
              (i.src = n.getAttribute("data-src"));
          }),
          P.allSettled(t).then(function () {
            e.each(function (e, t) {
              t.src = t.getAttribute("data-src");
            });
          })
        );
      },
    },
  }),
  Class(UI.SmartTemplate, "SavedConfigurations")
    .inherits(Widget)
    .includes(BubblingSupport)({
    prototype: {
      init: function (e) {
        Widget.prototype.init.call(this, e);
        var t = this;
        (t.items = this.element.find(".carousel-item")),
          t.appendChild(
            new UI.ListContainer({
              name: "listContainer",
              element: e.element,
              items: t.items,
            })
          ),
          t.items.each(function (e, n) {
            t._bindItemTrackingEvent(n),
              t.listContainer
                .appendChild(
                  new UI.PreviewThumbnail({
                    name: "thumbnail" + e,
                    element: $(this),
                    useOffsetInHelpText: !0,
                  })
                )
                .bind("preview.shown", function () {
                  t.hidePreviews(this);
                });
          }),
          t._initBookmarks(),
          UI.Navigation.NavBar.bind("user:login", t._handleUserLogin.bind(t)),
          UI.SmartTemplate.SavedConfigurations.bind(
            "user:logout",
            t._handleUserLogout.bind(t)
          );
      },
      hidePreviews: function (e) {
        this._getThumbnailsItems().forEach(function (t) {
          (e && t.name === e.name) || t.hidePreview();
        });
      },
      _handleUserLogin: function () {
        var e = this,
          t = e._getBookmarkContainers();
        $.get(
          "/api/v2/bookmarked_stages_from_user?user_id=" +
            Helpers.App.getUser().id
        )
          .done(function (e) {
            t.forEach(function (t) {
              var n = t.bookmark;
              n &&
                (-1 != e.bookmarkedStages.indexOf(parseInt(n.stageId))
                  ? n.afterLogin(!0)
                  : n.bookmarkAfterLogin
                  ? n.setBookmarked(!0)
                  : n.afterLogin(!1));
            });
          })
          .fail(function () {});
      },
      _handleUserLogout: function () {
        var e = this,
          t = e._getBookmarkContainers();
        t.forEach(function (e) {
          e.bookmark && e.bookmark.afterLogout();
        });
      },
      loadAssets: function () {
        var e = null;
        try {
          throw new Error("Get stack trace");
        } catch (t) {
          e = t.stack || "No stack trace";
        }
        Helpers.GlobalEventTracker.deprecatedMethod({
          module: "UI.SmartTemplate.SavedConfiguration",
          file: "saved_configuration.js",
          stackTrace: e,
        });
      },
      _bindItemTrackingEvent: function (e) {
        var t = $(e).find("a"),
          n = t.attr("href");
        t.click(function () {
          Helpers.GlobalEventTracker.carouselClick(
            "savedconfiguration",
            Helpers.App.getSlugFromStageURL(n)
          );
        });
      },
      _initBookmarks: function () {
        var e = this;
        e.items.each(function (t, n) {
          var i = new Widget({
            element: $(n),
            name: "savedConfig_" + t,
          });
          e.listContainer.appendChild(i),
            i.appendChild(
              new UI.Bookmark({
                name: "bookmark",
                element: $(n),
              })
            );
        });
      },
      _getBookmarkContainers: function () {
        return this.listContainer.getItems().filter(function (e) {
          return 0 === e.name.indexOf("savedConfig");
        });
      },
      _getThumbnailsItems: function () {
        return this.listContainer.getItems().filter(function (e) {
          return 0 === e.name.indexOf("thumbnail");
        });
      },
    },
  }),
  Class(UI.SmartTemplate, "SideBar")
    .inherits(Widget)
    .includes(
      BubblingSupport,
      GenericDestroySupport
    )({
    html: "<aside></aside>",
    elementClass: "smart-templates__sidebar",
    textControlGroup: !1,
    prototype: {
      init: function (e) {
        var t = this;
        Widget.prototype.init.call(this, e),
          e.isMobilePhone &&
            (t
              .appendChild(
                new UI.SmartTemplate.Mobile.GoBackButton({
                  name: "goBackButton",
                  sidebar: t,
                })
              )
              .render(t.element),
            t.element.addClass("mobile")),
          t.bind("expand.control", function (e) {
            t.children.forEach(function (n) {
              "GoBackButton" !== n.constructor.className &&
                n !== e.data.target &&
                t._collapseControl(n);
            });
          }),
          t.bind("collapse.control", function (e) {
            t.children.forEach(function (n) {
              "GoBackButton" !== n.constructor.className &&
                n !== e.data.target &&
                t._expandControl(n);
            });
          });
      },
      activate: function () {
        Widget.prototype.activate.call(this),
          Helpers.App.isMobile() &&
            (document.documentElement.classList.add("modal-is-open"),
            document.body.classList.remove("iosBugFixCaret")),
          this.isMobilePhone &&
            this.children.forEach(function (e) {
              e.controlInView && e.controlInView();
            });
      },
      deactivate: function () {
        if (Helpers.App.isMobile()) {
          document.documentElement.classList.remove("modal-is-open");
          var e = navigator.userAgent,
            t = /iPad|iPhone|iPod/.test(e),
            n = /OS 11_0|OS 11_1|OS 11_2/.test(e);
          t && n && document.body.classList.add("iosBugFixCaret");
        }
        Widget.prototype.deactivate.call(this);
      },
      _collapseControl: function (e) {
        var t = e.element;
        t.addClass("canAnimate"),
          (t[0].oldStyle = t[0].style.cssText),
          (t[0].oldHeight = t.height()),
          (t[0].style.flex = "0 0 " + t[0].oldHeight + "px"),
          window.requestAnimationFrame(function () {
            window.requestAnimationFrame(function () {
              t.addClass("collapsed"), (t[0].style.cssText = t[0].oldStyle);
            });
          });
      },
      _expandControl: function (e) {
        var t = e.element;
        t.removeClass("collapsed"),
          (t[0].style.flex = "0 0 " + t[0].oldHeight + "px"),
          setTimeout(function () {
            (t[0].style.cssText = t[0].oldStyle), t.removeClass("canAnimate");
          }, 300);
      },
      destroy: function () {
        this.genericDestroy();
      },
      append: function (e) {
        this.element.append(e);
      },
      getTextControlGroup: function () {
        return this.textControlGroup;
      },
    },
  }),
  Class(UI.SmartTemplate, "TextControl")
    .inherits(Widget)
    .includes(
      BubblingSupport,
      GenericDestroySupport,
      ColorPalettesSupport,
      StageControlsDestroySupport,
      CDNSupport,
      SkeletonCardSupport
    )({
    html: '        <div>            <div class="form-group">              <div class="input-group">                <div class="input-group-addon"><label><input class="checkbox" type="checkbox"/><span class="eye-open"></span><span class="eye-closed"></span></label></div>                <div class="input-container"><input type="text" class="textbox form-control"></div>              </div>            </div>            <div class="font-container"><img><div class="caret"></div></div>            <select class="select hidden" data-height="29px"></select>        </div>',
    elementClass: "text-control form-group",
    TEXTCHANGE_EVENT_DEBOUNCE_DURATION: 1800,
    FOCUS_ANIMATION_DURATION: 500,
    FOCUS_ANIMATION_CLASS: "wobble-vertical",
    prototype: {
      initialValues: {},
      _debounceTime: 1e3,
      _popstateHandler: null,
      _timeouts: [],
      _colorControl: null,
      _tabbedColorPicker: null,
      newLineRegex: /\n/g,
      init: function (e) {
        var t,
          n = this;
        if (
          (Widget.prototype.init.call(this, e),
          (n._timeouts = []),
          this.defaultDebounceTime &&
            (this._debounceTime = this.defaultDebounceTime),
          (n.initialValues = {
            text: n.record.contents,
            checkbox: n.record.visible,
            color: n.record.color,
            font: n.record.font,
          }),
          (this.prefix = e.prefix || ""),
          (this.textUrlParameterName = this.prefix + "text" + this.name),
          (this.fontUrlParameterName = this.prefix + "font" + this.name),
          (this.fontSizeUrlParameterName =
            this.prefix + this.name + "_fontSize"),
          (this.chkUrlParameterName = this.prefix + "checkbox" + this.name),
          (this.stageType = e.stageType || "image"),
          (this.$formgroup = this.element.find(".form-group")),
          (this.$checkbox = this.element.find(".checkbox")),
          (this.$inputContainer = this.element.find(".input-container")),
          (this.$fontContainer = this.element.find(".font-container")),
          (this.$imgContainer = this.$fontContainer.find("img")),
          this.record.allowMultiline)
        ) {
          var i = this.element.find(".input-container"),
            r = document.createElement("textarea");
          i.find(".textbox").detach(),
            (r.className = "textbox form-control"),
            (r.maxLength = this.record.maxCharacters),
            (r.rows = 2),
            r.setAttribute("maxLines", this.record.maxLines),
            (r.wrap = "hard"),
            (r.style = "resize:none;"),
            i.append(r),
            (this.$textbox = i.find(".textbox")),
            this.$textbox.keypress(function (e) {
              13 === e.keyCode &&
                n.isMaxLinesInvalid() === !0 &&
                e.preventDefault();
            });
        } else this.$textbox = this.element.find(".textbox");
        (this.$select = this.element.find(".select")),
          (this.isMobilePhone = e.isMobilePhone),
          this.$select.addClass("font-list"),
          (this.previousValues = {
            checkbox: this.record.visible,
            textbox: this.record.contents,
            select: this.record.font,
          });
        var s = (void 0 === this.record.visible && !0) || this.record.visible;
        e.prefillCheckbox
          ? (s = JSON.parse(e.prefillCheckbox))
          : "string" == typeof e.prefillText &&
            e.prefillText.trim() &&
            (s = !0);
        var o =
          "string" == typeof e.prefillText
            ? e.prefillText
            : this.record.contents;
        this.$checkbox.prop("checked", s),
          (this.record.visible = s),
          this.$textbox.val(o),
          this.record.sizes &&
            this.record.sizes.length > 1 &&
            (this.record.sizes.length > 5 &&
              this.record.sizes.splice(5, this.record.sizes.length - 5),
            this.appendChild(
              new UI.SmartTemplate.FontSize({
                name: "fontSize",
                record: this.record.sizes,
                isMobilePhone: e.isMobilePhone,
                prefillSize: e.prefillSize,
              })
            )),
          "undefined" == typeof e.record.isTabbedColorpicker
            ? ((this._colorControl = new UI.SmartTemplate.ColorControl({
                name: "color" + n.name,
                record: n.record,
                prefix: n.prefix,
                isMobilePhone: n.isMobilePhone,
                prefillColor: e.prefillColor || e.record.color || "#F1F1F1",
                sidebarSide: "left",
                changeColorEventName: "textColorChange",
                colorPickerPopupTopOffset: 0,
                spectrumOptions: {
                  containerClassName: e.isMobilePhone
                    ? "colorpicker-container-mobile"
                    : "colorpicker-container-text-control",
                  replacerClassName: e.isMobilePhone
                    ? "colorpicker-replacer-mobile"
                    : "colorpicker-replacer",
                  showSelectionPalette: !0,
                },
              })),
              n.appendChild(this._colorControl).render(n.element))
            : ((t = {
                name: "color" + n.name,
                nameBg: "bgColor" + n.name,
                namePadding: "bgPaddingFraction" + n.name,
                nameOpacity: "bgOpacity" + n.name,
                record: n.record,
                prefix: n.prefix,
                isMobilePhone: n.isMobilePhone,
                prefillColor: e.prefillColor || e.record.color || "#F1F1F1",
                sidebarSide: "left",
                changeColorEventName: "addedTextColorChange",
                colorPickerPopupTopOffset: 0,
                tabs: e.tabs || null,
                colorPickerPreview: e.colorPickerPreview || null,
                type: "text",
                spectrumOptions: {
                  containerClassName: e.isMobilePhone
                    ? "colorpicker-container-mobile"
                    : "colorpicker-container-text-control",
                  replacerClassName: e.isMobilePhone
                    ? "colorpicker-replacer-mobile"
                    : "colorpicker-replacer",
                  showSelectionPalette: !0,
                },
              }),
              (this._tabbedColorPicker = new UI.SmartTemplate.TabbedColorPicker(
                t
              )),
              n.appendChild(this._tabbedColorPicker).render(n.element)),
          this.record.excludable === !1 &&
            (this.element.find(".input-group-addon").remove(),
            this.element.find(".input-group").removeClass("input-group")),
          this.$textbox.attr("maxLength", this.record.maxCharacters);
        this.record.allowedFonts.sort(function (e, t) {
          var n, i;
          return (
            (n = e.name.toLowerCase()),
            (i = t.name.toLowerCase()),
            n > i ? 1 : i > n ? -1 : 0
          );
        });
        this.$select.val(e.prefillFont || this.record.font),
          this.$textbox.bind("focus", function () {
            n.previousValues.textbox = n.$textbox.val();
          }),
          n.$textbox.on("keyup blur", function () {
            n.$textbox.val().length >= parseInt(n.$textbox.attr("maxLength")) &&
              (n.$formgroup.addClass("has-error"),
              n._timeouts.push(
                setTimeout(function () {
                  n.$formgroup.removeClass("has-error");
                }, 1e3)
              ));
          }),
          n.$textbox.on("input", function (e) {
            var t = n.$textbox.val(),
              i = n.record.maxCharacters,
              r = !0;
            if (n.record.allowMultiline && n.isMaxLinesInvalid() === !0) {
              e.preventDefault();
              var s = "\n";
              n.$textbox.val().indexOf("\r") > -1 && (s = "\r");
              var o = t.split(s),
                a = parseInt(n.$textbox.attr("maxlines"));
              "number" == typeof a && (o = o.splice(0, a)),
                (t = o.join(s)),
                n.$textbox.val(t),
                (r = !1);
            }
            return t.length >= i
              ? (n.$textbox.val(t.substring(0, i)), e.preventDefault(), !1)
              : r
              ? void 0
              : !1;
          }),
          this.$textbox.bind(
            "focus",
            function () {
              this.dispatch("focus", this.record.name);
            }.bind(this)
          ),
          this.$textbox.bind(
            "blur",
            function () {
              this.dispatch("blur");
            }.bind(this)
          ),
          "image" === this.stageType
            ? this._imageTextBoxChangeHandler()
            : this._videoTextBoxChangeHandler(),
          this._timeouts.push(
            setTimeout(function () {
              var t = n.$checkbox.prop("checked");
              e.prefillFont &&
                n.$select.trigger("change", {
                  triggeredByPopState: !0,
                }),
                "string" == typeof e.prefillText &&
                  ((n._debounceTime = 0),
                  n.$textbox.trigger("input", {
                    triggeredByPopState: !0,
                  })),
                e.prefillCheckbox &&
                  (n.$checkbox.prop("checked", t),
                  n.$checkbox.trigger("change", {
                    triggeredByPopState: !0,
                  }));
            }, 0)
          ),
          e.isMobilePhone && this.$select.attr("data-width", "79%"),
          (n._popstateHandler = function () {
            var e = Helpers.App.getAllURLParams(),
              t = n.record.visible,
              i =
                "string" == typeof e[n.textUrlParameterName]
                  ? e[n.textUrlParameterName]
                  : n.initialValues.text,
              r = n.$textbox.val();
            return (
              (t = e[n.chkUrlParameterName]
                ? JSON.parse(e[n.chkUrlParameterName])
                : !0),
              n._updateFontPickerSelection(
                e[n.fontUrlParameterName] || n.initialValues.font
              ),
              n.$checkbox.prop("checked") !== t
                ? (n.$checkbox.prop("checked", t),
                  void n.$checkbox.trigger("change", {
                    triggeredByPopState: !0,
                  }))
                : (n.$textbox.val(i),
                  void (
                    n.$textbox.val() !== r &&
                    n.$textbox.trigger("change", {
                      triggeredByPopState: !0,
                    })
                  ))
            );
          }),
          window.addEventListener("popstate", n._popstateHandler),
          n._updateCharacterCount(),
          n._useFontIfPresentOnUrl(),
          this.bindSkeleton();
      },
      setSwappableFont: function (e) {
        this._swappableFont ||
          ((this._swappableFont = {}),
          this.record.allowedFonts.push(this._swappableFont)),
          (this._swappableFont.displayName = e.displayName),
          (this._swappableFont.file = e.file),
          (this._swappableFont.image = e.image),
          (this._swappableFont.name = e.name),
          (this._swappableFont.visible = e.visible),
          (this._swappableFont.isPremium = e.isPremium);
      },
      setFont: function (e, t, n) {
        var i = this,
          r = e.name,
          s = this.record.allowedFonts.filter(function (t) {
            return t.name === e.name;
          });
        i.previousValues.select !== r &&
          (s.length || this.setSwappableFont(e),
          (i.record.font = r),
          i.record.visible
            ? i.dispatch("change", {
                triggeredByPopState: n,
                triggeredByUser: t,
                originalDispatcher: i,
                changedProperty: "font",
              })
            : i.dispatch("notVisible"),
          Helpers.GlobalEventTracker.smartTemplateEvent("textFontChange", {
            previous: i.previousValues.select,
            new: r,
            name: i.name,
          }),
          (i.previousValues.select = r),
          i.dispatch("hideModal", {
            originalDispatcher: i,
          }));
      },
      _findInAllFontsData: function (e) {
        var t = this.allFonts.filter(function (t) {
          return t.name === e;
        });
        return t;
      },
      _updateFontPickerSelection: function (e) {
        var t,
          n,
          i = this.fontPicker.getFontInstances(e);
        this.fontPicker.deselectFontItems(),
          0 !== i.length
            ? (n = i[0].fontData.originalData)
            : ((t = this.fontListManager.findInList("all", e)),
              null !== t &&
                ((n = t.originalData),
                this.fontPicker.addRecentFont(t),
                (i = this.fontPicker.getFontInstances(e)))),
          i.forEach(function (e) {
            e.element.addClass("active");
          }),
          this.setFont(n, void 0, !0),
          this._setFontImage(i[0].fontData.image),
          this.fontPicker.setActiveFont(n);
      },
      _videoTextBoxChangeHandler: function () {
        var e,
          t = this;
        this.$textbox.bind("input change", function (n, i) {
          var r = Helpers.App.getAllURLParams(),
            s = r ? r[t.chkUrlParameterName] : void 0,
            o = void 0 !== s ? JSON.parse(s) : !0;
          return (
            t._updateCharacterCount(),
            t.$checkbox.prop("checked", "" !== t.$textbox.val().trim()),
            (t.record.visible = t._getRecordVisibility()),
            ((i && !i.triggeredByPopState) ||
              t.$checkbox.prop("checked") !== o) &&
              t.$checkbox.prop(
                "checked",
                void 0 !== s ? JSON.parse(s) : t.record.visible
              ),
            (t.previousValues.checkbox = t.record.visible),
            t.previousValues.textbox == t.$textbox.val()
              ? void n.stopImmediatePropagation()
              : (t.$checkbox.prop("checked", "" !== t.$textbox.val().trim()),
                void (
                  "input" == n.type &&
                  (clearTimeout(e),
                  (e = setTimeout(function () {
                    if (
                      ((t.record.contents = t._cleanUpText(t.$textbox.val())),
                      t.record.visible)
                    )
                      t.previousValues.textbox !== t.$textbox.val() &&
                        (i && i.triggeredByPopState
                          ? t.dispatch("change", i)
                          : t.dispatch("change", {
                              triggeredByUser: !0,
                              originalDispatcher: t,
                            }));
                    else if (i && i.triggeredByPopState)
                      t.dispatch("change", i);
                    else {
                      var e = {
                        allowed: !0,
                      };
                      (e.triggeredByUser = !0),
                        (e.originalDispatcher = t),
                        t.dispatch("change", e);
                    }
                    n.originalEvent &&
                      Helpers.App.replaceUrlParamWithHistory(
                        t.textUrlParameterName,
                        t.$textbox.val(),
                        !0
                      ),
                      Helpers.GlobalEventTracker.smartTemplateEvent(
                        "textChange",
                        Object.assign(
                          {
                            previous: t.previousValues.textbox,
                            new: t.record.contents,
                            name: t.name,
                          },
                          Helpers.App.getProductShownData()
                        )
                      ),
                      (t.previousValues.textbox = t.record.contents),
                      (t._debounceTime = t.defaultDebounceTime
                        ? t.defaultDebounceTime
                        : 1e3);
                  }, t._debounceTime)))
                ))
          );
        }),
          this.$textbox.on("focus blur", function () {
            t.$inputContainer.toggleClass("is-focused");
          }),
          this.element.bind("change", function (e, n) {
            var i = e.target.nodeName,
              r = !1,
              s = n && n.triggeredByPopState,
              o = n && n.triggeredByUser;
            switch (i) {
              case "TEXTAREA":
              case "INPUT":
                var a = $(e.target);
                if (a.hasClass("textbox")) {
                  var l = t._cleanUpText(t.$textbox.val());
                  t.previousValues.textbox != l &&
                    ((r = !0),
                    s ||
                      ((o = !0),
                      Helpers.App.replaceUrlParamWithHistory(
                        t.textUrlParameterName,
                        l,
                        !0
                      )),
                    Helpers.GlobalEventTracker.smartTemplateEvent(
                      "textChange",
                      Object.assign(
                        {
                          previous: t.previousValues.textbox,
                          new: t.record.contents,
                          name: t.name,
                        },
                        Helpers.App.getProductShownData()
                      )
                    ),
                    (t.record.contents = l),
                    (t.previousValues.textbox = l));
                } else if (a.hasClass("checkbox")) {
                  var c = t.$checkbox.prop("checked");
                  t.previousValues.checkbox != c &&
                    ((t.record.visible = t._getRecordVisibility()),
                    t.dispatch("change", {
                      triggeredByPopState: s,
                    }),
                    s ||
                      Helpers.App.replaceUrlParamWithHistory(
                        t.chkUrlParameterName,
                        c ? "" : c
                      ),
                    Helpers.GlobalEventTracker.smartTemplateEvent(
                      "textCheckboxChange",
                      Object.assign(
                        {
                          previous: t.previousValues.checkbox,
                          new: c,
                          name: t.name,
                        },
                        Helpers.App.getProductShownData()
                      )
                    ),
                    (t.previousValues.checkbox = c));
                  var u,
                    d = Helpers.App.getAllURLParams(),
                    h = d ? d[t.chkUrlParameterName] : void 0;
                  h && (u = JSON.parse(h)),
                    t.$textbox.attr("disabled", void 0 !== u ? u === !1 : !1);
                }
                break;
              case "SELECT":
                var p = t.$select.val();
                t.previousValues.select != p &&
                  ((r = !0),
                  s ||
                    Helpers.App.replaceUrlParamWithHistory(
                      t.fontUrlParameterName,
                      p
                    ),
                  Helpers.GlobalEventTracker.smartTemplateEvent(
                    "textFontChange",
                    Object.assign(
                      {
                        previous: t.previousValues.select,
                        new: p,
                        name: t.name,
                      },
                      Helpers.App.getProductShownData()
                    )
                  ),
                  (t.previousValues.select = p),
                  (o = !s)),
                  t.dispatch("hideModal", {
                    originalDispatcher: t,
                  });
            }
            r && t.record.visible
              ? t.dispatch("change", {
                  triggeredByPopState: s,
                  triggeredByUser: o,
                  originalDispatcher: t,
                })
              : r && t.dispatch("notVisible");
          });
      },
      _imageTextBoxChangeHandler: function () {
        var e,
          t = this;
        (t._eventTextChangeDebounced = Helpers.App.debounce(function () {
          Helpers.GlobalEventTracker.smartTemplateEvent(
            "textChange",
            Object.assign(
              {
                previous: t.previousValues.textbox,
                new: t.record.contents,
                name: t.name,
              },
              Helpers.App.getProductShownData()
            )
          ),
            (t.previousValues.textbox = t.record.contents);
        }, t.constructor.TEXTCHANGE_EVENT_DEBOUNCE_DURATION).bind(t)),
          this.$textbox.bind("input change", function (n, i) {
            var r = Helpers.App.getAllURLParams(),
              s = r ? r[t.chkUrlParameterName] : void 0,
              o = void 0 !== s ? JSON.parse(s) : !0,
              a = i && i.triggeredByPopState;
            if (
              (t._updateCharacterCount(),
              t.$checkbox.prop("checked", "" !== t.$textbox.val().trim()),
              (t.record.visible = t._getRecordVisibility()),
              !a || t.$checkbox.prop("checked") !== o)
            ) {
              var l = void 0 !== s ? JSON.parse(s) : t.record.visible;
              t.$checkbox.prop("checked", l);
            }
            return (
              a || (t.previousValues.checkbox = t.record.visible),
              t.previousValues.textbox == t.$textbox.val()
                ? void n.stopImmediatePropagation()
                : void (
                    "input" == n.type &&
                    (clearTimeout(e),
                    (e = setTimeout(function () {
                      (t.record.contents = t._cleanUpText(t.$textbox.val())),
                        t.record.visible
                          ? t.previousValues.textbox !== t.$textbox.val() &&
                            (i && i.triggeredByPopState
                              ? ((i.originalDispatcher = t),
                                (i.changedProperty = "contents"),
                                t.dispatch("change", i))
                              : t.dispatch("change", {
                                  triggeredByUser: !0,
                                  changedProperty: "contents",
                                  originalDispatcher: t,
                                }))
                          : i && i.triggeredByPopState
                          ? ((i.originalDispatcher = t),
                            (i.changedProperty = "contents"),
                            t.dispatch("change", i))
                          : t.dispatch("change", {
                              originalDispatcher: t,
                              changedProperty: "contents",
                            }),
                        n.originalEvent &&
                          (Helpers.App.replaceUrlParamWithHistory(
                            t.textUrlParameterName,
                            t.record.contents,
                            !0
                          ),
                          "" === t.$textbox.val().trim() &&
                          "" !== t.previousValues.textbox
                            ? (Helpers.App.replaceUrlParamWithHistory(
                                t.chkUrlParameterName,
                                !1
                              ),
                              t.$checkbox.prop("checked", !1))
                            : "" !== t.$textbox.val().trim() &&
                              "" === t.previousValues.textbox &&
                              (Helpers.App.replaceUrlParamWithHistory(
                                t.chkUrlParameterName,
                                !0
                              ),
                              t.$checkbox.prop("checked", !0))),
                        t._eventTextChangeDebounced(),
                        (t._debounceTime = t.defaultDebounceTime
                          ? t.defaultDebounceTime
                          : 1e3);
                    }, t._debounceTime)),
                    t._timeouts.push(e))
                  )
            );
          }),
          this.$textbox.on("focus blur", function () {
            t.$inputContainer.toggleClass("is-focused");
          }),
          this.element.bind("change", function (e, n) {
            var i = e.target.nodeName,
              r = n && n.triggeredByPopState,
              s = n && n.triggeredByUser;
            switch (i) {
              case "TEXTAREA":
              case "INPUT":
                var o = $(e.target);
                if (o.hasClass("textbox")) {
                  var a = t._cleanUpText(t.$textbox.val());
                  if (t.previousValues.textbox != a) {
                    var l =
                      e.isTrusted ||
                      (e.originalEvent && e.originalEvent.isTrusted);
                    t.record.visible
                      ? t.dispatch("change", {
                          triggeredByPopState: r,
                          triggeredByUser: s || l,
                          originalDispatcher: t,
                          changedProperty: "contents",
                        })
                      : t.dispatch("notVisible"),
                      r ||
                        Helpers.App.replaceUrlParamWithHistory(
                          t.textUrlParameterName,
                          a
                        ),
                      Helpers.GlobalEventTracker.smartTemplateEvent(
                        "textChange",
                        Object.assign(
                          {
                            previous: t.previousValues.textbox,
                            new: t.record.contents,
                            name: t.name,
                          },
                          Helpers.App.getProductShownData()
                        )
                      ),
                      (t.record.contents = a),
                      (t.previousValues.textbox = a);
                  }
                } else if (o.hasClass("checkbox")) {
                  var c = t.$checkbox.prop("checked"),
                    u = c === !1;
                  t.$textbox.attr("disabled", u),
                    t.previousValues.checkbox != c &&
                      ((t.record.visible = t._getRecordVisibility()),
                      t.dispatch("change", {
                        changedProperty: "visible",
                        originalDispatcher: t,
                        triggeredByPopState: r,
                      }),
                      r ||
                        Helpers.App.replaceUrlParamWithHistory(
                          t.chkUrlParameterName,
                          c
                        ),
                      Helpers.GlobalEventTracker.smartTemplateEvent(
                        "textCheckboxChange",
                        Object.assign(
                          {
                            previous: t.previousValues.checkbox,
                            new: c,
                            name: t.name,
                          },
                          Helpers.App.getProductShownData()
                        )
                      ),
                      (t.previousValues.checkbox = c));
                }
                break;
              case "SELECT":
                var d = t.$select.val();
                t.previousValues.select != d &&
                  (t.record.visible
                    ? t.dispatch("change", {
                        triggeredByPopState: r,
                        triggeredByUser: s,
                        originalDispatcher: t,
                        changedProperty: "font",
                      })
                    : t.dispatch("notVisible"),
                  r ||
                    Helpers.App.replaceUrlParamWithHistory(
                      t.fontUrlParameterName,
                      d
                    ),
                  Helpers.GlobalEventTracker.smartTemplateEvent(
                    "textFontChange",
                    Object.assign(
                      {
                        previous: t.previousValues.select,
                        new: d,
                        name: t.name,
                      },
                      Helpers.App.getProductShownData()
                    )
                  ),
                  (t.previousValues.select = d),
                  (s = !r));
            }
          });
      },
      _cleanUpText: function (e) {
        var t,
          n = this;
        return (
          (t = e.replace(n.newLineRegex, "\r")),
          (t = Helpers.App.sanitizeControlCharacters(t))
        );
      },
      _getRecordVisibility: function () {
        var e = this.$checkbox.prop("checked"),
          t = !1;
        return (
          e || "" === this.$textbox.val().trim() || (t = !1),
          e && "" === this.$textbox.val().trim() && (t = !1),
          e && "" !== this.$textbox.val().trim() && (t = !0),
          e || "" !== this.$textbox.val().trim() || (t = !1),
          t
        );
      },
      _updateCharacterCount: function () {
        var e = this,
          t = e.$textbox.val().length,
          n = e.record.maxCharacters,
          i = t + "/" + n;
        t === n
          ? e.$inputContainer.addClass("max-count")
          : e.$inputContainer.removeClass("max-count"),
          e.$inputContainer.attr("data-character-count", i);
      },
      loadAssets: function (e) {
        var t = this;
        t.areAssetsLoaded ||
          ((this.preSelectedFont = this.fontListManager.findInList(
            "all",
            this.record.font
          )),
          this._setFontImage(this.preSelectedFont.image),
          this.appendChild(
            new UI.SmartTemplate.FontPicker({
              listingsData: [
                {
                  name: "suggested",
                  emptyState: "",
                },
                {
                  name: "recent",
                  emptyState:
                    '<div class="recents-empty">                        <i class="recent-icon"></i>                        <div class="title">No Recent Fonts Used Yet</div>                    </div>',
                },
                {
                  name: "saved",
                  emptyState:
                    '<div class="saved-empty">                        <i class="star-off"></i>                        <div class="title">No Saved Fonts Yet</div>                        <div class="subtitle">To save a font click on the star</div>                    </div>',
                },
              ],
              fontsModal: t.fontsModal,
              fontListManager: t.fontListManager,
              savedFonts: t.savedFonts,
              activeFont: this.preSelectedFont,
              name: "fontPicker",
              control: this.$fontContainer,
              isMobileVersion: Helpers.App.isMobile(),
            })
          ).render($("body")),
          this.record.allowedFonts.forEach(function (e) {
            var n = t.fontListManager.findInList("all", e.name);
            null !== n && (e.isPremium = n.isPremium),
              t.fontPicker.addSuggestedFont(e);
          }),
          void 0 ===
            this.fontPicker[this.preSelectedFont.name + "_suggested"] &&
            (t.fontPicker.addRecentFont(this.preSelectedFont),
            t.setSwappableFont(this.preSelectedFont),
            null ===
              t.fontListManager.findInList(
                "recent",
                this.preSelectedFont.name
              ) &&
              t.fontListManager
                .getList("recent")
                .add(this.preSelectedFont, "name")),
          this._bindFontPicker(),
          "function" == typeof e && e(),
          (t.areAssetsLoaded = !0));
      },
      _fontUrlToFontId: function (e) {
        return e.split("/").pop().split(".").shift();
      },
      _bindFontPicker: function () {
        (this.boundShowFontPicker = this.fontPicker.activate.bind(
          this.fontPicker
        )),
          (this.boundClickHandler = this._handleFontContainerClick.bind(this)),
          this.$fontContainer.bind("click", this.boundClickHandler),
          (this.boundFontPickerChange =
            this._fontPickerChangeHandler.bind(this)),
          (this.boundFontPickerShow = this._fontPickerShowHandler.bind(this)),
          (this.boundFontPickerHide = this._fontPickerHideHandler.bind(this)),
          this.fontPicker.bind("fontpicker:change", this.boundFontPickerChange),
          this.fontPicker.bind("fontpicker:show", this.boundFontPickerShow),
          this.fontPicker.bind("fontpicker:hide", this.boundFontPickerHide);
      },
      _fontPickerChangeHandler: function (e) {
        var t = e.data;
        this._setFontImage(t.image),
          Helpers.App.isMobile() === !0 && this.fontPicker.deactivate(),
          Helpers.StageType.isVideoV4() ? this.setFont(t, !0) : this.setFont(t),
          this._updateFontUrlParam();
      },
      _fontPickerShowHandler: function () {
        this.isMobilePhone &&
          this.dispatch("showModal", {
            originalDispatcher: this.fontPicker,
          }),
          this.element.addClass("open-fontpicker"),
          (this.previousValues.select = this.$select.val()),
          this.dispatch("componentOpen", {
            component: this.fontPicker.element,
          });
      },
      _fontPickerHideHandler: function () {
        this.isMobilePhone &&
          this.dispatch("hideModal", {
            originalDispatcher: this.fontPicker,
          }),
          this.element.removeClass("open-fontpicker"),
          this.dispatch("componentClose");
      },
      updatePrefix: function (e) {
        (this.prefix = e),
          (this.textUrlParameterName = this.prefix + "text" + this.name),
          (this.fontUrlParameterName = this.prefix + "font" + this.name),
          (this.fontSizeUrlParameterName =
            this.prefix + this.name + "_fontSize"),
          (this.chkUrlParameterName = this.prefix + "checkbox" + this.name);
      },
      hideRuleControls: function () {
        this.fontSize && this.fontSize.disable();
      },
      updateSelection: function () {
        this.$select.val(this.record.font),
          this.$select.trigger("change", {
            triggeredByPopState: !0,
          });
        var e = this._colorControl || this._tabbedColorPicker;
        e.refreshColorpicker();
      },
      showRuleControls: function () {
        this.fontSize && this.fontSize.enable();
      },
      isMaxLinesInvalid: function () {
        var e = this,
          t = parseInt(e.$textbox.attr("maxlines")),
          n = "\n";
        e.$textbox.val().indexOf("\r") > -1 && (n = "\r");
        var i = e.$textbox.val().split(n);
        return i.length > t - 1;
      },
      destroy: function () {
        this.$select.selectpicker("destroy"),
          this.clearTimeouts(),
          this.clearPopstateEventHandler(),
          this.genericDestroy();
      },
      focus: function () {
        var e = this;
        e.$textbox[0].focus(),
          e.$textbox[0].select(),
          e.element.addClass(e.constructor.FOCUS_ANIMATION_CLASS),
          setTimeout(function () {
            e.element.removeClass(e.constructor.FOCUS_ANIMATION_CLASS);
          }, e.constructor.FOCUS_ANIMATION_DURATION);
      },
      setText: function (e) {
        var t = this,
          n = t._cleanUpText(e);
        t.previousValues.textbox != n &&
          (t.$textbox.val(n),
          (t.record.visible = "" !== t.$textbox.val().trim()),
          t.$checkbox.prop("checked", "" !== t.$textbox.val().trim()),
          Helpers.App.replaceUrlParamWithHistory(t.textUrlParameterName, n, !0),
          (t.record.contents = n),
          (t.previousValues.textbox = n),
          t.dispatch("change", {
            triggeredByUser: !0,
            originalDispatcher: t,
          }),
          Helpers.GlobalEventTracker.smartTemplateEvent(
            "textChange",
            Object.assign(
              {
                previous: t.previousValues.textbox,
                new: t.record.contents,
                name: t.name,
              },
              Helpers.App.getProductShownData()
            )
          ));
      },
      hideInStage: function () {
        if (
          this.previousValues.checkbox &&
          (this.$checkbox.click(), this._wasWarningShown !== !0)
        ) {
          var e = new HideElementPopoverWarning({
            target: this.element.find(".input-group"),
            arrowTarget: this.$checkbox,
            template:
              '<div class="popover hide-element-warning" role="tooltip"><div class="arrow"></div><div class="close-icon"></div><div class="popover-content"></div></div>',
            text: "Click on the checkbox to show the text again",
            placement: "bottom",
            cssClass: "",
          });
          setTimeout(function () {
            e.render($("body"));
          }, 1e3),
            (this._wasWarningShown = !0);
        }
      },
      _useFontIfPresentOnUrl: function () {
        var e = Helpers.App.getAllURLParams(),
          t = e[this.fontUrlParameterName];
        t && (this.record.font = t);
      },
      _setFontImage: function (e) {
        this.$imgContainer.attr("src", this._cdnBasePath() + e);
      },
      _updateFontUrlParam: function () {
        Helpers.App.replaceUrlParamWithHistory(
          this.fontUrlParameterName,
          this.record.font
        );
      },
      _handleFontContainerClick: function (e) {
        e.preventDefault(),
          e.stopImmediatePropagation(),
          e.stopPropagation(),
          this.boundShowFontPicker();
      },
      updateSuggestedFontsInFontPicker: function () {
        this.fontPicker.updateSuggestedFonts(this.record.allowedFonts);
      },
      afterReady: function () {
        var e = {
          originalDispatcher: this,
          triggeredByUser: !1,
          triggeredByPopState: !0,
        };
        this.dispatch("render", e);
      },
    },
  }),
  Class(UI.SmartTemplate, "TextControlGroup")
    .inherits(Widget)
    .includes(BubblingSupport)({
    elementClass: "text-group-control",
    prototype: {
      updatePrefix: function (e) {
        this.children.forEach(function (t) {
          t.updatePrefix(e);
        });
      },
      updatePremiumBadgeInControls: function () {
        this.children.forEach(function (e) {
          e.updateSuggestedFontsInFontPicker();
        });
      },
    },
  }),
  Class(UI.SmartTemplate, "ThumbItemFeedbackLayer").inherits(Widget)({
    html: '        <div>            <div class="thumb-item-feedback-layer__inner">                <div data-spinner class="pl-spinner-primary-sm relative"></div>                <div data-text></div>            </div>        </div>    ',
    elementClass: "thumb-item-feedback-layer",
    prototype: {
      init: function (e) {
        if (
          (Widget.prototype.init.call(this, e),
          (this.textElement = this.element.find("[data-text]")),
          Helpers.App.isMobile())
        ) {
          var t = this.element.find("[data-spinner]");
          t.removeClass("pl-spinner-primary-sm"),
            t.addClass("pl-spinner-primary-xl");
        }
        e.text && this.updateText(e.text), this._bindEvents();
      },
      updateText: function (e) {
        return (
          this.textElement[e ? "addClass" : "removeClass"]("ellipsing"),
          this.textElement.text(e),
          this
        );
      },
      _bindEvents: function () {
        return (
          (this._stopPropagation = this._stopPropagation.bind(this)),
          this.element.on("click", this._stopPropagation),
          this.element.on("mouseenter", this._stopPropagation),
          this.element.on("mouseleave", this._stopPropagation),
          this
        );
      },
      _stopPropagation: function (e) {
        e.stopPropagation();
      },
      destroy: function () {
        this.element.off("click", this._stopPropagation),
          this.element.off("mouseenter", this._stopPropagation),
          this.element.off("mouseleave", this._stopPropagation),
          Widget.prototype.destroy.call(this);
      },
    },
  }),
  (UI.RelatedTemplates = {}),
  Class(UI.RelatedTemplates, "Controller")
    .inherits(Widget)
    .includes(BubblingSupport)({
    ITEM_CLASS: {
      13: "SmartTemplateItem",
      15: "SmartVideoItem",
    },
    prototype: {
      pendingItems: [],
      changeDebounce: null,
      useFallbackProcessing: !1,
      outputUrlHash: {},
      hasOwnQueue: !1,
      hasOutputItems: !1,
      init: function (e) {
        var t;
        Widget.prototype.init.call(this, e),
          (this.pendingItems = []),
          (this.items = e.element.find(".carousel-item")),
          this.appendChild(
            new UI.ListContainer({
              name: "listContainer",
              element: e.element,
              items: this.items,
            })
          ),
          (t = this),
          Array.prototype.forEach.call(this.items, function (n, i) {
            var r, s;
            (r = $(n).prop("dataset").stageTypeId),
              (s = UI.RelatedTemplates.Controller.ITEM_CLASS[r]),
              t._bindItemTrackingEvent(n),
              t.listContainer.appendChild(
                new UI.RelatedTemplates[s]({
                  name: "relatedTemplateItem" + i,
                  uiJson: e.uiJson,
                  element: $(n),
                  index: i,
                })
              );
            var o = new UI.PreviewThumbnail({
              name: "thumbnail" + i,
              element: $(n),
              helpString: "Tap Again to Open",
              useOffsetInHelpText: !0,
            });
            t.listContainer.appendChild(o),
              o.bind("preview.shown", function () {
                t.hidePreviews(this);
              }),
              o.bind("thumbnailPreview", function (e) {
                t.dispatch("thumbnailPreview", e.data);
              });
          }),
          this.queue || this.fallbackToRemoteProcess(),
          this._addEventListeners();
      },
      getRelatedTemplatesInfo: function () {
        var e = this.getRelatedTemplatesItems();
        e.forEach(function (e) {
          e.getRelatedTemplateInfo();
        });
      },
      hidePreviews: function (e) {
        var t = this;
        this.items.each(function (n) {
          (e &&
            t.listContainer.getItemByName(["thumbnail" + n]).name === e.name) ||
            t.listContainer.getItemByName(["thumbnail" + n]).hidePreview();
        });
      },
      fallbackToRemoteProcess: function () {
        var e;
        (this.useFallbackProcessing = !0),
          this._createQueue(),
          (e = this.getRelatedTemplatesItems()),
          e.forEach(function (e) {
            e.fallbackToRemoteProcess && e.fallbackToRemoteProcess();
          });
      },
      _createQueue: function () {
        this.queue && (delete this.queue, (this.queue = null)),
          (this.queue = new SmartQueue({
            actionName: "loadPreview",
            minConsumers: 1,
            maxConsumers: 3,
            itemsPerConsumer: 1,
          })),
          (this.hasOwnQueue = !0);
      },
      _addEventListeners: function () {
        var e = this;
        this.listContainer
          .getElement()
          .on("afterChange scroll", this._changeEventHandler.bind(this)),
          $(document).on({
            scroll: this._scrollEventHandler.bind(this),
            touchmove: this._scrollEventHandler.bind(this),
          }),
          UI.Navigation.NavBar.bind(
            "user:login",
            this._handleUserLogin.bind(this)
          ),
          UI.RelatedTemplates.Controller.bind(
            "user:logout",
            this._handleUserLogout.bind(this)
          ),
          this.listContainer.bind("beforeProcess", function (t) {
            var n, i, r;
            (n = t.data.target.index),
              (i = e.listContainer.getItemByName(["thumbnail" + n]).isImage),
              (r = e.listContainer.getItemByName(["thumbnail" + n])),
              r.isHovered() &&
                (i === !0
                  ? ((r.keepLoader = !0), r.hideImage())
                  : r.hideVideo());
          }),
          this.listContainer.bind("process", function (e) {
            e.stopPropagation();
          }),
          this.listContainer.bind("outputFound", function () {
            (e.hasOutputItems = !0),
              e.hasOwnQueue === !1 && e.fallbackToRemoteProcess();
          }),
          this.listContainer.bind("fallbackToRemoteProcess", function () {
            e.hasOwnQueue === !1 && e.fallbackToRemoteProcess();
          });
      },
      _handleUserLogin: function () {
        var e = this,
          t = e.getItems();
        $.get(
          "/api/v2/bookmarked_stages_from_user?user_id=" +
            Helpers.App.getUser().id
        )
          .done(function (e) {
            t.forEach(function (t) {
              var n = t.bookmark;
              n &&
                (-1 !== e.bookmarkedStages.indexOf(parseInt(n.stageId))
                  ? n.afterLogin(!0)
                  : n.bookmarkAfterLogin
                  ? n.setBookmarked(!0)
                  : n.afterLogin(!1));
            });
          })
          .fail(function () {});
      },
      _handleUserLogout: function () {
        var e = this,
          t = e.getItems();
        t.forEach(function (e) {
          e.bookmark && e.bookmark.afterLogout();
        });
      },
      setLastChange: function (e) {
        this.getItems().forEach(function (t) {
          t.lastChange = e;
        }),
          (this.lastChange = e);
      },
      getVisibleItems: function () {
        return this.listContainer.getVisibleItems(this._isRelatedTemplateItem);
      },
      _isRelatedTemplateItem: function (e) {
        var t, n;
        t = [];
        for (key in UI.RelatedTemplates.Controller.ITEM_CLASS)
          t.push(UI.RelatedTemplates.Controller.ITEM_CLASS[key]);
        return (
          (n = t.filter(function (t) {
            return e.constructor.className === t;
          })[0]),
          void 0 !== n
        );
      },
      getRelatedTemplatesItems: function () {
        return this.getItems().filter(this._isRelatedTemplateItem);
      },
      getItems: function () {
        return this.listContainer.getItems();
      },
      _scrollEventHandler: function () {
        this.listContainer.isInsideViewport() &&
          this.pendingItems.length &&
          (this.update(this.pendingItems), (this.pendingItems = []));
      },
      _changeEventHandler: function () {
        clearTimeout(this.changeDebounce),
          (this.changeDebounce = setTimeout(
            function () {
              this.update(this.getVisibleItems());
            }.bind(this),
            1500
          ));
      },
      reset: function () {
        this.getItems().forEach(function (e) {
          e.processed = !1;
        });
      },
      update: function (e) {
        var t = this;
        t.listContainer.isInsideViewport()
          ? t.queue.push(e)
          : (t.pendingItems = e);
      },
      shouldExport: function () {
        var e = this,
          t = !1;
        return e.outputUrlHash[e.lastChange]
          ? !1
          : (e.getVisibleItems().forEach(function (n) {
              "output" === n.strategy &&
                n.lastProcess !== e.lastChange &&
                (t = !0);
            }),
            e.useFallbackProcessing === !1 && t);
      },
      loadAssets: function () {
        var e = null;
        try {
          throw new Error("Get stack trace");
        } catch (t) {
          e = t.stack || "No stack trace";
        }
        Helpers.GlobalEventTracker.deprecatedMethod({
          module: "UI.RelatedTemplates.controller",
          file: "controller.js",
          stackTrace: e,
        });
      },
      _togglesAllSmartItemsLoaders: function (e) {
        var t = this.getRelatedTemplatesItems();
        t.forEach(function (t) {
          t.toggleLoader && t.toggleLoader(e);
        });
      },
      _bindItemTrackingEvent: function (e) {
        var t = $(e).find("a"),
          n = t.attr("href");
        t.click(function () {
          Helpers.GlobalEventTracker.carouselClick(
            Helpers.App.getUrlParam("iref", n) || "model",
            Helpers.App.getSlugFromStageURL(n)
          );
        });
      },
    },
  }),
  Class(UI.RelatedTemplates, "SmartTemplateItem")
    .inherits(Widget)
    .includes(
      CleanRecordSupport,
      BubblingSupport,
      FetchLayersSupport,
      UiJsonSupport
    )({
    PROCESS_URL: {
      development: "https://smart-templates.us/api/v4/related_templates_jobs",
      staging: "https://smart-templates.us/api/v4/related_templates_jobs",
      production: "https://nicev2.placeit.net/api/v4/related_templates_jobs",
    },
    RELATED_INFO_URL: {
      development: "https://smart-templates.us/api/v4/related_templates_info",
      staging: "https://smart-templates.us/api/v4/related_templates_info",
      production: "https://nicev2.placeit.net/api/v4/related_templates_info",
    },
    prototype: {
      busy: !1,
      baseUrl: null,
      presetId: null,
      smartTemplateId: null,
      graphicId: null,
      niceCategoryId: null,
      query: null,
      uiJson: null,
      $loader: null,
      $image: null,
      placeholderSrc: null,
      $anchor: null,
      processUrl: null,
      engineCachedData: null,
      originalUiJSON: null,
      structureJSON: null,
      useFallbackProcessing: !1,
      strategyNotFound: !1,
      strategy: null,
      _processUniqueId: null,
      _processStartTime: null,
      pendingChanges: null,
      _firstRun: !0,
      onlyCaching: !1,
      didCaching: !1,
      isSafari: /^((?!chrome|android).)*safari/i,
      init: function (e) {
        Widget.prototype.init.call(this, e);
        var t = this;
        (this.pendingChanges = null),
          (this.uiJson = e.uiJson),
          (this.processUrl =
            UI.RelatedTemplates.SmartTemplateItem.PROCESS_URL[
              window.environment
            ]),
          (this.$loader = this.element.find(".loading-overlay")),
          (this.$image = this.element.find("img.thumb-image")),
          (this.placeholderSrc = this.$image[0] && this.$image[0].src),
          (this.$anchor = this.element.find("> a")),
          (this.query = e.query),
          (this.$loagingGif = this.element.find(".loading-gif"));
        var n = this.element.prop("dataset");
        ("true" === n.forceFallback ||
          e.forceFallback === !0 ||
          window.forceRTFallback ||
          "Mockups" === n.categoryName) &&
          (this.useFallbackProcessing = !0),
          this.isSafari.test(navigator.userAgent) === !0 &&
            (this.useFallbackProcessing = !0),
          Helpers.App.isMobile() === !0 && (this.useFallbackProcessing = !0),
          this.useFallbackProcessing &&
            setTimeout(function () {
              t.dispatch("fallbackToRemoteProcess");
            }, 500),
          n.smartTemplateId &&
            (this.smartTemplateId = n.smartTemplateId.trim()),
          n.presetId && (this.presetId = n.presetId),
          this.appendChild(
            new UI.Bookmark({
              name: "bookmark",
              element: this.element,
            })
          ),
          (this.baseUrl = this.$anchor.data("href")),
          this._hideNlpItem(),
          this._bindings();
      },
      _bindings: function () {
        var e = this;
        e.bind("process", function () {
          e._showNlpLoader();
        });
      },
      _hideNlpItem: function () {
        this._firstRun &&
          this.isNlpEnabled === !0 &&
          (this.$loagingGif.detach(),
          this.$loader.append('<div class="item-spinner"></div>'),
          this.$loader.addClass("nlp-loading"),
          this.element.addClass("first-run"));
      },
      _showNlpLoader: function () {
        this._firstRun &&
          this.isNlpEnabled === !0 &&
          (this.element.removeClass("first-run"), (this._firstRun = !1));
      },
      getRelatedTemplateInfo: function () {
        var e = this,
          t =
            UI.RelatedTemplates.SmartTemplateItem.RELATED_INFO_URL[
              window.environment
            ],
          n = {
            source_ui_json: this.uiJson,
            preset_id: this.presetId,
            target_id: this.smartTemplateId,
          };
        e.isCustomExperience === !0 &&
          ((n.strategy = "input"),
          (n.source_ui_json = {
            id: "fake",
          })),
          $.ajax({
            url: t,
            method: "POST",
            data: JSON.stringify(n),
            contentType: "application/json",
            json: !0,
          })
            .done(function (t) {
              (e.strategy = t.strategy),
                (e.originalUiJSON = t.target),
                "output" === e.strategy && e.dispatch("outputFound"),
                e.pendingChanges &&
                  (e.loadPreview(e.pendingChanges), (e.pendingChanges = null));
            })
            .fail(function () {
              e.strategyNotFound = !0;
            });
      },
      _clearColors: function (e) {
        var t = JSON.parse(JSON.stringify(e));
        return (
          t.text.forEach(function (e) {
            e.color = null;
          }),
          t.graphic.forEach(function (e) {
            (e.color = null), (e.layers = []);
          }),
          (t.backgroundColor = null),
          (t.defaultAssetColors = []),
          t
        );
      },
      loadPreview: function (e) {
        var t = {
          shouldRun: !0,
          eventOrigin: this,
        };
        return (
          this.dispatch("beforeProcessTemplate", t),
          (e.onlyCaching = this.onlyCaching),
          (e.didCaching = this.didCaching),
          t.shouldRun
            ? this.useFallbackProcessing === !0
              ? void this._loadPreviewFromRemote(e)
              : this.originalUiJSON || this.strategyNotFound
              ? this.originalUiJSON && this.originalUiJSON.forceReload === !0
                ? void this._loadPreviewFromRemote(e)
                : "output" === this.strategy
                ? void this._loadPreviewFromRemote(e)
                : this.strategyNotFound
                ? void e()
                : void this._loadPreviewFromIframe(e)
              : void (this.pendingChanges = e)
            : void e()
        );
      },
      _loadPreviewFromRemote: function (e) {
        var t, n, i;
        if (e.onlyCaching) return (e.onlyCaching = !1), void e();
        if (
          ((t = this),
          (n = t.lastChange),
          t.lastChange === t.lastProcess || null === t.smartTemplateId)
        )
          return (t.lastProcess = n), e();
        if (null == t.strategy && "fake" != t.uiJson.id)
          return (t.lastProcess = n), e();
        this.toggleLoader(!0),
          this.dispatch("beforeProcess"),
          (this._processUniqueId = Helpers.App.generateUid()),
          (this._processStartTime = performance.now()),
          (this.busy = !0),
          (t.$image[0].dataset.busy = !0);
        var r = this.getCleanRecord(this.uiJson);
        "input" !== this.strategy ||
          this.isCustomExperience ||
          (r = this._clearColors(r)),
          this.graphicId &&
            r.graphic[0] &&
            (r.graphic[0].layer = this.graphicId),
          (r.referrer = window.location.href),
          (i = {
            source_ui_json: r,
            target_id: this.smartTemplateId,
            preset_id: this.presetId,
          }),
          this.presetStrategy && (i.strategy = this.presetStrategy),
          $.ajax({
            url: this.processUrl,
            method: "POST",
            data: JSON.stringify(i),
            contentType: "application/json",
            json: !0,
          })
            .done(function (i) {
              (t.busy = !1),
                t.$image.on("load", function () {
                  t.$image.off("load"),
                    t.lastChange === n && t.toggleLoader(!1),
                    t.dispatch("process");
                }),
                t.$image.attr("src", i.previewImage.value),
                t.$image.length &&
                  ((t.$image[0].dataset.processed = !0),
                  (t.$image[0].dataset.busy = !1)),
                t._setUrlParams(i),
                (t._processStartTime = null),
                (t._processUniqueId = null),
                (t.lastProcess = n),
                t.dispatch("free"),
                t._setDesignPlan(i),
                e();
            })
            .fail(function (n) {
              return n && 429 === n.status
                ? (console.log("Throttled! Awaiting 2 secs before retrying"),
                  void setTimeout(function () {
                    console.log("Retrying after throttle"),
                      t._loadPreviewFromRemote(e);
                  }, 2e3))
                : ((t.busy = !1),
                  (t.$image[0].dataset.busy = !1),
                  t.dispatch("process"),
                  t.toggleLoader(!1),
                  Helpers.GlobalEventTracker.noticeError(
                    "stItem:remoteProcessFail",
                    {
                      response: n.responseText,
                      smartTemplateId: t.smartTemplateId,
                      presetId: t.presetId,
                    }
                  ),
                  void e());
            });
      },
      _setUrlParams: function (e) {
        var t = this,
          n = t.baseUrl,
          i = t._getUrlParams(e).replace("?", "");
        if (i) {
          var r = -1 !== n.indexOf("?"),
            s = n + (r ? "&" : "?") + i;
          t.$anchor.attr("href", s);
        }
      },
      _loadPreviewFromIframe: function (e) {
        var t,
          n = this,
          i = n.lastChange;
        if (n.lastChange === n.lastProcess || null === n.smartTemplateId)
          return (n.lastProcess = i), e();
        t = function (t) {
          return t
            ? ((n._processStartTime = performance.now()),
              e.onlyCaching ||
                ((n._processUniqueId = Helpers.App.generateUid()),
                (n.busy = !0),
                (n.$image[0].dataset.busy = !0),
                n.toggleLoader(!0)),
              (e.lastChange = i),
              void n._handleMessageFromIframe(t, e))
            : void e();
        };
        IframePool.getInstance().get(t);
      },
      _handleMessageFromIframe: function (e, t) {
        var n = e[0].contentWindow.wrapper;
        n ||
          ((e[0].wrapper = new e[0].contentWindow.SimpleEngineWrapper()),
          (n = e[0].wrapper)),
          n.setErrorCallback(this._iframeFailCallback.bind(this, e, t)),
          n.setSmartTemplateId(this.smartTemplateId),
          n.setEnvironment(window.environment),
          this.structureJSON
            ? this._onStructureFetched(e, n, t, this.structureJSON)
            : n.fetchStructure(
                (this.originalUiJSON && this.originalUiJSON.size) || "",
                this._onStructureFetched.bind(this, e, n, t)
              );
      },
      _onStructureFetched: function (e, t, n, i) {
        var r,
          s = JSON.parse(JSON.stringify(i));
        (this.structureJSON = s),
          (t._structureJSON = i),
          (r = n.onlyCaching
            ? this._initialCachingCallback.bind(this, e, t, n)
            : this._requestIframeProcess.bind(this, e, t, n)),
          t.bootstrap(
            this.originalUiJSON,
            this.engineCachedData,
            r,
            n.onlyCaching
          );
      },
      _removeCachedElementsFromDOM: function () {
        var e = this;
        e.engineCachedData &&
          e.engineCachedData.textures &&
          Object.keys(e.engineCachedData.textures).forEach(function (t) {
            var n = e.engineCachedData.textures[t];
            n.parentNode.removeChild(n),
              (e.engineCachedData.textures[t] = null);
          }),
          e.engineCachedData &&
            e.engineCachedData.masks &&
            Object.keys(e.engineCachedData.masks).forEach(function (t) {
              var n = e.engineCachedData.masks[t];
              n.parentNode.removeChild(n), (e.engineCachedData.masks[t] = null);
            });
      },
      _addNewCachedElementsToDOM: function () {
        var e = this;
        Object.keys(e.engineCachedData.textures).forEach(function (t) {
          var n = e.engineCachedData.textures[t];
          n.classList.add("off-screen"), document.body.append(n);
        }),
          Object.keys(e.engineCachedData.masks).forEach(function (t) {
            var n = e.engineCachedData.masks[t];
            n.classList.add("off-screen"), document.body.append(n);
          });
      },
      _initialCachingCallback: function (e, t, n, i, r) {
        var s = this;
        this._removeCachedElementsFromDOM(),
          (s.engineCachedData = r),
          (s.engineCachedData._structureJSON = s.structureJSON),
          (s.$image[0].dataset.busy = !1),
          (s.busy = !1),
          this._addNewCachedElementsToDOM(),
          IframePool.getInstance().destroyIframe(e),
          console.log("Caching finish", this.smartTemplateId),
          n();
      },
      transferColors: function (e, t) {
        var n, i, r, s, o, a;
        (n = function (e) {
          return (e || []).filter(function (e) {
            return e.visible === !0;
          });
        }),
          (i = function (e, t) {
            return t.filter(function (t) {
              return t.name && -1 !== t.name.indexOf(e);
            })[0];
          }),
          (r = function (e, t) {
            var r = n(e.layers)[0] || {},
              l = n(t.layers)[0] || {},
              c = i("Main", l.layers || []);
            c && (c.color = t.color),
              l.layers &&
                l.layers.forEach(function (e) {
                  var t = i(e.name, r.layers || []);
                  if (t) return void (e.color = t.color);
                  if ("Accent" === e.name) {
                    if (s && s[0]) return void (e.color = s[0]);
                    if (a && a.color) return void (e.color = a.color);
                    if (o && o[0]) return void (e.color = o[0]);
                  }
                });
          }),
          (s = e.defaultAssetColors),
          (o = t.defaultAssetColors),
          (a = i("Accent Color", e.graphic)),
          t.graphic.forEach(function (t) {
            var n = UiJsonMap.findTag(t.tag, e.graphic)[0] || {};
            r(n, t);
          });
      },
      _requestIframeProcess: function (e, t, n, i) {
        var r,
          s,
          o,
          a,
          l,
          c = this;
        (r = this.engineCachedData ? !1 : !0),
          (s = !0),
          (o = JSON.parse(JSON.stringify(i))),
          (a = this.getCleanRecord(this.uiJson)),
          "input" !== this.strategy ||
            this.isCustomExperience ||
            (a = this._clearColors(a)),
          this.graphicId &&
            a.graphic[0] &&
            (a.graphic[0].layer = this.graphicId),
          this.setSelectedLayers(o.graphic),
          this.fetchLayers(a.graphic)
            .then(
              function () {
                return (
                  (l = UiJsonMap.map(this.strategy, a, o)),
                  this.fetchGraphicLayers(l.graphic)
                    .then(function () {
                      return c.transferColors(a, l);
                    })
                    .then(
                      function () {
                        r && this.presetId && (s = !1),
                          !r && this.presetId && n.didCaching && (s = !1),
                          this._sendFinishBootstrapOrProcessEvent(
                            "related-iframe-bootstrap:finish",
                            r
                          ),
                          t.process(
                            l,
                            this._iframeProcessCallback.bind(this, e, l, n),
                            this._iframeFailCallback.bind(this, e, n),
                            s
                          );
                      }.bind(this)
                    )
                );
              }.bind(this)
            )
            ["catch"](function (e) {
              throw e;
            });
      },
      _iframeFailCallback: function (e, t) {
        var n = this;
        (n.engineCachedData = null),
          (n.busy = !1),
          (n.$image[0].dataset.busy = !1),
          n.dispatch("process"),
          IframePool.getInstance().destroyIframe(e),
          n.toggleLoader(!1),
          Helpers.GlobalEventTracker.noticeError("stItem:localProcessFail", {
            smartTemplateId: n.smartTemplateId,
            presetId: n.presetId,
          }),
          t();
      },
      _iframeProcessCallback: function (e, t, n, i, r) {
        var s, o, a;
        (s = this),
          (o = this.engineCachedData ? !1 : !0),
          (a = n.lastChange),
          this._removeCachedElementsFromDOM(),
          (s.engineCachedData = r),
          (s.engineCachedData._structureJSON = s.structureJSON),
          this.$image.on("load", function () {
            s.$image.off("load"),
              s.lastChange === a && s.toggleLoader(!1),
              s.dispatch("process");
          }),
          s.$image.attr("src", i),
          (s.$image[0].dataset.processed = !0),
          (s.$image[0].dataset.busy = !1),
          s._setUrlParams(t),
          (s.busy = !1),
          s.$image.length &&
            ((s.$image[0].dataset.processed = !0),
            (s.$image[0].dataset.busy = !1)),
          this._addNewCachedElementsToDOM(),
          this._sendFinishBootstrapOrProcessEvent(
            "related-iframe-process:finish",
            o
          ),
          Math.random() < 0.01 && this._sendResultingImageEvent(),
          (this._processStartTime = null),
          (this._processUniqueId = null),
          IframePool.getInstance().destroyIframe(e),
          n(),
          (s.lastProcess = a),
          s.dispatch("free");
      },
      fallbackToRemoteProcess: function () {
        this.useFallbackProcessing = !0;
      },
      setPlaceholderSrc: function (e) {
        if (
          (e.setDefaultPlaceHolder &&
            this.$image.attr("src", this.placeholderSrc),
          this.$anchor && this.$anchor.length)
        ) {
          var t = this.$anchor.data("href");
          (t = Helpers.App.removeParam(e.customGraphicId, t)),
            this.$anchor.attr("href", t);
        }
        this.$image.length && (this.$image[0].dataset.processed = !1);
      },
      toggleLoader: function (e) {
        e
          ? (this.element.addClass("item-loading"), this.$loader.show())
          : (this.element.removeClass("item-loading"), this.$loader.hide());
      },
      _sendFinishBootstrapOrProcessEvent: function (e, t) {
        var n = performance.now() - this._processStartTime,
          i = Math.random();
        i > 0.05 ||
          Helpers.GlobalEventTracker.track(e, {
            processId: this._processUniqueId,
            smartTemplateId: this.smartTemplateId,
            stageId: this.uiJson.id,
            timestamp: Date.now(),
            duration: n,
            strategy: this.strategy,
            isFirstRun: t,
            isCustomExperience: this.isCustomExperience,
          });
      },
      _sendResultingImageEvent: function () {
        var e = this,
          t = function (t) {
            Helpers.GlobalEventTracker.track(
              "related-iframe-process:image-uploaded",
              {
                processId: e._processUniqueId,
                smartTemplateId: e.smartTemplateId,
                stageId: e.uiJson.id,
                timestamp: Date.now(),
                imageUrl: t,
                isCustomExperience: e.isCustomExperience,
              }
            );
          };
        if (this.engineCachedData && this.engineCachedData._canvas) {
          if ("function" != typeof this.engineCachedData._canvas.toBlob)
            return void t();
          this.engineCachedData._canvas.toBlob(function (e) {
            var n = new FormData();
            n.append("inputFile", e),
              $.ajax({
                url:
                  NICE_DOMAIN.protocol +
                  "://" +
                  NICE_DOMAIN.hostname +
                  "/files",
                type: "POST",
                data: n,
                processData: !1,
                contentType: !1,
              })
                .done(function (e) {
                  t(e.url);
                })
                .fail(function () {
                  console.log("Failed to upload resulting image"), t();
                });
          });
        }
      },
      _setDesignPlan: function () {},
    },
  }),
  Class(UI.RelatedTemplates, "SmartVideoItem")
    .inherits(Widget)
    .includes(
      CleanRecordSupport,
      BubblingSupport
    )({
    prototype: {
      $image: null,
      placeholderSrc: null,
      init: function (e) {
        Widget.prototype.init.call(this, e),
          (this.$image = this.element.find("img")),
          (this.placeholderSrc = this.$image[0] && this.$image[0].src),
          this.appendChild(
            new UI.Bookmark({
              name: "bookmark",
              element: this.element,
            })
          );
      },
      loadPreview: function () {},
      getRelatedTemplateInfo: function () {},
      setPlaceholderSrc: function () {
        this.$image.attr("src", this.placeholderSrc);
      },
    },
  }),
  Class(UI, "SavedDraftItem").inherits(Widget).includes(BubblingSupport)({
    html: '<figure class="carousel-item draft-item deletable" style="margin-bottom: 6px; zoom: 1; opacity: 1;"><a class="thumb-link" data-href="{{ href }}" href="{{ href }}" target="_blank"><video data-src="" src="" style="display:none; width: 100%; position: absolute; margin-left: auto; margin-right: auto;" muted playsinline></video><div class="loading-overlay"><img class="loading-gif" src="./assets/loader-easing.gif" /></div><span class="badge badge-type__13"><img class="thumb-image" data-src="{{ previewImageURL }}" style="width: 100%; height: auto; display: block; margin-left: auto; margin-right: auto;"/></span></a><div class="draft-item__trash delete hvr-grow"><button></button></div></figure>',
    prototype: {
      id: null,
      thumb: null,
      draftURL: null,
      hasVideo: !1,
      interval: null,
      $video: null,
      _timeout: null,
      poolingTimeout: 3e5,
      intervalTime: 5e3,
      init: function (e) {
        (this.timeTook = performance.now()),
          Widget.prototype.init.call(this, e),
          (this.$image = this.element.find(".badge img")),
          (this.$links = this.element.find(".a")),
          (this.$thumbLink = this.element.find(".thumb-link")),
          (this.$removeButton = this.element.find(
            ".draft-item__trash.delete button"
          ));
        var t = this;
        if (
          (e.previewImage &&
            (this.$image.attr("src", e.previewImage),
            this.$image.attr("data-src", e.previewImage),
            (this.$image[0].onload = function () {
              t.dispatch("loadDraftImage", {
                draftItem: t,
              });
            })),
          e.params)
        ) {
          var n = e.params;
          this.$thumbLink.attr("href", n), this.$thumbLink.attr("data-href", n);
        }
        (this.$video = this.element.find("video")),
          (this.hasVideo = this.hasVideo || this.element.data("hasVideo")),
          this.hasVideo || (this.$video.remove(), (this.$video = null)),
          this._bindEvents();
        var i = this.$video && this.$video.length > 0;
        if (this.hasVideo || i) {
          var r = this.$video.attr("data-src");
          "" === r ? this._checkVideoExistence() : this._createThumbnailChild();
        }
      },
      _bindEvents: function () {
        var e = this;
        this.$links.click(function () {
          Helpers.GlobalEventTracker.draftItemClicked({
            draftId: e.id,
          });
        }),
          this.element.find(".draft-item__trash").click(function (t) {
            t.preventDefault(),
              e.dispatch("delete", {
                id: e.id,
              });
          });
      },
      _addVideoStatusInfo: function () {
        var e = new UI.SavedDraftVideoStatusInfo({
          name: "statusInfo",
        });
        this.appendChild(e).render(this.$thumbLink);
      },
      _checkVideoExistence: function () {
        var e = this;
        this._addVideoStatusInfo(),
          this.statusInfo.setStatus(
            UI.SavedDraftVideoStatusInfo.VIDEO_STATUS.PROCESSING
          ),
          (this.interval = setInterval(function () {
            Draft.find(e.id)
              .then(function (t) {
                e._checkVideoExistenceHandler(t);
              })
              ["catch"](function (t) {
                404 === t.status && e._clearInterval();
              });
          }, this.intervalTime)),
          (this._timeout = setTimeout(function () {
            e.interval &&
              (clearInterval(e.interval),
              e.statusInfo &&
                e.statusInfo.setStatus(
                  UI.SavedDraftVideoStatusInfo.VIDEO_STATUS.FAILED
                ));
          }, this.poolingTimeout));
      },
      _clearInterval: function () {
        var e = this;
        e.interval && clearInterval(e.interval),
          e._timeout && clearTimeout(e.timeout);
      },
      _checkVideoExistenceHandler: function (e) {
        var t = this;
        if (!t.statusInfo) return void t._clearInterval();
        if (window.checkDraftsWithStatus) {
          if ("FAILED" === e.videoStatus)
            return (
              t.statusInfo.setStatus(
                UI.SavedDraftVideoStatusInfo.VIDEO_STATUS.FAILED
              ),
              void t._clearInterval()
            );
          if ("SUCCESS" !== e.videoStatus) return;
        } else if (e.videoPreviewStatus === !1) return;
        t.setVideoPreview(e.previewVideo.url),
          t._createThumbnailChild(),
          (t.timeTook = performance.now() - t.timeTook),
          Helpers.GlobalEventTracker.track("SavedDraftAdded", {
            error: !1,
            timeTook: t.timeTook,
          }),
          t.statusInfo.setStatus(
            UI.SavedDraftVideoStatusInfo.VIDEO_STATUS.SUCCESS
          ),
          t._clearInterval();
      },
      _requestDeletion: function () {},
      setVideoPreview: function (e) {
        this.$video.attr("data-src", e), this.$video.attr("src", e);
      },
      _createThumbnailChild: function () {
        this.appendChild(
          new UI.PreviewThumbnail({
            name: "thumbnail" + this.id,
            element: this.element,
            thumbContainer: $(this.element.find("a")[0]),
            useOffsetInHelpText: !0,
            disablePreviewOverlay: !0,
          })
        );
      },
      getIndex: function () {
        return this.element.attr("data-slick-index");
      },
      remove: function (e, t) {
        var n = this;
        clearInterval(n.interval), clearTimeout(n._timeout);
        var i = function () {
          "function" == typeof t && t(), n.destroy();
        };
        return e > 0
          ? (this.element.fadeOut(e, i), this)
          : (this.element.hide(), i(), this);
      },
      fadeOut: function (e, t) {
        var n = this;
        clearInterval(n.interval), clearTimeout(n._timeout);
        var i = function () {
          "function" == typeof t && t();
        };
        return e > 0
          ? (this.element.fadeOut(e, i), this)
          : (this.element.hide(), i(), this);
      },
      disableRemoveButton: function () {
        this.$removeButton.attr("disabled", !0);
      },
      enableRemoveButton: function () {
        this.$removeButton.attr("disabled", !1);
      },
      hidePreview: function () {
        this["thumbnail" + this.id] &&
          this["thumbnail" + this.id].hidePreview();
      },
    },
  }),
  Class(UI, "SavedDraftsContainer")
    .inherits(Widget)
    .includes(
      BubblingSupport,
      SaveDraftSupport
    )({
    html: '<div class="saved-drafts-container">            <div class="saved-drafts-title">Your <strong>Saved Drafts (<span class="saved-drafts-count">0</span>)</strong></div>            <div class="saved-drafts-grid"></div>        </div>',
    prototype: {
      itemsCount: 0,
      itemToBeDeleted: null,
      synchronizing: !1,
      gridConfig: {
        mobile: {
          columns: 2,
        },
        desktop: {
          columns: 6,
        },
        "xl-desktop": {
          columns: 7,
        },
      },
      mobileMaxWidth: 1024,
      desktopMaxWidth: 2599,
      containerSize: 250,
      init: function (e) {
        var t = this;
        Widget.prototype.init.call(this, e),
          (this.$title = this.element.find(".saved-drafts-title")),
          this.buildContainer(),
          this._updateCountInDOM(),
          t._imagesLoaded().then(function () {
            t.dispatch("contentReady", {
              originalDispatcher: t,
            }),
              t.showMoreContainer.show(),
              t._updateContainerSize();
          }),
          t._updateLayout(),
          t._bindEvents();
      },
      buildContainer: function () {
        var e = this;
        this.$saveDraftGrid = this.element.find(".saved-drafts-grid");
        var t = this.$saveDraftGrid.find(".carousel-item"),
          n = new UI.ShowMoreContainer({
            name: "showMoreContainer",
            size: this.containerSize,
          });
        e.appendChild(n).render(e.element);
        var i = new Widget({
          name: "layoutContainer",
          element: this.$saveDraftGrid,
        });
        return (
          n.addComponent(i),
          (this.layoutContainer = i),
          t.each(function (t, n) {
            var i = $(n).data("draftId"),
              r = new UI.SavedDraftItem({
                name: "draft" + i,
                element: $(n),
                index: t,
                id: i,
              });
            e.layoutContainer.appendChild(r),
              r.bind("delete", function (t) {
                e._onRemoveDraftItemRequest(t.data.id);
              }),
              r.bind("preview.shown", function () {
                e.hidePreviews(this);
              }),
              e.itemsCount++;
          }),
          t.length > 0 && this.element.css("display", "block"),
          this
        );
      },
      _updateContainerSize: function () {
        var e = this.getDraftsRendered()[0];
        if (e) {
          var t = $(e.element).outerHeight();
          this.showMoreContainer.changeContainerSize(t);
        }
      },
      hidePreviews: function (e) {
        this.layoutContainer.children.forEach(function (t) {
          t.element.find(".video-status-info").length > 0 ||
            (e && t.name === e.name) ||
            t.hidePreview();
        });
      },
      _bindEvents: function () {
        var e = this;
        if (Helpers.App.isLoggedIn() === !1) {
          var t = function () {
            e._handleUserLogin(), UI.Navigation.NavBar.unbind("user:login", t);
          };
          UI.Navigation.NavBar.bind("user:login", t);
        }
        this.layoutContainer.bind("loadDraftImage", function () {
          e.$saveDraftGrid.hasClass("sync") &&
            e.$saveDraftGrid.removeClass("sync"),
            e._updateContainerSize();
        });
      },
      updateStatus: function () {
        (this.itemsCount =
          this.getDraftsRendered().length -
          this.getDraftsRendered().filter(this._isHiddenDraft).length),
          this.dispatch("savedDraftCount", {
            count: this.itemsCount,
            add: !1,
          }),
          this._updateCountInDOM(),
          this._updateLayout(),
          0 === this.layoutContainer.children.length &&
            this.synchronizing === !1 &&
            this.$title.hide();
      },
      _updateCountInDOM: function () {
        (this.$savedDraftsCount = this.element.find(".saved-drafts-count")),
          0 !== this.$savedDraftsCount.length &&
            this.$savedDraftsCount.html(this.itemsCount);
      },
      addDraftItem: function (e) {
        var t,
          n,
          i,
          r,
          s = this;
        (t = e.id),
          (n = e.previewImage.url),
          (i = e.params),
          (r = e.hasVideo),
          this.element.css("display", "block");
        var o = new UI.SavedDraftItem({
          name: "draft" + t,
          index: this.layoutContainer.children.length,
          id: t,
          previewImage: n,
          params: i,
          hasVideo: r,
        });
        this.layoutContainer.appendChild(o),
          o.render(this.$saveDraftGrid, !0),
          o.bind("delete", function (e) {
            s._onRemoveDraftItemRequest(e.data.id);
          }),
          o.bind("preview.shown", function () {
            s.hidePreviews(this);
          }),
          this.itemsCount++,
          this._updateCountInDOM(),
          this._updateLayout(),
          this._updateContainerSize(),
          this.$title.show(),
          this.dispatch("savedDraftCount", {
            count: this.itemsCount,
            add: !0,
          });
      },
      _updateLayout: function () {
        var e = $(window).width();
        this.itemsCount > this._getColumnsPerRow(e)
          ? this._setGridLayout()
          : this._setListLayout();
      },
      _setGridLayout: function () {
        this.showMoreContainer.showLoadMoreButtonContainer(),
          this.$saveDraftGrid.addClass("grid-layout");
      },
      _setListLayout: function () {
        this.showMoreContainer.hideLoadMoreButtonContainer(),
          this.$saveDraftGrid.removeClass("grid-layout");
      },
      _getColumnsPerRow: function (e) {
        var t = "desktop";
        return (
          Helpers.App.isMobile() && (t = "mobile"),
          e > this.desktopMaxWidth && (t = "xl-desktop"),
          this.gridConfig[t].columns
        );
      },
      syncSavedDraftsItems: function (e) {
        var t = this,
          n = [];
        t._removeHiddenDrafts(), (n = t.getDraftsRendered());
        var i = e
            .map(function (e) {
              return e.id;
            })
            .sort(function (e, t) {
              return e - t;
            })
            .toString(),
          r = n
            .map(function (e) {
              return e.id;
            })
            .sort(function (e, t) {
              return e - t;
            })
            .toString();
        i !== r &&
          (t.$saveDraftGrid.css(
            "height",
            t.layoutContainer.element.outerHeight()
          ),
          t.$saveDraftGrid.addClass("sync"),
          (t.synchronizing = !0),
          n.forEach(function (e) {
            t._removeDraft(e);
          }),
          (t.itemsCount = 0),
          e.forEach(function (e) {
            t.addDraftItem(e);
          }),
          t.$saveDraftGrid.css("height", "auto"),
          (t.synchronizing = !1),
          t.updateStatus());
      },
      _removeHiddenDrafts: function () {
        var e = this,
          t = e.getDraftsRendered(),
          n = Utils.bindFn(this);
        t.filter(e._isHiddenDraft).forEach(n(e._removeDraft));
      },
      _isHiddenDraft: function (e) {
        return "none" === e.element.css("display");
      },
      _removeDraft: function (e) {
        var t = this,
          n = t.layoutContainer;
        n.removeChild(e), e.destroy();
      },
      getDraftsRendered: function () {
        var e = this;
        return e.layoutContainer.children.filter(function (t) {
          return e._isSavedDraftItem(t);
        });
      },
      removeDraftItem: function (e) {
        var t = this,
          n = Utils.bindFn(this),
          i = function (n) {
            t._hideRemovedDraft(e, n);
          };
        return (
          e.disableRemoveButton(),
          Draft.remove(e.id)
            .then(i)
            .then(n(this._requestSync))
            ["catch"](function (n) {
              404 !== n.status
                ? (e.enableRemoveButton(),
                  t.dispatch("removeDraft.error", {
                    errorMessage:
                      "Sorry but we couldn't delete your draft. Please try again later",
                  }))
                : t.dispatch("syncDrafts", {
                    action: "deleted",
                    success: !1,
                    error: n,
                  });
            })
        );
      },
      find: function (e, t, n) {
        return e.children.filter(function (e) {
          return e[t] === n;
        })[0];
      },
      _hideRemovedDraft: function (e, t) {
        var n = this;
        return new Promise(function (i) {
          var r = function () {
            n.updateStatus(), i(t);
          };
          e.element ? e.fadeOut(250, r) : r();
        });
      },
      _requestSync: function (e) {
        this.dispatch("syncDrafts", {
          action: "deleted",
          success: !0,
          response: e,
        });
      },
      _onRemoveDraftItemRequest: function (e) {
        var t = new Date().getTime();
        if (
          window.confirm("This draft will be forever deleted.") === !0 ||
          new Date().getTime() - t <= 3
        ) {
          var n = this.find(this.layoutContainer, "id", e);
          if (!n) return;
          this.dispatch("removeSavedDraft"), this.removeDraftItem(n);
        }
      },
      _isSavedDraftItem: function (e) {
        return "SavedDraftItem" === e.constructor.className;
      },
      _handleUserLogin: function () {
        var e = this;
        Draft.findByStageId(Helpers.StageType.getStageID()).then(function (t) {
          t.forEach(function (t) {
            e.addDraftItem(t), e.$title.show();
          });
        });
      },
      getDraftCount: function () {
        return this.itemsCount;
      },
      getOffSet: function () {
        return this.element.offset();
      },
      _imagesLoaded: function () {
        var e = this.element.find("img.thumb-image"),
          t = [];
        return (
          e.each(function (e, n) {
            var i = new Image();
            t.push(
              new Promise(function (e, t) {
                i.addEventListener("load", e, !1),
                  i.addEventListener("error", t, !1);
              })
            ),
              (i.src = n.getAttribute("data-src"));
          }),
          P.allSettled(t).then(function () {
            e.each(function (e, t) {
              t.src = t.getAttribute("data-src");
            });
          })
        );
      },
    },
  }),
  Module("UiJsonMapper")({
    _originalSourceUiData: null,
    _originalTargetUiData: null,
    keysToAlwaysMap: ["customRule", "layers", "color"],
    keysToNeverMap: ["name"],
    prototype: {
      init: function (e, t) {
        (this._originalSourceUiData = e), (this._originalTargetUiData = t);
      },
      getTags: function (e) {
        e = this._convertToArray(e);
        var t = e.map(function (e) {
          return e.tag;
        });
        return t;
      },
      getTaggedElement: function (e, t) {
        e = this._convertToArray(e);
        var n = e.filter(function (e) {
          return e.tag === t;
        });
        return n.length > 0 ? n[0] : null;
      },
      mapElementsByTags: function (e, t) {
        var n = this,
          i = n.getTags(e),
          r = n.getTags(t);
        n._keysToMap(i, r).forEach(function (i) {
          var r = n.getTaggedElement(e, i),
            s = n.getTaggedElement(t, i);
          "Accent Color" !== r.name.trim() && n._mapElements(r, s);
        });
      },
      _mapElements: function (e, t) {
        var n = this,
          i = Object.keys(e),
          r = Object.keys(t),
          s = n._keysToMap(i, r);
        (s = s.concat(n.constructor.keysToAlwaysMap)),
          s.forEach(function (i) {
            -1 == n.constructor.keysToNeverMap.indexOf(i) && (t[i] = e[i]);
          });
      },
      _deepObjectCopy: function (e) {
        return JSON.parse(JSON.stringify(e));
      },
      _keysToMap: function (e, t) {
        var n = t.filter(function (t) {
          var n = e.indexOf(t);
          return -1 != n ? !0 : !1;
        });
        return n;
      },
      _getNamedElement: function (e, t) {
        var n = e.filter(function (e) {
          return e.name === t;
        });
        return n.length > 0 ? n[0] : null;
      },
      _convertToArray: function (e) {
        return 0 == Array.isArray(e) ? [e] : e;
      },
    },
  }),
  Class("SmartTemplateToAnimatedTemplateMapper").includes(UiJsonMapper)({
    sourceUiData: null,
    targetUiData: null,
    mappedPairs: [
      {
        source: "text",
        target: "text",
      },
      {
        source: "customGraphic",
        target: "images",
      },
      {
        source: "graphic",
        target: "asset_library",
      },
      {
        source: "graphic",
        target: "graphic",
      },
      {
        source: "background",
        target: "asset_library",
      },
      {
        source: "background",
        target: "graphic",
      },
      {
        source: "graphic",
        target: "color_picker",
      },
      {
        source: "backgroundColor",
        target: "color_picker",
      },
    ],
    prototype: {
      map: function () {
        var e = this;
        return (
          (e.sourceUiData = e._deepObjectCopy(e._originalSourceUiData)),
          (e.targetUiData = e._deepObjectCopy(e._originalTargetUiData)),
          e.transferCustomRulesInSourceUi(),
          e.copyComposition(),
          e.copyDefaultColors(),
          e.constructor.mappedPairs.forEach(function (t) {
            var n = e.sourceUiData[t.source],
              i = e.targetUiData[t.target];
            n && i && e.mapElementsByTags(n, i);
          }),
          e.targetUiData
        );
      },
      copyComposition: function () {
        var e = this;
        e.sourceUiData.composition &&
          (e.targetUiData.composition = e._deepObjectCopy(
            e.sourceUiData.composition
          ));
      },
      transferCustomRulesInSourceUi: function () {
        var e = this,
          t = e.sourceUiData;
        t.customRules &&
          0 != t.customRules.length &&
          t.customRules.forEach(function (n) {
            var i = e._getNamedElement(t.text, n.layerName);
            if (i) return void (i.customRule = e._deepObjectCopy(n));
            var r = e._getNamedElement(t.graphic, n.layerName);
            r && (r.customRule = e._deepObjectCopy(n));
          });
      },
      copyDefaultColors: function () {
        var e = this;
        e.sourceUiData.defaultAssetColors &&
          (e.targetUiData.defaultAssetColors = e._deepObjectCopy(
            e.sourceUiData.defaultAssetColors
          ));
      },
    },
  }),
  Class("AnimatedTemplateToSmartTemplateMapper").includes(UiJsonMapper)({
    sourceUiData: null,
    targetUiData: null,
    mappedPairs: [
      {
        source: "text",
        target: "text",
      },
      {
        source: "images",
        target: "customGraphic",
      },
      {
        source: "asset_library",
        target: "graphic",
      },
      {
        source: "graphic",
        target: "graphic",
      },
      {
        source: "asset_library",
        target: "background",
      },
      {
        source: "graphic",
        target: "background",
      },
      {
        source: "color_picker",
        target: "graphic",
      },
      {
        source: "color_picker",
        target: "backgroundColor",
      },
    ],
    prototype: {
      map: function () {
        var e = this;
        return (
          (e.sourceUiData = e._deepObjectCopy(e._originalSourceUiData)),
          (e.targetUiData = e._deepObjectCopy(e._originalTargetUiData)),
          e.copyComposition(),
          e.recreateCustomRulesInSourceUiLayers(),
          e.searchAndRemoveVideoAssets(),
          e.constructor.mappedPairs.forEach(function (t) {
            var n = e.sourceUiData[t.source],
              i = e.targetUiData[t.target];
            n && i && e.mapElementsByTags(n, i);
          }),
          e.targetUiData
        );
      },
      copyComposition: function () {
        var e = this;
        e.sourceUiData.composition &&
          (e.targetUiData.composition = e._deepObjectCopy(
            e.sourceUiData.composition
          ));
      },
      recreateCustomRulesInSourceUiLayers: function () {
        var e = this,
          t = ["text", "images", "graphic", "asset_library"],
          n = [];
        t.forEach(function (t) {
          e.sourceUiData[t].forEach(function (e) {
            e.customRule && (n.push(e.customRule), delete e.customRule);
          });
        }),
          (e.targetUiData.customRules = n);
      },
      searchAndRemoveVideoAssets: function () {
        var e = this,
          t = ["images", "graphic", "asset_library"];
        t.forEach(function (t) {
          e.sourceUiData[t].forEach(function (e) {
            e.selectedLayer &&
              null !== e.selectedLayer &&
              "null" !== e.selectedLayer &&
              (".mp4" === e.selectedLayer.type ||
                ".mov" === e.selectedLayer.type) &&
              ((e.selectedLayer = null), (e.layers = []));
          });
        });
      },
    },
  }),
  Class(UI, "CircularChar").inherits(Widget)({
    elementClass: "circular-char-widget",
    html: "        <svg>            <circle/>            <path/>        </svg>",
    prototype: {
      init: function (e) {
        (this.angleInterval = 4),
          (this.size = 50),
          (this.startAngle = -90),
          (this.angle = this.startAngle),
          (this.mainStroke = 5),
          (this.fillStroke = 10),
          Widget.prototype.init.call(this, e),
          (this.el = this.element[0]),
          (this.svg = this.el),
          (this.circle = this.el.querySelector("circle")),
          (this.path = this.el.querySelector("path")),
          (this.cx = this.size / 2),
          (this.cy = this.size / 2),
          this._createBaseCircle(this.size, this.mainStroke),
          this._createBasePath(this.size, this.fillStroke);
      },
      updateCircleSize: function (e) {
        (this.size = e),
          (this.cx = this.size / 2),
          (this.cy = this.size / 2),
          this._createBaseCircle(this.size, this.mainStroke),
          this._createBasePath(this.size, this.fillStroke);
      },
      updateProgress: function (e) {
        e = this.startAngle + e;
        var t, n, i;
        (t = this.angle),
          (n = function r() {
            var n, s, o, a, l;
            return (
              (t += this.angleInterval),
              t > e
                ? cancelAnimationFrame(i)
                : ((this.angle = t),
                  (this.angle %= 360),
                  (n = (this.angle / 180) * Math.PI),
                  (s = this.cx + Math.cos(n) * this.radius),
                  (o = this.cy + Math.sin(n) * this.radius),
                  (a = this.path.getAttribute("d")),
                  (l = a + " L " + s + " " + o),
                  this.path.setAttribute("d", l),
                  void requestAnimationFrame(r.bind(this)))
            );
          }.bind(this)),
          (i = requestAnimationFrame(n));
      },
      resetProgress: function () {
        return (
          (this.angle = this.startAngle),
          this._createBasePath(this.size, this.fillStroke),
          this
        );
      },
      _createBaseCircle: function (e, t) {
        (e = e || 160), (t = t || 5);
        var n, i;
        (n = e / 2),
          (i = n - t),
          this.svg.setAttribute("width", e),
          this.svg.setAttribute("height", e),
          this.circle.setAttribute("cx", n),
          this.circle.setAttribute("cy", n),
          this.circle.setAttribute("r", i),
          this.circle.setAttribute("fill", "transparent"),
          this.circle.setAttribute("stroke-width", t),
          this.circle.setAttribute("stroke", "#c2c2c2"),
          (n = i = null);
      },
      _createBasePath: function (e, t) {
        (e = e || 160), (t = t || 5);
        var n, n, i, r;
        (n = e / 2),
          (h_stroke = t / 2),
          (i = n - h_stroke),
          (r = "M" + n + "," + h_stroke),
          (this.radius = i),
          this.path.setAttribute("d", r),
          this.path.setAttribute("fill", "transparent"),
          this.path.setAttribute("stroke-width", t),
          this.path.setAttribute("stroke", "#007ecf"),
          (n = h_stroke = i = r = null);
      },
    },
  }),
  Class(UI, "VideoProcessing").inherits(Widget)({
    elementClass: "video_processing absolute-fill",
    html: '        <div>            <h4>                <span class="legend"></span>                <span class="dots">...</span>            </h4>        </div>',
    prototype: {
      errors: 0,
      maxErrors: 20,
      init: function (e) {
        Widget.prototype.init.call(this, e),
          (this.el = this.element[0]),
          (this.text = this.el.querySelector(".legend")),
          this.appendChild(
            new UI.CircularChar({
              name: "char",
              size: this.getCircleSize(),
            })
          ).render(this.element, !0),
          this.updateText("Your Video is Being Prepared!");
      },
      getCircleSize: function () {
        var e = 160;
        if (
          ($(window).width() <= 604 && (e = 100),
          Helpers.StageType.isSmartTemplate())
        )
          return (e = 45);
        var t = this.element.parent(),
          n = t.outerHeight(),
          i = t.outerWidth();
        return (
          i >= n && 160 >= i / 2 && (e = i / 2),
          n >= n && 160 >= n / 2 && (e = n / 2),
          e
        );
      },
      increaseErrors: function () {
        return this.errors++, this;
      },
      updateText: function (e) {
        return $(this.text).html(e), this;
      },
      updateChar: function (e) {
        return this["char"].updateProgress(e), this;
      },
      resetChar: function () {
        this["char"].resetProgress();
        var e = this,
          t = setInterval(function () {
            var n = e.getCircleSize();
            n && clearInterval(t), e["char"].updateCircleSize(n);
          }, 500);
        return this;
      },
      show: function () {
        return Widget.prototype.show.call(this), (this.errors = 0), this;
      },
    },
  }),
  Class(UI, "VideoProductController").includes(
    CustomEventSupport,
    NodeSupport
  )({
    MAX_SECONDS_FOR_POLLING: 500,
    TRESHOLD_FOR_UPDATING_LOADER: 100,
    PERCENTAGE_TO_SHOW_WHEN_ON_QUEUE: 30,
    POLLING_INTERVAL: 1e3,
    prototype: {
      videoProductID: null,
      timePollStarted: null,
      timerID: null,
      videoProductProcessed: !1,
      videoProcessingText: null,
      successMessage: null,
      initialMessage: null,
      defaultVideoProcessingText: "Processing All Slides",
      _lastQueueValue: null,
      _processCompletion: 0,
      init: function (e) {
        return (
          Widget.prototype.init.call(this, e),
          this.appendChild(
            new UI.VideoProcessing({
              name: "videoUploadScreen",
            })
          ),
          this
        );
      },
      startPolling: function (e, t) {
        (this.videoProductID = e),
          Helpers.StageType.setVideoProductUUID(t),
          (this.timePollStarted = new Date()),
          (this._lastQueueValue = null),
          this.poll();
      },
      poll: function () {
        var e = this;
        (this.path = this.path || "/video_products/"),
          $.ajax({
            method: "GET",
            url: e.path + e.videoProductID,
            success: this.handleSuccessPoll.bind(e),
            error: function () {
              e.dispatchError();
            },
          });
      },
      _dispatchEventForMissingUiJson: function (e) {
        return (
          clearTimeout(this.timerID),
          this.hideLoader({
            error: "Sorry but this template could not be loaded!",
            videoproduct: e,
          }),
          this.dispatch("videoProduct:uiJson.error"),
          this
        );
      },
      handleSuccessPoll: function (e) {
        var t,
          n,
          i = this.getSecondsSinceProcessingStarted(),
          r = this.constructor.PERCENTAGE_TO_SHOW_WHEN_ON_QUEUE,
          s = this.constructor.MAX_SECONDS_FOR_POLLING,
          o = this.constructor.TRESHOLD_FOR_UPDATING_LOADER;
        switch (((this._lastQueueValue = e.queue), this._lastQueueValue)) {
          case null:
            this._dispatchEventForMissingUiJson(e);
            break;
          case -2:
            this.updateText(),
              (this._processCompletion = 36),
              this.videoUploadScreen.updateChar(this._processCompletion);
            break;
          case 0:
            if (
              (this.timePollStarted || (this.timePollStarted = new Date()),
              (t = (i * ((100 - r) / 10)) / (o / 10) + r),
              (this._processCompletion = (360 * t) / 100),
              this._processCompletion > 360 && (this._processCompletion = 360),
              this.videoUploadScreen.updateChar(this._processCompletion),
              this.updateText(),
              this.getSecondsSinceProcessingStarted() > s)
            )
              return this.dispatchError(
                e,
                "Processing Is Taking Longer Than Usual, Please Try Again Later"
              );
            break;
          case -1:
            return (
              (n = Helpers.StageType.getStageInfo()),
              (n.video = {
                url: e.video.url,
              }),
              (n.pl_id = e.id),
              Helpers.StageType.isVideoV4() &&
                Helpers.StageType.setStageInfo(n),
              this.dispatch("videoproduct.processed", {
                videoproduct: e,
              }),
              (this._processCompletion = 360),
              this.videoUploadScreen.updateChar(this._processCompletion),
              this.updateText(),
              (this.videoProductProcessed = !0),
              setTimeout(
                function () {
                  return (
                    (this._lastQueueValue = null),
                    this.videoUploadScreen.updateText(""),
                    this.hideLoader({
                      success: !0,
                      videoproduct: e,
                    })
                  );
                }.bind(this),
                1e3
              )
            );
          default:
            (this.timePollStarted = new Date()),
              (this._processCompletion =
                (360 * this.constructor.PERCENTAGE_TO_SHOW_WHEN_ON_QUEUE) /
                100),
              this.videoUploadScreen.updateChar(this._processCompletion),
              -3 === e.queue &&
                (this.updateText(), this.resetPollStartedTime()),
              e.queue < -3 && (this.updateText(), this.resetPollStartedTime()),
              1 === e.queue && this.updateText(),
              e.queue > 1 && this.updateText();
        }
        this.timerID = setTimeout(
          this.poll.bind(this),
          this.constructor.POLLING_INTERVAL
        );
      },
      dispatchError: function (e, t) {
        (t =
          t ||
          "Your Stage Couldn't Be Processed Right Now, Please Try Again Later"),
          clearTimeout(this.timerID),
          this.hideLoader({
            error: t,
            videoproduct: e,
          });
        var n = this;
        return (
          this.dispatch("stage.error", {
            error: t,
            process_id: n.videoProductID,
            videoproduct: e,
            errorType: "processing",
          }),
          this
        );
      },
      showLoader: function (e) {
        return (
          (e && 0 !== e.length) || (e = this.element),
          this.initialMessage &&
            this.videoUploadScreen.updateText(this.initialMessage),
          this.videoUploadScreen.render(e).show(),
          (this._processCompletion = 0),
          this.videoUploadScreen.resetChar(),
          this.isSmartVideoproduct || this.updateText(),
          this.dispatch("videoproduct.loading"),
          (this.videoProductProcessed = !1),
          this
        );
      },
      hideLoader: function (e) {
        return (
          (this._processCompletion = 0),
          this.videoUploadScreen.resetChar(),
          this.videoUploadScreen.element.detach(),
          this.dispatch("videoproduct.hidden", e),
          this
        );
      },
      updateText: function () {
        var e = "";
        switch (this._lastQueueValue) {
          case null:
            e = this.isSmartVideoproduct
              ? this.initialMessage || ""
              : "Uploading Your Image";
            break;
          case -2:
            this.isSmartVideoproduct || (e = "Cropping Your Image");
            break;
          case 0:
            e = this.videoProcessingText || this.defaultVideoProcessingText;
            break;
          case -1:
            e = this.successMessage || "Your Video Was Successfully Processed";
            break;
          case -3:
            e = "You Have 1 Pending Job";
            break;
          case 1:
            e = "There Is 1 User Ahead of You";
        }
        this._lastQueueValue < -3 &&
          (e =
            "You Have " + -1 * (this._lastQueueValue - -2) + " Pending Jobs"),
          this._lastQueueValue > 1 &&
            (e = "There Are " + this._lastQueueValue + " Users Ahead of You"),
          this.videoUploadScreen.updateText(e);
      },
      getSecondsSinceProcessingStarted: function () {
        return (new Date().getTime() - this.timePollStarted.getTime()) / 1e3;
      },
      resetPollStartedTime: function () {
        this.timePollStarted = new Date();
      },
    },
  }),
  Class(UI, "ATVideoProductController")
    .inherits(UI.VideoProductController)
    .includes(
      CustomEventSupport,
      NodeSupport
    )({
    prototype: {
      init: function (e) {
        UI.VideoProductController.prototype.init.call(this, e);
      },
      updateText: function () {
        var e = "";
        this._processCompletion >= 0 &&
          this._processCompletion < 90 &&
          (e = "Processing..."),
          this._processCompletion >= 90 &&
            this._processCompletion < 180 &&
            (e = "Animating..."),
          this._processCompletion >= 180 &&
            this._processCompletion < 270 &&
            (e = "Rendering..."),
          this._processCompletion >= 270 && (e = "Wrapping Up..."),
          this.videoUploadScreen.updateText(e);
      },
    },
  }),
  Class("UiJsonPresetMerge")({
    ALLOWED_FONTS_LIMIT: 84,
    _mergeJsonSections: function (e, t, n) {
      var i,
        r,
        s = {},
        o = {};
      return (
        n.sections.forEach(function (a) {
          (s[a] = UiJsonPresetMerge._reformatToIndex(e[a], n.indexKey)),
            (o[a] = UiJsonPresetMerge._reformatToIndex(t[a], n.indexKey)),
            (i = Object.keys(s[a])),
            (r = Object.keys(o[a])),
            i
              .filter(function (e) {
                return r.indexOf(e) >= 0;
              })
              .forEach(function (e) {
                n.properties.forEach(function (t) {
                  if (Array.isArray(s[a][e][t]) && !n.overrideArray)
                    UiJsonPresetMerge._selectMergeArray(s[a][e][t], o[a][e][t]);
                  else {
                    if ("text" === a && "sizes" === t) return;
                    if ("preconfiguredSearch" === t && !o[a][e][t]) return;
                    s[a][e][t] = o[a][e][t];
                  }
                });
              });
        }),
        e
      );
    },
    _jsonTextSectionMerge: function (e, t, n) {
      var i,
        r,
        s = {},
        o = {};
      return (
        n.sections.forEach(function (a) {
          (s[a] = UiJsonPresetMerge._reformatToIndex(e[a], n.indexKey)),
            (o[a] = UiJsonPresetMerge._reformatToIndex(t[a], n.indexKey)),
            (i = Object.keys(s[a])),
            (r = Object.keys(o[a])),
            i
              .filter(function (e) {
                return r.indexOf(e) >= 0;
              })
              .forEach(function (e) {
                n.properties.forEach(function (t) {
                  if ("allowedFonts" === t) {
                    var n = s[a][e][t],
                      i = o[a][e][t],
                      r = s[a][e].font,
                      l = UiJsonPresetMerge._findFontInArray(n, r);
                    (n = UiJsonPresetMerge._concatenateToUniqueArray(i, n)),
                      (n = UiJsonPresetMerge._trimArrayToSize(
                        n,
                        UiJsonPresetMerge.ALLOWED_FONTS_LIMIT
                      )),
                      void 0 === UiJsonPresetMerge._findFontInArray(n, r) &&
                        n.unshift(l),
                      (s[a][e][t] = n);
                  } else s[a][e][t] = o[a][e][t];
                });
              });
        }),
        e
      );
    },
    _findFontInArray: function (e, t) {
      var n = e.filter(function (e) {
        return e.name === t;
      });
      return n.length > 0 ? n[0] : void 0;
    },
    _trimArrayToSize: function (e, t) {
      for (var n = e.length - t, i = 0; n > i; i++) e.pop();
      return e;
    },
    _concatenateToUniqueArray: function (e, t) {
      var n = e.concat(t);
      return (n = Helpers.App.arrayObjUnique(n, "name"));
    },
    _reformatToIndex: function (e, t) {
      var n = {};
      return void 0 === e && void 0 === t
        ? n
        : (n = Array.isArray(e)
            ? UiJsonPresetMerge._generateIndexFromArray(e, {
                indexKey: t,
              })
            : UiJsonPresetMerge._generateIndexFromArray(
                [e].filter(function (e) {
                  return e;
                }),
                {
                  indexKey: t,
                }
              ));
    },
    _generateIndexFromArray: function (e, t) {
      var n,
        i = {};
      return (
        (t = t || {}),
        (n = t.indexKey),
        (e || []).forEach(function (e) {
          n ? (i[e[n]] = e) : (i[e.id || e.name] = e),
            t.getSelected && e.visible === !0 && (i[t.getSelected.token] = e);
        }),
        i
      );
    },
    _selectMergeArray: function (e, t) {
      var n,
        i = {},
        r = {},
        s = "__selected__";
      return (
        (i = UiJsonPresetMerge._generateIndexFromArray(e, {
          getSelected: {
            token: s,
          },
        })),
        (r = UiJsonPresetMerge._generateIndexFromArray(t, {
          getSelected: {
            token: s,
          },
        })),
        !r.hasOwnProperty(s) && i.hasOwnProperty(s)
          ? void (i[s].visible = !1)
          : void (
              r.hasOwnProperty(s) &&
              ((n = r[s].id || r[s].name),
              i.hasOwnProperty(n) &&
                (i.hasOwnProperty(s) && (i[s].visible = !1),
                (i[n].visible = !0)))
            )
      );
    },
    mergeUiJson: function (e, t) {
      return (
        UiJsonPresetMerge._mergeJsonSections(e, t, {
          sections: ["graphic", "background"],
          properties: [
            "color",
            "visible",
            "preconfiguredSearch",
            "layers",
            "selectedLayer",
          ],
        }),
        UiJsonPresetMerge._jsonTextSectionMerge(e, t, {
          sections: ["text"],
          properties: [
            "color",
            "font",
            "fontFamily",
            "justification",
            "capitalization",
            "contents",
            "allowedFonts",
            "sizes",
            "visible",
          ],
        }),
        UiJsonPresetMerge._mergeJsonSections(e, t, {
          sections: ["backgroundColor"],
          properties: ["color", "visible", "layers"],
        }),
        e.composition &&
          UiJsonPresetMerge._mergeJsonSections(e, t, {
            sections: ["composition"],
            properties: Object.keys(e.composition),
          }),
        t.size && (e.size = t.size),
        t.previewImage && (e.previewImage.value = t.previewImage.value),
        t.defaultAssetColors && (e.defaultAssetColors = t.defaultAssetColors),
        t.customRules &&
          t.customRules.length &&
          (e.customRules = t.customRules),
        e
      );
    },
    mergeUiJsonVideo: function (e, t) {
      var n,
        i,
        r = {},
        s = {};
      return (
        (n = JSON.parse(JSON.stringify(e))),
        (i = JSON.parse(JSON.stringify(t))),
        UiJsonPresetMerge._mergeJsonSections(n, i, {
          sections: ["video"],
          properties: [
            "type",
            "visible",
            "layers",
            "allowColorpicker",
            "allowSearch",
            "excludable",
            "nodeName",
            "selectedLayer",
            "preconfiguredSearch",
            "color",
          ],
        }),
        UiJsonPresetMerge._mergeJsonSections(n, i, {
          sections: ["graphic", "background"],
          properties: [
            "color",
            "visible",
            "preconfiguredSearch",
            "layers",
            "selectedLayer",
          ],
        }),
        UiJsonPresetMerge._mergeJsonSections(n, i, {
          sections: ["images"],
          indexKey: "nodeName",
          overrideArray: !0,
          properties: ["width", "height", "name", "required", "layers"],
        }),
        UiJsonPresetMerge._mergeJsonSections(n, i, {
          sections: ["asset_library"],
          properties: [
            "color",
            "visible",
            "preconfiguredSearch",
            "layers",
            "selectedLayer",
          ],
        }),
        UiJsonPresetMerge._mergeJsonSections(n, i, {
          sections: ["color_picker"],
          properties: ["color", "limited_colors", "nodeName"],
        }),
        UiJsonPresetMerge._jsonTextSectionMerge(n, i, {
          sections: ["text"],
          properties: [
            "color",
            "font",
            "fontFamily",
            "justification",
            "capitalization",
            "contents",
            "allowedFonts",
            "sizes",
            "visible",
          ],
        }),
        UiJsonPresetMerge._mergeJsonSections(n, i, {
          sections: ["backgroundColor"],
          properties: ["color", "visible", "layers"],
        }),
        UiJsonPresetMerge._mergeJsonSections(n, i, {
          sections: ["audio"],
          properties: ["track"],
        }),
        n.options &&
          i.options &&
          ((r = UiJsonPresetMerge._generateIndexFromArray(n.options)),
          (s = UiJsonPresetMerge._generateIndexFromArray(i.options)),
          i.options.forEach(function (e) {
            r.hasOwnProperty(e.id) &&
              (r[e.id].selectedOptions = e.selectedOptions);
          })),
        i._slideData && (n._slideData = i._slideData),
        i.defaultAssetColors && (n.defaultAssetColors = i.defaultAssetColors),
        n
      );
    },
  }),
  Class("IframePool")({
    _instance: null,
    getInstance: function () {
      return IframePool._instance
        ? IframePool._instance
        : ((IframePool._instance = new IframePool()), IframePool._instance);
    },
    prototype: {
      minIframes: 1,
      maxIframes: 3,
      _iframeCollection: [],
      pendingRequests: [],
      init: function (e) {
        $.extend(this, e),
          this._iframeCollection.push(this._createIframe()),
          this._iframeCollection.push(this._createIframe()),
          this._iframeCollection.push(this._createIframe());
      },
      get: function (e) {
        var t = this._getIdleIframe();
        return t
          ? (t.data("idle", !1), e(t))
          : void this.pendingRequests.push(e);
      },
      destroyIframe: function (e) {
        var t = e[0].contentWindow;
        t.engine && t.engine.destroy(),
          delete t.engine,
          delete t.wrapper,
          delete t.RuleClass,
          delete t.layer,
          delete t.parent,
          delete t.app,
          (t.app = {
            activeDocument: {},
          }),
          delete t.texts,
          delete t.effect,
          delete t.canvas,
          delete t.globalThis,
          delete t.window,
          delete t.self,
          e.data("idle", !0),
          this.pendingRequests.length && this.get(this.pendingRequests.pop());
      },
      _getIdleIframe: function () {
        var e = this._iframeCollection.find(function (e) {
          return e.data("idle");
        });
        return e
          ? e
          : this._iframeCollection.length === this.maxIframes
          ? null
          : ((e = this._createIframe()), this._iframeCollection.push(e), e);
      },
      _createIframe: function () {
        var e = this,
          t = $("<iframe></iframe>");
        t.attr("id", performance.now()),
          t.addClass("off-screen"),
          t.appendTo("body"),
          (t[0].src = "/simple_engine");
        var n = function (i) {
          var r = t[0].contentWindow;
          r === i.source &&
            (window.removeEventListener("message", n),
            t.data("idle", !0),
            e.pendingRequests.length && e.get(e.pendingRequests.pop()));
        }.bind(this);
        return window.addEventListener("message", n), t;
      },
    },
  }),
  Class("IframeProcessWrapper").includes(CustomEventSupport)({
    prototype: {
      _iframe: null,
      _nginWrapper: null,
      _originalUiJSON: null,
      _smartTemplateId: null,
      isReady: !1,
      _pendingProcess: null,
      init: function (e) {
        var t = this;
        (this._originalUiJSON = e.uiJSON),
          (this._smartTemplateId = e.uiJSON.id),
          IframePool.getInstance().get(this._onIframeLoad.bind(this)),
          (this.isReady = !1),
          (this._pendingProcess = null),
          (this._debounceErrorFunction = Helpers.App.debounce(function () {
            t.dispatch("engineError");
          }, 2e3));
      },
      _onIframeLoad: function (e) {
        this._iframe = e;
        var t = this._iframe[0];
        (this._nginWrapper = t.contentWindow.wrapper),
          this._nginWrapper ||
            ((t.wrapper = new t.contentWindow.SimpleEngineWrapper()),
            (this._nginWrapper = t.wrapper)),
          this._nginWrapper.setErrorCallback(this._onIframeError.bind(this)),
          this._nginWrapper.setSmartTemplateId(this._smartTemplateId),
          this._nginWrapper.setEnvironment(window.environment),
          this._nginWrapper.fetchStructure(
            "",
            this._onStructureFetch.bind(this)
          );
      },
      _onStructureFetch: function (e) {
        JSON.parse(JSON.stringify(e));
        (this._nginWrapper._structureJSON = e),
          this._nginWrapper.bootstrap(
            this._originalUiJSON,
            null,
            this._onBootstrap.bind(this)
          );
      },
      _onBootstrap: function () {
        (this.isReady = !0),
          this._pendingProcess && this.dispatch("engineReady");
      },
      process: function (e) {
        var t = this;
        return (
          (this._pendingProcess = e),
          this._processPromise
            ? this._processPromise
            : ((this._processPromise = new Promise(function (e, n) {
                var i = function () {
                    t._nginWrapper.process(
                      t._pendingProcess,
                      function (n) {
                        e(n), (t._processPromise = null);
                      },
                      function () {
                        n(), (t._processPromise = null);
                      }
                    ),
                      t.unbind("engineReady", i);
                  },
                  r = function () {
                    t.unbind("engineError", r), n(), (t._processPromise = null);
                  };
                t.bind("engineError", r),
                  t.isReady ? i() : t.bind("engineReady", i);
              })),
              this._processPromise)
        );
      },
      _onIframeError: function () {
        this._debounceErrorFunction();
      },
      destroy: function () {
        (this._originalUiJSON = null),
          (this._smartTemplateId = null),
          (this._pendingProcess = null),
          IframePool.getInstance().destroyIframe(this._iframe);
      },
    },
  }),
  (UI.AnimatedTemplates = {}),
  Class(UI.AnimatedTemplates, "Linker").includes(
    CustomEventSupport,
    UiJsonSupport,
    CDNSupport,
    FetchLayersSupport,
    CleanRecordSupport,
    VideoS3BucketSupport
  )({
    PROCESS_URL: {
      // development: "https://smart-templates.us/api/v4/jobs/",
      // staging: "https://smart-templates.us/api/v4/jobs/",
      // production: "https://nicev2.placeit.net/api/v4/jobs/",
      // development: "https://smart-templates.us/api/v4/jobs/",
      // staging: "https://smart-templates.us/api/v4/jobs/",
      production: "http://localhost:9999/api/v4/jobs",
    },
    prototype: {
      imageUiJSON: null,
      videoUiJSON: null,
      mappedUiJSON: null,
      lastMappingTime: null,
      lastChangeTime: null,
      _iframeWrapper: null,
      _isAlternateVideo: !1,
      _mappedSlideIndex: 0,
      _lastVideoPreviewUrl: null,
      _lastProcessedMappedUiJSONHash: null,
      init: function (e) {
        var t = this;
        if (
          ((this._isAlternateVideo = 13 === _stageData.stage_data.image_type),
          this._isAlternateVideo)
        ) {
          (this.imageUiJSON = e.stageUiJSON),
            this._getAlternateUiJSON().then(function (e) {
              (e.defaultAssetColors = e.defaultAssetColors || []),
                t._fetchAndSetAssetLayersForUiJson(e).then(function () {
                  t.videoUiJSON = e;
                  var n = window.linked_video_preview_for_animated_templates;
                  t.dispatch("allUiJsonsReady", n);
                });
            });
          var n = new URL(window.location.href),
            i = n.searchParams.get("video_stateId");
          if (i) {
            var r = n.origin + n.pathname,
              s = n.search.split("&").filter(function (e) {
                return /video_stateId/.test(e) === !1;
              }),
              o = r + s.join("&");
            window.history.replaceState(null, null, o);
            var a = ["/stateid/", i].join("");
            $.ajax({
              url: a,
              method: "GET",
              async: !1,
              success: t._videoLastStateIdLoaded.bind(t),
            });
          }
        } else
          (this.videoUiJSON = e.stageUiJSON),
            this._getAlternateUiJSON().then(function (e) {
              (e.defaultAssetColors = e.defaultAssetColors || []),
                t._fetchAndSetAssetLayersForUiJson(e).then(function () {
                  t.imageUiJSON = e;
                  var n = null;
                  if (e.previewImage) {
                    var i = "";
                    e.previewImage.type
                      ? (i =
                          "data:" +
                          e.previewImage.type +
                          ";base64," +
                          e.previewImage.value)
                      : ((i =
                          t._cdnBasePath() +
                          "/smart_templates/" +
                          window.linked_template_id_for_animated_templates),
                        (i += "/" + e.previewImage.value)),
                      (n = i);
                  }
                  IntegrityCheck.checkCapability() &&
                    (t._iframeWrapper = new IframeProcessWrapper({
                      uiJSON: t.imageUiJSON,
                    })),
                    (t.processUrl =
                      UI.AnimatedTemplates.Linker.PROCESS_URL[
                        window.environment
                      ]),
                    t.dispatch("allUiJsonsReady", n);
                });
            });
        this.lastChangeTime = this.lastMappingTime = Date.now();
      },
      _videoLastStateIdLoaded: function (e) {
        var t = decodeURIComponent(JSON.parse(e)),
          n = new URLSearchParams(t);
        this._mappedSlideIndex = n.get("cfid") || 0;
        var i = n.get(this._mappedSlideIndex + "_id"),
          r = n.get(this._mappedSlideIndex + "_from"),
          s = n.get("slidesCollection"),
          o = new RegExp("&*" + this._mappedSlideIndex + "_[^&]*", "g"),
          a = new RegExp("&slidesCollection=[^&]*", "g");
        if (
          ((this._urlWithoutMappedSlideParams = t
            .replace(o, "")
            .replace(/\?/, "&")
            .replace(a, "")),
          r)
        ) {
          var l = "&" + this._mappedSlideIndex + "_from=" + r,
            c = "";
          "&" !== this._urlWithoutMappedSlideParams[0] && (c = "&"),
            (this._urlWithoutMappedSlideParams =
              l + c + this._urlWithoutMappedSlideParams);
        }
        if (i) {
          var l = "&" + this._mappedSlideIndex + "_id=" + i,
            c = "";
          "&" !== this._urlWithoutMappedSlideParams[0] && (c = "&"),
            (this._urlWithoutMappedSlideParams =
              l + c + this._urlWithoutMappedSlideParams);
        }
        if (s) {
          var l = "&slidesCollection=" + s,
            c = "";
          "&" !== this._urlWithoutMappedSlideParams[0] && (c = "&"),
            (this._urlWithoutMappedSlideParams =
              l + c + this._urlWithoutMappedSlideParams);
        }
        var u = this._urlWithoutMappedSlideParams.split("&"),
          d = u.filter(function (e) {
            return e.match(/\d\d*_(id|from)/);
          });
        d = d.sort(function (e, t) {
          var n = parseInt(e.split("_")[0]),
            i = parseInt(t.split("_")[0]);
          return n > i ? 1 : -1;
        });
        var h = new RegExp(d.join("&*|") + "&*", "g");
        (this._urlWithoutMappedSlideParams =
          this._urlWithoutMappedSlideParams.replace(h, "")),
          (this._urlWithoutMappedSlideParams += "&" + d.join("&")),
          (this._urlWithoutMappedSlideParams = this._urlWithoutMappedSlideParams
            .replace("pip_slide_index", "&pip_slide_index")
            .replace("pip_slide_id", "&pip_slide_id")
            .replace("last_process_preview", "&last_process_preview")
            .replace(/&&/, "&"));
      },
      generatePreview: function () {
        this._isAlternateVideo
          ? this._generateVideoPreview()
          : this._generateImagePreview();
      },
      _generateImagePreview: function () {
        var e = this;
        if (
          ((this.mappedUiJSON = this._mapChanges()),
          this.mappedUiJSON.graphic &&
            this.mappedUiJSON.graphic.forEach(function (e) {
              e.layers =
                e.selectedLayer && "null" !== e.selectedLayer.id
                  ? [e.selectedLayer]
                  : [];
            }),
          this.mappedUiJSON.background &&
            this.mappedUiJSON.background.forEach(function (e) {
              e.layers =
                e.selectedLayer && "null" !== e.selectedLayer.id
                  ? [e.selectedLayer]
                  : [];
            }),
          this._iframeWrapper)
        )
          this._iframeWrapper
            .process(this.mappedUiJSON)
            .then(function (t) {
              e._dispatchNewPreview(t);
            })
            ["catch"](function () {
              e._iframeWrapper.destroy(),
                delete e._iframeWrapper,
                e._generateImagePreview();
            });
        else {
          this.mappedUiJSON.highResolution = !1;
          var t = this.getCleanRecord(this.mappedUiJSON);
          (t.referrer = encodeURI(window.location.href)),
            $.ajax({
              url: this.processUrl,
              type: "POST",
              dataType: "json",
              contentType: "application/json",
              data: JSON.stringify(t),
            }).then(function (t) {
              e._dispatchNewPreview(t.designPlan.previewImage.value);
            });
        }
        e.dispatch("showLoader");
      },
      _validateIfSelectedAssetHasLayers: function (e, t) {
        var n;
        return (
          Array.isArray(e) === !0 &&
            (n = e.filter(function (e) {
              return e.tag === t;
            })[0]),
          n && n.hasLayers !== !1
            ? n.selectedLayer && Array.isArray(n.selectedLayer.layers) !== !1
              ? !0
              : n
            : !0
        );
      },
      clearLastPreviewHash: function () {
        this._lastProcessedMappedUiJSONHash = null;
      },
      getExistingPreview: function () {
        this.mappedUiJSON = this._mapChanges();
        var e = this.getNormalizedJSON(this.mappedUiJSON);
        e.linkedSmartTemplateId = Helpers.StageType.getRecordId();
        var t = $.md5(JSON.stringify(e)),
          n = this._getVideoS3URL(t);
        return new Promise(function (e, t) {
          $.ajax({
            type: "HEAD",
            async: !0,
            url: n,
          })
            .done(function () {
              e(n);
            })
            .fail(t);
        });
      },
      _generateVideoPreview: function () {
        var e = this;
        this.mappedUiJSON = this._mapChanges();
        var t = this._validateIfSelectedAssetHasLayers(
          this.mappedUiJSON.graphic,
          "GRAPHIC1"
        );
        if (t !== !0)
          throw new Error(
            "Invalid data to process video: " +
              JSON.stringify({
                id: this.mappedUiJSON.id,
                type: t.type,
                name: t.name,
                hasLayers: t.hasLayers,
                selectedLayer: t.selectedLayer,
              })
          );
        var n,
          i,
          r = new FormData(),
          s = new XMLHttpRequest(),
          o = this,
          a = "POST",
          l = null;
        (i = {
          stage_id: window.linked_stage_id_for_animated_templates,
          background_id: null,
          stageVersion: "one",
        }),
          (l = UI.StageBase.processPath.fusionfullvideo);
        for (var c in i) i.hasOwnProperty(c) && r.append(c, i[c]);
        n = [];
        var u = [this.mappedUiJSON],
          d = !1,
          h = null,
          p = encodeURI(window.location.href);
        u.forEach(function (e) {
          n.push(o.getNormalizedJSON(e));
        }),
          (n[0].linkedSmartTemplateId = Helpers.StageType.getRecordId()),
          (this._lastProcessedMappedUiJSONHash = $.md5(JSON.stringify(n[0]))),
          r.append("audio_track_uuid", h),
          r.append("audio_enabled", d),
          r.append("referrer", p),
          r.append("ui_json", JSON.stringify(n)),
          r.append(
            $("[name=csrf-param]").attr("content"),
            $("[name=csrf-token]").attr("content")
          ),
          s.open(a, l),
          s.setRequestHeader("Accept", "application/json");
        var f = function () {
          if (s.readyState === s.DONE && 201 === s.status) {
            var t = JSON.parse(s.responseText);
            e.dispatch("startPolling", {
              id: t.id,
              uuid: t.uuid,
            });
          }
        };
        (s.onreadystatechange = f), e.dispatch("showLoader"), s.send(r);
      },
      _dispatchNewPreview: function (e) {
        var t = {
          src: e,
        };
        this._isAlternateVideo && (t.keyTime = this.videoUiJSON.key_time),
          this.dispatch("newPreview", t);
      },
      generateURL: function () {
        this._isAlternateVideo
          ? this._generateVideoURL()
          : this._generateImageURL();
      },
      _generateImageURL: function () {
        this.mappedUiJSON = this._mapChanges();
        var e = this._getUrlParams(this.mappedUiJSON, !0);
        (e = this._getShortenURL(e)),
          (e = e.replace("?", "")),
          (e = window.linked_url_for_animated_templates + "?" + e),
          (e +=
            this._getSeparator(e) +
            "linked_smart_template_id=" +
            Helpers.StageType.getStageID());
        var t = new URL(window.location.href).searchParams.get("stateId");
        t && (e += "&video_stateId=" + t),
          this._dispatchNewURL({
            newUrl: e,
          });
      },
      _getShortenURL: function (e) {
        function t(e, t) {
          var n = new Set(e);
          return (
            t.forEach(function (e) {
              n["delete"](e);
            }),
            n
          );
        }
        this._normalizeImageJSON(this.imageUiJSON);
        var n = this._getUrlParams(this.imageUiJSON, !0),
          i = new Set(n.split("&")),
          r = new Set(e.split("&")),
          s = t(r, i),
          o = [];
        return (
          s.forEach(function (e) {
            o.push(e);
          }),
          o.join("&")
        );
      },
      _getShortenVideoURL: function (e, t) {
        function n(e, t) {
          var n = new Set(e);
          return (
            t.forEach(function (e) {
              n["delete"](e);
            }),
            n
          );
        }
        var i = new Set(e.split("&")),
          r = new Set(t.split("&")),
          s = n(r, i),
          o = [];
        return (
          s.forEach(function (e) {
            o.push(e);
          }),
          o.join("&")
        );
      },
      _generateVideoURL: function () {
        var e = this;
        this.mappedUiJSON = this._mapChanges();
        var t = this._getUrlParamsForVideo(
            this.videoUiJSON,
            this._mappedSlideIndex
          ),
          n = this._getUrlParamsForVideo(
            this.mappedUiJSON,
            this._mappedSlideIndex
          );
        if (
          ((n = this._getShortenVideoURL(t, n)),
          (n = n.replace("?", "")),
          this._urlWithoutMappedSlideParams)
        ) {
          var i = "";
          "&" !== this._urlWithoutMappedSlideParams[0] && (i = "&"),
            (n = n + i + this._urlWithoutMappedSlideParams);
        }
        if (
          (-1 === n.indexOf("pip_slide_index") &&
            (n += "&pip_slide_index=" + this._mappedSlideIndex),
          -1 === n.indexOf("pip_slide_id") &&
            (n +=
              "&pip_slide_id=" +
              window.linked_template_id_for_animated_templates),
          null !== this._lastVideoPreviewUrl &&
            (n +=
              "&last_process_preview=" +
              encodeURIComponent(this._lastVideoPreviewUrl || "")),
          null !== this._lastProcessedMappedUiJSONHash)
        ) {
          var r = this._mappedSlideIndex + "_md5Hash";
          n += "&" + r + "=" + this._lastProcessedMappedUiJSONHash;
        }
        var s = function (t) {
            (n =
              window.linked_url_for_animated_templates +
              "?stateId=" +
              t.data.stateObject.id),
              (n +=
                "&linked_smart_template_id=" + Helpers.StageType.getStageID()),
              e._dispatchNewURL({
                newUrl: n,
              }),
              Helpers.State.unbind("replacestate", s);
          },
          o = n.charAt(0);
        "?" !== o && (n = "&" === o ? n.replace("&", "?") : "?" + n),
          Helpers.State.bind("replacestate", function (e) {
            try {
              s(e);
            } catch (t) {
              Helpers.GlobalEventTracker.track("StateId.beforeRequest", {
                error: !0,
                message: t.message,
                stack: t.stack,
                customMessage:
                  "Something went wrong before sending request to databox in linker",
              });
            }
          }),
          Helpers.State.setParams(n, !0);
      },
      _dispatchNewURL: function (e) {
        this.dispatch("newUrl", e);
      },
      _mapChanges: function () {
        if (this.shouldMap() === !1) return this.mappedUiJSON;
        var e,
          t = null;
        return (
          this._isAlternateVideo
            ? ((this.imageUiJSON = page.stage.record),
              (t = new SmartTemplateToAnimatedTemplateMapper(
                this.imageUiJSON,
                this.videoUiJSON
              )),
              (e = t.map()))
            : ((this.videoUiJSON = page.stage.record),
              (t = new AnimatedTemplateToSmartTemplateMapper(
                this.videoUiJSON,
                this.imageUiJSON
              )),
              (e = t.map()),
              this._normalizeImageJSON(e)),
          e
        );
      },
      _normalizeImageJSON: function (e) {
        e.graphic &&
          e.graphic.forEach(function (e) {
            e.selectedLayer && "null" !== e.selectedLayer.id
              ? ((e.layers = [e.selectedLayer]), (e.layer = e.selectedLayer.id))
              : ((e.layers = []), delete e.layer),
              e.color || (e.color = "#000000");
          }),
          e.background &&
            e.background.forEach(function (e) {
              e.layers =
                e.selectedLayer && "null" !== e.selectedLayer.id
                  ? [e.selectedLayer]
                  : [];
            });
      },
      updateChangeTimeStamp: function () {
        this.lastChangeTime = Date.now();
      },
      shouldMap: function () {
        return this.lastChangeTime >= this.lastMappingTime;
      },
      _getPresetUiJSON: function () {
        var e = "";
        return "" !== window.linked_preset_id_for_animated_templates
          ? ((e =
              this._cdnBasePath() +
              "/presets/" +
              window.linked_preset_id_for_animated_templates +
              "/ui.json"),
            P.get(e))
          : Promise.resolve(null);
      },
      _getSavedConfigUiJSON: function () {
        var e = window.linked_saved_config_url_for_animated_templates;
        return e
          ? P.get(e).then(function (e) {
              if (Array.isArray(e.collection) === !1) return null;
              var t = e.collection.find(function (e) {
                return (
                  e.id === window.linked_template_id_for_animated_templates
                );
              });
              return t || null;
            })
          : Promise.resolve(null);
      },
      _getStageUiJSON: function () {
        var e = "smart_templates";
        this._isAlternateVideo && (e = "videos");
        var t =
          this._cdnBasePath() +
          "/" +
          e +
          "/" +
          window.linked_template_id_for_animated_templates +
          "/ui.json";
        return P.get(t);
      },
      _getAlternateUiJSON: function () {
        var e = this,
          t = this._getStageUiJSON(),
          n = this._getPresetUiJSON(),
          i = this._getSavedConfigUiJSON();
        return Promise.all([t, n, i]).then(function (t) {
          var n = t[0],
            i = t[1] || {},
            r = t[2] || {};
          return (
            e._isAlternateVideo === !1 &&
              "" !== window.linked_preset_id_for_animated_templates &&
              (n = UiJsonPresetMerge.mergeUiJson(n, i)),
            e._isAlternateVideo &&
              "" !== window.linked_saved_config_url_for_animated_templates &&
              (n = UiJsonPresetMerge.mergeUiJsonVideo(n, r)),
            n
          );
        });
      },
      _fetchAndSetAssetLayersForUiJson: function (e) {
        var t = this;
        return new Promise(function (n) {
          var i = [];
          e.graphic.forEach(function (n) {
            if (
              !n.selectedLayer ||
              "document" !== n.selectedLayer.type ||
              Array.isArray(n.selectedLayer.layers)
            )
              return void (n.layers = []);
            var r = t.fetchAndSetAssetLayers(
              n.selectedLayer,
              e.defaultAssetColors || []
            );
            i.push(r);
          }),
            Promise.all(i)
              .then(function () {
                n();
              })
              ["catch"](function () {
                n();
              });
        });
      },
      setLastPreviewParam: function (e) {
        (this._lastVideoPreviewUrl = e), this.generateURL();
      },
    },
  }),
  Module("AnimatedTemplatesSupport")({
    prototype: {
      pip: null,
      _animatedTemplatesLinker: null,
      _linkedSlideIndex: null,
      _linkedSlideId: null,
      _graphicReady: !1,
      instantiateWidgetsIfAnimatedTemplate: function () {
        window.linked_stage_id_for_animated_templates &&
          ($(".page-container").addClass("linked-stage"),
          this.bind(
            "stage.infoReady",
            function () {
              if (
                (console.time("stage.infoReady"),
                this._initPiP(),
                this._initLinker(),
                this._isAlternateVideo())
              )
                this._initVideoProductController();
              else {
                var e = Helpers.App.getAllURLParams();
                (this._linkedSlideIndex = parseInt(e.pip_slide_index) || 0),
                  (this._linkedSlideId = e.pip_slide_id || this.record.id);
                var t = parseInt(this.videoSlides.getSelectedSlide());
                this._linkedSlideIndex !== t
                  ? this.pip.hide()
                  : (page.stage.record.linkedSmartTemplateId =
                      window.linked_template_id_for_animated_templates);
              }
              this._setAnimatedTemplatesBindings();
            }.bind(this)
          ));
      },
      _initPiP: function () {
        (this.pip = this._isAlternateVideo()
          ? new UI.AnimatedTemplates.VideoPiP({
              name: "pip",
            })
          : new UI.AnimatedTemplates.ImagePiP({
              name: "pip",
            })),
          this.pip.render(this.stageImageWidget.element, !1),
          this.appendChild(this.pip);
      },
      _initLinker: function () {
        this._animatedTemplatesLinker = new UI.AnimatedTemplates.Linker({
          stageUiJSON: this.record,
        });
      },
      _initVideoProductController: function () {
        (this.videoProductController = new UI.ATVideoProductController({
          name: "videoProductController",
          isSmartVideoproduct: !0,
          path: "/placeit/video/v4/",
          element: this.pip.element,
        })),
          this.videoProductController.updateText();
      },
      _setAnimatedTemplatesBindings: function () {
        var e = this;
        if (
          (this.pip.bind("newPreviewRequest", function () {
            e._animatedTemplatesLinker.generatePreview(),
              e.pip.trackPreviewRequest();
          }),
          this.pip.bind("reposition.needed", function () {
            e._repositionPiP();
          }),
          this.bind("stage.imageShown", function () {
            e.pip.shouldShowPiP = !0;
          }),
          this.pip.bind("newURLRequest", function () {
            e.newChange();
          }),
          this._animatedTemplatesLinker.bind("newPreview", function (t) {
            e.pip.setProcessing(!1), e.pip._onNewPreview(t);
          }),
          this._animatedTemplatesLinker.bind("newUrl", function (t) {
            e.pip._onNewURL(t);
          }),
          this._animatedTemplatesLinker.bind("allUiJsonsReady", function (t) {
            var n = e.shouldTriggerProcessing();
            if (n) {
              var i = null,
                r = function () {
                  e._animatedTemplatesLinker.generateURL(),
                    e._animatedTemplatesLinker.generatePreview(),
                    e.pip.trackPreviewRequest(),
                    console.log("#start pip process");
                },
                s = function () {
                  return e._graphicReady || e.pip.shouldShowPiP
                    ? (clearInterval(i),
                      e._isAlternateVideo() === !1
                        ? void r()
                        : void e._animatedTemplatesLinker
                            .getExistingPreview()
                            .then(function (t) {
                              e._animatedTemplatesLinker._dispatchNewPreview(t),
                                (reusingVideo = !0);
                            })
                            ["catch"](function () {
                              e._animatedTemplatesLinker._dispatchNewPreview(
                                t.data
                              ),
                                setTimeout(function () {
                                  r();
                                }, 400);
                            }))
                    : void 0;
                };
              (i = setInterval(s, 1e3)),
                e._isAlternateVideo() === !1 &&
                  e._animatedTemplatesLinker._dispatchNewPreview(t.data);
            } else e._animatedTemplatesLinker._dispatchNewPreview(t.data);
          }),
          this._isAlternateVideo())
        )
          this._animatedTemplatesLinker.bind("startPolling", function (t) {
            var n = t.data.id,
              i = t.data.uuid;
            e.videoProductController.startPolling(n, i);
          }),
            this._animatedTemplatesLinker.bind("showLoader", function () {
              e.videoProductController.showLoader(), e.pip.setProcessing(!0);
            }),
            this.videoProductController.bind(
              "videoproduct.processed",
              function (t) {
                var n = t.data.videoproduct.video.url;
                e.pip._onNewPreview({
                  data: {
                    src: n,
                  },
                }),
                  e.pip.setProcessing(!1),
                  e._animatedTemplatesLinker.generateURL(),
                  e.pip.trackPreviewSuccess();
              }
            ),
            this.videoProductController.bind("stage.error", function () {
              e.pip.setProcessing(!1),
                e._animatedTemplatesLinker.clearLastPreviewHash();
            });
        else {
          this._animatedTemplatesLinker.bind("showLoader", function () {
            e.pip.setProcessing(!0);
          });
          var t = function (t, n) {
            setTimeout(function () {
              var t = e.record.id,
                i = parseInt(n.newIndex);
              if (t !== e._linkedSlideId) e.pip.hide();
              else if (e._linkedSlideIndex === i) {
                e.pip.show();
                var r = Helpers.App.getAllURLParams();
                (r.pip_slide_index = r.cfid || 0),
                  (r.pip_slide_id = e.record.id),
                  e.videoSlides.setUrlParams(r);
              } else e.pip.hide();
            });
          };
          this.bind("videoSlide.onSelectedSlideChange", t),
            this.bind("videoSlide.newSelectedFromPopState", t),
            this.bind("timeline.slidemoved", function (t) {
              setTimeout(function () {
                var n, i;
                if (
                  ((n = parseInt(t.data.startIndex)),
                  (i = parseInt(t.data.endIndex)),
                  n === e._linkedSlideIndex)
                )
                  e._linkedSlideIndex = i;
                else {
                  var r = n > e._linkedSlideIndex && i <= e._linkedSlideIndex,
                    s = n < e._linkedSlideIndex && i >= e._linkedSlideIndex;
                  r && e._linkedSlideIndex++, s && e._linkedSlideIndex--;
                }
                var o = Helpers.App.getAllURLParams();
                (o.pip_slide_index = e._linkedSlideIndex),
                  e.videoSlides.setUrlParams(o);
              });
            }),
            this.bind("timeline.slidemenu.remove", function (t, n) {
              setTimeout(function () {
                var t = n.index;
                if (t < e._linkedSlideIndex) {
                  e._linkedSlideIndex--;
                  var i = Helpers.App.getAllURLParams();
                  (i.pip_slide_index = e._linkedSlideIndex),
                    e.videoSlides.setUrlParams(i);
                }
              });
            }),
            this.bind("timeline.slidemenu.duplicate", function (t, n) {
              setTimeout(function () {
                var t = n.index;
                if (t < e._linkedSlideIndex) {
                  e._linkedSlideIndex++;
                  var i = Helpers.App.getAllURLParams();
                  (i.pip_slide_index = e._linkedSlideIndex),
                    e.videoSlides.setUrlParams(i);
                }
              });
            }),
            Helpers.State.bind("pushstate", function () {
              try {
                e._onNewVideoState();
              } catch (t) {
                Helpers.GlobalEventTracker.track("StateId.beforeRequest", {
                  error: !0,
                  message: t.message,
                  stack: t.stack,
                  customMessage:
                    "Something went wrong before sending request to databox in animated support",
                });
              }
            }),
            Helpers.State.bind("replacestate", function () {
              e._onNewVideoState();
            });
        }
      },
      _onNewVideoState: function () {
        var e = window.location.href,
          t = /linked_smart_template_id/.test(e);
        t ||
          window.history.replaceState(
            window.history.state,
            Helpers.StageType.getStageSlug(),
            window.location.href +
              "&linked_smart_template_id=" +
              window.linked_stage_id_for_animated_templates
          );
      },
      newChange: function () {
        this.pip && this.pip.newStageChange(),
          this._animatedTemplatesLinker &&
            (this._animatedTemplatesLinker.updateChangeTimeStamp(),
            this._animatedTemplatesLinker.generateURL());
      },
      _repositionPiP: function () {
        if (this.pip)
          if (this._isAlternateVideo()) {
            var e = this.stageImageWidget.element,
              t = this.stageImageWidget.$image,
              n = this.stageImageWidget.getElement().find("canvas"),
              i = this.canProcessWithEngine && n.length > 0 ? n : t;
            this.pip.element.css("bottom", e.height() - i.outerHeight() + "px"),
              this.pip.element.css(
                "right",
                (e.width() - i.outerWidth()) / 2 + "px"
              );
          } else
            this.pip.element.css("bottom", "0px"),
              this.pip.element.css("right", "0px");
      },
      _isAlternateVideo: function () {
        return 15 !== _stageData.stage_data.image_type;
      },
      _getAnimatedTemplateDefaultPreview: function () {
        return this._isAlternateVideo()
          ? void 0
          : window.video_preview_for_animated_template;
      },
      shouldTriggerProcessing: function () {
        var e = Helpers.App.getAllURLParams();
        if (
          (delete e.linked_smart_template_id,
          delete e.video_stateId,
          delete e.ngin,
          delete e.iref,
          $.isEmptyObject(e) === !0)
        )
          return !1;
        var t = Object.keys(e).every(function (e) {
          return /search/.test(e);
        });
        return t === !1;
      },
    },
  }),
  Class(UI.AnimatedTemplates, "BasePiP").inherits(Widget)({
    html: '        <div class="pip">             <div class="preview-handler right">             </div>             <div class="preview-container">             </div>         </div>     ',
    prototype: {
      previewUrl: null,
      alternateVersionUrl:
        window.linked_url_for_animated_templates +
        "?linked_smart_template_id=" +
        Helpers.StageType.getStageID(),
      changesInStage: 0,
      previewTimeout: null,
      isHidden: !1,
      hasPopover: !1,
      _isInLargerThumbState: !1,
      _growDecreaseFactor: 1.75,
      firstAutoPlay: !1,
      containerClicks: 0,
      updateType: "auto",
      shouldShowPiP: !1,
      waitingToNavigate: !1,
      init: function (e) {
        Widget.prototype.init.call(this, e),
          (this.shouldShowPiP = !0),
          (this.$previewContainer = this.element.find(".preview-container")),
          (this.$previewHandler = this.element.find(".preview-handler")),
          this.$previewHandler.hide(),
          this._buildPopover();
      },
      setBindings: function () {
        var e = this;
        this.element.mouseenter(this._onMouseOver.bind(this)),
          this.$previewContainer.mouseenter(this._trackHover.bind(this)),
          this.element.mouseleave(this._onMouseLeave.bind(this)),
          this.$previewHandler.click(function () {
            e._toggleContainer();
          }),
          this.$previewContainer.click(function () {
            Helpers.App.isMobile()
              ? e._handleMobileTap()
              : e._handleNavigateRequest();
          });
      },
      _onMouseOver: function (e) {
        if (!e || !$(e.target).hasClass("preview-handler")) {
          var t = this;
          if (!this.isHidden) {
            if (!Helpers.App.isMobile() && this.toggleContainerExecuted)
              return void (this.toggleContainerExecuted = !1);
            this._increasePiPSize(),
              this.$previewHandler.show(),
              setTimeout(function () {
                t.hasPopover &&
                  t.firstAutoPlay === !1 &&
                  (t.$previewContainer.popover("show"),
                  (t.popoverIsShown = !0));
              }, 500);
          }
        }
      },
      _increasePiPSize: function () {
        var e = this.$previewContainer.css("width"),
          t = this.$previewContainer.css("height");
        (e = parseInt(e)),
          (t = parseInt(t)),
          this.$previewContainer.css({
            width: e * this._growDecreaseFactor + "px",
            height: t * this._growDecreaseFactor + "px",
          });
      },
      _onMouseLeave: function (e) {
        if (!e || !$(e.target).hasClass("preview-handler")) {
          var t = this;
          if (!this.isHidden) {
            var n = this.$previewContainer.css("width"),
              i = this.$previewContainer.css("height");
            (n = parseInt(n)),
              (i = parseInt(i)),
              this.$previewContainer.css({
                width: n / this._growDecreaseFactor + "px",
                height: i / this._growDecreaseFactor + "px",
              }),
              this.$previewHandler.hide(),
              setTimeout(function () {
                t.hasPopover &&
                  t.popoverIsShown &&
                  (t.$previewContainer.popover("hide"), t._destroyPopover());
              });
          }
        }
      },
      _onNewPreview: function () {
        throw new Error("This method should be implemented by children");
      },
      _onNewURL: function (e) {
        (this.alternateVersionUrl = e.data.newUrl),
          this.waitingToNavigate &&
            (this._navigateToAlternateVersion(), (this.waitingToNavigate = !1));
      },
      _handleNavigateRequest: function () {
        (this.waitingToNavigate = !0), this.dispatch("newURLRequest");
      },
      _navigateToAlternateVersion: function () {
        var e = this;
        e.containerClicks++,
          e.$video
            ? Helpers.GlobalEventTracker.pipEvent("pip:go_to_animated", {
                clicks: e.containerClicks,
              })
            : Helpers.GlobalEventTracker.pipEvent("pip:go_to_static", {
                clicks: e.containerClicks,
              }),
          (window.location.href = e.alternateVersionUrl);
      },
      _toggleContainer: function () {
        var e = this,
          t = this.$previewContainer.css("width");
        if ("0px" === t) {
          var n = this.pipWidth,
            i = this.pipHeight;
          Helpers.App.isMobile() ||
            ((n *= this._growDecreaseFactor), (i *= this._growDecreaseFactor)),
            this.$previewContainer.css({
              width: n,
              minWidth: this.pipWidth,
              height: i,
              minHeight: this.pipHeight,
            }),
            (this.isHidden = !1),
            this.$previewHandler.removeClass("left").addClass("right"),
            this.$previewContainer.removeClass("no-borders"),
            Helpers.App.isMobile() ||
              ((this.toggleContainerExecuted = !0),
              setTimeout(function () {
                e.toggleContainerExecuted = !1;
              }, 1500));
        } else
          this.$previewContainer.css({
            width: "0px",
            minWidth: "0px",
            height: "0px",
            minHeight: "0px",
          }),
            this.$previewHandler.show(),
            this.$previewHandler.removeClass("right").addClass("left"),
            this.$previewContainer.addClass("no-borders"),
            (this.isHidden = !0);
        this.hasPopover &&
          (this.$previewContainer.popover("hide"), this._destroyPopover());
      },
      newStageChange: function () {
        this.changesInStage++;
      },
      _buildPopover: function () {
        var e = "Image";
        Helpers.StageType.isSmartTemplate() && (e = "Video");
        var t = "";
        (t += Helpers.App.isMobile() ? "Tap" : "Click"),
          (t += " to Open " + e + " Version");
        var n = $('<div class="pip-popover"></>');
        n.text(t),
          this.$previewContainer.popover({
            content: n,
            html: !0,
            container: "body",
            trigger: "manual",
            placement: "top",
          }),
          this.$previewContainer.on(
            "shown.bs.popover",
            this._popoverShown.bind(this)
          ),
          (this.hasPopover = !0);
      },
      _destroyPopover: function () {
        this.$previewContainer.popover("destroy"), (this.hasPopover = !1);
      },
      _handleMobileTap: function () {
        throw new Error("This method should be implemented by children");
      },
      hide: function () {
        this.element.hide();
      },
      show: function () {
        this.element.show();
      },
      cancelAutomaticPreview: function () {},
      _popoverShown: function () {},
      getUpdateType: function () {
        return this.updateType;
      },
      trackPreviewRequest: function () {
        var e = this;
        (e.previewTiming = performance.now()),
          e.$video
            ? Helpers.GlobalEventTracker.pipEvent("static:pip:update", {
                updateType: e.getUpdateType(),
              })
            : Helpers.GlobalEventTracker.pipEvent("animated:pip:update", {
                updateType: e.getUpdateType(),
              });
      },
      trackPreviewSuccess: function () {
        var e = this;
        e.previewTiming &&
          ((e.previewTiming = performance.now() - e.previewTiming),
          e.$video
            ? Helpers.GlobalEventTracker.pipEvent(
                "static:pip:update:previewShown",
                {
                  timeTook: e.previewTiming,
                  updateType: e.getUpdateType(),
                }
              )
            : Helpers.GlobalEventTracker.pipEvent(
                "animated:pip:update:previewShown",
                {
                  timeTook: e.previewTiming,
                  updateType: e.getUpdateType(),
                }
              ),
          (e.previewTiming = 0));
      },
      _trackHover: function () {
        var e = this;
        Helpers.App.isMobile() ||
          Helpers.GlobalEventTracker.pipEvent(
            e.$video ? "static:pip:hover" : "animated:pip:hover"
          );
      },
    },
  }),
  Class(UI.AnimatedTemplates, "ImagePiP").inherits(
    UI.AnimatedTemplates.BasePiP
  )({
    prototype: {
      ownHTML:
        '            <img src="" />             <div class="chart-container transparent animate-rotation">                 <h4>                    <span class="legend"></span>                </h4>            </div>         ',
      PREVIEW_REQUEST_TIMEOUT: 2e3,
      LARGER_THUMB_TIMEOUT: 5e3,
      init: function (e) {
        UI.AnimatedTemplates.BasePiP.prototype.init.call(this, e),
          this.element.css("visibility", "hidden");
        var t = $(this.ownHTML);
        this.$previewContainer.append(t),
          (this.$charContainer = this.element.find(".chart-container")),
          (this.$image = this.element.find("img")),
          this.element.find(".legend").text("Processing..."),
          this.previewUrl && this._onNewPreview(),
          (this.cc = new UI.CircularChar({
            name: "chart",
            size: 45,
          })),
          this.cc.updateProgress(288),
          this.setBindings();
      },
      _onNewPreview: function (e) {
        var t = this;
        t.trackPreviewSuccess(),
          e && e.data && e.data.src && (this.previewUrl = e.data.src),
          this.$image.attr("src", this.previewUrl),
          this.$previewContainer.css(
            "backgroundImage",
            "url(" + this.previewUrl + ")"
          ),
          this.$image.on("load", function () {
            (t.pipWidth = this.naturalWidth / 10),
              (t.pipHeight = this.naturalHeight / 10),
              t.$previewContainer.css({
                width: t.pipWidth + "px",
                height: t.pipHeight + "px",
                minWidth: t.pipWidth + "px",
                minHeight: t.pipHeight + "px",
                maxWidth: t.pipWidth * t._growDecreaseFactor + "px",
                maxHeight: t.pipHeight * t._growDecreaseFactor + "px",
              }),
              t.dispatch("reposition.needed"),
              t.element.addClass("pip-animation"),
              setTimeout(function () {
                t.element.css("visibility", "initial"),
                  console.timeEnd("PiP"),
                  console.timeEnd("stage.infoReady"),
                  console.timeEnd("Init AT classes");
              });
          });
      },
      _requestPreview: function () {
        this.dispatch("newPreviewRequest");
      },
      newStageChange: function () {
        UI.AnimatedTemplates.BasePiP.prototype.newStageChange.call(this);
        var e = this;
        this.previewTimeout && clearTimeout(this.previewTimeout),
          (this.previewTimeout = setTimeout(function () {
            e._requestPreview();
          }, this.PREVIEW_REQUEST_TIMEOUT));
      },
      _handleMobileTap: function () {
        var e = this;
        return this._isInLargerThumbState
          ? void this._handleNavigateRequest()
          : (Helpers.GlobalEventTracker.pipEvent("animated:pip:hover"),
            this.element.mouseover(),
            (this._isInLargerThumbState = !0),
            void setTimeout(function () {
              e.element.mouseleave(), (e._isInLargerThumbState = !1);
            }, this.LARGER_THUMB_TIMEOUT));
      },
      isProcessing: function () {
        return !1;
      },
      setProcessing: function (e) {
        (this.processing = e),
          setTimeout(
            function () {
              this.toggleSpinner(e);
            }.bind(this),
            400
          ),
          e
            ? (this.$previewHandler.hide(),
              this._increasePiPSize(),
              this.element.off("mouseenter"),
              this.element.off("mouseleave"))
            : (this.element.mouseenter(this._onMouseOver.bind(this)),
              this.element.mouseleave(this._onMouseLeave.bind(this)));
      },
      toggleSpinner: function (e) {
        this.isSpinnerShown !== e &&
          (this.cc || e) &&
          ((this.isSpinnerShown = e),
          e
            ? (this.$charContainer.removeClass("transparent"),
              this.cc.render(this.$charContainer, !0))
            : (this.cc.element.detach(),
              this.$charContainer.addClass("transparent")));
      },
    },
  }),
  Class(UI.AnimatedTemplates, "VideoPiP").inherits(
    UI.AnimatedTemplates.BasePiP
  )({
    prototype: {
      ownHTML:
        '            <div class="video-pip">                 <video src="" muted playsinline disableRemotePlayback></video>                 <div class="update-btn-wrapper">                     <button class="update-btn">Update</button>                 </div>             </div>         ',
      PREVIEW_REQUEST_TIMEOUT: 5e3,
      shouldGeneratePreviewAutomatically: !0,
      shouldAutoplay: !1,
      changeDuringProcessing: !1,
      processing: !1,
      _shouldVideoPlayTwice: !1,
      _alreadyPlayTwice: !1,
      _keyTime: null,
      _loop: !1,
      init: function (e) {
        UI.AnimatedTemplates.BasePiP.prototype.init.call(this, e),
          this.element.css("visibility", "hidden");
        var t = $(this.ownHTML);
        this.$previewContainer.append(t),
          (this.$video = this.element.find("video")),
          (this.$updateBtnWrapper = this.element.find(".update-btn-wrapper")),
          (this.$updateButton = this.element.find(".update-btn")),
          this.previewUrl && this._onNewPreview(),
          this.setBindings();
      },
      setBindings: function () {
        UI.AnimatedTemplates.BasePiP.prototype.setBindings.call(this);
        var e = this;
        this.$updateBtnWrapper.click(function (e) {
          e.stopPropagation(), e.preventDefault();
        }),
          this.element.off("mouseenter"),
          this.element.off("mouseleave"),
          this.element.mouseenter(function (t) {
            e._onMouseOver(t);
          }),
          this.element.mouseleave(function (t) {
            e._onMouseLeave(t);
          }),
          this.$video.on("ended", function () {
            e._shouldVideoPlayTwice && !e._alreadyPlayTwice
              ? ((e.$video[0].currentTime = 0),
                e.$video[0].play(),
                e._loop || (e._alreadyPlayTwice = !0))
              : ((e.$video[0].currentTime = e._keyTime),
                (Helpers.App.isMobile() || e.firstAutoPlay) &&
                  (e.element.mouseleave(),
                  (e._isInLargerThumbState = !1),
                  (e.firstAutoPlay = !1)));
          });
      },
      _onUpdateButtonClick: function (e) {
        (this.updateType = "manual"),
          e.stopPropagation(),
          e.preventDefault(),
          this._requestPreview(),
          this._hideUpdateButton();
      },
      _onNewPreview: function (e) {
        var t = this;
        e && e.data && e.data.src && (this.previewUrl = e.data.src),
          e && e.data && e.data.keyTime && (this._keyTime = e.data.keyTime),
          this.$video.attr("src", this.previewUrl);
        var n = !1,
          i = function () {
            (t.pipWidth = this.videoWidth / 5),
              (t.pipHeight = this.videoHeight / 5),
              t.$previewContainer.css({
                width: t.pipWidth + "px",
                height: t.pipHeight + "px",
                minWidth: t.pipWidth + "px",
                minHeight: t.pipHeight + "px",
                maxWidth: t.pipWidth * t._growDecreaseFactor + "px",
                maxHeight: t.pipHeight * t._growDecreaseFactor + "px",
              }),
              t.dispatch("reposition.needed"),
              t.element.addClass("pip-animation");
            var e = function () {
              t.element.css("visibility", "initial"),
                console.timeEnd("PiP"),
                console.timeEnd("stage.updated"),
                console.timeEnd("stage.infoReady"),
                console.timeEnd("Init AT classes"),
                t.$video[0].duration <= 10 && (t._shouldVideoPlayTwice = !0),
                (t.$video[0].currentTime = t._keyTime),
                t.autoPlayOnLoad(),
                t.shouldGeneratePreviewAutomatically === !1 &&
                  (t.element.mouseenter(), (t.firstAutoPlay = !0)),
                (n = !0);
            };
            if (t._thereAreUrlChanges())
              if (t.shouldShowPiP) setTimeout(e, 100);
              else
                var i = setInterval(function () {
                  t.shouldShowPiP && (clearInterval(i), e());
                }, 150);
            else setTimeout(e, 100);
          };
        this.$video.one("loadeddata", i),
          this.$video.one("suspend", function () {
            n || t.$video.load();
          }),
          this.changeDuringProcessing === !1 && (this.shouldAutoplay = !0),
          this.wasPopoverShown || this._buildPopover();
      },
      autoPlayOnLoad: function () {
        var e = Helpers.App.getAllURLParams();
        delete e.linked_smart_template_id,
          delete e.video_stateId,
          delete e.ngin,
          $.isEmptyObject(e) &&
            (this.element.mouseenter(), (this.firstAutoPlay = !0));
      },
      _requestPreview: function () {
        this.dispatch("newPreviewRequest");
      },
      newStageChange: function () {
        if (
          (UI.AnimatedTemplates.BasePiP.prototype.newStageChange.call(this),
          (this.shouldAutoplay = !1),
          this.wasPopoverShown || this._destroyPopover(),
          this.processing && (this.changeDuringProcessing = !0),
          this.shouldGeneratePreviewAutomatically !== !1)
        ) {
          var e = this;
          this.previewTimeout && clearTimeout(this.previewTimeout),
            this.changesInStage >= 5 &&
              (this.previewTimeout = setTimeout(function () {
                (e.previewTiming = performance.now()), e._requestPreview();
              }, this.PREVIEW_REQUEST_TIMEOUT));
        }
      },
      _showUpdateButton: function () {
        var e = this;
        this.isHidden ||
          (this.$updateBtnWrapper.show(),
          this.$updateButton.show(400, function () {
            e.$updateButton.off("click"),
              e.$updateButton.click(e._onUpdateButtonClick.bind(e));
          }));
      },
      _hideUpdateButton: function () {
        this.$updateBtnWrapper.hide(), this.$updateButton.hide();
      },
      setProcessing: function (e) {
        var t = this;
        (t.processing = e),
          (t.changeDuringProcessing = !1),
          e
            ? (t.$previewHandler.hide(),
              t._hideUpdateButton(),
              t.$updateButton.off("click"),
              t._increasePiPSize(),
              t.element.off("mouseenter"),
              t.element.off("mouseleave"))
            : (t.element.mouseenter(t._onMouseOver.bind(this)),
              t.element.mouseleave(t._onMouseLeave.bind(this))),
          0 !== this.changesInStage && t.cancelAutomaticPreview();
      },
      _onMouseOver: function (e) {
        UI.AnimatedTemplates.BasePiP.prototype._onMouseOver.call(this, e),
          e && e.stopPropagation();
        this.processing ||
          (this.shouldAutoplay
            ? ((this.$video[0].currentTime = 0),
              this.$video[0].play(),
              (this._alreadyPlayTwice = !1),
              e &&
                e.originalEvent &&
                e.originalEvent.isTrusted &&
                (this._loop = !0))
            : this._showUpdateButton());
      },
      _onMouseLeave: function (e) {
        UI.AnimatedTemplates.BasePiP.prototype._onMouseLeave.call(this, e),
          e && e.stopPropagation(),
          this.processing ||
            (this.shouldAutoplay
              ? (this.$video[0].pause(),
                (this.$video[0].currentTime = this._keyTime),
                (this._alreadyPlayTwice = !1))
              : (this._hideUpdateButton(), this.$updateButton.off("click")),
            this.firstAutoPlay && (this.firstAutoPlay = !1),
            (this._loop = !1),
            (this._isInLargerThumbState = !1));
      },
      _handleMobileTap: function () {
        return this._isInLargerThumbState
          ? void this._handleNavigateRequest()
          : (Helpers.GlobalEventTracker.pipEvent("static:pip:hover"),
            this.element.mouseenter(),
            void (this._isInLargerThumbState = !0));
      },
      cancelAutomaticPreview: function () {
        this.shouldGeneratePreviewAutomatically = !1;
      },
      _popoverShown: function () {
        this.wasPopoverShown = !0;
      },
      _toggleContainer: function () {
        UI.AnimatedTemplates.BasePiP.prototype._toggleContainer.call(this),
          this.isHidden
            ? this._hideUpdateButton()
            : this.shouldAutoplay || this._showUpdateButton();
      },
      isProcessing: function () {
        return this.processing;
      },
      _thereAreUrlChanges: function () {
        var e = Helpers.App.getAllURLParams();
        return (
          delete e.linked_smart_template_id,
          delete e.video_stateId,
          delete e.ngin,
          $.isEmptyObject(e) === !1
        );
      },
    },
  }),
  Module("ControlsGroupingSupport")({
    CLASSES_BY_TAB_NAME: {
      Text: ["TextControlGroup"],
      Colors: ["ColorControl"],
      Graphics: ["CustomGraphicControl", "MultiControl", "AddGraphicButton"],
      Options: ["AlternateValueControl", "Layout"],
    },
    prototype: {
      _getTabsArray: function (e) {
        var t = [],
          n = {
            Text: [],
            Colors: [],
            Graphics: [],
            Options: [],
          },
          i = function () {
            var t = e.MultiControl.filter(function (e) {
                return e.hasAssets() === !0;
              }),
              i = e.MultiControl.filter(function (e) {
                return e.hasAssets() === !1;
              });
            $.merge(n.Colors, i), $.merge(n.Graphics, t);
          };
        for (var r in n) {
          var s = this.constructor.CLASSES_BY_TAB_NAME[r];
          s.forEach(function (t) {
            e.hasOwnProperty(t) !== !1 &&
              ("MultiControl" === t ? i() : $.merge(n[r], e[t]));
          });
        }
        for (var r in n) {
          var o = n[r];
          "Graphics" === r && Helpers.StageType.isVideoV4() && (r = "Visuals"),
            o.length > 0 &&
              t.push({
                name: r,
                contents: o,
              });
        }
        return t;
      },
      _getUIMobileGroupedControls: function () {
        var e, t, n, i;
        return (
          (e = this),
          (t = {}),
          (n = [
            "leftSideBar",
            "rightSideBar",
            "bgMobileSideBar",
            "audioMobileSideBar",
            "stageActionsManager",
          ]),
          (i = [
            "TextControlGroup",
            "Layout",
            "ColorControl",
            "MultiControl",
            "CustomGraphicControl",
            "AudioControl",
            "AlternateValueControl",
            "AddGraphicButton",
          ]),
          n.forEach(function (n) {
            e.hasOwnProperty(n) &&
              e[n].children.forEach(function (n) {
                i.includes(n.constructor.className) &&
                  e._canShowUIMobileControl(n) &&
                  (t.hasOwnProperty(n.constructor.className) ||
                    (t[n.constructor.className] = []),
                  t[n.constructor.className].push(n));
              });
          }),
          t.MultiControl &&
            (t.MultiControl = this._sortUIMobileMulticontrol(t.MultiControl)),
          t
        );
      },
      _sortUIMobileMulticontrol: function (e) {
        if (e) {
          var t = this,
            n = [],
            i = [],
            r = [],
            s = [],
            o = [],
            a = [];
          return (
            this.record.asset_library &&
              (s = this.record.asset_library.map(function (e) {
                return e.name;
              })),
            this.record.graphic &&
              (o = this.record.graphic.map(function (e) {
                return e.name;
              })),
            this.record.video &&
              (a = this.record.video.map(function (e) {
                return e.name;
              })),
            e.forEach(function (e) {
              var l = s.indexOf(e.record.name),
                c = o.indexOf(e.record.name),
                u = a.indexOf(e.record.name);
              l >= 0
                ? n.splice(l, 0, e)
                : c >= 0
                ? i.splice(c, 0, e)
                : u >= 0
                ? r.splice(u, 0, e)
                : t.record.background && n.splice(0, 0, e);
            }),
            n.concat(i, r)
          );
        }
      },
    },
  }),
  Class(UI, "StageBase")
    .inherits(Widget)
    .includes(
      ChangesCounterSupport,
      AnimatedTemplatesSupport,
      SkeletonCardManagerSupport,
      SkeletonCardSupport,
      ControlsGroupingSupport,
      ThemeSupport,
      SwitchStageThemeSupport,
      AlgoliaAnalyticsSupport,
      StageFontsSupport,
      CDNSupport
    )({
    elementClass: "stage-object-image",
    html: '        <div>            <button class="download-btn" type="button">Download</button>            <button class="edit-btn" type="button">Edit</button>            <input type="file" class="stage-upload-file">            <img class="stage-base-image">            <img class="stage-background-image">            <img class="stage-foreground-image">            <img class="stage-processed-image">            <span class="loader">Loading</span>        </div>    ',
    acceptedFiles: {
      image: {
        "image/png": !0,
        "image/jpeg": !0,
      },
      video: {
        "video/mp4": !0,
        "video/quicktime": !0,
      },
      app: {
        "application/vnd.android.package-archive": !0,
        "": !0,
        "application/zip": !0,
        "application/x-gzip": !0,
      },
    },
    acceptedFormats: {
      image: ".png,.jpeg,.jpg",
      video: ".mp4,.mov",
      app: "apk, zip, tar.gz",
    },
    maxSizeAllowed: {
      image: 20e6,
      video: 1e8,
      resizecrop: 12e6,
    },
    storagePath: {
      image: "/stages/store_image",
      video: "/stages/store_video",
      app: "/stages/upload_app",
      videoproduct: "/video_products",
      fusionvideo: "/placeit/video/v4",
    },
    processPath: {
      image: "/stages/",
      video: "/stages/video_crop_params/",
      videoproduct: "/video_products/",
      fusionvideo: "/placeit/video/v4",
      fusionfullvideo: "/placeit/video/v4/full_video",
    },
    EMPTY_PRODUCTSHOT_PATH: "/stages/create_productshot_without_user_image",
    CLONE_PRODUCTSHOT_PATH: "/stages/clone_productshot",
    GENERIC_PROCESSING_ERROR_MESSAGE:
      "There was an error processing your image.",
    GENERIC_UPLOADING_WARN_MESSAGE: "Please wait for your upload to finish...",
    maxLoadTries: 90,
    loadIncrementalInterval: 500,
    psdProcessingTimeoutMs: 3e4,
    ALGOLIA_FONTS_RESULT_QUANTITY: 1e3,
    prototype: {
      dragoverListenerHandler: null,
      dragleaveListenerHandler: null,
      dropListenerHandler: null,
      loadTries: 0,
      downloaded: !1,
      imageProcessed: null,
      dropPointID: null,
      multipleScreenShots: null,
      dropPoints: [],
      holderVersion: "one",
      productshotData: {
        stage_id: null,
        productshot: null,
      },
      isVideoDemo: !1,
      videoWorkInProgress: !1,
      _inputCache: {},
      notificationTimeout: null,
      statusFetcher: null,
      psdProcessing: !1,
      _psdProcessingTimer: null,
      imgExistChecker: null,
      _lastUserInteraction: null,
      currentlyOpenedFontSizesComponent: null,
      syncDraftPromise: null,
      syncDraftsDebounce: null,
      resultShown: {
        start: 0,
        end: 0,
        origin: "",
        sent: !1,
      },
      carouselSettings: {
        arrows: !1,
        centerMode: !1,
        draggable: !0,
        infinite: !1,
        mobileFirst: !0,
        slidesToScroll: 2,
        slidesToShow: 1.5,
        swipeToSlide: !0,
        responsive: [
          {
            breakpoint: 511,
            settings: {
              slidesToScroll: 3,
              slidesToShow: 2.5,
            },
          },
          {
            breakpoint: 767,
            settings: {
              slidesToScroll: 4,
              slidesToShow: 3.5,
            },
          },
          {
            breakpoint: 1024,
            settings: {
              arrows: !0,
              draggable: !1,
              slidesToScroll: 6,
              slidesToShow: 6,
              swipeToSlide: !1,
            },
          },
        ],
      },
      _mobileSpectrumWrappers: {},
      init: function (e) {
        console.time("PiP"), Widget.prototype.init.call(this, e);
        var t = this;
        (this.$body = $(document.body)),
          (this.$pageWrapper = $(".page-wrapper")),
          (this.$pageContainer = $(".page-container")),
          (this.$file = this.element.find(".stage-upload-file")),
          (this.$editBtn = this.element.find(".edit-btn")),
          (this.stageImgContainer = this.$pageWrapper.find(".stage-object")),
          (this.$bottom_info = this.stageImgContainer.find(
            ".stage-info-wrapper"
          )),
          (this.$mobileControlsContainer = $(
            ".stage-mobile-controls-container"
          )),
          (this.$noMovementOption = this.stageImgContainer.find(
            ".no-movement-option-group"
          )),
          (this.$notification = this.element.find(
            ".processing-notification-box"
          )),
          (this.$similarStagesContainer = $(".similar-stages-container")),
          (this.$relatedTemplatesContainer = $(".related-templates-container")),
          (this.$savedConfigurationsContainer = $(
            ".saved-configurations-container"
          )),
          (this.colorpickerSharedColors = new ColorpickerSharedColors()),
          (this.$stageDescription = $(".stage-info-wrapper")),
          [8, 14].indexOf(window._stageData.stage_data.image_type) > -1
            ? this.$file.attr("accept", ".mp4")
            : this.$file.attr("accept", ".jpg, .png, .jpeg"),
          this.bindSkeletonManager(),
          this._setAlgoliaAnalyticsQueryFromUrl();
        var n = !!Object.keys(this._getURLParams()).length;
        this.appendChild(
          new UI.StageImage({
            name: "stageImageWidget",
            schemaName: "Placeit Stage Image",
            element: this.element.find(".stage__image-wrapper--foreground"),
            addVideo: Helpers.StageType.isVideoV4(),
            hasParams: n,
          })
        ),
          this.stageImageWidget.updateSource(this.source),
          Helpers.StageType.setStageInfo(window._stageData.stage_data),
          this.initSwitchStageThemeSupport(),
          this._initStageActionManager(),
          this._setStageActionsManagerBindings(),
          this._initSaveDraftSupport(),
          this.stageActionsManager.bind(
            "user-has-bookmarks",
            function (e) {
              this.dispatch("user-has-bookmarks", e.data);
            }.bind(this)
          ),
          this.$similarStagesContainer.get(0) &&
            !this.manuallyLoadAssets &&
            this.instantiateSimilarStages()
              .loadAssets()
              .bind("thumbnailPreview", function (e) {
                t.dispatch("thumbnailPreview", e.data);
              }),
          document.body.addEventListener(
            "click",
            function () {
              t._lastUserInteraction = new Date().getTime();
            },
            !0
          ),
          (this.increment = Helpers.App.debounce(
            this.increment.bind(this),
            150,
            !1
          )),
          Helpers.StageType.isSmartTemplate() !== !0 &&
            (console.time("Init AT classes"),
            t.instantiateWidgetsIfAnimatedTemplate()),
          this.bind("updateWorkAreaDimentions", function () {
            t.unbind("updateWorkAreaDimentions"),
              t.stageImageWidget.setDimensions(t.record.original.size),
              t.stageImageWidget.updateWorkAreaDimentions();
          });
      },
      _setupFontsModal: function () {
        var e = this;
        if (!e.fontsModal) {
          window.fontTags = Helpers.App.sortObjAlphabetically(
            window.fontTags,
            "tag"
          );
          var t = new UI.FontsModal({
            name: "fontsModal",
            tags: window.fontTags,
            fontListManager: e.fontListManager,
          });
          t.render($(document.body)), e.appendChild(t);
        }
      },
      instantiateSimilarStages: function () {
        return (
          this.appendChild(
            new UI.SimilarStagesGrid({
              name: "similarStages",
              element: this.$similarStagesContainer,
              fullWidth: this.similarStagesFullWidth,
            })
          ),
          this.similarStages
        );
      },
      setChangesCounterBindings: function () {
        var e = this;
        this.bind("newChange", function (t) {
          var n = t.data.newValue - t.data.oldValue;
          1 === n
            ? e.stageActionsManager.changeDraftHandler(n)
            : t.data.fromIncrement
            ? e.stageActionsManager.changeDraftHandler(n)
            : ((e.stageActionsManager.nChanges = t.data.newValue),
              e.stageActionsManager.changeSaveButtonState());
          for (var i = 0; n > i; i++) this.newChange();
        });
      },
      setDownloaded: function (e) {
        return (this.downloaded = e), this;
      },
      getDownloaded: function () {
        return this.downloaded;
      },
      _renderTextControls: function (e) {
        var t,
          n,
          i = this;
        this.record.text.length > 0 &&
          ((t = this._createTextControlGroup()),
          this._beforeBuildTextControls()),
          this.record.text.forEach(function (r, s) {
            (n = i._createTextControl({
              textItem: r,
              itemIndex: s,
              slidePrefix: e,
            })),
              t.appendChild(n),
              n.render(t.element);
          });
      },
      _beforeBuildTextControls: function () {
        this._setupFontsModal(), this._bindLoginToUpdateSavedFonts();
      },
      _createTextControlGroup: function () {
        var e = new UI.SmartTemplate.TextControlGroup({
          name: "textControlGroup",
        });
        return (
          this.leftSideBar.appendChild(e),
          e.render(this.leftSideBar.element),
          e.element.prepend($('<span id="text-indicator">Text</span>')),
          e
        );
      },
      _bindLoginToUpdateSavedFonts: function () {
        var e = this;
        this._boundSavedFontsLogin ||
          (page.appNavBar.bind("login.success", function () {
            e.savedFonts
              .fetchFonts()
              .then(function (t) {
                return e._findSavedFontsInIndex(t);
              })
              .then(function (t) {
                return e._feedHitsToSavedFontsList(t);
              });
          }),
          (this._boundSavedFontsLogin = !0));
      },
      _findSavedFontsInIndex: function (e) {
        return e.savedFonts && 0 !== e.savedFonts.length
          ? AlgoliaClient.findFontsBy(
              {
                id: e.savedFonts,
              },
              150
            )
          : Promise.resolve(AlgoliaClient.getEmptyResponse());
      },
      _feedHitsToSavedFontsList: function (e) {
        var t = this;
        return (
          window.AlgoliaFontDataAdapter.adaptAlgoliaResponse(e),
          e.hits.forEach(function (e) {
            var n = new Font({
              data: e,
            });
            t.fontListManager.getList("saved").add(n, "name"),
              t.fontListManager.getList("all").add(n, "name");
          }),
          new Promise.resolve()
        );
      },
      _getTextControls: function () {
        var e = this.leftSideBar.textControlGroup;
        return e ? e.children : [];
      },
      _isImageStage: function () {
        return "StageCanvas" === this.constructor.className;
      },
      _createTextControl: function (e) {
        var t = this,
          n = e.textItem.type || e.itemIndex,
          i = Helpers.App.getAllURLParams(),
          r = t._isImageStage(),
          s = Helpers.App.isMobile(),
          o = r ? e.textItem.type + "_" + e.textItem.name : n + e.textItem.name,
          a = {
            name: o,
            record: e.textItem,
            isMobilePhone: s,
            prefillText: i[(e.slidePrefix || "") + "text" + o],
            prefillColor: i[(e.slidePrefix || "") + "color" + o],
            prefillFont: i[(e.slidePrefix || "") + "font" + o],
            prefillCheckbox: i[(e.slidePrefix || "") + "checkbox" + o],
            prefillSize: i[(e.slidePrefix || "") + o + "_fontSize"],
            defaultDebounceTime: t.canProcessWithEngine ? 100 : 1e3,
            fontsModal: t.fontsModal,
            fontListManager: t.fontListManager,
            savedFonts: t.savedFonts,
          };
        r || ((a.prefix = e.slidePrefix), (a.stageType = "video"));
        var l = new UI.SmartTemplate.TextControl(a);
        return (
          l.bind("showFontSizes", function (e) {
            if (t.currentlyOpenedFontSizesComponent) {
              var n =
                e.target.name !==
                t.currentlyOpenedFontSizesComponent.parent.name;
              n &&
                (t.currentlyOpenedFontSizesComponent.hide(!0),
                (t.currentlyOpenedFontSizesComponent = null));
            }
            t.currentlyOpenedFontSizesComponent = e.target.fontSize;
          }),
          l.bind("focus", function (e) {
            t._textEditingOverlay(e);
          }),
          l
        );
      },
      _isOlarkChatButtonAvailable: function () {
        return (
          0 !== $("#olark-wrapper").length &&
          !$("#olark-wrapper").hasClass("olark-hidden")
        );
      },
      _textEditingOverlay: function (e) {
        var t = this;
        if (Helpers.App.isMobile()) {
          var n = e.target;
          Modals.editTextControlModal ||
            (Modals.editTextControlModal = new UI.TextEditionOverlay({
              name: "editTextControlModal",
            })),
            t._textEditingOverlayActivateHandler(Modals.editTextControlModal),
            Modals.editTextControlModal.activate(n.record),
            Modals.editTextControlModal.unbind("change"),
            Modals.editTextControlModal.bind("change", function (e) {
              n.setText(e.data.value),
                n._updateCharacterCount(),
                $("main")[0].scrollIntoView();
            }),
            t._textEditingOverlayDeactivatedHandler(
              Modals.editTextControlModal
            );
        }
      },
      _textEditingOverlayActivateHandler: function (e) {
        var t = this,
          n = function (e) {
            t._hideOlarkChatButton(e);
          };
        e.unbind("activate", n), e.bind("activate", n);
      },
      _textEditingOverlayDeactivatedHandler: function (e) {
        var t = this,
          n = function (e) {
            t._showOlarkChatButton(e);
          };
        e.unbind("deactivate", n), e.bind("deactivate", n);
      },
      _showOlarkChatButton: function () {
        var e = this;
        e._isOlarkChatButtonAvailable() !== !1 &&
          $(".olark-launch-button-wrapper").show();
      },
      _hideOlarkChatButton: function () {
        var e = this;
        e._isOlarkChatButtonAvailable() !== !1 &&
          $(".olark-launch-button-wrapper").hide();
      },
      _setStageTypeToElement: function (e) {
        return (
          e
            .removeClass(
              "                is_still is_wide-still is_blender is_multi-stage is_multicolor                is_workflow is_liveImage is_video is_psd is_video-product                "
            )
            .addClass("is_" + Helpers.StageType.getStageType()),
          this
        );
      },
      enableActions: function () {
        return (
          this.multipleScreenShots ||
            Helpers.StageType.hasGesture() ||
            this.element.addClass("has-content"),
          this.stageActionsManager.showButtonsForState("finish"),
          this
        );
      },
      disableActions: function () {
        this.element.removeClass("has-content");
      },
      _handleStageData: function (e) {
        var t = e.action_buttons;
        this.stageActionsManager
          .setStageButtonsInfo(t)
          .showButtonsForState("start"),
          this._hasUploadButtons(t) === !1 && this.ignoreMainFileUpload(),
          e.variations &&
            e.variations.length > 0 &&
            15 != _stageData.stage_data.image_type &&
            this._handleVariations(e.variations);
      },
      _hasUploadButtons: function (e) {
        var t = !1,
          n = ["active", "disabled"];
        return (
          Object.keys(e).forEach(function (i) {
            n.forEach(function (n) {
              $.inArray("image_upload", e[i][n]) > -1 && (t = !0);
            });
          }),
          t
        );
      },
      ignoreMainFileUpload: function () {
        (this.element.get(0).ondragover = function (e) {
          e.preventDefault();
        }),
          (this.element.get(0).ondragend = function (e) {
            e.preventDefault();
          }),
          (this.element.get(0).ondrop = function (e) {
            e.preventDefault();
          });
      },
      refreshProductshotData: function () {
        var e;
        this.imageProcessed &&
          ((e = this.productshotData),
          Helpers.StageType.setStageInfo(this.mainStageData),
          Helpers.StageType.setProductshotInfo(e.productshot));
      },
      _showGenericProcessingError: function (e) {
        return (
          (e = e || {}),
          (e.message = this.constructor.GENERIC_PROCESSING_ERROR_MESSAGE),
          this.dispatch("stage.error", e),
          this
        );
      },
      setNotificationText: function (e) {
        this.$notification.find(".text-content").text(e);
      },
      _initStageActionManager: function () {
        this.appendChild(
          new UI.StageObjectActionsManager({
            name: "stageActionsManager",
            element: $(".stage-object-actions"),
          })
        );
      },
      _setStageActionsManagerBindings: function () {
        var e;
        (e = this),
          e.stageActionsManager.bind("download", function () {
            e.sendAlgoliaAnalyticsStageConversionEvent();
          });
      },
      _initSaveDraftSupport: function () {
        var e = this;
        e.buildSavedDraftContainer(),
          (e.stageActionsManager.nDrafts =
            e.savedDraftsContainer.getDraftCount());
        var t = Utils.bindFn(this);
        e.bind("syncDrafts", t(this._syncDraftsContainerDebounce)),
          e.bind("removeSavedDraft", t(this._removeSavedDraftHandler)),
          e.stageActionsManager.bind("save", function () {
            e.stageActionsManager.saveButtonLoading(!0),
              e
                .saveDraft()
                .then(t(e.saveDraftSuccessHandler))
                ["catch"](t(e.saveDraftErrorHandler));
          });
      },
      _removeSavedDraftHandler: function () {
        this._cancelSyncDraftPromise();
      },
      buildSavedDraftContainer: function () {
        var e = this,
          t = {
            name: "savedDraftsContainer",
          },
          n = $(".saved-drafts-container");
        n.length > 0 && (t.element = n),
          e
            .appendChild(new UI.SavedDraftsContainer(t))
            .render($(".page-container"));
      },
      saveDraftSuccessHandler: function (e) {
        var t = this;
        t.savedDraftsContainer.show(),
          t.addDraftToContainer(e),
          t.dispatch("syncDrafts", {
            response: e,
            action: "create",
            success: "true",
          });
      },
      saveDraftErrorHandler: function (e) {
        var t = this;
        if (
          (t.stageActionsManager.saveButtonLoading(!1),
          422 === e.status && e.responseJSON.existent_drafts >= 20)
        )
          return (
            t.dispatch("saveDraft.error", {
              errorMessage:
                "Drafts Limit Reached (20). Delete a Draft to Save a New One",
              seconds: 5,
            }),
            void t.dispatch("syncDrafts", {
              error: e,
              action: "create",
              success: !1,
            })
          );
        throw (
          (t.dispatch("saveDraft.error", {
            errorMessage: "Draft not Saved!",
            seconds: 5,
          }),
          new Error(
            "Save draft request error: " +
              JSON.stringify({
                responseJSON: e.responseJSON,
                status: e.status,
                statusText: e.statusText,
              })
          ))
        );
      },
      _syncDraftsContainerDebounce: function (e) {
        var t = this;
        null !== this.syncDraftsDebounce &&
          clearTimeout(this.syncDraftsDebounce),
          (this.syncDraftsDebounce = setTimeout(function () {
            t._cancelSyncDraftPromise(), t.syncDraftsContainerHandler(e);
          }, 500));
      },
      _cancelSyncDraftPromise: function () {
        null !== this.syncDraftPromise &&
          (this.syncDraftPromise.cancel(), (this.syncDraftPromise = null));
      },
      syncDraftsContainerHandler: function (e) {
        var t = this,
          n = function (n) {
            var i = e.data,
              r = 0;
            return (
              i.response &&
                i.response.changesBeforeRequest &&
                (r = i.response.changesBeforeRequest),
              0 === n.length
                ? t.savedDraftsContainer.hide()
                : t.savedDraftsContainer.show(),
              t.savedDraftsContainer.syncSavedDraftsItems(n),
              t.stageActionsManager.syncDraftHandler(
                t.savedDraftsContainer.getDraftCount(),
                r
              ),
              1 === n.length &&
                "create" === i.action &&
                setTimeout(function () {
                  t.goToDraftCarousel();
                }, 250),
              n
            );
          },
          i = function (e) {
            if ("Cancelation Error" === e.message)
              return void console.warn("syncDraft promise: cancel");
            throw (
              (t.dispatch("saveDraft.error", {
                errorMessage: "Draft sync failure!",
                seconds: 5,
              }),
              new Error(
                "Save draft request error: " +
                  JSON.stringify({
                    responseJSON: e.responseJSON,
                    status: e.status,
                    statusText: e.statusText,
                  })
              ))
            );
          };
        return (
          (this.syncDraftPromise = P.cancelable(function () {
            return Draft.findByStageId(Helpers.StageType.getStageID());
          })()),
          this.syncDraftPromise.then(n)["catch"](i)
        );
      },
      saveDraft: function () {
        var e = this;
        e.stageActionsManager.saveButtonLoading(!0);
        var t = this.prepareDataToSaveDraft(),
          n = this.stageActionsManager.nChanges,
          i = new Draft(t);
        return i
          .save()
          .then(function (t) {
            return (
              Helpers.GlobalEventTracker.draftItemSaved({
                draftId: t.id,
                stageId: Helpers.StageType.getStageID(),
              }),
              e.dispatch("saveDraft.success", {
                message:
                  'Draft Saved! <a id="link-to-saved-drafts">It\'s Here \u2193</a>',
                seconds: 5,
              }),
              (t.changesBeforeRequest = n),
              t
            );
          })
          ["catch"](function (e) {
            return (e.changesBeforeRequest = n), e;
          });
      },
      _addDragEventsListeners: function (e) {
        var t,
          n,
          i = this,
          r = "StageCanvas" === this.constructor.className;
        (t = r ? this.record.customGraphic.length : this.record.images.length),
          (n = !1),
          document.body.removeEventListener(
            "dragover",
            this.dragoverListenerHandler,
            !0
          ),
          document.removeEventListener(
            "dragleave",
            this.dragleaveListenerHandler,
            !0
          ),
          document.removeEventListener("drop", this.dropListenerHandler, !0);
        var s = function (r) {
          var s, o;
          if (
            ((s = r.target),
            (o = UI.SmartTemplate.FileInputControl.elementClass),
            !$(s).hasClass("fade") &&
              ((s.classList.contains(o) ||
                s.parentNode.classList.contains(o) ||
                s.parentNode.parentNode.classList.contains(o) ||
                s.parentNode.parentNode.parentNode.classList.contains(o) ||
                s.classList.contains("drop-zone")) &&
                r.preventDefault(),
              !n))
          ) {
            n = !0;
            for (var a = 0; t > a; ++a)
              i._filesContainer[(e || "") + "customG_" + a].setLabelDragged();
          }
        };
        document.body.addEventListener("dragover", s, !0);
        var o = function (r) {
          var s;
          (r = r || window.event),
            (s = function () {
              n = !1;
              for (var r = 0; t > r; ++r)
                i._filesContainer[(e || "") + "customG_" + r].resetLabel();
            });
          try {
            (0 === r.pageX || 0 === r.pageY) && s();
          } catch (o) {
            s();
          }
        };
        document.addEventListener("dragleave", o, !0);
        var a = function (r) {
          n = !1;
          for (var s = 0; t > s; ++s)
            i._filesContainer[(e || "") + "customG_" + s].resetLabel();
          var o, a, l;
          if (
            ((o = r.target),
            (l = UI.SmartTemplate.FileInputControl.elementClass),
            !$(o).hasClass("fade"))
          ) {
            if (o.classList.contains(l))
              r.preventDefault(), (a = $(o).find('input[type="file"]'));
            else if (o.parentNode.classList.contains(l))
              r.preventDefault(), (a = $(o).siblings('input[type="file"]'));
            else if (
              o.parentNode.parentNode.classList.contains(l) ||
              o.parentNode.parentNode.parentNode.classList.contains(l)
            )
              r.preventDefault(),
                (a = $(o.parentNode).siblings('input[type="file"]'));
            else {
              if (!o.classList.contains("drop-zone") || !o.dataset.dropTargetId)
                return !1;
              r.preventDefault(), (a = $("#" + o.dataset.dropTargetId));
            }
            var c = o.files || (r.dataTransfer && r.dataTransfer.files);
            if (c) {
              a.val(null);
              for (var s = 0; t > s; ++s) {
                var u = i._filesContainer[(e || "") + "customG_" + s];
                a.is(u.getFileInput()) && u.setFile(c[0]);
              }
            }
          }
        };
        document.addEventListener("drop", a, !0),
          (i.dragoverListenerHandler = s),
          (i.dragleaveListenerHandler = o),
          (i.dropListenerHandler = a);
      },
      getComponentsByClassName: function (e) {
        var t,
          n,
          i,
          r,
          s = this,
          o = [],
          a = [];
        return (
          (t = function (t) {
            return t.constructor.className === e;
          }),
          s.rightSideBar && s.leftSideBar
            ? ((n = s.rightSideBar.children.filter(t)),
              (i = s.leftSideBar.children.filter(t)),
              (r = s.leftSideBar.textControlGroup),
              r && (i = i.concat(r.children.filter(t))),
              s.isMobilePhone &&
                ((a = s.bgMobileSideBar.children.filter(t)),
                (o = s._filesContainer.children.filter(t))),
              n.concat(i).concat(a).concat(o))
            : []
        );
      },
      getComponentsByType: function (e) {
        var t,
          n,
          i,
          r = this,
          s = [];
        return (
          (t = function (t) {
            return t.type === e;
          }),
          (n = r.rightSideBar.children.filter(t)),
          (i = r.leftSideBar.children.filter(t)),
          r.isMobilePhone && (s = r.bgMobileSideBar.children.filter(t)),
          n.concat(i).concat(s)
        );
      },
      accomodateLeftSidebarScrollBar: function () {
        if (this.leftSideBar) {
          var e,
            t = this,
            n = this.leftSideBar.element;
          (e = function () {
            return n.get(0) ? n.get(0).scrollHeight > n.innerHeight() : !1;
          }),
            (hasGraphicsWithLayers = function () {
              var e = t.leftSideBar.children.filter(function (e) {
                return (
                  "GraphicControl" === e.constructor.className && e.hasLayers()
                );
              });
              return e.length;
            });
        }
      },
      _openComponentEventHandler: function (e) {
        var t = e.data.component;
        if (this._currentlyOpenComponent) {
          var n = this._currentlyOpenComponent.prop("nodeName");
          this._currentlyOpenComponent.hasClass("fontpicker") &&
            this._currentlyOpenComponent.hide(),
            ".picker-modal" === this._currentlyOpenComponent.selector
              ? this._currentlyOpenComponent.hide()
              : "INPUT" === n
              ? this._currentlyOpenComponent.spectrum("hide")
              : "BUTTON" === n && this._currentlyOpenComponent.click(),
            (this._currentlyOpenComponent = null);
        }
        return (this._currentlyOpenComponent = t), this;
      },
      _closedComponentEventHandler: function () {
        return (this._currentlyOpenComponent = null), this;
      },
      goToDraftCarousel: function () {
        this.savedDraftsContainer &&
          $("html, body").animate(
            {
              scrollTop: this.savedDraftsContainer.getOffSet().top,
            },
            500,
            "swing"
          );
      },
      _repositionVideoHandler: function (e) {
        Helpers.GlobalEventTracker.trimmerEvent("click", {
          id: e.data.recordHash,
        });
        var t = this,
          n = e.data,
          i = this._validateData(
            [
              "viewportData",
              "cropParams",
              "userVideoPath",
              "recordHash",
              "duration",
              "videoWidth",
              "videoHeight",
              "timelineUrls",
              "originalVideoUrl",
              "videoItem",
            ],
            n
          );
        return i.length
          ? t._notifyErrorMessage(
              "Cannot reposition video. Missing data: " + i.join(", ") + "."
            )
          : t.uploadPending === !0
          ? t._notifyWarnMessage(UI.StageBase.GENERIC_UPLOADING_WARN_MESSAGE)
          : (t.cropperModal.setViewportDimensions(n.viewportData).loadVideo(
              {
                cropperConstraints: {
                  zoom: !1,
                  movement: !1,
                },
                videoInfo: {
                  duration: Number(n.duration),
                  trimStart: Number(n.cropParams.trim_start),
                  trimEnd: Number(n.cropParams.trim_end),
                  fragmentDuration: Number(n.fragmentDuration),
                  timelineUrls: n.timelineUrls,
                  width: Number(n.videoWidth),
                  height: Number(n.videoHeight),
                },
                existingImageInfo: t._getFormattedCropParams(n.cropParams),
              },
              n.userVideoPath
            ),
            t._onceCroppedAndTrimmed(function (e, i) {
              (i.id = n.recordHash),
                (i.viewport = n.viewportData),
                (i.isVideo = !0),
                (i.type = n.cropParams.type),
                (i.is_custom_upload = n.cropParams.is_custom_upload),
                (i.original_video_url = n.originalVideoUrl),
                (i.isPremium = n.videoItem.record.isPremium),
                t._addLoaderDivElement(),
                t._disableTabbedControls(),
                n.videoItem.showFeedbackLayer("Cropping & Trimming"),
                Helpers.GlobalEventTracker.trimmerEvent(
                  "trimmed",
                  Object.assign({}, i)
                ),
                Helpers.GlobalEventTracker.smartTemplateEvent(
                  "cropVideoStart",
                  Object.assign({}, i)
                ),
                CropperRemoteCropper.cropVideo(i)
                  .then(function (e) {
                    Helpers.GlobalEventTracker.smartTemplateEvent(
                      "cropVideoEnd",
                      {
                        id: e.data.id,
                      }
                    );
                    var i = t._validateData(
                      [
                        "crop_params",
                        "cropped_video_url",
                        "duration",
                        "file_name",
                        "id",
                        "original_video_url",
                        "preview_url",
                        "thumbnail_url",
                        "timeline_urls",
                        "user_image_url",
                        "user_video_url",
                        "video_file_name",
                        "video_height",
                        "video_width",
                      ],
                      e.data
                    );
                    return i.length
                      ? Promise.reject(
                          "Cannot update cropped/trimmed video. Missing data " +
                            i.join(", ") +
                            "."
                        )
                      : (t._removeLoaderDivElement(),
                        t._enableTabbedControls(),
                        n.videoItem.hideFeedbackLayer(),
                        void n.videoItem.repositionFinished(e.data));
                  })
                  ["catch"](function (e) {
                    t._removeLoaderDivElement(),
                      t._enableTabbedControls(),
                      n.videoItem.hideFeedbackLayer(),
                      t._notifyErrorMessage(e);
                  });
            }));
      },
      _repositionVideoLibraryHandler: function (e) {
        var t = this,
          n = e.data,
          i = this._validateData(
            [
              "viewportData",
              "libraryId",
              "duration",
              "videoWidth",
              "videoHeight",
              "videoItem",
            ],
            n
          );
        return i.length
          ? t._notifyErrorMessage(
              "Cannot reposition video. Missing data: " + i.join(", ") + "."
            )
          : t.uploadPending === !0
          ? t._notifyWarnMessage(UI.StageBase.GENERIC_UPLOADING_WARN_MESSAGE)
          : ((t.uploadPending = !0),
            t._addLoaderDivElement(),
            t._disableTabbedControls(),
            n.videoItem.showFeedbackLayer("Loading"),
            Helpers.GlobalEventTracker.trimmerEvent("click", {
              id: n.libraryId,
            }),
            Helpers.GlobalEventTracker.smartTemplateEvent(
              "uploadLibraryVideoStart",
              {
                id: n.libraryId,
                type: n.videoItem.record.type,
              }
            ),
            CropperRemoteUploader.uploadVideoByUrl({
              library_id: n.libraryId,
              duration: n.duration,
              video_width: n.videoWidth,
              video_height: n.videoHeight,
              type: n.videoItem.record.type,
            })
              .then(function (e) {
                Helpers.GlobalEventTracker.smartTemplateEvent(
                  "uploadLibraryVideoEnd",
                  {
                    id: e.data.id,
                  }
                );
                var i = t._validateData(
                  [
                    "duration",
                    "file_name",
                    "id",
                    "original_video_url",
                    "timeline_urls",
                    "user_image_url",
                    "user_video_url",
                    "video_file_name",
                    "video_height",
                    "video_width",
                  ],
                  e.data
                );
                return i.length
                  ? $.Deferred().reject(
                      "Cannot load video. Missing data " + i.join(", ") + "."
                    )
                  : ((t.uploadPending = !1),
                    t._removeLoaderDivElement(),
                    t._enableTabbedControls(),
                    n.videoItem.hideFeedbackLayer(),
                    t.cropperModal
                      .setViewportDimensions(n.viewportData)
                      .loadVideo(
                        {
                          cropperConstraints: {
                            zoom: !1,
                            movement: !1,
                          },
                          videoInfo: {
                            duration: e.data.duration,
                            fragmentDuration: n.fragmentDuration,
                            width: e.data.video_width,
                            height: e.data.video_height,
                            timelineUrls: e.data.timeline_urls,
                          },
                        },
                        e.data.user_video_url
                      ),
                    void t._onceCroppedAndTrimmed(function (i, r) {
                      (r.id = e.data.id),
                        (r.viewport = n.viewportData),
                        (r.isVideo = !0),
                        (r.type = n.videoItem.record.type),
                        (r.original_video_url = e.data.original_video_url),
                        (r.is_custom_upload = !1),
                        (r.isPremium = n.videoItem.record.isPremium),
                        t._addLoaderDivElement(),
                        t._disableTabbedControls(),
                        n.videoItem.showFeedbackLayer("Cropping & Trimming"),
                        Helpers.GlobalEventTracker.trimmerEvent(
                          "trimmed",
                          Object.assign({}, r)
                        ),
                        Helpers.GlobalEventTracker.smartTemplateEvent(
                          "cropVideoStart",
                          Object.assign({}, r)
                        ),
                        CropperRemoteCropper.cropVideo(r)
                          .then(function (e) {
                            Helpers.GlobalEventTracker.smartTemplateEvent(
                              "cropVideoEnd",
                              {
                                id: e.data.id,
                              }
                            );
                            var i = t._validateData(
                              [
                                "crop_params",
                                "cropped_video_url",
                                "duration",
                                "file_name",
                                "id",
                                "original_video_url",
                                "preview_url",
                                "thumbnail_url",
                                "timeline_urls",
                                "user_image_url",
                                "user_video_url",
                                "video_file_name",
                                "video_height",
                                "video_width",
                              ],
                              e.data
                            );
                            return i.length
                              ? Promise.reject(
                                  "Cannot update cropped/trimmed video. Missing data " +
                                    i.join(", ") +
                                    "."
                                )
                              : (t._removeLoaderDivElement(),
                                t._enableTabbedControls(),
                                n.videoItem.hideFeedbackLayer(),
                                void n.videoItem.repositionFinished(
                                  e.data,
                                  n.videoItem.element
                                ));
                          })
                          ["catch"](function (e) {
                            t._removeLoaderDivElement(),
                              t._enableTabbedControls(),
                              n.videoItem.hideFeedbackLayer(),
                              t._notifyErrorMessage(e);
                          });
                    }));
              })
              ["catch"](function (e) {
                (t.uploadPending = !1),
                  t._removeLoaderDivElement(),
                  t._enableTabbedControls(),
                  n.videoItem.hideFeedbackLayer(),
                  t._notifyErrorMessage(e);
              }));
      },
      _validateData: function (e, t) {
        var n = [];
        return (
          e.forEach(function (e) {
            t[e] || n.push(e);
          }),
          n
        );
      },
      _notifyErrorMessage: function (e) {
        var t,
          n,
          i = this;
        return (
          "string" == typeof e
            ? (n = e)
            : ((t = e.responseJSON || {}),
              (n =
                t.error || "Couldn\u2019t process asset, please try again.")),
          i.dispatch("stage.error", {
            message: n,
          })
        );
      },
      _notifyWarnMessage: function (e, t) {
        var n = this;
        if (e)
          return n.dispatch("stage.warn", {
            message: e,
            seconds: t || 3,
          });
      },
      _onceCroppedAndTrimmed: function (e) {
        var t,
          n,
          i,
          r,
          s,
          o = this;
        return (
          (t = function () {
            o.cropperModal.activate();
          }),
          (n = function (t, n) {
            return s(), e(t, n);
          }),
          (s = function () {
            return o.cropperModal
              .unbind("imageLoaded", t)
              .unbind("cropImage", n)
              .unbind("imageLoadError", i)
              .unbind("modal.cancel", r);
          }),
          (i = s),
          (r = s),
          o.cropperModal
            .bind("imageLoaded", t)
            .bind("cropImage", n)
            .bind("imageLoadError", i)
            .bind("modal.cancel", r)
        );
      },
      _getFormattedCropParams: function (e) {
        return {
          aw: Number(e.actual_width),
          ah: Number(e.actual_height),
          w: Number(e.new_width),
          h: Number(e.new_height),
          at: Number(e.actual_top),
          al: Number(e.actual_left),
          t: Number(e.image_element_top),
          l: Number(e.image_element_left),
          s: Number(e.zoom),
        };
      },
      getDraft: function () {
        var e = this;
        e.dispatch("savedDraft.requestCompleted", {
          failedToLoad: !1,
        });
      },
      _enableTabbedControls: function () {
        this.stageControlTabs && this.stageControlTabs.enable();
      },
      _disableTabbedControls: function () {
        this.stageControlTabs && this.stageControlTabs.disable();
      },
      _canShowUIMobileControl: function (e) {
        var t;
        switch (e.type) {
          case "background":
            if (
              ((t = this.getComponentsByType("background")),
              (t = t.filter(function (e) {
                return (
                  (e.record.allowColorpicker === !1 &&
                    e.record.hasLayers === !1) == !1
                );
              })),
              !t.length)
            )
              return !1;
            break;
          case "graphic":
            if (
              ((t = this.getComponentsByType("graphic")),
              (t = t.filter(function (e) {
                return (
                  (e.record.allowColorpicker === !1 &&
                    e.record.hasLayers === !1) == !1
                );
              })),
              !t.length)
            )
              return !1;
            break;
          case "addGraphic":
            return !0;
        }
        return "none" === e.element.css("display") ||
          "hidden" === e.element.css("visibility")
          ? !1
          : !0;
      },
      _bindUIMobileEvents: function () {
        $(document).unbind("click.spectrum");
      },
      _renderUIMobile: function () {
        var e, t, n;
        (e = this),
          this._createUserGraphicTabs(),
          (n = this._getUIMobileGroupedControls()),
          n.hasOwnProperty("AudioControl") &&
            n.AudioControl[0].render(this.stageActionsManager.element),
          n.hasOwnProperty("TextControlGroup") &&
            n.TextControlGroup[0].bind("render", function (t) {
              e.resetControlsInstances(t.target);
            }),
          n.hasOwnProperty("CustomGraphicControl") &&
            n.CustomGraphicControl.forEach(function (e) {
              e.element
                .find("span.file-upload-label__control-title")
                .text("Upload Your Image");
            }),
          n.hasOwnProperty("MultiControl") &&
            n.MultiControl.forEach(function (t) {
              t.bind("render", function (t) {
                e.resetControlsInstances(t.target);
              });
            }),
          (t = this._getTabsArray(n)),
          n.hasOwnProperty("Layout") && (e.layoutTabIndex = t.length - 1),
          this._createComponentPopup(),
          this.stageControlTabs && this.stageControlTabs.destroy(),
          this.appendChild(
            new UI.TabbedContainers({
              name: "stageControlTabs",
              tabs: t,
              contentClass: "smart-templates__sidebar",
              isSlider: !0,
            })
          ).render(this.$mobileControlsContainer),
          this.stageControlTabs.element
            .find(".tabbedContainer-content")
            .each(function () {
              t.forEach(function (t) {
                t.contents.map(e.resetControlsInstances.bind(e));
              });
            }),
          this._bindUIMobileEvents(),
          this.dispatch("updateWorkAreaDimentions"),
          this.buildMobileOnboarding(),
          this._resize();
      },
      _resize: function () {
        this.stageControlTabs && this.stageControlTabs.setContentSliderHeight();
      },
      _createComponentPopup: function () {
        void 0 === this.componentPopup &&
          (this.appendChild(
            new UI.ComponentPopupBackdrop({
              name: "componentPopupBackdrop",
            })
          ).render(this.$mobileControlsContainer),
          this.appendChild(
            new UI.ComponentPopup({
              name: "componentPopup",
              cssClass: "mobile-colorpicker",
            })
          ).render(this.componentPopupBackdrop.element),
          (this._boundBackdropShow =
            this.showComponentPopupBackdrop.bind(this)),
          (this._boundBackdropHide =
            this.hideComponentPopupBackdrop.bind(this)),
          this.componentPopup.bind("show", this._boundBackdropShow),
          this.componentPopup.bind("hide", this._boundBackdropHide));
      },
      hideComponentPopupBackdrop: function () {
        this.componentPopupBackdrop.hide();
      },
      showComponentPopupBackdrop: function () {
        this.componentPopupBackdrop.show();
      },
      _createUserGraphicTabs: function () {
        var e, t, n;
        for (
          e =
            0 === Helpers.StageType.getMaxUserAddedGraphics()
              ? 0
              : Helpers.StageType.getMaxUserAddedGraphics() + 1,
            this._hasLogoCustomGraphic && e--,
            t = 0;
          e > t;
          t++
        )
          (n = new AddGraphicButton({
            name: "addGraphicButtonMobile" + t,
            maxAddedGraphics: e,
            builtInGraphicsCount: UserGraphicController._getBuiltInGraphicCount(
              this.record.graphic
            ),
            canProcessWithEngine: this.canProcessWithEngine,
            isAddedLogo: 0 === t && !this._hasLogoCustomGraphic,
            isMobile: Helpers.App.isMobile(),
            type: "addGraphic",
          })),
            this.rightSideBar.appendChild(n),
            this._addGraphicButtons.push(n);
      },
      buildMobileOnboarding: function () {
        var e = Helpers.App.getCookie("onboardingCanvasZoomScale").includes(
          "onboarding_completed"
        );
        !e &&
          this._isImageStage() &&
          this._supportsInteractions() &&
          this.canProcessWithEngine &&
          this.appendChild(
            new UI.OnboardingWizard({
              name: "onboardingCanvasZoomScale",
              steps: [
                {
                  key: "scaling_canvas_element",
                  settings: [
                    {
                      type: "overlay",
                      name: "onb-canvas-move-scale",
                      target: $("#main-content-wrapper"),
                      text: "Use gestures to interact with the template",
                      img: "/onboarding/pinch-scale-gesture.svg",
                      cssClass: "onboarding-canvas-move-scale",
                      button: "Got it!",
                      row: !0,
                    },
                  ],
                },
              ],
            })
          );
        var t = Helpers.App.getCookie("onboardingVideoOrderSlides").includes(
          "onboarding_completed"
        );
        !t &&
          Helpers.StageType.isVideoV4() &&
          (this.appendChild(
            new UI.OnboardingWizard({
              name: "onboardingVideoOrderSlides",
              steps: [
                {
                  key: "scaling_canvas",
                  settings: [
                    {
                      type: "overlay",
                      name: "onb-reorder-slides",
                      target: $(".video-slides-container"),
                      img: "/onboarding/video-order-slides.svg",
                      cssClass: "onboarding-video-order-slides",
                    },
                    {
                      type: "tooltip",
                      name: "onb-tooltip-taphold",
                      target: $(
                        ".video-slides-container .carousel-item"
                      ).first(),
                      text: "Tap and drag to change the slides order",
                      placement: "top",
                      button: "Got it!",
                    },
                  ],
                },
              ],
            })
          ),
          this.onboardingVideoOrderSlides.hidePopovers());
      },
      buildMobileMultiControlVideoOnboarding: function (e) {
        Helpers.GlobalEventTracker.deprecatedMethod({
          module: "StageBase::buildMobileMultiControlVideoOnboarding",
          file: "stage_base.js",
        }),
          Helpers.StageType.isVideoV4() &&
            (this.onboardingMultiControlVideo &&
              this.onboardingMultiControlVideo.destroy(),
            this.appendChild(
              new UI.OnboardingWizard({
                name: "onboardingMultiControlVideo",
                steps: [
                  {
                    key: "multicontrol_video",
                    settings: [
                      {
                        type: "overlay",
                        name: "onb-multicontrol_video",
                        target: e,
                        text: "Videos are marked with this play icon",
                        img: "/onboarding/multicontrol-with-videos.svg",
                        cssClass: "onboarding-multicontrol-video",
                        button: "Got it!",
                      },
                    ],
                  },
                ],
              })
            ));
      },
      resetControlsInstances: function (e) {
        var t = this,
          n = t.componentPopup.getComponentContainer(),
          i = "";
        switch (
          (e.constructor &&
            e.constructor.className &&
            (i = e.constructor.className),
          i)
        ) {
          case "TextControl":
            e.fontPicker.render(n);
            break;
          case "ColorControl":
            e.colorPickerDataSet.flat
              ? ((n = e.element.closest(".tabbedContainer-content")),
                n.find(".component-popup").remove())
              : (e.colorPickerDataSet.appendTo = n),
              e.record &&
                e.record.color &&
                (e.colorPickerDataSet.color = e.record.color),
              t._mobileSpectrumWrappers[e.name] &&
                t._mobileSpectrumWrappers[e.name].destroy(),
              (t._mobileSpectrumWrappers[e.name] = new SpectrumWrapper({
                $colorpicker: e.$colorpicker,
                spectrumConfig: e.colorPickerDataSet,
                limitedColors: "1" == e.record.limited_colors,
                $popupContainer: n,
              })),
              e.element.find(".sp-replacer").unbind("touchstart"),
              e.element.find(".sp-replacer").unbind("touchstart.spectrum"),
              e.element
                .find(".sp-palette")
                .undelegate(".sp-thumb-el", "touchstart.spectrum"),
              e.colorPickerDataSet.flat === !0 &&
                (e.element
                  .find(".sp-palette")
                  .delegate(
                    ".sp-palette-row-selection .sp-thumb-el",
                    "click",
                    function () {
                      e.$colorpicker.trigger("change");
                    }
                  ),
                e.element
                  .find(".sp-palette")
                  .delegate(
                    ".sp-palette-row .sp-thumb-el",
                    "click",
                    function () {
                      e.$colorpicker.trigger("change");
                    }
                  ));
            break;
          case "MultiControl":
            if (e.hasAssets() === !1) break;
            if (n.has(e.element).length) break;
            n.append(e.element), e.hide();
        }
        e.children &&
          e.children.length > 0 &&
          e.children.forEach(function (e) {
            t.resetControlsInstances(e);
          });
      },
      _getURLParams: function () {
        var e, t, n, i;
        return (
          (e = [
            /text\w+_\w+/,
            /color\w+_\w+/,
            /font\w+_\w+/,
            /checkbox\w+_\w+/,
            /background\w+_\w+/,
            /multi\w+_\w+/,
            /customG_\w+/,
            /pos-size_\w+/,
            /size\w+/,
            /zoom/,
            /layout/,
          ]),
          (t = Helpers.App.getAllURLParams()),
          (n = Object.keys(t).filter(function (t) {
            return e.reduce(function (e, n) {
              return e || n.test(t);
            }, !1);
          })),
          (i = {}),
          n.forEach(function (e) {
            i[e] = t[e];
          }),
          i
        );
      },
      _createFontLists: function () {
        if (void 0 === this.fontListManager) {
          var e = this;
          (e.fontListManager = new ObjectListManager({
            name: "fontListManager",
          })),
            e.fontListManager.createList("recent", {
              fonts: [],
              limit: 13,
            }),
            e.fontListManager.createList("saved", {
              fonts: [],
              limit: 104,
            }),
            e.fontListManager.createList("all", {
              fonts: [],
            });
        }
      },
      _setSavedFontsClass: function () {
        this.savedFonts = new SavedFonts({
          name: "savedFonts",
          readingEndpoint: "/api/v2/saved_fonts",
          writingEndpoint: "/api/v2/saved_fonts",
          deletionEndpoint: "/api/v2/saved_fonts/",
        });
      },
      _getForeignFonts: function (e) {
        return (
          this._compileStageRecordsFonts(e),
          this._validateForeignFonts(this._getFontNamesFromUrl(), "name")
        );
      },
      _setFontsIndexSearchParams: function (e, t) {
        var n = {};
        return 0 === e.length && 0 === t.length
          ? null
          : (t.length > 0 && (n.id = t), e.length > 0 && (n.name = e), n);
      },
      _compileStageRecordsFonts: function (e) {
        var t = this,
          n = t._collectStageFonts(e);
        return (
          "production" === window.environment
            ? window.DEFAULT_FONTS_PRODUCTION &&
              (n = n.concat(window.DEFAULT_FONTS_PRODUCTION))
            : window.DEFAULT_FONTS_STAGING &&
              (n = n.concat(window.DEFAULT_FONTS_STAGING)),
          t._pushIntoAllFontsList(n),
          n
        );
      },
      _pushIntoAllFontsList: function (e) {
        for (
          var t = this, n = t.fontListManager.getList("all"), i = 0;
          i < e.length;
          i++
        ) {
          var r = e[i];
          r.id = t._fontUrlToFontId(r.image);
          var s = new Font({
            data: r,
          });
          n.add(s, "name");
        }
      },
      _fontUrlToFontId: function (e) {
        return e.split("/").pop().split(".").shift();
      },
      _collectStageFonts: function (e) {
        return Helpers.App.arrayObjUnique(
          e.reduce(function (e, t) {
            return e.concat(t.allowedFonts);
          }, []),
          "name"
        );
      },
      _validateForeignFonts: function (e) {
        for (var t, n = [], i = this, r = 0; r < e.length; r++) {
          var s = e[r];
          (t = i.fontListManager.findInList("all", s)), null === t && n.push(s);
        }
        return n;
      },
      _getFontNamesFromUrl: function () {
        var e = Helpers.App.getAllURLParams(),
          t = /font[0-9]*Text/,
          n = [];
        for (var i in e) t.test(i) && n.push(e[i]);
        return n;
      },
      _feedFontList: function (e, t, n, i) {
        for (var r = this, s = 0; s < e.length; s++)
          for (var o = e[s], a = 0; a < n.length; a++) {
            var l = n[a];
            if (l[i] === o) {
              var c = new Font({
                data: l,
              });
              r.fontListManager.getList(t).add(c, "name"),
                r.fontListManager.getList("all").add(c, "name");
            }
          }
      },
    },
  }),
  Module("PanZoomSupport")({
    prototype: {
      minScale: 1,
      maxScale: 3,
      distance: 0,
      previousDistance: 0,
      originalBounds: null,
      transformation: {
        originX: 0,
        originY: 0,
        translateX: 0,
        translateY: 0,
        scale: 1,
        lastScale: 1,
      },
      lastTouchPoint: null,
      PAN_ZOOM_TAP_TIME: 250,
      startPanZoom: function (e, t, n, i) {
        (this.maxScale = n || 5),
          (this.$elementToZoom = e),
          (this.$limitElement = t),
          (this.originalBounds = this._getBounds()),
          this._bindEvents(),
          (this.canPanZoom = i);
      },
      destroyPanZoom: function () {
        this.$elementToZoom && this._unbindEvents();
      },
      resetPanZoom: function () {
        this.$elementToZoom &&
          this.$limitElement &&
          (this.$elementToZoom.css("transform-origin", "unset"),
          this._panTo(0, 0, 1),
          (this.transformation = {
            originX: 0,
            originY: 0,
            translateX: 0,
            translateY: 0,
            scale: 1,
          }));
      },
      _bindEvents: function () {
        var e = this;
        e.$elementToZoom.on("touchstart", function (t) {
          if (!e.canPanZoom || e.canPanZoom() !== !1) {
            var n = t.originalEvent.targetTouches;
            n &&
              2 === n.length &&
              n[0].target === this &&
              n[1].target === this &&
              (e.dispatch("pinchReady"), (e.eventInsideElement = !0));
          }
        }),
          e.$elementToZoom.on("touchmove", e._pinchHandler.bind(e)),
          e.$elementToZoom.on("touchend", e._pinchEndHandler.bind(e));
      },
      _unbindEvents: function () {
        var e = this;
        e.$elementToZoom.off("touchmove"), e.$elementToZoom.off("touchend");
      },
      _avoidPropagateEvent: function (e) {
        e.stopPropagation(), e.cancelable === !0 && e.preventDefault();
      },
      _pinchHandler: function (e) {
        var t = e.originalEvent.touches;
        return (
          (2 == t.length || this._isScaled() === !0) &&
            this._avoidPropagateEvent(e),
          this.canPanZoom && this.canPanZoom() === !1
            ? void this.dispatch("zoom", {
                scaled: this.transformation.scale > 1,
              })
            : void (2 == t.length && this.eventInsideElement
                ? ((this.distance = this._getDistance(t[0], t[1])),
                  0 != this.previousDistance
                    ? ((this.midPoint = this._getMidPoint(t[0], t[1])),
                      this._zoom(
                        this.midPoint.x,
                        this.midPoint.y,
                        (this.distance / this.previousDistance) *
                          this.transformation.scale
                      ),
                      this.dispatch("zoom", {
                        scaled: this.transformation.scale > 1,
                      }),
                      (this.previousDistance = this.distance))
                    : (this.previousDistance = this.distance))
                : 1 == t.length && this.lastTouchPoint
                ? (this._panBy(
                    t[0].clientX - this.lastTouchPoint.clientX,
                    t[0].clientY - this.lastTouchPoint.clientY
                  ),
                  (this.lastTouchPoint = t[0]))
                : 1 != t.length ||
                  this.lastTouchPoint ||
                  (this.lastTouchPoint = t[0]))
        );
      },
      _pinchEndHandler: function () {
        (this.canPanZoom && this.canPanZoom() === !1) ||
          ((this.distance = 0),
          (this.previousDistance = 0),
          (this.lastTouchPoint = null),
          (this.eventInsideElement = !1),
          this.dispatch("pinchEnd", {
            scaled: this._isScaled(),
          }));
      },
      _getMidPoint: function (e, t) {
        var n = (e.clientX + t.clientX) / 2,
          i = (e.clientY + t.clientY) / 2;
        return {
          x: n,
          y: i,
        };
      },
      _getDistance: function (e, t) {
        return Math.sqrt(
          Math.pow(e.clientX - t.clientX, 2) +
            Math.pow(t.clientY - e.clientY, 2)
        );
      },
      _getMatrix: function (e, t, n) {
        var i =
          "matrix(${scale}, 0, 0, ${scale}, ${translateX}, ${translateY})";
        return i
          .replace(/\$\{scale\}/g, e)
          .replace("${translateX}", t)
          .replace("${translateY}", n);
      },
      _getTranslate: function (e, t, n) {
        var i = this;
        return function (r, s, o) {
          return i._valueInRange(e, t, n) && i._hasPositionChanged(r, s)
            ? o + (r - s * n) * (1 - 1 / n)
            : o;
        };
      },
      _valueInRange: function (e, t, n) {
        return t >= n && n >= e;
      },
      _hasPositionChanged: function (e, t) {
        return e !== t;
      },
      _pan: function (e, t) {
        (this.transformation.translateX += e),
          (this.transformation.translateY += t);
        var n = this._getMatrix(
          this.transformation.scale,
          this.transformation.translateX,
          this.transformation.translateY
        );
        this.$elementToZoom.css("transform", n);
      },
      _panTo: function (e, t, n) {
        (this.transformation.scale = n),
          this._pan(
            e - this.transformation.translateX,
            t - this.transformation.translateY
          );
      },
      _panBy: function (e, t) {
        if (this._isScaled() !== !1) {
          this.originalBounds = this.originalBounds;
          var n = this._getBounds(),
            i = n.right + e,
            r = n.left + e,
            s = n.top + t,
            o = n.bottom + t;
          i < this.originalBounds.right &&
            (e = this.originalBounds.right - n.right),
            r > this.originalBounds.left &&
              (e = this.originalBounds.left - n.left),
            s > this.originalBounds.top &&
              (t = this.originalBounds.top - n.top),
            o < this.originalBounds.bottom &&
              (t = this.originalBounds.bottom - n.bottom),
            this._pan(e, t);
        }
      },
      _isScaled: function () {
        return this.transformation.scale > 1;
      },
      isScaled: function () {
        return this._isScaled();
      },
      _getZoomTransformValues: function (e, t, n, i) {
        var r = e - n.left,
          s = t - n.top,
          o = r / this.transformation.scale,
          a = s / this.transformation.scale,
          l = this._getTranslate(
            this.minScale,
            this.maxScale,
            this.transformation.scale
          ),
          c = l(r, this.transformation.originX, this.transformation.translateX),
          u = l(s, this.transformation.originY, this.transformation.translateY);
        return {
          originX: o,
          originY: a,
          translateX: c,
          translateY: u,
          scale: i,
        };
      },
      _zoom: function (e, t, n) {
        var i = this.$elementToZoom[0].getBoundingClientRect(),
          r = this._getBounds();
        this.originalBounds = this.originalBounds;
        var s = this._getZoomTransformValues(e, t, i, n);
        if (n < this.transformation.scale) {
          var o = r.top >= this.originalBounds.top,
            a = r.right <= this.originalBounds.right,
            l = r.bottom <= this.originalBounds.bottom,
            c = r.left >= this.originalBounds.left;
          c
            ? ((s.translateX = 0),
              (s.originX = 0),
              (s.originY = this.originalBounds.height / 2))
            : o
            ? ((s.translateY = 0),
              (s.originX = this.originalBounds.width / 2),
              (s.originY = 0))
            : l
            ? ((s.translateY = 0),
              (s.originX = this.originalBounds.width / 2),
              (s.originY = this.originalBounds.height))
            : a &&
              ((s.translateX = 0),
              (s.originX = this.originalBounds.width),
              (s.originY = this.originalBounds.height / 2));
          var u = (r.right + s.translateX, r.left + s.translateX),
            d = r.top + s.translateY,
            h = r.bottom + s.translateY;
          u > this.originalBounds.left &&
            (s.translateX = this.originalBounds.left - r.left),
            d > this.originalBounds.top &&
              (s.translateY = this.originalBounds.top - r.top),
            h < this.originalBounds.bottom &&
              (s.translateY = this.originalBounds.bottom - r.bottom);
        }
        this.$elementToZoom.css(
          "transform-origin",
          s.originX + "px " + s.originY + "px"
        ),
          1 > n && (n = 1),
          n > this.maxScale && (n = this.maxScale),
          1 === n && ((s.translateX = 0), (s.translateY = 0)),
          (s.scale = n);
        var p = this._getMatrix(s.scale, s.translateX, s.translateY);
        this.$elementToZoom.css("transform", p), (this.transformation = s);
      },
      _getBounds: function () {
        var e = this.$limitElement[0].getBoundingClientRect(),
          t = this.$elementToZoom[0].getBoundingClientRect();
        return {
          top: t.top - e.top,
          left: t.left - e.left,
          bottom: t.bottom - e.bottom,
          right: t.right - e.right,
          height: t.height,
          width: t.width,
        };
      },
    },
  }),
  Class(UI, "StageImage")
    .inherits(Widget)
    .includes(
      BubblingSupport,
      GenericDestroySupport,
      PanZoomSupport,
      TapEventSupport
    )({
    elementClass: "stage__image-wrapper",
    html: '<div><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=" itemprop="image" /></div>',
    blankImagePath:
      "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",
    prototype: {
      _callback: null,
      source: null,
      el: null,
      $image: null,
      $canvas: null,
      image: null,
      isHorizontallyFlipped: !1,
      currentOffset: null,
      mainStageWrapper: $("#main-content-wrapper"),
      mobileControlsContainer: $(".stage-mobile-controls-container"),
      dimensions: null,
      isMobile: !1,
      _fetchImage: null,
      _workAreaElement: null,
      _tapEventTask: null,
      stageImageReadyPromise: null,
      hasParams: !1,
      init: function (e) {
        if (
          ((this.stageImageReadyPromise = P.runner(Promise.resolve(!0))),
          Widget.prototype.init.call(this, e),
          (this.el = this.element[0]),
          (this.$image = this.element.find("img")),
          (this.image = this.$image[0]),
          (this.isMobile = Helpers.App.isMobile()),
          this.addVideo)
        ) {
          var t = null;
          try {
            throw new Error("Get stack trace");
          } catch (n) {
            t = n.stack || "No stack trace";
          }
          Helpers.GlobalEventTracker.deprecatedBlock({
            module: "StageImage::init",
            file: "stage_image.js",
            stackTrace: t,
          }),
            this.appendChild(
              new UI.Video({
                name: "videoWidget",
              })
            ).render(this.element);
        }
        this._bindings(), this._setCustomVhValue();
      },
      _bindings: function () {
        window.addEventListener(
          "orientationchange",
          this._updateLandscapeWorkarea.bind(this)
        ),
          this.mainStageWrapper.on("touchend", function (e) {
            window.engine &&
              window.engine.ready &&
              ($(e.target).is("canvas") ||
                (engine._deactivateInteractions(), engine._refresh()));
          }),
          (this._workAreaElement = this.image),
          this.addTapEventSupport(this._workAreaElement);
        this.stageImageReadyPromise["catch"](function () {
          throw "Fail to load StageImage";
        });
      },
      _setCustomVhValue: function () {
        if (this.isMobile !== !1) {
          var e = function () {
              var e = $(
                  '<div style="height:100vh;display:none"></div>'
                ).appendTo(document.body),
                t = e.height() / 100;
              return e.remove(), t;
            },
            t = function () {
              if ($(":focus").is("input, textarea") !== !0) {
                var t = e();
                0 !== t &&
                  document.documentElement.style.setProperty("--vh", t + "px");
              }
            };
          window.addEventListener("orientationchange", function () {
            $(window).one("resize", t);
          }),
            t();
        }
      },
      updateSource: function (e) {
        var t = this,
          n = this.constructor.blankImagePath;
        return (
          e && (n = e),
          this._fetchImage && this._fetchImage.cancel(),
          (this._fetchImage = this.cancelablePromise(
            t.fetchImagePromise.bind(this)
          )),
          this._fetchImage(n)
            .then(function (e) {
              return (
                (t.image.src = e.src),
                t.dispatch("loaded"),
                t.setImageReady(),
                e
              );
            })
            ["catch"](function (e) {
              "Cancelation Error" !== e &&
                setTimeout(function () {
                  throw new Error("Stage Image: " + JSON.stringify(e));
                }, 10);
            })
        );
      },
      setImageReady: function () {
        null === Helpers.App.getEngine() &&
          (this._isStageImgBase64() || this._isPreviewImageReady()) &&
          this.stageImageReadyPromise.run();
      },
      _isStageImgBase64: function () {
        return null !== this.getStageImgBase64();
      },
      _isPreviewImageReady: function () {
        return (
          this.hasParams !== !0 &&
          this.getSource().includes(this.constructor.blankImagePath) !== !0
        );
      },
      cancelablePromise: function (e) {
        var t = function (n) {
          var i = function (e) {
              return t.canceled === !0
                ? Promise.reject("Cancelation Error")
                : e;
            },
            r = function (e) {
              return Promise.reject(
                t.canceled === !0 ? "Cancelation Error" : e
              );
            };
          return e(n).then(i, r);
        };
        return (
          (t.canceled = !1),
          (t.cancel = function () {
            t.canceled = !0;
          }),
          t
        );
      },
      fetchImagePromise: function (e) {
        var t = this,
          n = new Image();
        if (!t.image)
          return Promise.resolve({
            width: 0,
            height: 0,
          });
        n.src = e;
        var i = function (t, i) {
          (n.onload = function () {
            t({
              src: this.src,
              width: this.width,
              height: this.height,
            });
          }),
            (n.onerror = function () {
              var t = "Error loading " + e;
              i(t);
            });
        };
        return new Promise(i);
      },
      getSource: function () {
        return this.image.getAttribute("src");
      },
      setWideImagePosition: function (e) {
        var t = "translateX(-50%) scale(1,1)";
        return (
          (this.currentOffset = e),
          (this.isHorizontallyFlipped = !1),
          (this.image.style.left = "undefined" !== e ? e + "px" : "50%"),
          (this.image.style.right = "auto"),
          this._applyTransformation(t),
          Helpers.StageType.setFlippedState(this.isHorizontallyFlipped),
          this
        );
      },
      resetImagePosition: function () {
        return (
          (this.isHorizontallyFlipped = !1),
          (this.image.style.left = ""),
          (this.image.style.right = ""),
          this._applyTransformation(""),
          Helpers.StageType.setFlippedState(this.isHorizontallyFlipped),
          this
        );
      },
      loadingUI: function () {
        return this.$image.hide(), this;
      },
      setImageTitle: function (e) {
        var t;
        return (t = e + " " + this.schemaName), (this.image.alt = t), this;
      },
      loadedUI: function () {
        this.$image.show();
      },
      flip: function () {
        return (
          null !== this.currentOffset
            ? this.isHorizontallyFlipped
              ? this.setWideImagePosition(this.currentOffset)
              : (this._applyTransformation("translateX(50%) scale(-1,1)"),
                (this.image.style.left = "auto"),
                (this.image.style.right = this.currentOffset + "px"),
                (this.isHorizontallyFlipped = !0))
            : this.isHorizontallyFlipped
            ? this.resetImagePosition()
            : (this._applyTransformation("translateX(50%) scale(-1,1)"),
              (this.image.style.left = "auto"),
              (this.isHorizontallyFlipped = !0)),
          Helpers.StageType.setFlippedState(this.isHorizontallyFlipped),
          this
        );
      },
      _applyTransformation: function (e) {
        return (
          (this.image.style.webkitTransform = e),
          (this.image.style.MozTransform = e),
          (this.image.style.msTransform = e),
          (this.image.style.Otransform = e),
          (this.image.style.transform = e),
          this
        );
      },
      hideVisibility: function () {
        this.element.css("visibility", "hidden"),
          this.$image.css("visibility", "hidden");
      },
      showVisibility: function () {
        this.element.css("visibility", "visible"),
          this.$image.css("visibility", "visible");
      },
      getStageImgBase64: function () {
        var e;
        return (
          window.engine
            ? (window.engine._deactivateInteractions(),
              window.engine._refresh(),
              (e = window.engine.getImage()))
            : (e = this.$image.attr("src")),
          e.indexOf("data:image/png;base64") > -1 &&
          e !== this.constructor.blankImagePath
            ? e
            : null
        );
      },
      getVideoSrc: function () {
        var e = null;
        return this.videojsWidget && (e = this.videojsWidget.getVideoSrc()), e;
      },
      getVideoDuration: function () {
        return this.videojsWidget
          ? this.videojsWidget.player.duration()
          : void 0;
      },
      getDimentions: function () {
        var e = this.dimensions.preview;
        return e;
      },
      setDimensions: function (e) {
        this.dimensions = e;
      },
      isPortrait: function () {
        var e = this.getDimentions();
        return e.height >= e.width || Helpers.StageType.isVideoV4() === !0;
      },
      isSmallLandscape: function () {
        var e = this.getDimentions();
        return e.height < 300;
      },
      updateWorkAreaDimentions: function () {
        var e = this;
        this.isMobile !== !1 &&
          (this.isPortrait() === !0 && Helpers.StageType.isVideoV4() === !1
            ? this.mainStageWrapper.addClass("stage-portrait")
            : this.isSmallLandscape() === !0 &&
              Helpers.StageType.isVideoV4() === !1
            ? this.mainStageWrapper.addClass("stage-landscape")
            : this.mainStageWrapper.removeClass(
                "stage-portrait stage-landscape"
              ),
          e._isVideoPortrait() === !0
            ? this.element.find("video").addClass("video-js-portrait")
            : Helpers.StageType.isVideoV4() === !0 &&
              (this.mainStageWrapper.addClass("main-video-landscape"),
              this.mainStageWrapper
                .find(".is_fusion_video")
                .addClass("video-landscape")),
          this._updateLandscapeWorkarea());
      },
      _screenOrientationIsLandscape: function () {
        return 90 === Math.abs(window.orientation);
      },
      _getLargerSide: function () {
        var e = this._getPortraitHeight();
        return (
          this._screenOrientationIsLandscape() === !0 &&
            (e = this._getLandscapeWidth()),
          e
        );
      },
      _getPortraitHeight: function () {
        var e = window.innerHeight;
        return (
          Helpers.App.isMobileDevice() === !1 &&
            window.outerHeight > 0 &&
            (e = window.outerHeight),
          e
        );
      },
      _getLandscapeWidth: function () {
        var e = window.innerWidth;
        return (
          Helpers.App.isMobileDevice() === !1 &&
            window.outerWidth > 0 &&
            (e = window.outerWidth),
          e
        );
      },
      _setWorkareaDimentionsForLandScape: function () {
        this.mainStageWrapper.addClass("mobile-is-landscape");
      },
      _unsetWorkareaDimentionsForLandScape: function () {
        this.mainStageWrapper.removeClass("mobile-is-landscape");
      },
      _updateLandscapeWorkarea: function () {
        var e = this;
        if (this.isMobile !== !1) {
          this._screenOrientationIsLandscape() === !0
            ? this._setWorkareaDimentionsForLandScape()
            : this._unsetWorkareaDimentionsForLandScape();
          var t = Helpers.App.removeFocusFromAllInputs();
          this.mobileControlsContainer
            .find(".tabbedContainer-contents")
            .find(".graphic-body")
            .css({
              "max-height": "100vh",
            }),
            P.delay(1e3).then(function () {
              t.focus(), e.dispatch("orientationchange");
            });
        }
      },
      _isVideoPortrait: function () {
        var e = this.getDimentions();
        return e.height >= e.width && Helpers.StageType.isVideoV4() === !0;
      },
      hideImage: function () {
        return null !== this.$image && this.$image.hide(), this;
      },
      showImage: function () {
        return null !== this.$image && this.$image.show(), this;
      },
      hideCanvas: function () {
        return (
          this.$canvas &&
            this.$canvas.length > 0 &&
            (this.$canvas.css("visibility", "hidden"), this.$canvas.hide()),
          this
        );
      },
      showCanvas: function () {
        return (
          this.$canvas &&
            this.$canvas.length > 0 &&
            (this.$canvas.css("visibility", "visible"), this.$canvas.show()),
          this
        );
      },
      initCanvas: function (e) {
        var t = this;
        t.element.append(e),
          (t.$canvas = t.element.find("canvas")),
          (t._workAreaElement = this.$canvas[0]),
          t.addTapEventSupport(this._workAreaElement);
      },
      getWorkArea: function () {
        var e = $(this._workAreaElement);
        return {
          width: e.width(),
          height: e.height(),
          left: e.position().left,
          top: e.position().top,
        };
      },
      getImageElement: function () {
        return this.$canvas || this.$image;
      },
      getScalingFactor: function (e) {
        var t = this.getWorkArea(),
          n = Helpers.App.calcScalingFactor(e, t);
        return null === n ? null : n;
      },
      destroy: function () {
        window.removeEventListener("orientationchange"),
          this.mainStageWrapper.off("touchend"),
          this.genericDestroy();
      },
    },
  }),
  Class(UI, "StageObjectActionsManager")
    .inherits(Widget)
    .includes(
      SaveDraftSupport,
      ThemeSupport
    )({
    elementClass: "stage-object-actions",
    donwloadButtonText: {
      free: "Free Download",
      paid: "Download",
    },
    downloadTooltipContent: {
      normal:
        '            <i id="downloadTooltipArrow" class="sprite download-tooltip-arrow"></i>            <div class="download-tooltip-content">                <div class="only-download"><span class="upArrow">&uarr;</span>You must upload an image</div>                <div class="only-embed hide">Your code is being generated</div>            </div>',
      smartTemplate:
        '            <div class="download-tooltip-content smart_template">                <div class="only-download">You must upload an image</div>            </div>            ',
      resizeCrop:
        '            <div class="download-crop-tooltip-content smart_template">                <div class="only-download">Make Some Changes First</div>            </div>            ',
      videoV4:
        '            <i id="downloadTooltipArrow" class="sprite download-tooltip-arrow"></i>            <div class="download-tooltip-content video_v4">                <div class="only-download">Please make some changes first!</div>            </div>',
      multiScene:
        '            <div class="download-tooltip-content video_v4">                <div class="only-download">You need to edit your video and then Play All your slides to download</div>            </div>',
      multiSceneWithChanges:
        '            <div class="download-tooltip-content video_v4">                <div class="only-download">You need to Play All your slides before downloading</div>            </div>',
    },
    bookmarkItContent: {
      full: '          <div class="bookmark-tooltip-content">              Remove from Favorites          </div>',
      empty:
        '          <div class="bookmark-tooltip-content">              Add to Favorites          </div>',
      unlogged:
        '          <div class="bookmark-tooltip-content">              Please Login to Add to Favorites!          </div>',
    },
    shareTooltipContent: {
      default:
        '            <div class="tooltip-content">                Share            </div>',
      requiredActionSmartTemplate:
        '            <div class="tooltip-content">                <div class="only-download">You must upload an image</div>            </div>',
      requiredActionVideoV4:
        '            <i id="downloadTooltipArrow" class="sprite download-tooltip-arrow"></i>            <div class="tooltip-content lg">                <div class="only-download">Please make some changes first!</div>            </div>',
    },
    prototype: {
      $shareModal: null,
      $priceContainer: null,
      _states: ["start", "processing", "finish"],
      hasSingleScene: !1,
      actionButtonsInfo: {
        start: {
          active: ["share_productshot", "download_productshot"],
          disabled: [],
        },
        processing: {
          active: [],
          disabled: ["share_productshot", "download_productshot"],
        },
        finish: {
          active: ["share_productshot", "download_productshot"],
          disabled: [],
        },
      },
      changesInSlide: !1,
      init: function (e) {
        Widget.prototype.init.call(this, e),
          (this.$shareButton = this.element.find(".share-button")),
          (this.$downloadButton = this.element.find(
            Helpers.App.isMobile()
              ? ".description .download-button"
              : ".action-buttons .download-button"
          )),
          (this.$downloadButtonWrapper = this.element.find(
            ".productshot-actions"
          )),
          (this.$bookmarkSign = this.element.find(
            ".bookmark-it span.glyphicon"
          )),
          (this.$bookmarkButton = this.element.find(".bookmark-it")),
          (this.$priceContainer = this.element.find("#price_tag_container")),
          (this.$dropDownTag = $(".dropdown-tag")),
          (this.bookPopup = null),
          (this.$moreContextMenu = this.element.find("#share-draft-dropdown")),
          (this.$moreContextDropdown = this.element.find(
            ".more-context-dropdown"
          )),
          this.$moreContextMenu.click(function (e) {
            e.stopPropagation();
          }),
          this.$moreContextDropdown.on("show.bs.dropdown", function () {
            $(".dropdown-backdrop").hide();
          }),
          (this._buttonsLibrary = {
            download_productshot: this.$downloadButton,
            share_productshot: this.$shareButton,
          }),
          this.element.removeClass("initial-state"),
          this.stageIsFavorite()
            ? (this.$bookmarkSign.removeClass("glyphicon-heart-empty"),
              this.$bookmarkSign.addClass("glyphicon-heart"))
            : (this.$bookmarkSign.removeClass("glyphicon-heart"),
              this.$bookmarkSign.addClass("glyphicon-heart-empty")),
          window._stageData.stage_data.is_slave
            ? this.$bookmarkButton.hide()
            : this.$bookmarkButton.show(),
          this.initializeSaveDraft(),
          this.bindEvents(),
          this._refreshSharePopover();
        var t = this;
        setTimeout(function () {
          Helpers.StageType.getTheme()
            .then(function (e) {
              t.setTheme(e);
            })
            ["catch"](function (e) {
              throw (t.setPaidTheme(), new Error(e));
            });
        }, 0);
      },
      _refreshSharePopover: function () {
        var e = "body",
          t = UI.StageObjectActionsManager.shareTooltipContent["default"];
        Helpers.App.isMobileDevice() && (e = ".page-container"),
          Helpers.StageType.isFusionVideo() &&
          this.$downloadButton.is(".disabled")
            ? (t =
                UI.StageObjectActionsManager.shareTooltipContent
                  .requiredActionVideoV4)
            : this.$shareButton.is(".disabled") &&
              (t =
                UI.StageObjectActionsManager.shareTooltipContent
                  .requiredActionSmartTemplate),
          this.$shareButton.popover("destroy"),
          this.$shareButton.popover({
            content: t,
            html: !0,
            container: e,
            trigger: "hover",
            placement: "top",
          });
      },
      enableShareButton: function () {
        this.$shareButton.removeClass("disabled"), this._refreshSharePopover();
      },
      disableShareButton: function () {
        this.$shareButton.addClass("disabled"), this._refreshSharePopover();
      },
      removeShareButtonTooltip: function () {
        this.$shareButton.popover("destroy");
      },
      bindEvents: function () {
        this._setBindingForDownload(),
          this._setBindingForBookmarks(),
          this._setBindingForShare();
      },
      _setBindingForDownload: function () {
        var e, t, n, i;
        (t = this),
          (i = UI.StageObjectActionsManager.downloadTooltipContent),
          (e = "body"),
          Helpers.App.isMobileDevice() && (e = ".page-container"),
          (n = this.$downloadButton.popover({
            content: i.normal,
            html: !0,
            container: e,
            trigger: "manual",
            placement: "top",
          })),
          this.setClickListenerForDownloadButton(function () {
            $(this).hasClass("disabled") ||
              (t.beforeDownload(), t.dispatch("download"));
          }),
          this.$downloadButton
            .bind("mouseenter", function () {
              t.$downloadButton.is(".disabled") &&
                ("undefined" != typeof window._stageData &&
                Helpers.StageType.isCropperTool()
                  ? n
                      .attr("data-content", i.resizeCrop)
                      .data("bs.popover")
                      .setContent()
                  : Helpers.StageType.isSmartTemplate() &&
                    !Helpers.App.isMobileDevice()
                  ? n
                      .attr("data-content", i.smartTemplate)
                      .data("bs.popover")
                      .setContent()
                  : Helpers.StageType.isFusionVideo() && t.changesInSlide === !1
                  ? n
                      .attr("data-content", i.multiScene)
                      .data("bs.popover")
                      .setContent()
                  : Helpers.StageType.isFusionVideo() && t.changesInSlide === !0
                  ? n
                      .attr("data-content", i.multiSceneWithChanges)
                      .data("bs.popover")
                      .setContent()
                  : n
                      .attr("data-content", i.normal)
                      .data("bs.popover")
                      .setContent(),
                t.$downloadButton.popover("show"));
            })
            .bind("mouseleave", function () {
              t.$downloadButton.popover("hide");
            })
            .on("shown.bs.popover", function () {
              var e = $("#downloadTooltipArrow").parent().parent();
              e.addClass("download-popover").removeClass("is_embed");
            });
      },
      _setBindingForBookmarks: function () {
        var e,
          t = this;
        this.$bookmarkButton.bind("click", function () {
          if (0 === Helpers.App.getUser().id)
            (e = {
              type: "warning",
              content:
                'Please create an account to add this stage to favorites.<br /> Already have an account?                             <a href="#" onclick="event.preventDefault();page.appNavBar.ssoModal.showTab(\'' +
                UI.SsoModal.TAB_LOGIN +
                '\')" class="trigger_login_link" role="button">Log In</a>',
              contentForceLogIn:
                'Please log in to add this stage to favorites.<br /> Don\'t have an account?                             <a href="#" onclick="event.preventDefault();page.appNavBar.ssoModal.showTab(\'' +
                UI.SsoModal.TAB_SIGNUP +
                '\')" class="trigger_signup_link" role="button">Sign Up</a> today!',
            }),
              page.appNavBar.ssoModal.activate(),
              page.appNavBar.ssoModal.showMessage(e);
          else {
            var n, i, r;
            (n = Helpers.App.getUser().id),
              (i = parseInt(Helpers.StageType.getStageID())),
              (r = {
                user: n,
                stage: i,
              }),
              t._setBookmark(r);
          }
        }),
          this._refreshBookmarkPopover(),
          this.bind("form.success", function () {
            t._refreshBookmarkPopover(), t._isBookmarkedStage();
          });
      },
      _setBindingForShare: function () {
        var e, t, n;
        (n = window.ogData),
          (e = this),
          (t = UI.StageObjectActionsManager.downloadTooltipContent),
          this.$shareButton.length ||
            ((this.$shareButton = this.element.find(".share-tool-button")),
            e.enableShareButton()),
          this.$shareButton.bind("click", function () {
            if (!e.$shareButton.hasClass("disabled")) {
              var t = Helpers.StageType.getProductshotInfo(),
                i = "productshot",
                r = "";
              if (
                (Helpers.StageType.isFusionVideo() && (i = "videoProduct"),
                (e.$shareModal = null),
                (e.$shareModal =
                  "undefined" != typeof window._stageData &&
                  Helpers.StageType.isTool()
                    ? new UI.ShareToolModal({
                        type: i,
                        ogData: n,
                      })
                    : new UI.ShareModal({
                        type: i,
                        ogData: n,
                      })),
                e.$shareModal.activate(),
                Helpers.StageType.isTool())
              ) {
                if (null === e.$shareModal.element) return;
                (r = window.location.origin + window.location.pathname),
                  e.$shareModal.loadShareSocialButtons(r),
                  e.$shareModal.updateInput(r).loader(!1);
              } else if (Helpers.StageType.isSmartTemplate())
                Helpers.StageType.getPreviewImage()
                  .then(function (t) {
                    var n = encodeURI(window.location.href),
                      i = {
                        stage_id: Helpers.StageType.getStageID(),
                        referrer: n,
                        uri: t,
                      };
                    e.$shareModal
                      .updateInput("Generating Share URL")
                      .loader(!0),
                      e.$shareModal.addAnimatedEllipsis(),
                      e
                        .requestShareImage(i)
                        .done(function (t) {
                          if (null !== e.$shareModal.element) {
                            var n = t.data;
                            (r = window.location.origin + "/" + n.hsh),
                              Helpers.StageType.setProductshotInfo(n),
                              e.$shareModal.loadShareSocialButtons(),
                              e.$shareModal.updateInput(r).loader(!1);
                          }
                        })
                        .fail(function (t) {
                          e.$shareModal
                            .updateInput(
                              "There was an error generating your image, try again later."
                            )
                            .loader(!1),
                            setTimeout(function () {
                              throw new Error(
                                "Error fetching share image from backend: " +
                                  JSON.stringify(t)
                              );
                            }, 10);
                        });
                  })
                  ["catch"](function (e) {
                    setTimeout(function () {
                      throw new Error(
                        "Something went wrong when fetching the preview image: " +
                          JSON.stringify(e)
                      );
                    }, 10);
                  });
              else if (Helpers.StageType.isFusionVideo()) {
                var s = Helpers.StageType._videoProductUUID,
                  o = Helpers.StageType.getStageID();
                (r = window.location.origin + "/video_v4/share/" + (s ? s : o)),
                  e.$shareModal.updateInput(r).loader(!1),
                  e.$shareModal.loadShareSocialButtons(r);
              } else
                (r = window.location.origin + "/" + t.hsh),
                  e.$shareModal.loadShareSocialButtons(),
                  e.$shareModal.updateInput(r);
              Helpers.GlobalEventTracker.track("share:click", {
                slug: window._stageData.stage_data.slug,
                stage_type:
                  Helpers.StageType._types[
                    window._stageData.stage_data.image_type
                  ] || "No Info",
              });
            }
          });
      },
      _setBookmark: function (e) {
        var t,
          n = this;
        (t = n.$bookmarkButton.hasClass("favorite")),
          t
            ? Helpers.GlobalEventTracker.track(
                "BookmarkedStageEvent:Unbookmark",
                e
              )
            : Helpers.GlobalEventTracker.track(
                "BookmarkedStageEvent:Bookmark",
                e
              ),
          $.ajax({
            url: "/bookmarks/" + e.stage,
            type: t ? "DELETE" : "POST",
            success: function () {
              n.toggleFavorite();
            },
            error: function (e) {
              console.error(e);
            },
          });
      },
      _fillFavoriteIcon: function () {
        var e = UI.StageObjectActionsManager.bookmarkItContent;
        this.$bookmarkButton.addClass("favorite"),
          this.$bookmarkSign.addClass("glyphicon-heart"),
          this.$bookmarkSign.removeClass("glyphicon-heart-empty"),
          Helpers.App.isMobileDevice() ||
            this.bookPopup
              .attr("data-content", e.full)
              .data("bs.popover")
              .setContent();
      },
      _clearFavoriteIcon: function () {
        var e = UI.StageObjectActionsManager.bookmarkItContent;
        this.$bookmarkButton.removeClass("favorite"),
          this.$bookmarkSign.removeClass("glyphicon-heart"),
          this.$bookmarkSign.addClass("glyphicon-heart-empty"),
          !Helpers.App.isMobileDevice() &&
            this.bookPopup.length > 0 &&
            this.bookPopup
              .attr("data-content", e.empty)
              .data("bs.popover")
              .setContent();
      },
      _isBookmarkedStage: function () {
        var e = this;
        $.get(
          "/bookmarks/stage_is_bookmarked/" + Helpers.StageType.getStageID(),
          function (t) {
            t.stage_is_bookmarked
              ? e._fillFavoriteIcon()
              : e._clearFavoriteIcon(),
              window._stageData.stage_data.is_slave
                ? e.$bookmarkButton.hide()
                : e.$bookmarkButton.show();
          }
        );
      },
      _refreshBookmarkPopover: function () {
        if (!Helpers.App.isMobileDevice()) {
          var e = this,
            t = e.constructor.bookmarkItContent;
          e.$bookmarkButton.popover("destroy"),
            (e.bookPopup =
              0 === Helpers.App.getUser().id
                ? e.$bookmarkButton
                    .popover({
                      content: t.unlogged,
                      html: !0,
                      container: "body",
                      selector: ".bookmark-it",
                      trigger: "manual",
                      placement: "top",
                    })
                    .bind("mouseenter", function () {
                      e.$bookmarkButton.is(".disabled") === !1 &&
                        e.$bookmarkButton.popover("show");
                    })
                    .bind("mouseleave", function () {
                      e.$bookmarkButton.popover("hide");
                    })
                : e.$bookmarkButton
                    .popover({
                      content: e.stageIsFavorite() ? t.full : t.empty,
                      html: !0,
                      container: "body",
                      selector: ".bookmark-it",
                      trigger: "manual",
                      placement: "top",
                    })
                    .bind("mouseenter", function () {
                      e.stageIsFavorite()
                        ? e.bookPopup
                            .attr("data-content", t.full)
                            .data("bs.popover")
                            .setContent()
                        : e.bookPopup
                            .attr("data-content", t.empty)
                            .data("bs.popover")
                            .setContent(),
                        e.$bookmarkButton.is(".disabled") === !1 &&
                          e.$bookmarkButton.popover("show");
                    })
                    .bind("mouseleave", function () {
                      e.$bookmarkButton.popover("hide");
                    }));
        }
      },
      requestShareImage: function (e) {
        return $.ajax({
          method: "post",
          url: "/stages/share_image",
          data: e,
        });
      },
      stageIsFavorite: function () {
        return this.$bookmarkButton.hasClass("favorite");
      },
      toggleFavorite: function () {
        var e = null;
        this._refreshBookmarkPopover(),
          this.stageIsFavorite()
            ? (this._clearFavoriteIcon(),
              Helpers.App.isMobileDevice() ||
                this.$bookmarkButton.popover("show"),
              1 === Helpers.App.getBookmarksCount() &&
                this.dispatch("user-has-bookmarks", !1),
              (e = Helpers.App.getBookmarksCount() - 1))
            : (this._fillFavoriteIcon(),
              Helpers.App.isMobileDevice() ||
                this.$bookmarkButton.popover("show"),
              this.dispatch("user-has-bookmarks", !0),
              (e = Helpers.App.getBookmarksCount() + 1)),
          Helpers.App.setBookmarksCount(e),
          (window._pl_numberOfBookmarks = e);
      },
      beforeDownload: function () {
        var e, t;
        return (
          Helpers.GlobalEventTracker.downloadClick({
            slug: window._stageData.stage_data.slug,
          }),
          (t = this.parent),
          (e = Helpers.StageType.getProductshotInfo()),
          alert(111),
          document.querySelector("canvas").toBlob(function (blob) {
            let url = window.URL.createObjectURL(blob);
            // window.open(url, "_blank");
            const a = document.createElement("a");
            a.href = url;
            a.download = "out.png";
            a.target = "_blank";
            a.click();
          }, "image/png"),
          this
          // Helpers.StageType.isSmartTemplate() && t.recordState.success === !1
          //   ? alert(t.recordState.message)
          //   : (Helpers.StageType.isSmartTemplate() &&
          //       t.dispatch("download.overlay.activate"),
          //     this)
        );
      },
      resetButtonsStyles: function () {
        this.element.removeClass("hidden");
      },
      setFinalVideoButtonsStyles: function () {},
      disableDownloadButton: function () {
        this.$downloadButton.addClass("disabled");
      },
      enableDownloadButton: function () {
        this.$downloadButton.removeClass("disabled"),
          this.$downloadButton.addClass("show");
      },
      setStageButtonsInfo: function () {
        return this;
      },
      isDownloadButtonDisabled: function () {
        this.$downloadButton.hasClass("disabled");
      },
      showButtonsForState: function (e) {
        var t, n;
        return this._states.indexOf(e) < 0
          ? this
          : ((t = this.actionButtonsInfo[e]),
            (n = t.active.concat(t.disabled)),
            "start" === e
              ? this._disableButtons(t.disabled)
              : (this._disableButtons(t.disabled),
                this._enableButtons(t.active)),
            this);
      },
      _hideButtons: function () {
        var e = this;
        return (
          Object.keys(this._buttonsLibrary).forEach(function (t) {
            e._buttonsLibrary[t].hide(),
              "share_productshot" === t && e._buttonsLibrary[t].show();
          }),
          this
        );
      },
      _showButtons: function (e) {
        var t = this;
        return (
          e.forEach(function (e) {
            t._buttonsLibrary[e] && t._buttonsLibrary[e].show();
          }),
          this
        );
      },
      _enableButtons: function (e) {
        var t = this;
        return (
          e.forEach(function (e) {
            t._buttonsLibrary[e] &&
              t._buttonsLibrary[e]
                .removeAttr("disabled")
                .removeClass("disabled");
          }),
          this
        );
      },
      _disableButtons: function (e) {
        var t = this;
        return (
          e.forEach(function (e) {
            switch (e) {
              case "download_productshot":
                t.disableDownloadButton();
                break;
              case "share_productshot":
                t.disableShareButton();
            }
          }),
          this
        );
      },
      setClickListenerForDownloadButton: function (e) {
        this.$downloadButton.off("click"), this.$downloadButton.on("click", e);
      },
      setFreeTheme: function () {
        this.$downloadButton
          .find(".btn-download-text")
          .html(UI.StageObjectActionsManager.donwloadButtonText.free),
          this.$downloadButton.removeClass("subscribed-user");
      },
      setPaidTheme: function () {
        this.$downloadButton
          .find(".btn-download-text")
          .html(UI.StageObjectActionsManager.donwloadButtonText.paid),
          this.$downloadButton.removeClass("subscribed-user");
      },
      setAdminTheme: function () {
        this.setSubscribedTheme();
      },
      setSubscribedTheme: function () {
        this.setPaidTheme(),
          Helpers.App.isSubscriptionValid() === !0 &&
            this.$downloadButton.addClass("subscribed-user");
      },
    },
  }),
  Class(UI, "TabbedContainers")
    .inherits(Widget)
    .includes(
      BubblingSupport,
      GenericDestroySupport
    )({
    ICONS: {
      Text: '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none"><path fill="icon-color" d="M9.655 2H3.7a.7.7 0 00-.7.7v3.108a.5.5 0 001 0V3.3a.3.3 0 01.3-.3h4.2v11.923H6.32a.538.538 0 000 1.077h5.36a.538.538 0 000-1.077H9.5V3h4.2a.3.3 0 01.3.3v2.508a.5.5 0 001 0V2.7a.7.7 0 00-.7-.7H9.655z"/></svg>',
      Colors:
        '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none"><path stroke="icon-color" d="M10.014 3.607l2.884 2.644a5.41 5.41 0 011.497 2.77 5.355 5.355 0 01-.313 3.13 5.435 5.435 0 01-2.024 2.433A5.555 5.555 0 019 15.5a5.552 5.552 0 01-3.058-.916 5.431 5.431 0 01-2.024-2.434 5.354 5.354 0 01-.313-3.13 5.41 5.41 0 011.497-2.769l2.884-2.644a1.503 1.503 0 012.028 0z"/></svg>',
      Graphics:
        '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none"><path fill="icon-color" fill-rule="evenodd" d="M3 5.5C3 4.29 4.254 3 5.465 3h7.07C13.745 3 15 4.254 15 5.465v5.02c0 .554-.343.515-.343.515H11c-.5 0-1 .5-1 1v2.656C10 15 9.746 15 9.707 15H5.465C4.255 15 3 13.71 3 12.5v-7zM7 16H5.465A3.464 3.464 0 012 12.535v-7.07A3.464 3.464 0 015.465 2h7.07A3.464 3.464 0 0116 5.465V7l.004 3.902c0 .409-.185.795-.504 1.05l-4.727 3.875c-.22.176-.49.174-.77.173H7zm4-1.8l2.75-2.2H11.2c-.04 0-.2 0-.2.2v2z" clip-rule="evenodd"/></svg>',
      Visuals:
        '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none"><circle cx="11.445" cy="10.667" r="4.833" fill="#fff" stroke="icon-color"/><path fill="#fff" stroke="icon-color" d="M5.795 3.135a.9.9 0 011.521 0l4 6.317a.9.9 0 01-.76 1.381h-8a.9.9 0 01-.76-1.381l4-6.317z"/></svg>',
      Options:
        '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none"><path fill="icon-color" d="M15.194 10.018l-.283-.152c-.337-.18-.538-.504-.538-.866s.201-.685.538-.866l.283-.152c.77-.415 1.035-1.33.59-2.049l-.538-.866c-.444-.716-1.432-.962-2.202-.549l-.283.152c-.336.18-.738.18-1.074 0a.98.98 0 01-.538-.866V3.5c0-.827-.723-1.5-1.612-1.5H8.463c-.89 0-1.612.673-1.612 1.5v.304a.98.98 0 01-.538.866c-.336.18-.738.18-1.074 0l-.283-.152c-.77-.413-1.758-.167-2.202.549l-.538.866c-.445.718-.181 1.635.59 2.05l.283.151c.337.18.538.504.538.866s-.201.685-.538.866l-.283.152c-.771.414-1.035 1.33-.59 2.049l.538.866c.445.716 1.433.963 2.202.549l.283-.152c.336-.181.738-.18 1.074 0a.98.98 0 01.538.866v.304c0 .827.723 1.5 1.612 1.5h1.074c.89 0 1.612-.673 1.612-1.5v-.304a.98.98 0 01.538-.866c.336-.18.738-.181 1.074 0l.283.152c.77.413 1.758.167 2.202-.549l.537-.866c.446-.718.182-1.634-.59-2.05zm-.341 1.549l-.538.866a.56.56 0 01-.733.183l-.283-.152a2.27 2.27 0 00-2.15 0c-.673.362-1.074 1.01-1.074 1.732v.304c0 .276-.241.5-.538.5H8.463c-.297 0-.538-.224-.538-.5v-.304c0-.723-.401-1.37-1.074-1.732a2.27 2.27 0 00-2.15 0l-.283.152a.558.558 0 01-.733-.183l-.538-.866a.482.482 0 01.197-.683l.283-.152C4.3 10.371 4.7 9.723 4.7 9c0-.723-.401-1.37-1.074-1.732l-.283-.152a.482.482 0 01-.197-.683l.538-.866a.56.56 0 01.733-.183l.283.152a2.27 2.27 0 002.15 0c.673-.362 1.074-1.01 1.074-1.732V3.5c0-.276.241-.5.538-.5h1.074c.297 0 .538.224.538.5v.304c0 .723.401 1.37 1.074 1.732a2.27 2.27 0 002.15 0l.283-.152a.559.559 0 01.733.183l.538.866a.482.482 0 01-.197.683l-.283.152C13.7 7.629 13.3 8.277 13.3 9c0 .723.401 1.37 1.074 1.732l.283.152c.253.136.347.44.197.683z"/><circle cx="9" cy="9" r="2.5" stroke="icon-color"/></svg>',
    },
    html: '<div class="tabbedContainer"><div class="tabbedContainer-tabs"></div><div class="tabbedContainer-contents"></div></div>',
    prototype: {
      $tabs: null,
      $contents: null,
      isSlider: !1,
      tabSlider: null,
      contentSlider: null,
      tabRecord: null,
      tabClass: "",
      contentClass: "",
      currentTab: null,
      lastTab: null,
      init: function (e) {
        var t = this;
        (this.tabRecord = []),
          Widget.prototype.init.call(this, e),
          (this.$tabs = this.element.find(".tabbedContainer-tabs")),
          (this.$contents = this.element.find(".tabbedContainer-contents")),
          e.tabs.forEach(function (e, n) {
            t.tabRecord.push(
              $.extend(e, {
                visible: !0,
                index: n,
              })
            );
          }),
          this._addTabs(e.tabs),
          e.isSlider &&
            ((this.tabSlider = new UI.ParentSlider({
              name: "tabSlider",
              $parent: this.$tabs,
              itemsToShow: e.tabs.length,
              centerMode: !1,
              clickToSet: !0,
              scrollCallback: this._triggerControls.bind(this),
            }).bind("slider.beforeScroll", function () {
              t.dispatch("tabbedContainer.beforeChange", {
                current: t.tabRecord[this.current.num],
              });
            })),
            (this.contentSlider = new UI.ParentSlider({
              name: "contentSlider",
              $parent: this.$contents,
              itemsToShow: 1,
              centerMode: !0,
              scrollSnap: !0,
              scrollCallback: this._triggerTabs.bind(this),
              singleItemSwipe: !0,
              draggable: !0,
              dragSpeed: 1.5,
              autoHeight: !0,
              maxHeight: 340,
            }))),
          e.tabClass && (this.tabClass = e.tabClass),
          e.contentClass && (this.contentClass = e.contentClass);
      },
      _addTab: function (e) {
        var t,
          n = this.constructor.ICONS[e.name],
          i =
            '<div class="tabbedContainer-tab ' +
            this.tabClass +
            '" name="' +
            e.name +
            '">' +
            n +
            e.name +
            "</div>",
          r =
            '<div class="tabbedContainer-content ' +
            this.contentClass +
            '" name="' +
            e.name +
            '"></div>';
        (t = $(i)), (t.name = e.name), this.$tabs.append(t);
        var s = $(r);
        this.$contents.append(s),
          e.contents.forEach(function (e) {
            e.render(s);
          });
      },
      _addTabs: function (e) {
        for (var t = 0; t < e.length; t++) this._addTab(e[t], t);
      },
      hideTab: function (e) {
        var t = this,
          n = !1;
        (this.tabRecord[e].visible = !1),
          $(this.$contents.children()[e]).hide(),
          $(this.$tabs.children()[e]).hide(),
          e === this.tabSlider.current.num
            ? this.isTabVisible(this.lastTab)
              ? t._gotoTab(this.lastTab)
              : this.tabRecord.forEach(function (e, i) {
                  e.visible && !n && ((n = !0), t._gotoTab(i));
                })
            : this.currentTab && t._gotoTab(this.currentTab);
      },
      showTab: function (e) {
        var t = this.getCurrentIndex();
        (this.tabRecord[e].visible = !0),
          $(this.$contents.children()[e]).show(),
          $(this.$tabs.children()[e]).show(),
          this._gotoTab(t);
      },
      disable: function () {
        this.element.addClass("disabled"),
          this.isSlider &&
            (this.tabSlider.setSwipeable(!1),
            this.contentSlider.setSwipeable(!1));
      },
      enable: function () {
        this.element.removeClass("disabled"),
          this.isSlider &&
            (this.tabSlider.setSwipeable(!0),
            this.contentSlider.setSwipeable(!0));
      },
      getCurrentIndex: function () {
        return this.tabSlider.current.num;
      },
      refreshTab: function (e) {
        var t = this.tabRecord[e],
          n = $(this.$contents.children()[e]);
        t.contents.forEach(function (e) {
          e.render(n);
        });
      },
      destroy: function () {
        this.isSlider &&
          (this.tabSlider.destroy(), this.contentSlider.destroy()),
          this.genericDestroy();
      },
      _triggerTabs: function (e) {
        (this.lastTab = this.currentTab),
          (this.currentTab = e.num),
          this.tabSlider.scrollToItem(e.num),
          this.dispatch("tabbedContainer.change", {
            active: this.tabRecord[e.num],
          });
      },
      _triggerControls: function (e) {
        (this.lastTab = this.currentTab),
          (this.currentTab = e.num),
          this.contentSlider.scrollToItem(e.num),
          this.dispatch("tabbedContainer.change", {
            active: this.tabRecord[e.num],
          });
      },
      _gotoTab: function (e, t) {
        (this.lastTab = this.currentTab),
          (this.currentTab = e),
          this.tabSlider.scrollToItem(e),
          this.contentSlider.scrollToItem(e, t),
          this.dispatch("tabbedContainer.change", {
            active: this.tabRecord[e],
          });
      },
      goToTab: function (e, t) {
        this._gotoTab(e, t);
      },
      getActiveTab: function () {
        var e;
        return (e = {
          data: this.tabRecord[this.getCurrentIndex()],
          tabElement: this.element.find(
            ".tabbedContainer-tabs .tabbedContainer-tab.parent-active"
          ),
          contentElement: this.element.find(
            ".tabbedContainer-contents .tabbedContainer-content.parent-active"
          ),
        });
      },
      setContentSliderHeight: function (e) {
        this.contentSlider.setCurrentHeight(e);
      },
      getActiveContents: function () {
        var e = [];
        return (
          this.tabRecord[this.getCurrentIndex()] &&
            this.tabRecord[this.getCurrentIndex()].contents &&
            (e = this.tabRecord[this.getCurrentIndex()].contents),
          e
        );
      },
      getParentFromControl: function (e, t) {
        return (t = t || ".parent-item"), e.closest(t);
      },
      getIndexFromControl: function (e) {
        return (
          ("MultiControl" !== e.constructor.className &&
            "AddLogoMultiControl" !== e.constructor.className) ||
            !e.shouldRenderCompoundButton() ||
            (e = e.compoundButton),
          this.getParentFromControl(e.element).attr("parent_num")
        );
      },
      isTabVisible: function (e) {
        return this.tabRecord[e].visible;
      },
      findTabsByContentClassName: function (e) {
        var t = function (t) {
            return t.constructor.className === e;
          },
          n = function (e) {
            return e.contents.filter(t).length > 0;
          };
        return this.tabs.filter(n);
      },
      getTabByReplacementAreaName: function (e) {
        return this.findTabsByContentClassName("CustomGraphicControl").filter(
          function (t) {
            return (
              t.contents.filter(function (t) {
                if ("CustomGraphicControl" === t.constructor.className) {
                  var n = t.getLayerByName(e);
                  return void 0 !== n;
                }
              }).length > 0
            );
          }
        )[0];
      },
      focusOnContent: function (e, t) {
        var n,
          i = 0;
        if (((n = this.contentSlider.getSlider(e)), 0 === n.length))
          return this;
        if (((i = t.element.position().top), 0 >= i))
          return (
            n.animate(
              {
                scrollTop: 0,
              },
              200
            ),
            this
          );
        var r = i + t.element.height() + n.scrollTop() - n.height();
        return (
          r > 0 &&
            n.animate(
              {
                scrollTop: r,
              },
              200
            ),
          this
        );
      },
    },
  }),
  "undefined" == typeof UI && (window.UI = {}),
  Class(UI, "Tags").inherits(Widget)({
    hiddenItemsHTML:
      '<li id="tag-show-more">            <a class="stage-tag tag">&#9662;</a>            <div class="box-tag">                <ul class="dropdown-tag"></ul>            </div>        </li>',
    mouseLeaveDelay: 500,
    distanceThreshold: 50,
    maxTagWidth: 150,
    maxVisibleTags: 4,
    mobileBreakpoint: 1024,
    resizeEventDebounceTime: 10,
    prototype: {
      items: [],
      hiddenItems: [],
      $tagsContainer: {},
      closeTimeout: null,
      isMobile: !1,
      init: function (e) {
        Widget.prototype.init.call(this, e);
        var t = this;
        (t.$tagsContainer = t.element.find(".visible-tag")),
          (t.$buttonBar = t.element.closest(".button-bar-stages")),
          (t.$tagsFlexItem = t.element.closest(".tags")),
          t.$buttonBar.find(".description-tags").addClass("is-visible");
        var n = this.element.find(".tag").not(".show-more").closest("li");
        if (!(n.length <= 1)) {
          n.each(function (e, n) {
            t.items.push(n);
          }),
            (t.hiddenItems = t.items.slice(UI.Tags.maxVisibleTags)),
            t.hiddenItems.forEach(function (e) {
              e.remove();
            }),
            t.$tagsContainer.append($(UI.Tags.hiddenItemsHTML)),
            (t.$hiddenTagsContainer = t.$tagsContainer.find(".dropdown-tag")),
            t.hiddenItems.forEach(function (e) {
              t.$hiddenTagsContainer.append(e);
            }),
            (t.$tagShowMore = t.$tagsContainer.find("#tag-show-more")),
            t.$tagShowMore.mouseenter(function () {
              t.$tagShowMore.addClass("is-open"),
                clearTimeout(t.closeTimeout),
                (t.closeTimeout = null);
            }),
            t.$tagShowMore.mouseleave(function () {
              t.closeTimeout = setTimeout(function () {
                t.$tagShowMore.removeClass("is-open");
              }, UI.Tags.mouseLeaveDelay);
            }),
            t.items.length <= UI.Tags.maxVisibleTags && t.$tagShowMore.hide();
          var i = t._debounce(function () {
            t._relayoutTags();
          }, UI.Tags.resizeEventDebounceTime);
          $(window).resize(i), t._relayoutTags();
        }
      },
      _debounce: function (e, t, n) {
        var i;
        return function () {
          var r = this,
            s = arguments,
            o = function () {
              (i = null), n || e.apply(r, s);
            },
            a = n && !i;
          clearTimeout(i), (i = setTimeout(o, t)), a && e.apply(r, s);
        };
      },
      _calculateDelta: function () {
        var e = this,
          t = e.$tagsFlexItem.prev(),
          n = e.$buttonBar.find(".d-flex.center-buttons:visible"),
          i = (i = t.offset().left + t.width()),
          r = null;
        return (
          (r = n.length > 0 ? n.offset().left : e.$tagsFlexItem.offset().left),
          r - i
        );
      },
      _relayoutTags: function () {
        var e = this;
        if (window.innerWidth <= UI.Tags.mobileBreakpoint)
          return void (e.isMobile || ((e.isMobile = !0), e._doNotHideTags()));
        if (e.isMobile) return (e.isMobile = !1), void e._doHideTags();
        var t = e._calculateDelta();
        return t < UI.Tags.distanceThreshold
          ? void e._hideTag()
          : void (
              t > UI.Tags.maxTagWidth + UI.Tags.distanceThreshold &&
              e._showTag()
            );
      },
      _hideTag: function () {
        var e = this,
          t = e.$tagsContainer.children("li").not("#tag-show-more");
        if (1 !== t.length) {
          e.$tagShowMore.not(":visible") && e.$tagShowMore.show();
          var n = t.last();
          e.$hiddenTagsContainer.prepend(n);
          var i = e._calculateDelta();
          i < UI.Tags.distanceThreshold && e._hideTag();
        }
      },
      _showTag: function () {
        var e = this,
          t = e.$hiddenTagsContainer.children("li");
        if (
          !(
            e.$tagsContainer.children("li").not("#tag-show-more").length >=
            UI.Tags.maxVisibleTags
          )
        ) {
          var n = t.first();
          if (
            (n.insertBefore(e.$tagsContainer.find("#tag-show-more")),
            0 === e.$hiddenTagsContainer.children("li").length)
          )
            return void e.$tagShowMore.hide();
          var i = e._calculateDelta();
          i > UI.Tags.maxTagWidth + UI.Tags.distanceThreshold && e._showTag();
        }
      },
      _doNotHideTags: function () {
        var e = this,
          t = e.$hiddenTagsContainer.children("li");
        e.$tagsContainer.find("#tag-show-more").hide(),
          t.each(function (t, n) {
            $(n).appendTo(e.$tagsContainer);
          });
      },
      _doHideTags: function () {
        var e = this,
          t = e.$tagsContainer.find("#tag-show-more").nextAll("li");
        t.each(function (t, n) {
          $(n).appendTo(e.$hiddenTagsContainer);
        }),
          e.$hiddenTagsContainer.children("li").length > 0 &&
            e.$tagsContainer.find("#tag-show-more").show();
      },
    },
  }),
  Class(UI, "TextEditionOverlay")
    .inherits(Widget)
    .includes(GenericDestroySupport)({
    html: '        <div class="modal">            <span class="char-count"></span>            <textarea wrap="off" placeholder="Type here"></textarea>            <button class="done-btn">Done</button>        </div>    ',
    elementClass: "text-edition-overlay",
    DEFAULT_FONT_SIZE: 22,
    RESIZE_RETRIES: 3,
    prototype: {
      record: {},
      _previousValue: null,
      init: function (e) {
        Widget.prototype.init.call(this, e),
          (this.$charCount = this.element.find(".char-count")),
          (this.$textbox = this.element.find("textarea")),
          (this.$doneBtn = this.element.find(".done-btn")),
          Helpers.App.isIOS(window.navigator.userAgent) &&
            (this.element.addClass("is-ios"),
            window.innerWidth < 500 &&
              (this.$doneBtn.css("height", 0), this.$doneBtn.hide())),
          this._bindEvents();
      },
      _bindEvents: function () {
        this.$textbox
          .bind(
            "input",
            function (e) {
              this._limitCharacters(e),
                this._limitLines(),
                this._updateCharacterCount(),
                this._resizeToFitText();
            }.bind(this)
          )
          .bind(
            "blur",
            function () {
              this.deactivate();
            }.bind(this)
          ),
          this.element
            .bind("touchmove", function (e) {
              e.stopPropagation(), e.preventDefault();
            })
            .bind(
              "shown.bs.modal",
              function () {
                this._setTextboxHeight(),
                  this.$textbox.css(
                    "font-size",
                    this.constructor.DEFAULT_FONT_SIZE
                  ),
                  window.scrollTo(0, this.element.offset().top),
                  this.$textbox.focus(),
                  this.$textbox.get(0).setSelectionRange(0, 9999),
                  this._resizeToFitText();
              }.bind(this)
            ),
          this._canUseVisualViewport() === !0 &&
            window.visualViewport.addEventListener(
              "resize",
              function () {
                this._setTextboxHeight();
              }.bind(this)
            );
      },
      activate: function (e) {
        Widget.prototype.activate.call(this),
          (this.record = e),
          this.$textbox.val(
            this.record.visible ? this.record.contents : "Type here"
          ),
          (this._previousValue = this.$textbox.val()),
          this._updateCharacterCount(),
          this.element.modal("show");
      },
      deactivate: function () {
        Widget.prototype.deactivate.call(this),
          this.element.modal("hide"),
          this.dispatch("deactivate"),
          this._previousValue !== this.$textbox.val() &&
            this.dispatch("change", {
              value: this.$textbox.val(),
            });
      },
      _canUseVisualViewport: function () {
        return !!window.visualViewport;
      },
      _setTextboxHeight: function () {
        var e = this.$charCount.outerHeight() + this.$doneBtn.outerHeight(),
          t =
            parseInt(this.$textbox.css("margin-top")) +
            parseInt(this.$textbox.css("margin-bottom")),
          n = -(t + e);
        if (this._canUseVisualViewport() === !0) {
          var i = window.visualViewport.height;
          n += i;
        } else {
          var r = window.screen.height;
          n += 0.4 * r;
        }
        this.$textbox.css("height", n);
      },
      _updateCharacterCount: function () {
        var e = this.$textbox.val().length,
          t = this.record.maxCharacters;
        this.$charCount.html(e + " / " + t),
          e === t
            ? this.$charCount.addClass("max-count")
            : this.$charCount.removeClass("max-count");
      },
      _limitCharacters: function (e) {
        var t = this.$textbox.val();
        t.length >= this.record.maxCharacters &&
          (this.$textbox.val(t.substring(0, this.record.maxCharacters)),
          e.preventDefault());
      },
      _limitLines: function () {
        if (
          this.record.allowMultiline !== !0 ||
          null !== this.record.maxLines
        ) {
          var e = this.$textbox.val(),
            t = e.indexOf("\r") > -1 ? "\r" : "\n",
            n = e.split(t),
            i = this.record.allowMultiline ? this.record.maxLines : 1;
          (n = n.splice(0, i)), this.$textbox.val(n.join(t));
        }
      },
      _resizeToFitText: function () {
        this.$textbox.css("font-size", this.constructor.DEFAULT_FONT_SIZE);
        for (var e = 0; e < this.constructor.RESIZE_RETRIES; e++)
          this.$textbox.css(
            "font-size",
            this._getFontSize() * this._getResizeFactor()
          );
      },
      _getFontSize: function () {
        return parseFloat(this.$textbox.css("font-size"));
      },
      _getResizeFactor: function () {
        var e = this.$textbox.get(0),
          t = this.$textbox.innerWidth() / e.scrollWidth,
          n = this.$textbox.innerHeight() / e.scrollHeight;
        return t >= 1 && n >= 1 ? 1 : n > t ? t : n;
      },
    },
  }),
  Class(UI, "SimpleDropdown")
    .inherits(Widget)
    .includes(
      BubblingSupport,
      GenericDestroySupport
    )({
    elementClass: "simple-dropdown",
    prototype: {
      label: null,
      cssOptionsContainer: null,
      native: !1,
      options: [],
      init: function (e) {
        var t;
        Widget.prototype.init.call(this, e),
          (t = this),
          e.options && (t.options = e.options),
          e.cssOptionsContainer &&
            (t.cssOptionsContainer = e.cssOptionsContainer),
          e["native"] && (t["native"] = e["native"]),
          t._build(),
          t._bindEvents();
      },
      _build: function () {
        var e, t, n;
        (e = this),
          (t = document.createElement("select")),
          e.label && t.setAttribute("title", e.label),
          e["native"] === !1 &&
            ((n = document.createElement("option")),
            n.setAttribute("value", ""),
            n.setAttribute("disable", "disable"),
            (n.dataset.hidden = !0),
            t.append(n)),
          e.options.forEach(function (e) {
            (n = document.createElement("option")),
              n.append(document.createTextNode(e.label)),
              n.setAttribute("value", e.value),
              null !== e.cssClass && n.classList.add(e.cssClass),
              t.append(n);
          }),
          (e.$dropdown = $(t)),
          e.element.append(e.$dropdown),
          e["native"] === !1 &&
            ((e.$optionsContainer = $(
              '<div class="simple-dropdown-options-container"></div>'
            )),
            e.cssOptionsContainer &&
              e.$optionsContainer.addClass(e.cssOptionsContainer),
            $("body").append(e.$optionsContainer),
            e.$dropdown.selectpicker({
              container: e.$optionsContainer,
              dropupAuto: !0,
              mobile: !1,
            }));
      },
      _bindEvents: function () {
        var e;
        (e = this),
          e.$dropdown.bind("change", function () {
            e.dispatch("selectoption");
          });
      },
      getValue: function () {
        var e;
        return (e = this), e.$dropdown.val();
      },
      isOpen: function () {
        var e;
        return (
          (e = this),
          e.$optionsContainer
            ? e.$optionsContainer.find(".bootstrap-select").hasClass("open")
            : !1
        );
      },
      destroy: function () {
        var e;
        (e = this),
          e["native"] === !1 &&
            (e.$optionsContainer.remove(), e.$dropdown.selectpicker("destroy")),
          e.genericDestroy();
      },
      unselectOptions: function () {
        var e;
        (e = this),
          e.$dropdown.find("option:selected").prop("selected", !1),
          e["native"] === !1 && e.$dropdown.selectpicker("val", "");
      },
    },
  }),
  Module("BuildControlSupport")({
    prototype: {
      textPromises: null,
      graphicPromises: null,
      backgroundPromise: null,
      customGraphicPromises: null,
      _asyncBuildControl: function () {
        var e = this,
          t = [];
        return (
          this.record.text &&
            this.record.text.length > 0 &&
            this._beforeBuildTextControls(),
          (this.textPromises = AsyncController.prepare.apply(this, [
            this.record.text,
            "text",
          ])),
          (this.graphicPromises = AsyncController.prepare.apply(this, [
            this.record.graphic,
            "graphic",
          ])),
          (this.backgroundPromise = AsyncController.prepare.apply(this, [
            this.record.background,
            "background",
          ])),
          (this.customGraphicPromises = AsyncController.prepare.apply(this, [
            this.record.customGraphic,
            "customGraphic",
          ])),
          (t = t.concat(
            this.textPromises,
            this.graphicPromises,
            this.backgroundPromise,
            this.customGraphicPromises
          )),
          AsyncController.build(t).then(function () {
            (e._graphicReady = !0),
              e.dispatch("graphicControlsReady"),
              e._afterBuildControls();
          })
        );
      },
      _renderControls: function () {
        return this._beforeBuildControls(), this._asyncBuildControl();
      },
      getInitialUrlParams: function () {
        var e = Helpers.App.getAllURLParams();
        return (
          (this.getInitialUrlParams = function () {
            return e;
          }),
          this.getInitialUrlParams()
        );
      },
      _beforeBuildControls: function () {
        if (
          (this.isMobilePhone === !0 && this._createComponentPopup(),
          this._setupAddTextButton(this.addTextButtonSideBar),
          this.record.backgroundColor || this.record.background.length > 0)
        ) {
          var e = this._getBackgroundRecord();
          this.record.background.length > 0
            ? (this.record.background = [e] || [])
            : (this.record.backgroundColor = e || {});
        }
        this._initMultiSizeSupport();
      },
      _afterBuildControls: function () {
        var e = this,
          t = this.isMobilePhone;
        e.rightSideBar.render($(".page-container")),
          e.leftSideBar.render($(".page-container")),
          t &&
            (e.bgMobileSideBar.render($(".page-container")),
            $(".design-service-order-jersey-container")
              .detach()
              .appendTo(".stage-object-actions")),
          // this._initSavedConfigurations(),
          // this._initRelateTemplates(),
          this._initLayout(),
          IframeAPI.renderButton(this.leftSideBar),
          t || (e.accomodateLeftSidebarScrollBar(), e.hideSidebarsIfEmpty());
        var n = new UI.Tags({
          element: $(".description-tags"),
        });
        e.appendChild(n),
          this.dispatch("contentReady", {
            originalDispatcher: n,
          }),
          this.loadControlAssets(),
          setTimeout(function () {
            e.loadFromUrlParameters();
          }, 1),
          this.isMobilePhone === !0
            ? this._renderUIMobile()
            : this._renderAddGraphicDesktopButton(),
          this._addPopStateBinding(),
          this.isMobilePhone === !0 && e.canProcessWithEngine === !0
            ? e._startZoomInCanvas()
            : this.isMobilePhone === !0 &&
              e.canProcessWithEngine === !1 &&
              e._startZoomInImage();
      },
      _addPopStateBinding: function () {
        var e = this;
        window.addEventListener("popstate", function () {
          e.setSaveButtonByUrlChanges(),
            e._loadInteractionsFromUrl(),
            e.isMobilePhone === !0 && e._resize(),
            e.dispatch("change", {
              triggeredByPopState: !0,
            });
        });
      },
      _initUserGraphicController: function (e) {
        var t = this;
        return (
          (this._userGraphicController = new UserGraphicController({
            graphicsRecord: this.record.graphic,
            defaultColors: UserGraphicController.generateDefaultColors(
              this.record
            ),
            assetGroupId: Helpers.StageType.getAddGraphicAssetGroup(),
            maxAddedGraphics: Helpers.StageType.getMaxUserAddedGraphics(),
            renderGraphicControlDesktop:
              this._renderGraphicControlDesktop.bind(this),
            destroyGraphicControlDesktop:
              this._destroyGraphicControlDesktop.bind(this),
            renderGraphicControlMobile:
              this._renderUserGraphicControlMobile.bind(this),
            destroyGraphicControlMobile:
              this._destroyUserGraphicControlMobile.bind(this),
            onStateChanged: this._updateAddGraphicButtons.bind(this),
            groupTags: this.groupTags,
            addLogoTarget: this.leftSideBar,
            stageHasLogo: this._hasLogoCustomGraphic,
            defaultSelectedLayer: e,
          })),
          window.addEventListener("popstate", function () {
            t.hideAddGraphicAndAddLogoButtons();
          }),
          this.hideAddGraphicAndAddLogoButtons(),
          this._userGraphicController
        );
      },
      _addLogoBindings: function () {
        this.bind("addGraphic", function (e) {
          var t,
            n = this._userGraphicController.addGraphicAndSave(
              this._hasLogoCustomGraphic,
              e.data ? e.data.addGraphicButtonIndex : !1
            );
          if (
            "undefined" != typeof n &&
            this.isMobilePhone === !0 &&
            e.data &&
            e.data.action
          ) {
            if (
              ((t = n.constructor && n.constructor.className),
              "AddLogoMultiControl" === t)
            )
              return;
            var i = function () {
              n.unbind("multiControlReady", i),
                n.compoundButton[e.data.action]();
            };
            n.bind("multiControlReady", i);
          }
        });
      },
      _initLayout: function () {
        var e = this,
          t = this.getInitialUrlParams(),
          n = this.isMobilePhone;
        if (this.record.composition) {
          if (
            this.record.composition.sizes &&
            this.record.composition.sizes.length > 1
          ) {
            var i, r, s, o;
            (r = {
              name: "scaling",
              record: this.record.composition.sizes,
              prefillZoom: t.zoom,
            }),
              n
                ? ((r.isMobilePhone = n), (i = $(window).width() - 20))
                : (i = e.stageImageWidget.element.width()),
              this.appendChild(new UI.SmartTemplate.Scaling(r)).render(
                this.stageImageWidget.element
              ),
              e._stageImageShown && e.scaling.show(),
              e._repositionScaling(),
              e._repositionPiP();
          }
          this.record.composition.layout &&
            this.record.composition.layout.length > 1 &&
            (this.record.composition.layout.length > 6 &&
              this.record.composition.layout.splice(
                6,
                this.record.composition.layout.length - 6
              ),
            (o = this.record.composition.layout),
            (s = o.filter(function (e) {
              return e.visible;
            })[0]),
            this.leftSideBar
              .appendChild(
                new UI.SmartTemplate.Layout({
                  name: "layoutPicker",
                  record: o,
                  prefillLayout: t.layout,
                  defaultValue: s.name,
                })
              )
              .render(this.leftSideBar.element));
        }
      },
      _initSavedConfigurations: function () {
        var e;
        if (((e = $(".saved-configurations-grid")), e.length)) {
          var t = new UI.SmartTemplate.SavedConfigurations({
            name: "savedConfigurations",
            element: e,
          });
          this.appendChild(t);
        }
      },
      _initRelateTemplates: function () {
        var e = this,
          t = $(".related-templates-grid");
        t.length &&
          (UiJsonMapSupport.fetch(),
          t.each(function (n, i) {
            var r = new UI.RelatedTemplates.Controller({
              name: "relatedTemplates" + n,
              uiJson: e.record,
              element: $(i),
              queue: e.sharedQueue,
            }).bind("preview.shown", function () {
              var n = this;
              t.each(function (t) {
                e["relatedTemplates" + t].name !== n.name &&
                  e["relatedTemplates" + t].hidePreviews();
              });
            });
            r.getRelatedTemplatesInfo(),
              e.appendChild(r),
              (e._relatedTemplates[r.name] = {
                debounce: null,
                processInputFlags: [],
              });
          }),
          this._displayItemsBelowImage());
      },
      _initMultiSizeSupport: function () {
        var e = this,
          t = this.getInitialUrlParams();
        if (e.record.supportedSizes && e.record.supportedSizes.length) {
          var n = new UI.MultiSizesTemplates.Container({
            name: "multiSizesContainer",
            record: e.record,
            supportedSizes: e.record.supportedSizes,
            original: e.record.original,
            prefillSize: t.size || e.record.size,
          });
          e.appendChild(n),
            (this._relatedTemplates.multiSizesContainer = {
              debounce: null,
              processInputFlags: [],
            }),
            this.multiSizesContainer.bind(
              "sizeChange",
              function (e) {
                (e.data.originalDispatcher = this.multiSizesContainer),
                  this._waitForProcess(e);
              }.bind(this)
            ),
            this.multiSizesContainer.bind("sizeChange", function (t) {
              var n, i;
              (n = t.data),
                (i = n.dimensions),
                e.element.find("img").css({
                  visibility: "visible",
                }),
                (e._changeResolutionEventData = {
                  dimensions: i.high,
                  preview_dimensions: e.getPreviewDimensions(i.preview, i.high),
                  dpi: e.record.original.size.high.resolution,
                  id: n.id,
                }),
                e.stageImageWidget.setDimensions(i),
                e.bgContainer.dispatch(
                  "resolutionChange",
                  e._changeResolutionEventData
                ),
                (e.isChangeSizeInProgress = !0);
            }),
            setTimeout(function () {
              if (window.isSavedConfiguration || window.hasPresetJson) {
                e.multiSizesContainer.setLastChange(performance.now()),
                  e.multiSizesContainer.queue.clear();
                var t = e.multiSizesContainer.multiSizesCarousel.children;
                e.multiSizesContainer.update(t, !1);
              }
            }, 2e3);
        }
      },
      getTextControlGroup: function () {
        var e = this._createTextControlGroup();
        return (
          (this.getTextControlGroup = function () {
            return e;
          }),
          this.getTextControlGroup()
        );
      },
      _getBackgroundRecord: function () {
        return this.record.background.length > 0
          ? this._buildBackgroundRecord(
              this.record.backgroundColor,
              this.record.background[0]
            )
          : this._buildBackgroundRecord(this.record.backgroundColor, {});
      },
      _buildBackgroundControl: function (e) {
        var t, n, i, r;
        return (
          (t = e.type + "_" + e.name),
          (n = this.getInitialUrlParams()),
          (i = this.record.original.size),
          (r = this.getPreviewDimensions(i.preview, i.high)),
          new UI.SmartTemplate.MultiControl({
            title: e.displayName,
            position: 0,
            name: t,
            record: e,
            type: "background",
            isMobilePhone: this.isMobilePhone,
            prefillColor: n["color" + t],
            prefillGraphic: n["multi" + t],
            prefillSearch: n["search" + t] || e.preconfiguredSearch,
            viewport: r,
            onlyGraphics: !0,
          })
        );
      },
      _getNodeToAppendBackground: function () {
        return this.isMobilePhone ? this.bgMobileSideBar : this.rightSideBar;
      },
      _getElementToRenderBackground: function () {
        return this.isMobilePhone
          ? this.bgMobileSideBar.element
          : this.rightSideBar.element;
      },
      _afterRenderBackground: function (e) {
        var t = this,
          n = e.record;
        e.bind("change", function () {
          t._changeBackgroundColorRecord(n);
        }),
          e.bind("backgroundReady", function () {
            t._changeResolutionEventData &&
              t._changeResolutionEventData.id &&
              t.bgContainer.dispatch(
                "resolutionChange",
                t._changeResolutionEventData
              );
          }),
          n.allowColorpicker === !0
            ? (this._rightSidebarAvailableHeight -=
                this._layerlessControlHeight)
            : t.bgContainer.element.addClass("no-background-color"),
          n.hasLayers === !0
            ? ((this._rightSidebarAvailableHeight -=
                this._layerfulControlHeight - this._layerlessControlHeight),
              this._rightSidebarAvailableLayerfulControlSlots--,
              t.rightSideBar.bind("imageDataNotFound", function () {
                t._customImageNotFound = !0;
              }),
              t.bgContainer.bind("cropSuccess", function (e) {
                e.stopPropagation(),
                  t._backgroundCropSuccessHandler.call(t, e.data);
              }))
            : t.bgContainer.element.addClass("no-backgrounds"),
          this._setupSizeChange(e, this.multiSizesContainer);
      },
      _backgroundCropSuccessHandler: function (e) {
        var t, n, i;
        (i = e.id),
          (t = this.Folder_Background),
          (n = t.customBg.record.image),
          (t.customBg.record.record_hash = i),
          (t.customBg.record.image = e.croppedImageUrl),
          (t.customBg.record.visible = !0),
          t.setUrlParameter(i),
          t.customBg.updatePreview(e.thumbnailUrl),
          t.selectItem(t.customBg),
          this.dispatch("change", {
            errorCallback: function (e) {
              "abort" !== e.statusText &&
                400 === e.status &&
                (t.customBg.record.image = n);
            },
            triggeredByPopState: e.triggeredByPopState,
          });
      },
      _createGraphicControl: function (e, t) {
        var n, i, r;
        return (
          (n = this.getInitialUrlParams()),
          (i = n["search" + e.type + "_" + e.name] || e.preconfiguredSearch),
          (r = this.record.defaultAssetColors),
          new UI.SmartTemplate.MultiControl({
            title: e.displayName,
            position: t,
            type: "graphic",
            name: e.type + "_" + e.name,
            record: e,
            isMobilePhone: this.isMobilePhone,
            prefillColor: n["color" + e.type + "_" + e.name],
            prefillGraphic: n["multi" + e.type + "_" + e.name],
            prefillSearch: i,
            onlyGraphics: !0,
            defaultAssetColors: r,
          })
        );
      },
      _beforeRenderGraphicControl: function (e) {
        var t = e.record.hasLayers,
          n = t ? this._layerfulControlHeight : this._layerlessControlHeight,
          i = t ? 1 : 0,
          r = this._rightSidebarAvailableHeight > n,
          s = this._rightSidebarAvailableLayerfulControlSlots >= i,
          o = (r && s) || this.isMobilePhone,
          a = o ? this.rightSideBar : this.leftSideBar,
          l = t === !1 && e.record.allowColorpicker === !1;
        return {
          sidebar: a,
          controlIsHidden: l,
          shouldAddToRightSidebar: o,
          controlSlots: i,
          controlHeight: n,
        };
      },
      _afterRenderGraphicControl: function (e) {
        var t = (e.sidebar, e.controlIsHidden),
          n = e.controlSlots,
          i = e.controlHeight;
        t === !1 &&
          ((this._rightSidebarAvailableLayerfulControlSlots -= n),
          (this._rightSidebarAvailableHeight -= i));
      },
      _renderGraphicControlDesktop: function (e, t, n) {
        var i = this._beforeRenderGraphicControl(e),
          r = i.sidebar;
        r.appendChild(e),
          e.render(r.element, t),
          this._afterRenderGraphicControl(i, e, n);
      },
      _triggerProcess: function () {
        var e = window._pl_featureFlags.t19083_limit_jobs;
        !this.canProcessWithEngine && e && this.triggerChange();
      },
      _buildCustomGraphicControl: function (e, t, n) {
        var i, r, s, o;
        return (
          (o = {
            name: name,
            record: e,
            maxSize: this.constructor.maxSizeAllowed.image,
            acceptedFiles: this.constructor.acceptedFiles.image,
            isMobilePhone: this.isMobilePhone,
            showPreview: !0,
          }),
          $.extend(o, n),
          (i = new UI.SmartTemplate.CustomGraphicControl(o)),
          (s = this._filesContainer),
          (r = this._getCustomGraphicRenderTarget(t)),
          {
            instance: i,
            node: s,
            renderTarget: r,
          }
        );
      },
      _getCustomGraphicRenderTarget: function (e) {
        if (this.isMobilePhone !== !0) return this.leftSideBar.element;
        var t;
        return (
          e % 2 === 0
            ? ((t = e),
              this.stageActionsManager.element.append(
                '<div class="st_uploads st_uploads_' +
                  t +
                  ' btn-group stage-actions"></div>'
              ))
            : (t = e - 1),
          this.stageActionsManager.element.find(".st_uploads_" + t)
        );
      },
      _addCustomGraphicControlBindings: function (e) {
        var t = this;
        e.bind("grabUrlStart", t._grabUrlStart.bind(t)),
          e.bind("grabUrlSuccess", t._grabUrlSuccessHandler.bind(t, e)),
          e.bind("grabUrlFail", t._grabUrlFail.bind(t)),
          e.bind("setFileByUrl.start", t._setFileByUrlStartHandler.bind(t)),
          e.bind("setFileByUrl.success", t._setFileByUrlSuccessHandler.bind(t)),
          e.bind("setFileByUrl.fail", t._setFileByUrlFailHandler.bind(t));
      },
      _fetchCustomGraphicData: function (e) {
        var t, n, i, r, s;
        (t = e.getUrlParameter()),
          (n = t || e.presetValue),
          (i = function (t) {
            return e.dispatch("fetchData"), t;
          }),
          (r = function (e) {
            var t = Object.create(null);
            return function (n) {
              if (!t[n]) {
                var i = e(n);
                t[n] = i;
              }
              return t[n];
            };
          }),
          (s = function (t) {
            return UI.SmartTemplate.CustomGraphicControl.prototype.fetchData.call(
              e,
              t
            );
          });
        var o = r(s);
        n
          ? (o(n)
              .then(function (t) {
                return (
                  (e.record.layers[0].image = t.cropped_image_url),
                  (e.record.layers[0].visible = !0),
                  (e.record.hash = t.id),
                  t
                );
              })
              ["finally"](i),
            (e.fetchData = function (e) {
              return o(e);
            }))
          : e.dispatch("fetchData");
      },
      _initStageOverlayController: function () {
        var e, t, n;
        return (
          (e = Helpers.StageType.getStageData().category_name),
          (this.isMobilePhone === !0 && "Mockups" === e) != !1
            ? ((n = this.customGraphicPromises),
              (t = Promise.all(n).then(function (e) {
                return e.map(function (e) {
                  return e.instance;
                });
              })),
              this.initStageOverlayController(t).then(
                function (e) {
                  return this.tapEventBinding(), e;
                }.bind(this)
              ))
            : void 0
        );
      },
    },
  }),
  Class("AsyncControlBuilder")({
    text: function (e, t) {
      var n, i, r;
      try {
        return (
          (i = this.getTextControlGroup()),
          (n = this._createTextControl({
            textItem: e,
            itemIndex: t,
          })),
          (r = i.element),
          n.render(r),
          Promise.resolve(AsyncController.builderResponse(n, i, r))
        );
      } catch (s) {
        var o = AsyncController.buildErrorResponse(e, "text", s);
        return Promise.reject(o);
      }
    },
    background: function (e) {
      var t, n, i, r;
      try {
        return (
          (i = this._getElementToRenderBackground(this)),
          (n = this._getNodeToAppendBackground(this)),
          (t = this._buildBackgroundControl(e)),
          t.render(i),
          (r = AsyncController.builderResponse(t, n, i)),
          this._afterRenderBackground.apply(this, [t]),
          AsyncController.promisifyEvent(t, "multiControlReady").then(
            function () {
              return r;
            }
          )
        );
      } catch (s) {
        var o = AsyncController.buildErrorResponse(e, "background", s);
        return Promise.reject(o);
      }
    },
    graphic: function (e, t) {
      var n, i, r, s;
      try {
        var o = e.styles;
        if (
          (e.name.toLowerCase().search("logo") > 0 &&
            (this._hasLogoCustomGraphic = !0),
          e.allowCustomUpload && e.hasLayers === !1)
        ) {
          var a = Helpers.StageType.getStructureInstance(),
            l = a.getSmartObjectDimensions(e.name);
          (e.width = l.width),
            (e.height = l.height),
            e.layers.push({
              id: "customGraphic",
              name: "customGraphic",
              image: null,
              visible: !1,
            }),
            (i = this._buildCustomGraphicControl(e, t, {
              name: e.name,
            })),
            i.instance.render(i.renderTarget),
            this._addCustomGraphicControlBindings(i.instance),
            (s = AsyncController.promisifyEvent(i.instance, "fetchData")),
            this._fetchCustomGraphicData(i.instance);
        } else {
          if (!o.layerEffects || !o.layerEffects.solidFill)
            throw "Undefined Build Strategy";
          (n = this._createGraphicControl(e, t)),
            (r = this._beforeRenderGraphicControl(n)),
            n.render(r.sidebar.element),
            this._afterRenderGraphicControl(r, n),
            (i = AsyncController.builderResponse(
              n,
              r.sidebar,
              r.sidebar.element
            )),
            (s = AsyncController.promisifyEvent(n, "multiControlReady"));
        }
        return s.then(function () {
          return i;
        });
      } catch (c) {
        var u = AsyncController.buildErrorResponse(e, "graphic", c);
        return Promise.reject(u);
      }
    },
    customGraphic: function (e, t) {
      var n, i;
      try {
        var r = {
          name: "customG_" + t,
          allowImportFromDownloads: !0,
          allowPlaceholderThumbnail: !0,
          allowPlaceholderRemoval: this.record.customGraphic.length > 1,
        };
        (n = this._buildCustomGraphicControl(e, t, r)),
          (i = n.instance),
          i.render(n.renderTarget),
          this._addCustomGraphicControlBindings(i);
        var s = AsyncController.promisifyEvent(i, "fetchData").then(
          function () {
            return n;
          }
        );
        return this._fetchCustomGraphicData(i), s;
      } catch (o) {
        var a = AsyncController.buildErrorResponse(e, "customGraphic", o);
        return Promise.reject(a);
      }
    },
  }),
  Class("AsyncController")({
    MAX_TIMEOUT_PER_CONTROL: 5e3,
    prepare: function (e, t) {
      var n = this;
      return (Array.isArray(e) === !0 && e.length > 0) == !1
        ? []
        : e.map(function (e, i) {
            return AsyncControlBuilder[t].apply(n, [e, i]);
          });
    },
    build: function (e) {
      return P.allSettled(e).then(function (e) {
        return (
          e.forEach(function (e) {
            "rejected" === e.status
              ? AsyncController._notifyError(e.reason)
              : AsyncController._buildHandler(e);
          }),
          e
        );
      });
    },
    _append: function (e, t) {
      e && t && t.appendChild(e);
    },
    _notifyError: function (e) {
      Helpers.GlobalEventTracker.noticeError("Build Control error", e),
        console.error(e);
    },
    buildErrorResponse: function (e, t, n) {
      return {
        strategy: t,
        record: e,
        error: n,
      };
    },
    _buildHandler: function (e) {
      var t = e.value;
      AsyncController._append(t.instance, t.node), t.instance.afterReady();
    },
    promisifyEvent: function (e, t) {
      var n, i;
      return (
        (n = t || "change"),
        (i = P.promisifyEvent(n)),
        Promise.race([
          i(e),
          P.timeout(AsyncController.MAX_TIMEOUT_PER_CONTROL)["catch"](function (
            t
          ) {
            return {
              name: e.name,
              control: e.constructor.className,
              error: t,
            };
          }),
        ])
      );
    },
    builderResponse: function (e, t, n) {
      return {
        instance: e,
        node: t,
        renderTarget: n,
      };
    },
  }),
  Class("Tracker")({
    _data: {},
    start: function (e, t) {
      var n = this._data[e] || {};
      return (
        (n.start = n.start || Date.now()),
        (n.data = t || null),
        (n.end = 0),
        (n.time = Date.now() - n.start),
        (this._data[e] = n),
        n
      );
    },
    end: function (e, t) {
      var n = this.get(e);
      if ("object" == typeof n)
        return (
          (n.data = $.extend(!0, n.data, t || {})),
          (n.end = Date.now()),
          (n.time = n.end - n.start),
          n
        );
    },
    get: function (e) {
      return this._data[e];
    },
    all: function () {
      var e = this._data;
      return Object.keys(e)
        .map(function (t) {
          return (e[t].name = t), e[t];
        })
        .sort(function (e, t) {
          return e.end - t.end;
        });
    },
  }),
  Class(UI, "FragmentPlayer").includes(CustomEventSupport)({
    prototype: {
      _endedListener: null,
      _interval: 1e3 / 30,
      _lastTimestamp: 0,
      _timeupdateListener: null,
      currentTime: 0,
      end: 0,
      start: 0,
      video: null,
      init: function (e, t, n) {
        var i = this;
        i.setVideo(e),
          i.setBoundaries(t, n),
          (i._timeupdateListener = function () {
            i._onTimeupdate();
          }),
          (i._endedListener = function () {
            i._onEnded();
          }),
          i.bind("timeupdate", i._timeupdateListener);
      },
      _dispatchTimeupdate: function () {
        var e = Date.now(),
          t = e - this.lastTimestamp;
        this.isPlaying() !== !1 &&
          (requestAnimationFrame(this._dispatchTimeupdate.bind(this)),
          t < this.interval ||
            ((this.lastTimestamp = e - (t % this.interval)),
            this.dispatch("timeupdate", {
              currentTime: this.video.currentTime,
            })));
      },
      _checkBoundaries: function (e, t) {
        if (void 0 === e || null === e || void 0 === t || null === t)
          throw new Error(
            "FragmentPlayer: start time and end time should be defined and not null"
          );
        if (e > t)
          throw new Error(
            "FragmentPlayer: start time must be less than end time"
          );
      },
      _onTimeupdate: function () {
        var e = this.video.currentTime < this.start,
          t = this.video.currentTime > this.end,
          n = e || t;
        (this.currentTime = this.video.currentTime),
          n && this.setCurrentTime(this.start);
      },
      _onEnded: function () {
        this.setCurrentTime(this.start), this.play();
      },
      destroy: function () {
        this.video.removeEventListener("timeupdate", this._timeupdateListener),
          this.video.removeEventListener("ended", this._endedListener);
        for (var e in this) this.hasOwnProperty(e) && (this[e] = null);
      },
      pause: function () {
        this.video.removeEventListener("ended", this._endedListener),
          this.video.pause(),
          this.dispatch("pause");
      },
      play: function () {
        this.video.addEventListener("ended", this._endedListener),
          this.video.play(),
          this.dispatch("play"),
          this._dispatchTimeupdate();
      },
      setBoundaries: function (e, t) {
        this._checkBoundaries(e, t), (this.start = e), (this.end = t);
      },
      setCurrentTime: function (e) {
        this.video.currentTime = e;
      },
      setMute: function (e) {
        if ("boolean" != typeof e)
          throw new Error(
            "FragmentPlayer: setMute parameter must be a boolean value"
          );
        this.video.muted = e;
      },
      setVideo: function (e) {
        if (!e) throw new Error("FragmentPlayer: video not provided");
        (this.video = e), this.setCurrentTime(this.start);
      },
      isPlaying: function () {
        return this.video ? !this.video.paused : !1;
      },
    },
  }),
  Class(UI, "RangeButtons").inherits(Widget).includes(GenericDestroySupport)({
    html: '<div class="range-buttons">              <div data-range="decrease">                  <button class="range-button decrease"></button>              </div>              <div data-range="increase">                  <button class="range-button increase"></button>              </div>              <div data-range="reset">                  <button class="range-button reset">Reset</button>              </div>            </div>',
    prototype: {
      max: 1 / 0,
      min: 0,
      value: 0,
      step: 1,
      initialValue: 0,
      allowReset: !0,
      fractionDigits: 2,
      init: function (e) {
        Widget.prototype.init.call(this, e);
        var t = this;
        (t.initialValue = t.value),
          (t.$resetButton = t.element.find('[data-range="reset"]')),
          (t.$increaseButton = t.element.find('[data-range="increase"]')),
          (t.$decreaseButton = t.element.find('[data-range="decrease"]')),
          (t.actions = {
            increase: t.increase,
            decrease: t.decrease,
            reset: t.reset,
          }),
          t.allowReset === !1 && t.$resetButton.hide(),
          t.element.find("div").on("click", t._onButtonClick.bind(t));
      },
      _capValue: function (e) {
        return (
          e > this.max && (e = this.max), e < this.min && (e = this.min), e
        );
      },
      _onButtonClick: function (e) {
        var t = $(e.target).data("range");
        this.actions[t].call(this);
      },
      _setButtonsState: function () {
        this.getValue() >= this.max
          ? this.disableButton(this.$increaseButton)
          : this.enableButton(this.$increaseButton),
          this.getValue() <= this.min
            ? this.disableButton(this.$decreaseButton)
            : this.enableButton(this.$decreaseButton);
      },
      setValue: function (e) {
        (this.value = this._capValue(+e).toFixed(this.fractionDigits)),
          this._setButtonsState();
      },
      getValue: function () {
        return +this.value;
      },
      reset: function () {
        this.setValue(this.initialValue),
          this.dispatch("reset", {
            value: this.getValue(),
          });
      },
      increase: function () {
        this.setValue(this.getValue() + this.step),
          this.dispatch("change", {
            value: this.value,
          });
      },
      decrease: function () {
        this.setValue(this.getValue() - this.step),
          this.dispatch("change", {
            value: this.value,
          });
      },
      destroy: function () {
        this.genericDestroy();
      },
      enableButton: function (e) {
        e instanceof window.jQuery != !1 &&
          e.attr("disabled", !1).removeClass("disabled");
      },
      disableButton: function (e) {
        e instanceof window.jQuery != !1 &&
          e.attr("disabled", !0).addClass("disabled");
      },
    },
  }),
  Class(UI, "SeekableTimeline")
    .inherits(Widget)
    .includes(GenericDestroySupport)({
    html: '<div class="seekable-timeline">                <div class= "fragment-wrapper" >                    <div class="fragment">                        <div class="indicator-wrapper">                            <div class="indicator">                                <span class="tip"></span>                            </div>                        </div>                    </div>                </div>            </div >',
    MINIMUM_THUMBS_TO_SHOW: 6,
    SIMULATE_CLICK_MS_TRESHOLD: 100,
    SIMULATE_CLICK_PX_TRESHOLD: 5,
    MIN_RESIZABLE_SIZE_FOR_TIME_TO_SHOW: 45,
    prototype: {
      $fragment: null,
      $fragmentWrapper: null,
      $indicator: null,
      $indicatorWrapper: null,
      $totalDuration: null,
      dragging: !1,
      end: 0,
      forceContainerWidth: 0,
      fragmentHeightBeforeResizing: 0,
      fragmentLength: 0,
      fragmentPercent: 0,
      fragmentWidthBeforeResizing: 0,
      indicatorOffsetPositionBeforeResizing: 0,
      minLength: "0",
      _minLengthInPixels: 0,
      resizing: !1,
      start: 0,
      timelineHeight: 0,
      timelineWidth: 0,
      init: function (e) {
        Widget.prototype.init.call(this, e);
        var t = this;
        (this.fragmentLength = this.end - this.start),
          this.fragmentLength > this.totalLength &&
            ((this.start = 0),
            (this.end = this.fragmentLength = this.totalLength)),
          (this.fragmentPercent =
            (100 * this.fragmentLength) / this.totalLength),
          (this.$fragment = t.element.find(".fragment")),
          (this.$fragmentWrapper = t.element.find(".fragment-wrapper")),
          (this.$indicator = t.element.find(".indicator")),
          (this.$indicatorWrapper = t.element.find(".indicator-wrapper")),
          this.forceContainerWidth &&
            this.element.css("width", this.forceContainerWidth),
          this.resizable &&
            (this._makeFragmentResizable(),
            this.element.addClass("is-resizable"),
            this._showFragmentLengthOnTooltip(),
            (this.$totalDuration = $(
              '<span class="total-duration">' +
                this._getHumanReadableStringFromSeconds(this.totalLength) +
                "</span>"
            )),
            this.element.append(this.$totalDuration)),
          this.$fragment.draggable({
            axis: "x",
            containment: ".seekable-timeline",
            scroll: !1,
            start: t._onStart.bind(t),
            drag: t._onDrag.bind(t),
            stop: t._onStop.bind(t),
            cursor: "grabbing",
          }),
          this.$indicator.draggable({
            axis: "x",
            containment: ".indicator-wrapper",
            scroll: !1,
            start: t._onStart.bind(t),
            drag: t._onIndicatorDrag.bind(t),
            stop: t._onStop.bind(t),
            cursor: "ew-resize",
          }),
          this.bind("render", t._onRender),
          this.$fragment.on("click", t._onFragmentClick.bind(t)),
          this._simulateClickEventForFragmentOnMobile();
      },
      _makeFragmentResizable: function () {
        this.$fragment.resizable({
          handles: "e,w",
          resize: this._onResize.bind(this),
          stop: this._onResizeStop.bind(this),
          start: this._onResizeStart.bind(this),
        });
      },
      _calculateMinWidthInPixels: function () {
        return "%" === this.minLength[this.minLength.length - 1]
          ? void (this._minLengthInPixels = Math.max(
              Math.round(
                (parseFloat(this.minLength) * this.timelineWidth) / 100
              ),
              this.constructor.MIN_RESIZABLE_SIZE_FOR_TIME_TO_SHOW
            ))
          : void (this._minLengthInPixels = Math.max(
              Math.round(
                (parseFloat(this.minLength) / this.totalLength) *
                  this.timelineWidth -
                  2 * this._getFragmentBorderWidth()
              ),
              this.constructor.MIN_RESIZABLE_SIZE_FOR_TIME_TO_SHOW
            ));
      },
      _setMinWidthForResizableWidget: function () {
        this.$fragment.resizable("option", "minWidth", this._minLengthInPixels);
      },
      _onResize: function (e, t) {
        var n = $(e.target).data("ui-resizable").axis;
        this._keepResizableWithinBoundaries(t),
          this._forceSetBorderBoxSizes(t),
          this._updateFragmentValuesWhileResizing(t, n),
          this._handleIndicatorPositionWhileResizing(n),
          this._showFragmentLengthOnTooltip(),
          this.resizable && this._resizeTotalDurationElement();
      },
      _onResizeStop: function () {
        (this.resizing = !1),
          this.$indicator.removeClass("is-hidden"),
          this.setIndicatorPosition(this.start),
          this.dispatch("timeupdate", {
            currentTime: this.indicatorPosition,
          }),
          this.dispatch("change", {
            start: this.start,
            end: this.end,
          }),
          this.dispatch("resizeend");
      },
      _onResizeStart: function (e, t) {
        (this.fragmentHeightBeforeResizing = this.$fragment.outerHeight()),
          (this.fragmentWidthBeforeResizing = this.$fragment.outerWidth()),
          (this.indicatorOffsetPositionBeforeResizing =
            this.$indicator.offset().left),
          this._forceSetBorderBoxSizes(t),
          (this.resizing = !0),
          this.dispatch("resizestart");
      },
      _updateFragmentValuesWhileResizing: function (e, t) {
        (this.fragmentPercent = (e.size.width / this.timelineWidth) * 100),
          (this.fragmentLength =
            this.totalLength * (this.fragmentPercent / 100)),
          "w" === t
            ? (this.start = Math.max(
                0,
                +(
                  (this.$fragment.position().left / this.timelineWidth) *
                  this.totalLength
                ).toFixed(2)
              ))
            : (this.end = Math.min(
                +(this.start + this.fragmentLength).toFixed(2),
                this.totalLength
              ));
      },
      _handleIndicatorPositionWhileResizing: function (e) {
        this.$indicator.addClass("is-hidden"),
          this.setIndicatorPosition("w" === e ? this.start : this.end),
          this.dispatch("timeupdate", {
            currentTime: this.indicatorPosition,
          });
      },
      _keepResizableWithinBoundaries: function (e) {
        e.position.left + e.size.width + 2 * this._getFragmentBorderWidth() >=
          this.timelineWidth &&
          (e.size.width =
            this.timelineWidth -
            e.position.left -
            2 * this._getFragmentBorderWidth()),
          e.position.left <= 0 &&
            ((e.size.width += e.position.left), (e.position.left = 0));
      },
      _forceSetBorderBoxSizes: function (e) {
        (e.size.height = this.fragmentHeightBeforeResizing),
          (e.size.width +=
            this.fragmentWidthBeforeResizing - e.originalSize.width);
      },
      _showFragmentLengthOnTooltip: function () {
        this.$indicatorWrapper.attr(
          "data-fragment-length",
          this._getHumanReadableStringFromSeconds(
            +this.fragmentLength.toFixed(2)
          )
        );
      },
      _getHumanReadableStringFromSeconds: function (e) {
        var t = new Date(1e3 * e),
          n = t.getUTCMinutes(),
          i = t.getSeconds();
        return (
          n.toString().padStart(2, "0") + ":" + i.toString().padStart(2, "0")
        );
      },
      _simulateClickEventForFragmentOnMobile: function () {
        function e(e) {
          var t = e.timeStamp - i > n.constructor.SIMULATE_CLICK_MS_TRESHOLD,
            s =
              Math.abs(e.originalEvent.changedTouches[0].clientX - r) >
              n.constructor.SIMULATE_CLICK_PX_TRESHOLD;
          t ||
            s ||
            n.$fragment[0].dispatchEvent(
              new MouseEvent("click", {
                clientX: e.originalEvent.changedTouches[0].clientX,
              })
            );
        }
        function t(t) {
          (i = t.timeStamp),
            (r = t.originalEvent.changedTouches[0].clientX),
            n.$fragment.one("touchend touchcancel", e);
        }
        var n = this,
          i = null,
          r = null;
        n.$fragment.on("touchstart", t);
      },
      _onFragmentClick: function (e) {
        this.$indicator.css(
          "left",
          this._leftPositionToCenterIndicatorAt(e.clientX)
        ),
          this._updateIndicator();
      },
      _onStop: function () {
        (this.dragging = !1), this.dispatch("dragend");
      },
      _onStart: function () {
        (this.dragging = !0), this.dispatch("dragstart");
      },
      _onRender: function () {
        var e = this,
          t = function n() {
            return 0 === e.element.width() && 0 === e.element.height()
              ? window.requestAnimationFrame(n)
              : (e._measureTimelineSize(),
                e._renderThumbnailsAsBackground(),
                e._setFragmentWidth(),
                e.setFragmentPosition(e.start),
                e.setIndicatorPosition(e.start),
                void (
                  e.resizable &&
                  (e._calculateMinWidthInPixels(),
                  e._setMinWidthForResizableWidget(),
                  e._resizeTotalDurationElement())
                ));
          };
        t();
      },
      _elementLocalPositionInPercentage: function (e) {
        return (
          e.position().left / (e.parent().outerWidth() - e.outerWidth()) || 0
        );
      },
      _getFragmentBorderWidth: function () {
        return (this.$fragment.outerWidth() - this.$fragment.innerWidth()) / 2;
      },
      _onDrag: function () {
        this._updateFragment(),
          this._updateIndicator(),
          this.resizable && this._resizeTotalDurationElement();
      },
      _resizeTotalDurationElement: function () {
        this.$totalDuration.width(
          this.timelineWidth -
            (this.$fragment.outerWidth() + this.$fragment.position().left)
        );
      },
      _updateFragment: function () {
        (this.start = +(
          (this.totalLength - this.fragmentLength) *
          this._elementLocalPositionInPercentage(this.$fragment)
        ).toFixed(2)),
          (this.end = +(this.start + this.fragmentLength).toFixed(2)),
          this.dispatch("change", {
            start: this.start,
            end: this.end,
          });
      },
      _updateIndicator: function () {
        this.setIndicatorPosition(
          +(
            this.start +
            this.fragmentLength *
              this._elementLocalPositionInPercentage(this.$indicator)
          ).toFixed(2)
        ),
          this.dispatch("timeupdate", {
            currentTime: this.indicatorPosition,
          });
      },
      _computeOnIndicatorDragValues: function (e) {
        var t = e.clientX - this.element.offset().left,
          n = this.timelineWidth - this.$fragment.outerWidth();
        return {
          cursorIsToTheLeftOfFragment:
            t - this._getFragmentBorderWidth() <=
            this.$fragment.position().left,
          fragmentPositionIfPushedLeft: Math.max(
            t - this._getFragmentBorderWidth(),
            0
          ),
          cursorIsToTheRightOfFragment:
            t >=
            this.$fragment.position().left +
              this.$fragment.width() +
              this._getFragmentBorderWidth(),
          fragmentPositionIfPushedRight: Math.min(
            t - this.$fragment.width() - this._getFragmentBorderWidth(),
            n
          ),
        };
      },
      _onIndicatorDrag: function (e, t) {
        var n = this._computeOnIndicatorDragValues(e),
          i = null;
        n.cursorIsToTheLeftOfFragment
          ? (i = n.fragmentPositionIfPushedLeft)
          : n.cursorIsToTheRightOfFragment &&
            (i = n.fragmentPositionIfPushedRight),
          null !== i && (this.$fragment.css("left", i), this._updateFragment()),
          (t.position.left = this._leftPositionToCenterIndicatorAt(e.clientX)),
          this._updateIndicator(),
          this.resizable && this._resizeTotalDurationElement();
      },
      _leftPositionToCenterIndicatorAt: function (e) {
        var t =
            e - this.$fragment.offset().left - this._getFragmentBorderWidth(),
          n = 0,
          i = this.$indicatorWrapper.outerWidth() - this.$indicator.width();
        return Helpers.App.clamp(t, n, i);
      },
      _measureTimelineSize: function () {
        (this.timelineHeight = this.$fragmentWrapper.innerHeight()),
          (this.timelineWidth = this.$fragmentWrapper.innerWidth());
      },
      _numberOfThumbsThatFit: function () {
        var e = (this.videoWidth * this.timelineHeight) / this.videoHeight;
        return Math.max(
          this.timelineWidth / e,
          this.constructor.MINIMUM_THUMBS_TO_SHOW
        );
      },
      _pickThumbnailsToBeRendered: function () {
        for (
          var e = [],
            t = 1 / Math.ceil(this._numberOfThumbsThatFit() - 1),
            n = 0;
          n < Math.ceil(this._numberOfThumbsThatFit());
          n++
        ) {
          var i = Math.round((this.thumbs.length - 1) * t * n);
          e.push(this.thumbs[i]);
        }
        return e;
      },
      _buildBackgroundCssPropertyString: function (e) {
        var t = this;
        return e
          .map(function (e, n) {
            var i =
              n * (t.timelineWidth / Math.ceil(t._numberOfThumbsThatFit()));
            return "url({{url}}) {{position}}px center/contain no-repeat"
              .replace("{{url}}", e)
              .replace("{{position}}", i);
          })
          .reverse()
          .join(",");
      },
      _renderThumbnailsAsBackground: function () {
        this.$fragmentWrapper.css({
          background: this._buildBackgroundCssPropertyString(
            this._pickThumbnailsToBeRendered()
          ),
        });
      },
      setFragmentPosition: function (e) {
        var t, n;
        (this.start = e),
          (this.end = this.start + this.fragmentLength),
          (t = (this.start / (this.totalLength - this.fragmentLength)).toFixed(
            2
          )),
          (n = Math.round(
            (this.timelineWidth - this._calculateFragmentWidth()) * t
          )),
          this.$fragment.css({
            left: n + "px",
          });
      },
      getFragmentPosition: function () {
        return {
          start: this.start,
          end: this.end,
        };
      },
      _setFragmentWidth: function () {
        this.$fragment.css({
          width: this.fragmentPercent + "%",
        });
      },
      _calculateFragmentWidth: function () {
        return this.timelineWidth * (this.fragmentPercent / 100);
      },
      setIndicatorPosition: function (e) {
        var t = (e - this.start) / this.fragmentLength,
          n =
            this.$indicatorWrapper.outerWidth() - this.$indicator.outerWidth(),
          i = Math.round(n * t);
        (this.indicatorPosition = e),
          this.dragging ||
            this.resizing ||
            this.$indicator.css({
              left: i,
            });
      },
      destroy: function () {
        this.genericDestroy();
      },
    },
  });
